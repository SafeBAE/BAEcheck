<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BAE Check — Reflection & Accountability</title>
  <style>
    :root{
      /* SafeBAE palette */
      --sb-light:#D1FEFF;
      --sb-teal:#13848F;
      --sb-mint:#15FFC8;
      --sb-deep:#1D414E;

      /* App tokens */
      --bg: var(--sb-deep);
      --text: var(--sb-light);
      --muted: rgba(209,254,255,.78);
      --border: rgba(209,254,255,.18);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --accent: var(--sb-mint);
      --danger: var(--sb-teal);
    }

/* ----------- NEW ALCOHOL STYLES ----------- */
.alcoholRow{
  display:flex;
  align-items:flex-start;
  gap:14px;
}

.alcoholIcon{
  width:64px;   /* slightly larger */
  min-width:64px;
  height:auto;
  margin-top:2px;
}

    *{box-sizing:border-box}
    /* Prevent iOS zoom on input focus */
    input, select, textarea { font-size: 16px; }
    /* Remove tap highlight globally for touch devices */
    button, a, [role="button"], summary { -webkit-tap-highlight-color: transparent; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
                  radial-gradient(1200px 800px at 20% 10%, rgba(21,255,200,.18), transparent 55%),
                  radial-gradient(1000px 700px at 90% 20%, rgba(19,132,143,.22), transparent 60%),
                  radial-gradient(900px 600px at 40% 100%, rgba(209,254,255,.10), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding: 28px 14px 60px;
      transition: background 600ms ease;
    }
    .app{ width: min(540px, 100%); }
    .topbar{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
    .brand { display:flex; align-items:center; gap:10px; }

    .logo svg{ width:26px; height:36px; transform-origin: 50% 100%; animation: grow 7s ease-in-out infinite; }
    @keyframes grow {
      0%   { transform: scale(0.88) translateY(4px); opacity: .85; }
      50%  { transform: scale(1.00) translateY(0px); opacity: 1; }
      100% { transform: scale(0.92) translateY(2px); opacity: .92; }
    }
    .brand .title{ font-weight: 900; font-size: 16px; }
    .neon-underline{
      position: relative;
      display: inline-block;
    }
    .neon-underline::after{
      content:"";
      position:absolute;
      left:0;
      bottom:-3px;
      width:100%;
      height:3px;
      background:#15FFC8;
      box-shadow:0 0 6px #15FFC8, 0 0 12px #15FFC8;
      border-radius:2px;
    }
    .brand .subtitle{ font-size:12px; color: var(--muted); margin-top:2px; }
    .topActions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .btn{
      appearance:none; border:none;
      padding: 12px 14px;
      border-radius: 12px;
      font-weight: 800;
      cursor:pointer;
      background: rgba(255,255,255,.06);
      color: var(--text);
      border: 1px solid var(--border);
      transition: transform .06s ease, background .15s ease;
      text-align:left;
      width:100%;
    }
    .btn:hover{
      background: rgba(21,255,200,.18); /* mint glow */
      border: 1px solid rgba(21,255,200,.65);
      box-shadow: 0 0 8px rgba(21,255,200,.35);
      color: var(--sb-light);
    }
    .btn:active{ transform: translateY(1px); }
    .btnSmall{ padding:10px 12px; border-radius: 999px; font-size: 12px; width:auto; }
    .btnPrimary{
      background: linear-gradient(135deg, rgba(21,255,200,.98), rgba(19,132,143,.85));
      color:#041114; border: 1px solid rgba(209,254,255,.24);
    }
    .btnDanger{
      background: rgba(19,132,143,.22);
      border: 1px solid rgba(21,255,200,.30);
      color: var(--sb-light);
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .h1{ font-size: 22px; margin:0 0 10px; font-weight: 900; line-height:1.2; }
    .p{ margin:0 0 12px; color: var(--muted); line-height:1.45; }
    .grid{ display:grid; gap:10px; margin-top: 12px;}
    .note{
      border-left: 3px solid rgba(21,255,200,.70);
      background: rgba(21,255,200,.10);
      padding: 10px 12px;
      border-radius: 12px;
      color: var(--sb-light);
      font-size: 13px;
      line-height:1.35;
      margin: 10px 0 14px;
    }
    .footer{ margin-top:12px; display:flex; justify-content:space-between; gap:10px; font-size:12px; color: var(--muted);}
    a.link{ color: var(--sb-mint); text-decoration:none; font-weight:800;}
    a.link:hover{ text-decoration:underline;}

    /* ===== POWER DYNAMICS MODULE ===== */
.pdIntro {
  background: rgba(21,255,200,.07);
  border: 1px solid rgba(21,255,200,.22);
  border-radius: 14px;
  padding: 14px 16px;
  font-size: 13px;
  line-height: 1.55;
  color: var(--sb-light);
  margin: 12px 0 16px;
}
.pdTypeGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 12px 0;
}
.pdTypeBtn {
  appearance: none; border: none;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(209,254,255,.18);
  border-radius: 14px;
  padding: 14px 12px;
  cursor: pointer;
  color: var(--text);
  text-align: left;
  transition: background .15s, border-color .15s, box-shadow .15s;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.pdTypeBtn:hover, .pdTypeBtn.selected {
  background: rgba(21,255,200,.14);
  border-color: rgba(21,255,200,.55);
  box-shadow: 0 0 10px rgba(21,255,200,.18);
}
.pdTypeBtn.selected { border-color: var(--sb-mint); }
.pdTypeIcon { font-size: 22px; }
.pdTypeLabel { font-size: 13px; font-weight: 900; line-height: 1.2; }
.pdTypeSub { font-size: 11px; color: rgba(209,254,255,.62); line-height: 1.3; }

.pdDetail {
  margin: 10px 0 14px;
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(209,254,255,.14);
  border-radius: 14px;
  overflow: hidden;
  animation: pageIn 280ms ease both;
}
.pdDetailHead {
  padding: 14px 16px 10px;
  border-bottom: 1px solid rgba(209,254,255,.10);
}
.pdDetailTitle { font-size: 15px; font-weight: 900; margin-bottom: 4px; }
.pdDetailSub { font-size: 12px; color: rgba(209,254,255,.65); line-height: 1.4; }
.pdScenarioList { padding: 12px 16px; display: flex; flex-direction: column; gap: 8px; }
.pdScenario {
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(209,254,255,.10);
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 12.5px;
  color: rgba(209,254,255,.82);
  line-height: 1.45;
  cursor: pointer;
  transition: background .12s, border-color .12s;
  position: relative;
  padding-left: 34px;
}
.pdScenario::before {
  content: attr(data-icon);
  position: absolute;
  left: 10px;
  top: 10px;
  font-size: 13px;
}
.pdScenario:hover {
  background: rgba(21,255,200,.09);
  border-color: rgba(21,255,200,.30);
}
.pdScenario.revealed {
  background: rgba(21,255,200,.08);
  border-color: rgba(21,255,200,.40);
}
.pdScenarioReframe {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid rgba(21,255,200,.18);
  color: var(--sb-mint);
  font-size: 12px;
  font-weight: 700;
  line-height: 1.4;
  display: none;
}
.pdScenario.revealed .pdScenarioReframe { display: block; }
.pdScText { font-size: 12.5px; color: rgba(209,254,255,.82); line-height: 1.45; }
.pdWarnBox {
  background: rgba(19,132,143,.18);
  border: 1px solid rgba(21,255,200,.28);
  border-radius: 12px;
  padding: 12px 14px;
  font-size: 13px;
  color: var(--sb-light);
  line-height: 1.5;
  margin: 10px 0 14px;
}
.pdWarnBox b { color: var(--sb-mint); }
.pdSpectrumBar {
  display: flex;
  gap: 4px;
  margin: 12px 0 6px;
  height: 8px;
  border-radius: 8px;
  overflow: hidden;
}
.pdSpectrumSeg {
  flex: 1;
  border-radius: 4px;
  transition: opacity .3s;
}
.pdSpectrumLabels {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: rgba(209,254,255,.50);
  margin-bottom: 12px;
}
.pdContinueWrap {
  margin-top: 16px;
}

/* ===== FRIEND PATHWAY ===== */
.fpHero {
  text-align: center;
  padding: 8px 0 16px;
}
.fpHeroIcon { font-size: 40px; margin-bottom: 8px; }
.fpHeroTitle { font-size: 19px; font-weight: 900; line-height: 1.25; margin-bottom: 6px; }
.fpHeroSub { font-size: 13px; color: rgba(209,254,255,.70); line-height: 1.45; }

.fpSituationGrid {
  display: grid;
  gap: 9px;
  margin: 12px 0 16px;
}
.fpSitBtn {
  appearance: none; border: none;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(209,254,255,.16);
  border-radius: 13px;
  padding: 13px 14px;
  cursor: pointer;
  color: var(--text);
  text-align: left;
  font-size: 13.5px;
  font-weight: 700;
  line-height: 1.3;
  transition: background .14s, border-color .14s, box-shadow .14s;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-family: inherit;
}
.fpSitBtn:hover {
  background: rgba(21,255,200,.12);
  border-color: rgba(21,255,200,.50);
  box-shadow: 0 0 8px rgba(21,255,200,.15);
}
.fpSitIcon { font-size: 18px; min-width: 22px; margin-top: 1px; }
.fpSitText { display: flex; flex-direction: column; gap: 2px; }
.fpSitSub { font-size: 11px; color: rgba(209,254,255,.55); font-weight: 600; margin-top: 2px; }

.fpStepHead {
  font-size: 10px;
  font-weight: 900;
  letter-spacing: .8px;
  text-transform: uppercase;
  color: var(--sb-mint);
  opacity: .85;
  margin-bottom: 8px;
}
.fpConvoCards {
  display: flex;
  flex-direction: column;
  gap: 9px;
  margin: 10px 0 14px;
}
.fpConvoCard {
  border-radius: 12px;
  border: 1px solid rgba(209,254,255,.14);
  overflow: hidden;
  cursor: pointer;
}
.fpConvoCardHead {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 11px 14px;
  background: rgba(255,255,255,.04);
  transition: background .12s;
  font-size: 13px;
  font-weight: 800;
  gap: 8px;
}
.fpConvoCard:hover .fpConvoCardHead { background: rgba(21,255,200,.09); }
.fpConvoCardTag {
  font-size: 10px;
  font-weight: 900;
  letter-spacing: .4px;
  text-transform: uppercase;
  border-radius: 999px;
  padding: 2px 8px;
  flex-shrink: 0;
}
.fpTagSay { background: rgba(21,255,200,.18); color: var(--sb-mint); }
.fpTagAvoid { background: rgba(19,132,143,.25); color: rgba(209,254,255,.75); }
.fpTagBoth { background: rgba(255,200,80,.14); color: rgba(255,220,100,.9); }
.fpConvoBody {
  padding: 0 14px;
  max-height: 0;
  overflow: hidden;
  transition: max-height .25s ease, padding .25s ease;
  font-size: 12.5px;
  color: rgba(209,254,255,.78);
  line-height: 1.55;
}
.fpConvoCard.open .fpConvoBody {
  padding: 10px 14px 14px;
  max-height: 400px;
}
.fpConvoChev {
  transition: transform .2s;
  opacity: .6;
  flex-shrink: 0;
}
.fpConvoCard.open .fpConvoChev { transform: rotate(180deg); }

.fpSignalList {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 12px 0 14px;
}
.fpSignal {
  display: flex;
  gap: 10px;
  align-items: flex-start;
  padding: 10px 12px;
  border-radius: 11px;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(209,254,255,.10);
  font-size: 12.5px;
  color: rgba(209,254,255,.82);
  line-height: 1.45;
}
.fpSignalIcon { font-size: 14px; min-width: 18px; margin-top: 1px; }

.fpBoundaryBox {
  background: rgba(19,132,143,.15);
  border: 1px solid rgba(21,255,200,.22);
  border-radius: 12px;
  padding: 14px 16px;
  font-size: 13px;
  line-height: 1.55;
  color: var(--sb-light);
  margin: 10px 0 14px;
}
.fpBoundaryBox h4 {
  margin: 0 0 8px;
  font-size: 13px;
  color: var(--sb-mint);
  font-weight: 900;
}

.fpEnablingList {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 10px 0 14px;
}
.fpEnabling {
  border-radius: 11px;
  border: 1px solid rgba(209,254,255,.12);
  overflow: hidden;
  cursor: pointer;
}
.fpEnablingHead {
  padding: 10px 14px;
  background: rgba(255,255,255,.04);
  font-size: 13px;
  font-weight: 800;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  transition: background .12s;
}
.fpEnabling:hover .fpEnablingHead { background: rgba(19,132,143,.15); }
.fpEnablingBody {
  padding: 0 14px;
  max-height: 0;
  overflow: hidden;
  transition: max-height .25s ease, padding .25s ease;
  font-size: 12.5px;
  color: rgba(209,254,255,.75);
  line-height: 1.5;
}
.fpEnabling.open .fpEnablingBody { padding: 10px 14px 14px; max-height: 300px; }
.fpEnabling.open .fpConvoChev { transform: rotate(180deg); }

.fpAffectedBox {
  background: rgba(0,0,0,.20);
  border: 1px solid rgba(209,254,255,.13);
  border-radius: 13px;
  padding: 14px 16px;
  margin: 10px 0 14px;
}
.fpAffectedBox h4 { margin: 0 0 10px; font-size: 13px; font-weight: 900; color: var(--sb-mint); }
.fpAffectedRow {
  display: flex;
  gap: 10px;
  align-items: flex-start;
  margin-bottom: 10px;
  font-size: 12.5px;
  color: rgba(209,254,255,.80);
  line-height: 1.45;
}
.fpAffectedRow:last-child { margin-bottom: 0; }
.fpAffectedRowIcon { font-size: 14px; min-width: 18px; margin-top: 1px; }

.fpDecisionTree {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 12px 0 16px;
}
.fpDecNode {
  border-radius: 12px;
  border: 1px solid rgba(209,254,255,.14);
  overflow: hidden;
}
.fpDecNodeHead {
  padding: 12px 14px;
  background: rgba(255,255,255,.05);
  font-size: 13px;
  font-weight: 800;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  transition: background .12s;
}
.fpDecNode:hover .fpDecNodeHead { background: rgba(21,255,200,.09); }
.fpDecNodeBody {
  padding: 0 14px;
  max-height: 0;
  overflow: hidden;
  transition: max-height .28s ease, padding .28s ease;
  font-size: 12.5px;
  color: rgba(209,254,255,.78);
  line-height: 1.5;
}
.fpDecNode.open .fpDecNodeBody { padding: 10px 14px 14px; max-height: 400px; }

/* ===== PAGE TRANSITION ===== */
    @keyframes pageIn {
      from { opacity: 0; transform: translateY(14px) scale(0.985); }
      to   { opacity: 1; transform: translateY(0)    scale(1); }
    }
    .pageTransition {
      animation: pageIn 320ms cubic-bezier(0.22, 1, 0.36, 1) both;
    }
    @media (prefers-reduced-motion: reduce) {
      .pageTransition { animation: none; }
    }

    /* ===== DIGITAL SAFETY TOOL ===== */
    .dsHeader {
      margin-bottom: 14px;
    }
    .dsEyebrow {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: .8px;
      text-transform: uppercase;
      color: var(--sb-mint);
      margin-bottom: 4px;
      opacity: .85;
    }
    .dsProgress {
      display: flex;
      gap: 5px;
      margin: 10px 0 14px;
    }
    .dsProgressDot {
      height: 4px;
      flex: 1;
      border-radius: 4px;
      background: rgba(255,255,255,.12);
      transition: background .3s ease;
    }
    .dsProgressDot.active {
      background: var(--sb-mint);
      box-shadow: 0 0 6px rgba(21,255,200,.5);
    }
    .dsProgressDot.done {
      background: rgba(21,255,200,.45);
    }
    .dsPanel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    /* Consent cards */
    .dsConsentGrid {
      display: grid;
      gap: 10px;
      margin: 10px 0;
    }
    .dsConsentCard {
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      cursor: pointer;
      transition: background .15s ease, border-color .15s ease;
      overflow: hidden;
    }
    .dsConsentCard.open {
      border-color: rgba(21,255,200,.45);
      background: rgba(21,255,200,.06);
    }
    .dsConsentHead {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      font-weight: 800;
      font-size: 14px;
      color: var(--sb-light);
    }
    .dsConsentEmoji { font-size: 18px; }
    .dsConsentChev {
      margin-left: auto;
      font-size: 12px;
      color: var(--muted);
      transition: transform .2s ease;
    }
    .dsConsentCard.open .dsConsentChev { transform: rotate(180deg); }
    .dsConsentBody {
      max-height: 0;
      overflow: hidden;
      transition: max-height .3s ease;
      font-size: 13.5px;
      color: var(--muted);
      line-height: 1.45;
      padding: 0 14px;
    }
    .dsConsentCard.open .dsConsentBody {
      max-height: 300px;
      padding: 0 14px 14px;
    }
    .dsConsentTag {
      display: inline-block;
      font-size: 10px;
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      padding: 2px 7px;
      border-radius: 99px;
      margin-bottom: 6px;
    }
    .dsConsentTag.yes { background: rgba(21,255,200,.18); color: #15FFC8; }
    .dsConsentTag.no  { background: rgba(19,132,143,.28); color: #D1FEFF; }
    /* Action steps */
    .dsStepList {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 10px 0;
    }
    .dsStep {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    .dsStepNum {
      width: 26px;
      min-width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(21,255,200,.15);
      border: 1px solid rgba(21,255,200,.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 900;
      color: var(--sb-mint);
    }
    .dsStepText { flex: 1; font-size: 13.5px; color: var(--muted); line-height: 1.4; }
    .dsStepText b { color: var(--sb-light); }
    /* Script builder */
    .dsScriptBlock {
      border-radius: 14px;
      border: 1px solid rgba(21,255,200,.25);
      background: rgba(21,255,200,.06);
      padding: 14px;
      margin: 10px 0;
    }
    .dsScriptLabel {
      font-size: 11px;
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: var(--sb-mint);
      margin-bottom: 6px;
    }
    .dsScriptText {
      font-size: 14px;
      color: var(--sb-light);
      line-height: 1.5;
      font-style: italic;
    }
    .dsScriptSwitcher {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 10px 0;
    }
    .dsScriptChip {
      appearance: none;
      border: 1px solid var(--border);
      border-radius: 99px;
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
      padding: 6px 12px;
      cursor: pointer;
      transition: all .15s ease;
    }
    .dsScriptChip.on {
      background: rgba(21,255,200,.15);
      border-color: rgba(21,255,200,.55);
      color: var(--sb-mint);
    }
    .dsScriptChip:hover { background: rgba(21,255,200,.1); border-color: rgba(21,255,200,.35); }
    /* Resources */
    .dsResourceList { display: flex; flex-direction: column; gap: 8px; margin: 10px 0; }
    .dsResource {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      text-decoration: none;
      color: var(--sb-light);
      transition: background .15s ease, border-color .15s ease;
    }
    .dsResource:hover {
      background: rgba(21,255,200,.08);
      border-color: rgba(21,255,200,.3);
    }
    .dsResourceIcon { font-size: 20px; }
    .dsResourceName { font-weight: 800; font-size: 13.5px; margin-bottom: 2px; }
    .dsResourceDesc { font-size: 12px; color: var(--muted); line-height: 1.3; }
    .dsNavRow {
      display: flex;
      gap: 10px;
      margin-top: 6px;
    }
    .dsNavRow .btn { flex: 1; }
    /* Inline action link (reads like body text, not a button) */
    .inlineAction{
      color: var(--sb-mint);
      font-weight: 800;
      cursor: pointer;
      text-decoration: none;
    }
    .inlineAction:hover{ text-decoration: underline; }
    .btnBack{
      width:auto;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      color: var(--muted);
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      margin-bottom: 8px;
    }
    .btnBack:hover{ color: var(--text); background: rgba(255,255,255,.08); }
    .mutedBox{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed rgba(255,255,255,.18);
      color: var(--muted);
      font-size: 12px;
      line-height:1.35;
    }

    /* ===== MALE YOUTH MODULE ===== */
    .myPhraseGrid {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 8px 0;
    }
    .myPhrase {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(21,255,200,.25);
      background: rgba(21,255,200,.07);
      font-size: 13.5px;
      color: var(--sb-light);
      font-style: italic;
      line-height: 1.4;
    }
    .myQuizOpt {
      text-align: left;
      font-size: 13.5px;
      line-height: 1.4;
      padding: 11px 14px;
    }
    .myQuizOpt:disabled { cursor: default; opacity: .8; }
    .myQuizCorrect {
      background: rgba(21,255,200,.16) !important;
      border-color: rgba(21,255,200,.55) !important;
      color: #15FFC8 !important;
    }
    .myQuizWrong {
      background: rgba(255,80,80,.14) !important;
      border-color: rgba(255,80,80,.45) !important;
      color: #ff8080 !important;
    }

    /* Expandable exercise sections (Grounding page) */
    details.expando{
      border: 1px solid rgba(209,254,255,.14);
      background: rgba(0,0,0,.14);
      border-radius: 16px;
      overflow:hidden;
      margin-top: 12px;
    }
    details.expando summary{
      list-style:none;
      cursor:pointer;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      user-select:none;
      font-weight: 950;
      color: rgba(209,254,255,.92);
    }
    details.expando summary::-webkit-details-marker{ display:none; }
    details.expando summary .expandoMeta{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    details.expando summary .expandoTitle{
      font-size:12px;
      letter-spacing:.3px;
      text-transform:uppercase;
      font-weight: 950;
      color: rgba(209,254,255,.70);
      line-height:1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    details.expando summary .expandoSub{
      font-size:13px;
      color: rgba(209,254,255,.92);
      font-weight: 900;
      line-height:1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    details.expando summary .expandoArrow{
      flex:0 0 auto;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(209,254,255,.18);
      background: rgba(255,255,255,.04);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 14px;
      color: rgba(209,254,255,.80);
      transform: rotate(-90deg);
      transition: transform 180ms ease, background 180ms ease;
    }
    details.expando[open] summary{
      border-bottom: 1px solid rgba(209,254,255,.14);
      background: rgba(255,255,255,.03);
    }
    details.expando[open] summary .expandoArrow{
      transform: rotate(0deg);
      background: rgba(21,255,200,.08);
    }
    details.expando .expandoBody{
      padding: 14px;
    }



    /* Button content (icon + label) */
    .btnContent{ display:flex; align-items:center; gap:10px; }
    .btnIcon{ width:22px; text-align:center; font-size:18px; line-height:1; opacity:.95; }
    .btnLabel{ flex:1; }


    /* Breathing icon (anxious/panicking page) */
    .breatheWrap{
      margin: 10px 0 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(21,255,200,.28);
      background: rgba(21,255,200,.08);
    }
    .breathe{
      width: 150px;
      height: 150px;
      display:block;
      filter: drop-shadow(0 0 12px rgba(21,255,200,.18));
    }

    /* Animation layers */
    .breatheCore{
      transform-origin: 50% 50%;
      animation: breathe 10s ease-in-out infinite; /* 4s in, 6s out */
    }
    .breatheRing{
      transform-origin: 50% 50%;
      animation: breatheRing 10s ease-in-out infinite;
      opacity: .62;
    }
    .breatheHalo{
      transform-origin: 50% 50%;
      animation: halo 10s ease-in-out infinite;
      opacity: .30;
    }
    .breatheDot{
      transform-origin: 50% 50%;
      animation: dot 10s ease-in-out infinite;
      opacity: .9;
    }

    /* 0%→40% = inhale (4s) | 40%→100% = exhale (6s) */
    @keyframes breathe{
      0%   { transform: scale(0.86); opacity: .78; }
      40%  { transform: scale(1.00); opacity: 1; }
      100% { transform: scale(0.86); opacity: .82; }
    }
    @keyframes breatheRing{
      0%   { transform: scale(0.92); opacity: .30; }
      40%  { transform: scale(1.12); opacity: .62; }
      100% { transform: scale(0.92); opacity: .30; }
    }
    @keyframes halo{
      0%   { transform: scale(0.98); opacity: .18; }
      40%  { transform: scale(1.22); opacity: .34; }
      100% { transform: scale(0.98); opacity: .18; }
    }
    @keyframes dot{
      0%   { transform: scale(0.92); opacity: .70; }
      40%  { transform: scale(1.08); opacity: .95; }
      100% { transform: scale(0.92); opacity: .75; }
    }

    @media (prefers-reduced-motion: reduce){
      .breatheCore, .breatheRing, .breatheHalo, .breatheDot{ animation: none; }
    }
    /* Paused state — applied until user presses Start */
    .breatheWrap.paused .breatheCore,
    .breatheWrap.paused .breatheRing,
    .breatheWrap.paused .breatheHalo,
    .breatheWrap.paused .breatheDot {
      animation-play-state: paused;
    }



/* Modal */
.modalOverlay{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,.92);   /* much darker backdrop */
  backdrop-filter: none;        /* remove blur for clarity */
  z-index: 9999;
}

.modal{
  width: min(520px, 100%);
  border-radius: 18px;
  border: 1px solid var(--border);
  background: var(--sb-deep);   /* fully solid background */
  box-shadow: 0 25px 70px rgba(0,0,0,.7);
  padding: 24px;
}

.modalHeader{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.modalTitle{
  font-weight: 950;
  font-size: 18px;              /* slightly larger for clarity */
}

.modalClose{
  width: auto;
  padding: 8px 10px;
  border-radius: 999px;
  font-size: 12px;
}

.modalActions{
  display:flex;
  gap:10px;
  margin-top: 18px;
}

  
/* ===== Fog Feature (Confused emotion) ===== */
.fogOverlay{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:5;
  border-radius: var(--radius);
}
.fogLayer{
  position:absolute;
  inset:-20%;
  opacity:.88;
  filter: blur(22px);
  transform: scale(1.05);
}
.fogLayer::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(200px 140px at 20% 30%, rgba(209,254,255,.62), transparent 60%),
    radial-gradient(280px 210px at 72% 40%, rgba(209,254,255,.42), transparent 66%),
    radial-gradient(240px 180px at 42% 76%, rgba(21,255,200,.26), transparent 70%),
    radial-gradient(360px 260px at 32% 92%, rgba(19,132,143,.18), transparent 72%);
}
.fog1{ animation: fogDrift1 5.2s ease-out forwards; }
.fog2{ animation: fogDrift2 5.8s ease-out forwards; opacity:.72; filter: blur(26px); }
.fog3{ animation: fogDrift3 6.3s ease-out forwards; opacity:.60; filter: blur(30px); }

@keyframes fogDrift1{
  0%   { opacity:.88; transform: translate3d(0,0,0) scale(1.06); }
  70%  { opacity:.36; transform: translate3d(20px,-12px,0) scale(1.08); }
  100% { opacity:0; transform: translate3d(44px,-22px,0) scale(1.10); }
}
@keyframes fogDrift2{
  0%   { opacity:.72; transform: translate3d(0,0,0) scale(1.08); }
  70%  { opacity:.30; transform: translate3d(-18px,10px,0) scale(1.10); }
  100% { opacity:0; transform: translate3d(-38px,18px,0) scale(1.12); }
}
@keyframes fogDrift3{
  0%   { opacity:.60; transform: translate3d(0,0,0) scale(1.10); }
  70%  { opacity:.24; transform: translate3d(10px,18px,0) scale(1.12); }
  100% { opacity:0; transform: translate3d(26px,36px,0) scale(1.14); }
}
@media (prefers-reduced-motion: reduce){
  .fogLayer{ animation:none !important; opacity:0 !important; }
}


  

/* ===== Spiral Interrupt (Ashamed) ===== */
/* Container */
.siWrap .wrap{
  width:min(520px, 94vw);
}
/* Collapsible "box" */
.siWrap .panel{
  border-radius: var(--radius);
  border:1px solid var(--border);
  background: rgba(21,255,200,.06);
  box-shadow: var(--shadow);
  overflow:hidden;
}
/* Clickable header */
.siWrap .panelHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:16px 18px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}.siWrap .panelHeader:focus-visible{
  outline:none;
  box-shadow: 0 0 0 3px rgba(21,255,200,.32);
}.siWrap .titleBlock{
  display:flex;
  flex-direction:column;
  gap:2px;
  min-width:0;
}.siWrap .panelTitle{
  font-size:15px;
  font-weight:750;
  letter-spacing:.2px;
}.siWrap .panelSub{
  font-size:12px;
  color: var(--muted);
  line-height:1.3;
}.siWrap .chev{
  width:34px;
  height:34px;
  border-radius:999px;
  display:grid;
  place-items:center;
  border:1px solid rgba(209,254,255,.16);
  background: rgba(0,0,0,.12);
  transition: transform .18s ease, background .18s ease, border-color .18s ease;
  flex: 0 0 auto;
}.siWrap .panel.open .chev{
  transform: rotate(180deg);
  background: rgba(0,0,0,.18);
  border-color: rgba(21,255,200,.24);
}
/* Content area */
.siWrap .panelBody{
  max-height:0;
  opacity:0;
  transform: translateY(-6px);
  transition: max-height .28s ease, opacity .22s ease, transform .22s ease;
}.siWrap .panel.open .panelBody{
  max-height: 520px;
  opacity:1;
  transform: translateY(0);
}.siWrap .inner{
  padding: 0 18px 18px 18px;
}.siWrap .note{
  font-size:13px;
  color: var(--muted);
  margin: 6px 0 14px 0;
  line-height:1.35;
}.siWrap .pill{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid rgba(209,254,255,.18);
  background:rgba(0,0,0,.18);
  font-size:11px;
  opacity:.92;
  margin-left:8px;
}.siWrap .spiralStage{
  margin: 8px auto 10px auto;
  width: 220px;
  height: 220px;
  border-radius: 18px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}.siWrap .spiralStage:focus-visible{
  outline:none;
  box-shadow: 0 0 0 3px rgba(21,255,200,.32);
}.siWrap #spiral{
  width: 190px;
  height: 190px;
  transform-origin: 50% 50%;
  filter: drop-shadow(0 0 14px rgba(21,255,200,.12));
}.siWrap .msg{
  text-align:center;
  font-size:14px;
  line-height:1.45;
  min-height: 44px;
  margin-top: 6px;
}.siWrap .actionsRow{
  display:flex;
  justify-content:center;
  margin-top:12px;
}.siWrap .linkBtn{
  appearance:none;
  border:none;
  background:transparent;
  color: rgba(209,254,255,.92);
  font-weight:650;
  font-size:13px;
  cursor:pointer;
  padding:8px 10px;
  border-radius:999px;
  transition: background .15s ease;
}.siWrap .linkBtn:hover{
  background: rgba(209,254,255,.08);
}.siWrap .footer{
  margin-top:10px;
  font-size:12px;
  opacity:.62;
  text-align:center;
}

/* Reduced motion: keep transitions but avoid “extra” animations */

@media (prefers-reduced-motion: reduce){
  .siWrap .panelBody{ transition: max-height .01s linear, opacity .01s linear, transform .01s linear; }
  .siWrap .chev{ transition: transform .01s linear; }
}


/* ===== Brick Wall Reveal (Defensive) ===== */
.bwWrap{ margin-top:14px; }
.bwWrap .panel{
  border-radius: var(--radius);
  border:1px solid var(--border);
  background: rgba(21,255,200,.06);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.bwWrap .panelHeader{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:16px 18px; cursor:pointer;
  user-select:none; -webkit-tap-highlight-color: transparent;
}
.bwWrap .panelHeader:focus-visible{
  outline:none; box-shadow: 0 0 0 3px rgba(21,255,200,.32);
}
.bwWrap .titleBlock{ display:flex; flex-direction:column; gap:2px; min-width:0; }
.bwWrap .panelTitle{ font-size:15px; font-weight:750; letter-spacing:.2px; }
.bwWrap .panelSub{ font-size:12px; color: var(--muted); line-height:1.3; }
.bwWrap .chev{
  width:34px; height:34px; border-radius:999px;
  display:grid; place-items:center;
  border:1px solid rgba(209,254,255,.16);
  background: rgba(0,0,0,.12);
  transition: transform .18s ease, background .18s ease, border-color .18s ease;
  flex: 0 0 auto;
}
.bwWrap .panel.open .chev{
  transform: rotate(180deg); background: rgba(0,0,0,.18);
  border-color: rgba(21,255,200,.24);
}
.bwWrap .panelBody{
  max-height:0; opacity:0; transform: translateY(-6px);
  transition: max-height .30s ease, opacity .24s ease, transform .24s ease;
}
.bwWrap .panel.open .panelBody{
  max-height:640px; opacity:1; transform: translateY(0);
}
.bwWrap .inner{ padding: 0 16px 18px 16px; }
.bwLayout{
  display:grid; grid-template-columns: 1.25fr .75fr;
  gap:12px; align-items:start; margin-top:12px;
}
@media (max-width:540px){ .bwLayout{ grid-template-columns: 1fr; } }
.bwWall{
  position:relative; width:100%; height:240px;
  border-radius:14px; border:1px solid rgba(209,254,255,.14);
  background:rgba(0,0,0,.22); overflow:hidden;
}
.bwMessage{
  position:absolute; inset:0; display:flex;
  align-items:center; justify-content:center;
  padding:18px; text-align:center;
  opacity: var(--bw-reveal, 0);
  filter: blur(var(--bw-blur, 10px));
  transition: opacity .18s ease, filter .18s ease;
}
.bwMessageInner{ max-width:360px; font-size:14px; line-height:1.45; }
.bwMessageInner .small{
  display:block; margin-top:10px; font-size:12px; color: var(--muted);
}
.bwBricks{
  position:absolute; inset:0;
  display:grid; grid-template-columns: repeat(3,1fr);
  grid-template-rows: repeat(3,1fr);
  gap:7px; padding:9px;
}
.bwBrick{
  background: #7A3E2B; border-radius:7px; cursor:grab;
  box-shadow: 0 6px 16px rgba(0,0,0,.35);
  border:1px solid rgba(0,0,0,.18);
  transition: background .2s, box-shadow .2s, transform .1s;
}
.bwBrick:active{ cursor:grabbing; transform:scale(1.04); }
.bwBrick:hover{
  background: #9E5238;
  box-shadow: 0 0 0 2px rgba(21,255,200,.4), 0 6px 16px rgba(0,0,0,.35);
}
.bwPile{
  border-radius:14px; border:1px dashed rgba(21,255,200,.45);
  background: rgba(21,255,200,.08); padding:12px;
  min-height:180px; display:flex; flex-direction:column; gap:8px;
}
.bwPileTitle{ font-weight:750; font-size:13px; }
.bwPileHint{ font-size:11px; color: var(--muted); }
.bwDropZone{
  flex:1; border-radius:12px;
  border:1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.16);
  display:flex; align-items:center; justify-content:center;
  text-align:center; padding:10px; font-size:11px; min-height:80px;
  transition: box-shadow .15s, background .15s;
}
.bwDropZone.dragOver{
  box-shadow: 0 0 0 3px rgba(21,255,200,.25);
  background: rgba(21,255,200,.10);
}
.bwProgress{
  font-size:11px; color: var(--muted);
  display:flex; justify-content:space-between; margin-top:8px;
}
.bwFooter{ margin-top:10px; text-align:center; font-size:11px; opacity:.60; }
@media (prefers-reduced-motion:reduce){
  .bwBrick{ transition:none; }
  .bwMessage{ transition:none; }
  .bwWrap .panelBody{ transition: max-height .01s linear, opacity .01s linear, transform .01s linear; }
}

/* ===== Next Right Move (Guilt) ===== */
.nrmWrap{
  margin-top:14px;
}
.nrmWrap .panel{
  border-radius: var(--radius);
  border:1px solid var(--border);
  background: rgba(21,255,200,.06);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.nrmWrap .panelHeader{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:16px 18px; cursor:pointer;
  user-select:none; -webkit-tap-highlight-color: transparent;
}
.nrmWrap .panelHeader:focus-visible{
  outline:none; box-shadow: 0 0 0 3px rgba(21,255,200,.32);
}
.nrmWrap .titleBlock{ display:flex; flex-direction:column; gap:2px; min-width:0; }
.nrmWrap .panelTitle{ font-size:15px; font-weight:750; letter-spacing:.2px; }
.nrmWrap .panelSub{ font-size:12px; color: var(--muted); line-height:1.3; }
.nrmWrap .chev{
  width:34px; height:34px; border-radius:999px;
  display:grid; place-items:center;
  border:1px solid rgba(209,254,255,.16);
  background: rgba(0,0,0,.12);
  transition: transform .18s ease, background .18s ease, border-color .18s ease;
  flex: 0 0 auto;
}
.nrmWrap .panel.open .chev{
  transform: rotate(180deg); background: rgba(0,0,0,.18);
  border-color: rgba(21,255,200,.24);
}
.nrmWrap .panelBody{
  max-height:0; opacity:0; transform: translateY(-6px);
  transition: max-height .30s ease, opacity .24s ease, transform .24s ease;
}
.nrmWrap .panel.open .panelBody{
  max-height:700px; opacity:1; transform: translateY(0);
}
.nrmWrap .inner{ padding: 0 18px 18px 18px; }
.nrmCard{
  border:1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.16);
  border-radius:16px;
  padding:18px;
  text-align:center;
}
.nrmPathWrap{
  margin: 10px auto 14px auto;
  padding: 14px 12px;
  border-radius: 16px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.14);
}
.nrmPath{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  position:relative;
  padding: 8px 6px;
}
.nrmLine{
  position:absolute;
  left:18px; right:18px; top:50%;
  height:2px;
  transform:translateY(-50%);
  background: rgba(209,254,255,.14);
  border-radius:999px;
  overflow:hidden;
}
.nrmLineFill{
  width:0%;
  height:100%;
  background: rgba(21,255,200,.65);
  transition: width .25s ease;
}
.nrmNode{
  width:34px; height:34px;
  border-radius:999px;
  border:1px solid rgba(209,254,255,.22);
  background: rgba(0,0,0,.12);
  display:grid; place-items:center;
  z-index:1; position:relative;
  transition: transform .12s ease, border-color .15s ease, background .15s ease;
  flex-shrink:0;
}
.nrmNode span{ font-size:12px; font-weight:800; color: rgba(209,254,255,.78); }
.nrmNode.active{
  border-color: rgba(21,255,200,.55);
  background: rgba(21,255,200,.10);
  transform: translateY(-1px);
}
.nrmNode.done{
  border-color: rgba(21,255,200,.60);
  background: rgba(21,255,200,.14);
}
.nrmNode.done span{ color: rgba(209,254,255,.94); }
.nrmMoveBox{
  border:1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.16);
  border-radius:14px;
  padding:16px;
  margin: 0 auto 12px auto;
  min-height:130px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:8px;
  text-align:left;
}
.nrmLabelRow{
  display:flex; justify-content:space-between; gap:10px;
  align-items:center; flex-wrap:wrap;
}
.nrmLabel{ font-size:12px; color: rgba(209,254,255,.70); letter-spacing:.2px; text-transform:uppercase; }
.nrmBadge{
  display:inline-flex; align-items:center; gap:8px;
  padding:4px 10px; border-radius:999px;
  border:1px solid rgba(209,254,255,.16);
  background: rgba(0,0,0,.14);
  font-size:12px; color: rgba(209,254,255,.82);
}
.nrmBadgeDot{ width:8px; height:8px; border-radius:999px; background: rgba(21,255,200,.75); }
.nrmMove{ font-size:19px; font-weight:900; letter-spacing:.2px; }
.nrmDesc{ font-size:13px; color: rgba(209,254,255,.88); line-height:1.45; }
.nrmChallenge{
  margin-top:8px; padding:10px 12px; border-radius:12px;
  border:1px solid rgba(21,255,200,.26);
  background: rgba(21,255,200,.08);
}
.nrmChallengeTitle{ font-size:11px; font-weight:900; letter-spacing:.2px; text-transform:uppercase; color: rgba(209,254,255,.86); margin-bottom:4px; }
.nrmChallengeText{ font-size:12px; color: rgba(209,254,255,.88); line-height:1.4; }
.nrmControls{
  display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:10px;
}
.nrmBtn{
  appearance:none;
  border:1px solid rgba(21,255,200,.38);
  background: rgba(21,255,200,.12);
  color: var(--sb-light);
  border-radius: 999px;
  padding: 10px 14px;
  cursor:pointer;
  font-weight:850;
  font-size:13px;
  letter-spacing:.2px;
  transition: transform .06s ease, background .15s ease, border-color .15s ease;
}
.nrmBtn:hover{ background: rgba(21,255,200,.18); border-color: rgba(21,255,200,.52); }
.nrmBtn:active{ transform: translateY(1px); }
.nrmBtnGhost{
  border-color: rgba(209,254,255,.22);
  background: rgba(209,254,255,.06);
  font-weight:750;
}
.nrmBtnGhost:hover{ background: rgba(209,254,255,.09); border-color: rgba(209,254,255,.30); }
.nrmStamp{
  display:inline-block;
  padding:5px 10px;
  border-radius:10px;
  border:1px solid rgba(21,255,200,.28);
  background: rgba(21,255,200,.10);
  color: rgba(209,254,255,.92);
  font-weight:900;
  font-size:11px;
  letter-spacing:.3px;
  opacity:0;
  transform: translateY(4px);
  pointer-events:none;
  transition: opacity .18s ease, transform .18s ease;
  margin-top:6px;
}
.nrmStamp.show{ opacity:1; transform: translateY(0); }
.nrmSectionTitle{
  font-size:13px; font-weight:900; color: rgba(209,254,255,.92);
  margin-bottom:6px; letter-spacing:.2px; text-transform:uppercase;
}
@media (prefers-reduced-motion:reduce){
  .nrmBtn,.nrmNode,.nrmLineFill,.nrmStamp{ transition:none !important; }
  .nrmWrap .panelBody{ transition: max-height .01s linear, opacity .01s linear, transform .01s linear; }
  .nrmWrap .chev{ transition: transform .01s linear; }
}

/* ===== Repair Page — collapsible panels ===== */
.repairWrap{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }

.repairPanel{
  border-radius:var(--radius);
  border:1px solid var(--border);
  background: rgba(21,255,200,.06);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.repairPanel .panelHeader{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:16px 18px; cursor:pointer;
  user-select:none; -webkit-tap-highlight-color: transparent;
}
.repairPanel .panelHeader:focus-visible{
  outline:none; box-shadow:0 0 0 3px rgba(21,255,200,.32);
}
.repairPanel .titleBlock{ display:flex; flex-direction:column; gap:2px; min-width:0; }
.repairPanel .panelTitle{ font-size:15px; font-weight:750; letter-spacing:.2px; }
.repairPanel .panelSub{ font-size:12px; color:var(--muted); line-height:1.3; }
.repairPanel .chev{
  width:34px; height:34px; border-radius:999px;
  display:grid; place-items:center;
  border:1px solid rgba(209,254,255,.16);
  background:rgba(0,0,0,.12);
  transition: transform .18s ease, background .18s ease, border-color .18s ease;
  flex:0 0 auto;
}
.repairPanel.open .chev{
  transform:rotate(180deg); background:rgba(0,0,0,.18);
  border-color:rgba(21,255,200,.24);
}
.repairPanel .panelBody{
  max-height:0; opacity:0; transform:translateY(-6px);
  transition: max-height .30s ease, opacity .24s ease, transform .24s ease;
}
.repairPanel.open .panelBody{
  max-height:900px; opacity:1; transform:translateY(0);
}
.repairPanel .inner{ padding:0 18px 18px 18px; }
@media (prefers-reduced-motion:reduce){
  .repairPanel .panelBody{ transition:max-height .01s linear, opacity .01s linear, transform .01s linear; }
  .repairPanel .chev{ transition:transform .01s linear; }
}

.rbWarning{
  background:rgba(255,80,80,.08);
  border:1px solid rgba(255,80,80,.28);
  padding:10px 12px; border-radius:12px;
  font-size:13px; margin-bottom:14px; line-height:1.4;
  color:var(--muted);
}
.rbSection{ margin-bottom:14px; }
.rbLabel{
  font-size:11px; text-transform:uppercase; letter-spacing:.3px;
  color:var(--muted); margin-bottom:5px;
}
.rbTextarea{
  width:100%; min-height:64px;
  border-radius:10px;
  border:1px solid rgba(209,254,255,.18);
  background:rgba(0,0,0,.22);
  color:var(--sb-light);
  padding:10px; font-size:13px;
  resize:vertical;
  font-family:inherit;
}
.rbTextarea:focus{ outline:none; border-color:var(--sb-mint); }
.rbFlag{ color:#ff8080; font-size:12px; margin-top:5px; display:none; }
.rbOutput{
  margin-top:12px; padding:14px;
  border-radius:12px;
  background:rgba(0,0,0,.28);
  border:1px solid rgba(209,254,255,.18);
  font-size:13px; white-space:pre-line;
  line-height:1.55; display:none; color:var(--sb-light);
}
.rbBtnRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
.rbBtn{
  appearance:none;
  border-radius:999px; padding:9px 14px;
  font-size:13px; font-weight:800; cursor:pointer;
  border:1px solid rgba(21,255,200,.38);
  background:rgba(21,255,200,.12);
  color:var(--sb-light);
  transition: background .15s ease;
}
.rbBtn:hover{ background:rgba(21,255,200,.20); }
.rbBtnGhost{
  border-color:rgba(209,254,255,.22);
  background:rgba(209,254,255,.06);
}
.rbBtnGhost:hover{ background:rgba(209,254,255,.10); }
.rbCopyConfirm{
  font-size:12px; color:var(--sb-mint); opacity:0;
  transition:opacity .3s ease; margin-top:6px;
}
.rbCopyConfirm.show{ opacity:1; }

/* ===== Ongoing Consent Road (Relationship) ===== */
.ocWrap{
  margin-top: 10px;
}
.ocTopCopy{
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.14);
  border-radius: 16px;
  padding: 14px 14px;
  margin: 10px 0 14px 0;
}
.ocTopCopy p{
  margin: 0 0 10px 0;
  line-height: 1.5;
  font-size: 14px;
  color: rgba(209,254,255,.92);
}
.ocTopCopy p:last-child{ margin-bottom:0; }
.ocTopCopy b{ color: rgba(209,254,255,.98); }

.ocLayout{
  display:grid;
  grid-template-columns: 1fr 320px;
  gap: 14px;
  align-items:start;
}
@media (max-width: 900px){
  .ocLayout{ grid-template-columns: 1fr; }
}

.ocRoadWrap{
  position:relative;
  border-radius: 18px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.14);
  padding: 12px;
  height: 540px;
  overflow:auto;
}

.ocRoadInner{
  position:relative;
  min-height: 520px;
  padding: 28px 14px 36px 14px;
}

.ocRoad{
  position:absolute;
  left: 50%;
  top: 14px;
  bottom: 14px;
  width: 92px;
  transform: translateX(-50%);
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(209,254,255,.10), rgba(0,0,0,.18));
  border: 1px solid rgba(209,254,255,.12);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.18);
}
.ocRoad::after{
  content:"";
  position:absolute;
  left:50%;
  top: 18px;
  bottom: 18px;
  width: 2px;
  transform: translateX(-50%);
  background: repeating-linear-gradient(
    to bottom,
    rgba(21,255,200,.75) 0px,
    rgba(21,255,200,.75) 14px,
    transparent 14px,
    transparent 26px
  );
  opacity:.65;
  border-radius: 2px;
}

.ocMile{
  position:absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
}

.ocPin{
  position:absolute;
  left: 50%;
  top: 0;
  transform: translate(-50%, -50%);
  width: 14px;
  height: 14px;
  border-radius: 999px;
  background: rgba(21,255,200,.90);
  box-shadow: 0 0 0 6px rgba(21,255,200,.16), 0 12px 26px rgba(0,0,0,.40);
}

.ocBubble{
  position:absolute;
  max-width: 280px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(21,255,200,.34);
  background: rgba(21,255,200,.10);
  color: rgba(209,254,255,.96);
  font-size: 13px;
  line-height: 1.35;
  box-shadow: 0 14px 30px rgba(0,0,0,.35);
  opacity: 0;
  transform: translateY(10px) scale(.98);
  transition: opacity .22s ease, transform .22s ease;
}
.ocBubble.show{ opacity:1; transform: translateY(0) scale(1); }
.ocBubble::after{
  content:"";
  position:absolute;
  top: 16px;
  width: 10px;
  height: 10px;
  background: rgba(21,255,200,.10);
  border-left: 1px solid rgba(21,255,200,.34);
  border-bottom: 1px solid rgba(21,255,200,.34);
  transform: rotate(45deg);
}
.ocBubble.left{ right: 86px; }
.ocBubble.left::after{ right: -6px; }
.ocBubble.right{ left: 86px; }
.ocBubble.right::after{ left: -6px; }

.ocSide{
  border-radius: 18px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.14);
  padding: 16px;
}
.ocSide h2{
  margin:0 0 8px 0;
  font-size: 14px;
  font-weight: 900;
  letter-spacing:.2px;
}
.ocSide p{
  margin:0 0 10px 0;
  color: rgba(209,254,255,.90);
  font-size: 13px;
  line-height: 1.45;
}
.ocControls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top: 12px;
}
.ocBtn{
  appearance:none;
  border-radius:999px;
  padding:10px 14px;
  cursor:pointer;
  font-size:13px;
  font-weight: 900;
  letter-spacing:.2px;
  border: 1px solid rgba(21,255,200,.40);
  background: rgba(21,255,200,.12);
  color: var(--sb-light);
  transition: transform .06s ease, background .15s ease, border-color .15s ease;
}
.ocBtn:hover{ background: rgba(21,255,200,.16); border-color: rgba(21,255,200,.55); }
.ocBtn:active{ transform: translateY(1px); }

.ocBtnGhost{
  border-color: rgba(209,254,255,.22);
  background: rgba(209,254,255,.06);
  font-weight: 800;
}
.ocBtnGhost:hover{ background: rgba(209,254,255,.09); border-color: rgba(209,254,255,.30); }

.ocMeter{
  margin-top: 10px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  color: var(--muted);
  font-size: 12px;
}
.ocEndNote{
  margin-top: 12px;
  padding: 12px;
  border-radius: 14px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.12);
  color: rgba(209,254,255,.90);
  font-size: 13px;
  line-height: 1.45;
  display:none;
}
@media (prefers-reduced-motion: reduce){
  .ocBubble, .ocBubble.show{ transition:none; }
}

/* ===== Anger Pressure Meter ===== */
.pressureWrap{
  margin: 12px 0 14px;
  padding: 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
}
.pressureTop{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.pressureLabel{
  font-weight: 950;
  font-size: 13px;
  letter-spacing: .2px;
}
.pressureValue{
  font-weight: 950;
  font-size: 12px;
  color: var(--sb-light);
  opacity:.92;
  border: 1px solid rgba(255,255,255,.14);
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(0,0,0,.18);
  white-space: nowrap;
}
.pressureBar{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  overflow:hidden;
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.14);
}
.pressureFill{
  height:100%;
  width:50%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(21,255,200,.85), rgba(255,97,79,.85));
  transition: width .15s ease;
}
.pressureSlider{
  width:100%;
  margin: 12px 0 6px;
}
.pressureTicks{
  position: relative;
  height: 18px;
  font-size: 11px;
  color: var(--muted);
  opacity:.95;
}
.pressureTicks span{
  position: absolute;
  transform: translateX(-50%);
  white-space: nowrap;
}
.pressureCopy{
  margin-top:10px;
  font-size: 13px;
  line-height:1.35;
  color: var(--muted);
}
.pressurePrompt{
  margin-top:10px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(21,255,200,.22);
  background: rgba(21,255,200,.08);
  color: var(--sb-light);
  font-size: 13px;
  line-height:1.35;
}
.pressurePrompt b{ color: var(--sb-light); }



/* ===== Next Steps action grid ===== */
.nextGrid { display: grid; gap: 10px; margin-top: 12px; }
.nextBtn {
  appearance: none;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.055);
  color: var(--text);
  border-radius: 14px;
  padding: 14px 16px;
  cursor: pointer;
  text-align: left;
  font-family: inherit;
  font-weight: 700;
  width: 100%;
  display: flex;
  align-items: center;
  gap: 14px;
  transition: transform .06s ease, background .16s ease, border-color .16s ease, box-shadow .16s ease;
  -webkit-tap-highlight-color: transparent;
}
.nextBtn:hover {
  background: rgba(21,255,200,.12);
  border-color: rgba(21,255,200,.50);
  box-shadow: 0 0 10px rgba(21,255,200,.22);
  transform: translateY(-1px);
}
.nextBtn:active { transform: translateY(1px); }
.nextBtnIcon { font-size: 22px; width: 32px; text-align: center; flex-shrink: 0; line-height: 1; }
.nextBtnText { flex: 1; min-width: 0; }
.nextBtnLabel { font-size: 14px; font-weight: 850; color: var(--sb-light); display: block; }
.nextBtnSub { font-size: 12px; color: var(--muted); margin-top: 3px; display: block; line-height: 1.3; }




/* ===== Support screen link buttons ===== */
.supportLink {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  padding: 14px 16px;
  border-radius: 14px;
  border: 1px solid rgba(209,254,255,.16);
  background: rgba(255,255,255,.05);
  color: var(--sb-light);
  font-weight: 700;
  font-size: 14px;
  transition: background .15s ease, border-color .15s ease, transform .08s ease, box-shadow .15s ease;
  -webkit-tap-highlight-color: transparent;
}
.supportLink:hover {
  background: rgba(21,255,200,.11);
  border-color: rgba(21,255,200,.45);
  transform: translateY(-1px);
  box-shadow: 0 0 8px rgba(21,255,200,.18);
}
.supportLink:active { transform: translateY(1px); }
.supportLinkIcon { font-size: 22px; flex-shrink: 0; }
.supportLinkText { flex: 1; }
.supportLinkLabel { display: block; font-weight: 800; }
.supportLinkSub { display: block; font-size: 12px; color: var(--muted); margin-top: 2px; }
.supportLinkArrow { color: rgba(21,255,200,.55); font-size: 16px; flex-shrink: 0; }

/* ============================================================
   THE STANDARD
   ============================================================ */
.tsIntro {
  font-size: 13px;
  color: rgba(209,254,255,.70);
  line-height: 1.55;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid rgba(209,254,255,.10);
  background: rgba(0,0,0,.16);
  margin: 0 0 14px 0;
}
.tsTraits { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
.tsCard {
  border-radius: 14px;
  border: 1px solid rgba(209,254,255,.16);
  background: rgba(0,0,0,.18);
  padding: 14px 14px 12px;
  cursor: pointer;
  transition: border-color .16s ease, background .16s ease, transform .08s ease, box-shadow .16s ease;
  -webkit-tap-highlight-color: transparent;
}
.tsCard:hover { border-color: rgba(209,254,255,.28); background: rgba(0,0,0,.22); transform: translateY(-1px); }
.tsCard:active { transform: translateY(0); }
.tsCard.tsOn { border-color: rgba(21,255,200,.55); background: rgba(21,255,200,.07); box-shadow: 0 0 14px rgba(21,255,200,.10); }
.tsCardTop { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.tsIcon { font-size: 20px; flex-shrink: 0; line-height: 1; }
.tsCardLabel { flex: 1; font-size: 14px; font-weight: 900; color: var(--sb-light); letter-spacing: .1px; }
.tsToggle {
  font-size: 11px; font-weight: 900; letter-spacing: .5px; text-transform: uppercase;
  padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(209,254,255,.22);
  color: rgba(209,254,255,.60); background: rgba(0,0,0,.18); flex-shrink: 0; transition: all .14s ease;
}
.tsOn .tsToggle { border-color: rgba(21,255,200,.55); color: var(--sb-mint); background: rgba(21,255,200,.10); }
.tsCardDesc { font-size: 13px; color: rgba(209,254,255,.80); line-height: 1.5; margin-bottom: 6px; }
.tsAlt { font-size: 12px; color: rgba(209,254,255,.45); margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(209,254,255,.08); line-height: 1.4; }
.tsAltLabel { font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: .4px; color: rgba(255,140,100,.65); margin-right: 4px; }
.tsAltReframe { font-size: 12px; color: rgba(209,254,255,.55); line-height: 1.4; margin-top: 4px; padding-left: 2px; font-style: italic; }
.tsCommit {
  border-radius: 14px; border: 1px solid rgba(21,255,200,.40); background: rgba(21,255,200,.06);
  padding: 16px; margin-bottom: 4px; animation: tsCommitIn .25s ease forwards;
}
@keyframes tsCommitIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.tsCommitLabel { font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: .7px; color: rgba(21,255,200,.70); margin-bottom: 10px; }
.tsCommitText { display: flex; flex-direction: column; gap: 6px; margin-bottom: 10px; }
.tsCommitLine { font-size: 13px; font-weight: 800; color: var(--sb-light); letter-spacing: .1px; }
.tsCommitSub { font-size: 12px; color: rgba(209,254,255,.55); line-height: 1.4; font-style: italic; }

/* ============================================================
   THE REAL TALK TEST
   ============================================================ */
.ttIntro {
  font-size: 13px; color: rgba(209,254,255,.70); line-height: 1.55;
  padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(209,254,255,.10);
  background: rgba(0,0,0,.16); margin: 0 0 14px 0;
}
.ttCards { display: flex; flex-direction: column; gap: 8px; margin-bottom: 4px; }
.ttCard { border-radius: 14px; border: 1px solid rgba(209,254,255,.16); background: rgba(0,0,0,.18); overflow: hidden; transition: border-color .16s ease; }
.ttCard.ttOpen { border-color: rgba(209,254,255,.28); }
.ttCardHeader {
  display: flex; align-items: flex-start; gap: 10px; padding: 14px; cursor: pointer;
  -webkit-tap-highlight-color: transparent; transition: background .14s ease;
}
.ttCardHeader:hover { background: rgba(209,254,255,.04); }
.ttOpen .ttCardHeader { background: rgba(209,254,255,.04); }
.ttClaimWrap { flex: 1; display: flex; flex-direction: column; gap: 4px; }
.ttClaimTag { font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: .6px; color: rgba(255,160,80,.65); }
.ttClaim { font-size: 14px; font-weight: 900; color: var(--sb-light); line-height: 1.35; letter-spacing: .1px; }
.ttChev { flex-shrink: 0; margin-top: 2px; transition: transform .18s ease; opacity: .70; }
.ttOpen .ttChev { transform: rotate(180deg); }
.ttBody { padding: 0 14px 14px; display: flex; flex-direction: column; gap: 10px; }
.ttSection { background: rgba(0,0,0,.16); border-radius: 10px; padding: 10px 12px; border: 1px solid rgba(209,254,255,.08); }
.ttSectionLabel { font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: .6px; margin-bottom: 5px; }
.ttLabelSounds { color: rgba(21,200,255,.60); }
.ttLabelReality { color: rgba(21,255,200,.60); }
.ttSectionText { font-size: 13px; color: rgba(209,254,255,.82); line-height: 1.55; }
.ttGap {
  font-size: 13px; font-weight: 800; color: var(--sb-light); padding: 10px 12px;
  border-radius: 10px; border: 1px solid rgba(21,255,200,.28); background: rgba(21,255,200,.07); line-height: 1.4; letter-spacing: .05px;
}
.ttGapIcon { color: var(--sb-mint); margin-right: 4px; font-style: normal; }

/* ============================================================
   THE REAL TALK TEST
   ============================================================ */

/* Always single-column: road on top, controls below */
.ocLayout {
  grid-template-columns: 1fr !important;
  gap: 16px;
}

/* Road scroll container — scrolls horizontally inside the container */
.ocRoadWrap {
  height: 380px !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  padding: 0 !important;
  border-radius: 0 !important;
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
  scroll-behavior: smooth;
  position: relative;
  cursor: grab;
  flex: 1;
}
.ocRoadWrap:active { cursor: grabbing; }
.ocRoadWrap::-webkit-scrollbar { height: 6px; }
.ocRoadWrap::-webkit-scrollbar-thumb {
  background: linear-gradient(90deg, rgba(21,255,200,.40), rgba(19,132,143,.40));
  border-radius: 999px;
}
.ocRoadWrap::-webkit-scrollbar-track {
  background: rgba(0,0,0,.30);
  border-radius: 999px;
}

/* Scroll hint arrows */
.ocScrollHint {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  pointer-events: none;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: .4px;
  text-transform: uppercase;
  color: rgba(21,255,200,.55);
  display: flex;
  align-items: center;
  gap: 4px;
  animation: ocHintPulse 2s ease-in-out infinite;
}
.ocScrollHint.left { left: 10px; }
.ocScrollHint.right { right: 10px; }
@keyframes ocHintPulse {
  0%, 100% { opacity: .5; }
  50% { opacity: 1; }
}

/* Inner canvas — width set by JS */
.ocRoadInner {
  position: relative !important;
  height: 380px !important;
  min-height: 380px !important;
  padding: 0 !important;
}

/* Sky gradient layer on top */
.ocRoadInner::before {
  content: "";
  position: absolute;
  left: 0; right: 0;
  top: 0;
  height: 90px;
  background: linear-gradient(180deg,
    rgba(21,255,200,.04) 0%,
    transparent 100%
  );
  pointer-events: none;
  z-index: 0;
}

/* Ground gradient layer on bottom */
.ocRoadInner::after {
  content: "";
  position: absolute;
  left: 0; right: 0;
  bottom: 0;
  height: 70px;
  background: linear-gradient(0deg,
    rgba(21,255,200,.04) 0%,
    transparent 100%
  );
  pointer-events: none;
  z-index: 0;
}

/* Horizontal road band — asphalt texture with lane markings */
.ocRoad {
  position: absolute !important;
  left: 0 !important;
  right: 0 !important;
  top: 50% !important;
  bottom: auto !important;
  width: auto !important;
  height: 90px !important;
  transform: translateY(-50%) !important;
  border-radius: 0 !important;
  background:
    /* Subtle asphalt texture */
    repeating-linear-gradient(
      90deg,
      transparent 0px,
      transparent 3px,
      rgba(0,0,0,.04) 3px,
      rgba(0,0,0,.04) 6px
    ),
    linear-gradient(180deg,
      rgba(255,255,255,.00) 0%,
      rgba(0,0,0,.30) 15%,
      rgba(6,20,25,.95) 30%,
      rgba(8,24,30,.98) 50%,
      rgba(6,20,25,.95) 70%,
      rgba(0,0,0,.30) 85%,
      rgba(255,255,255,.00) 100%
    ) !important;
  border-top: 1px solid rgba(209,254,255,.10) !important;
  border-bottom: 1px solid rgba(209,254,255,.10) !important;
  border-left: none !important;
  border-right: none !important;
  box-shadow:
    0 -8px 30px rgba(21,255,200,.06),
    0 8px 30px rgba(21,255,200,.06) !important;
}

/* Edge glow lines along road borders */
.ocRoad::before {
  content: "";
  position: absolute;
  left: 0; right: 0;
  top: 0;
  height: 2px;
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(21,255,200,.35) 15%,
    rgba(21,255,200,.60) 50%,
    rgba(21,255,200,.35) 85%,
    transparent 100%
  );
  box-shadow: 0 0 12px rgba(21,255,200,.30);
}

/* Dashed center divider — animated flowing dashes */
.ocRoad::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 3px;
  transform: translateY(-50%);
  background: repeating-linear-gradient(
    90deg,
    rgba(21,255,200,.75) 0px,
    rgba(21,255,200,.75) 18px,
    transparent 18px,
    transparent 32px
  );
  box-shadow: 0 0 8px rgba(21,255,200,.25);
  animation: ocDashFlow 1.5s linear infinite;
}

@keyframes ocDashFlow {
  from { background-position: 0 0; }
  to   { background-position: 32px 0; }
}

/* Lane edge lines */
.ocLaneBottom {
  position: absolute;
  left: 0; right: 0;
  bottom: 0;
  height: 2px;
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(21,255,200,.25) 15%,
    rgba(21,255,200,.45) 50%,
    rgba(21,255,200,.25) 85%,
    transparent 100%
  );
  box-shadow: 0 0 8px rgba(21,255,200,.20);
  z-index: 1;
}

/* Mile markers: positioned at (x, vertical center) via JS */
.ocMile {
  position: absolute !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  width: 0;
  height: 0;
}

/* Checkpoint dot — neon beacon with pulse rings */
.ocPin {
  display: block !important;
  position: absolute;
  top: 0 !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  background: radial-gradient(circle, #fff 0%, rgba(21,255,200,1) 40%, rgba(21,255,200,.70) 100%);
  box-shadow:
    0 0 0 3px rgba(21,255,200,.25),
    0 0 0 7px rgba(21,255,200,.10),
    0 0 20px rgba(21,255,200,.60),
    0 0 40px rgba(21,255,200,.20);
  z-index: 3;
  animation: ocPinPulse 2.2s ease-in-out infinite;
}

@keyframes ocPinPulse {
  0%, 100% {
    box-shadow:
      0 0 0 3px rgba(21,255,200,.25),
      0 0 0 7px rgba(21,255,200,.10),
      0 0 20px rgba(21,255,200,.60),
      0 0 40px rgba(21,255,200,.20);
  }
  50% {
    box-shadow:
      0 0 0 5px rgba(21,255,200,.35),
      0 0 0 12px rgba(21,255,200,.12),
      0 0 30px rgba(21,255,200,.80),
      0 0 60px rgba(21,255,200,.30);
  }
}

/* Bubble cards — holographic floating signs */
.ocBubble {
  position: absolute;
  max-width: 140px;
  min-width: 100px;
  width: max-content;
  padding: 9px 12px;
  border-radius: 14px;
  border: 1px solid rgba(21,255,200,.45) !important;
  background: linear-gradient(135deg,
    rgba(13,40,50,.92) 0%,
    rgba(8,26,34,.96) 60%,
    rgba(13,40,48,.90) 100%
  ) !important;
  color: rgba(209,254,255,.98);
  font-size: 12px;
  font-weight: 700;
  line-height: 1.35;
  text-align: center;
  box-shadow:
    0 0 0 1px rgba(21,255,200,.12),
    0 4px 20px rgba(0,0,0,.60),
    0 0 20px rgba(21,255,200,.12),
    inset 0 1px 0 rgba(21,255,200,.15);
  backdrop-filter: blur(8px);
  /* centered on the pin */
  left: 50% !important;
  right: auto !important;
  transform: translate(-50%, 6px) !important;
  opacity: 0;
  transition: opacity .32s cubic-bezier(.22,1,.36,1), transform .32s cubic-bezier(.22,1,.36,1);
  z-index: 4;
}
.ocBubble::after { display: none !important; content: none !important; }

/* Connector line from bubble to pin */
.ocBubble::before {
  content: "";
  position: absolute;
  left: 50%;
  width: 1px;
  transform: translateX(-50%);
  background: linear-gradient(to var(--oc-connector-dir, bottom), rgba(21,255,200,.50), transparent);
  opacity: .70;
}

/* Top bubble: sits above the road */
.ocBubble.top {
  bottom: 70px !important;
  top: auto !important;
  transform: translate(-50%, 6px) !important;
}
.ocBubble.top::before {
  top: 100%;
  height: 16px;
  --oc-connector-dir: bottom;
}

/* Bottom bubble: sits below the road */
.ocBubble.bottom {
  top: 70px !important;
  bottom: auto !important;
  transform: translate(-50%, -6px) !important;
}
.ocBubble.bottom::before {
  bottom: 100%;
  height: 16px;
  --oc-connector-dir: top;
}

/* Show state — float in */
.ocBubble.show {
  opacity: 1 !important;
  transform: translate(-50%, 0) !important;
}

/* Growing progress line inside road — neon trail */
#ocProgressLine {
  position: absolute;
  top: 50%;
  left: 80px;
  height: 5px;
  width: 0;
  background: linear-gradient(90deg,
    rgba(21,255,200,.30) 0%,
    rgba(21,255,200,.90) 70%,
    rgba(21,255,200,1) 100%
  );
  border-radius: 4px;
  transform: translateY(-50%);
  transition: width 420ms cubic-bezier(.4,0,.2,1);
  z-index: 2;
  pointer-events: none;
  box-shadow: 0 0 8px rgba(21,255,200,.45), 0 0 20px rgba(21,255,200,.20);
}

/* Controls panel */
.ocSide {
  width: 100% !important;
  margin-top: 0 !important;
  border-radius: 16px;
  padding: 16px;
  background: linear-gradient(135deg, rgba(13,40,50,.70), rgba(7,22,28,.80));
  border: 1px solid rgba(21,255,200,.18) !important;
  box-shadow: 0 0 20px rgba(21,255,200,.06), inset 0 1px 0 rgba(21,255,200,.08);
}
.ocSide h2 {
  margin: 0 0 6px 0;
  font-size: 14px;
  font-weight: 900;
  letter-spacing: .2px;
  color: rgba(209,254,255,1);
}
.ocSide p {
  margin: 0 0 12px 0;
  color: rgba(209,254,255,.80);
  font-size: 13px;
  line-height: 1.45;
}
.ocControls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 0;
}

/* Progress track bar */
.ocProgressTrack {
  margin-top: 12px;
  height: 5px;
  border-radius: 999px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(21,255,200,.10);
  overflow: hidden;
  position: relative;
}
.ocProgressFill {
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(21,255,200,.60), rgba(21,255,200,1));
  box-shadow: 0 0 8px rgba(21,255,200,.40);
  width: 0%;
  transition: width 420ms cubic-bezier(.4,0,.2,1);
}

.ocMeter {
  margin-top: 10px;
  display: flex;
  justify-content: space-between;
  gap: 10px;
  color: var(--muted);
  font-size: 12px;
}

/* "Add check-in" button — glowing primary action */
#ocAddBtn {
  background: linear-gradient(135deg, rgba(21,255,200,.22), rgba(19,132,143,.18)) !important;
  border-color: rgba(21,255,200,.55) !important;
  box-shadow: 0 0 12px rgba(21,255,200,.15), inset 0 1px 0 rgba(21,255,200,.15) !important;
  color: rgba(209,254,255,1) !important;
  font-weight: 900 !important;
  letter-spacing: .2px;
}
#ocAddBtn:hover:not(:disabled) {
  background: linear-gradient(135deg, rgba(21,255,200,.32), rgba(19,132,143,.25)) !important;
  box-shadow: 0 0 20px rgba(21,255,200,.28), inset 0 1px 0 rgba(21,255,200,.20) !important;
  transform: translateY(-1px);
}
#ocAddBtn:disabled {
  opacity: .40;
  cursor: not-allowed;
}

/* Road title banner */
/* Outer wrapper: stacks title above scrolling road */
.ocRoadContainer {
  display: flex;
  flex-direction: column;
  border-radius: 18px;
  border: 1px solid rgba(21,255,200,.22);
  background:
    radial-gradient(ellipse 80% 60% at 50% 0%, rgba(19,132,143,.28) 0%, transparent 70%),
    radial-gradient(ellipse 60% 40% at 50% 100%, rgba(21,255,200,.08) 0%, transparent 60%),
    linear-gradient(180deg, #07161a 0%, #0a2028 25%, #0d2a32 50%, #071419 100%);
  box-shadow:
    0 0 0 1px rgba(21,255,200,.12),
    0 0 40px rgba(21,255,200,.08),
    inset 0 1px 0 rgba(209,254,255,.08);
  overflow: hidden;
}

/* Title bar — always visible above the scrolling road */
.ocRoadTitle {
  text-align: center;
  padding: 10px 16px 8px;
  font-size: 10px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: rgba(21,255,200,.65);
  background: rgba(0,0,0,.25);
  border-bottom: 1px solid rgba(21,255,200,.14);
  flex-shrink: 0;
  z-index: 10;
  backdrop-filter: blur(4px);
}

/* Milestone number badge */
.ocMileNum {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: 12px;
  font-size: 9px;
  font-weight: 900;
  color: rgba(21,255,200,.65);
  letter-spacing: .3px;
  white-space: nowrap;
  z-index: 5;
}


/* ===== Prevent Page — tool hub ===== */
.pvGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin:14px 0 18px;
}
@media(max-width:480px){ .pvGrid{ grid-template-columns:1fr; } }
.pvBtn{
  appearance:none;
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:4px;
  padding:16px;
  border-radius:16px;
  border:1px solid rgba(209,254,255,.18);
  background:rgba(21,255,200,.06);
  color:var(--sb-light);
  cursor:pointer;
  text-align:left;
  transition: background .15s ease, border-color .15s ease, transform .08s ease, box-shadow .15s ease;
}
.pvBtn:hover{
  background:rgba(21,255,200,.13);
  border-color:rgba(21,255,200,.45);
  box-shadow:0 0 12px rgba(21,255,200,.18);
  transform:translateY(-1px);
}
.pvBtn:active{ transform:translateY(0); }
.pvIcon{ font-size:24px; line-height:1; margin-bottom:2px; }
.pvLabel{ font-size:14px; font-weight:850; letter-spacing:.1px; }
.pvSub{ font-size:12px; color:var(--muted); line-height:1.3; }

/* ===== Supporting a Survivor modal ===== */
.ssGrid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:480px){ .ssGrid{ grid-template-columns:1fr; } }
.ssCol{ border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
.ssColDo{ background:rgba(21,255,200,.07); border:1px solid rgba(21,255,200,.25); }
.ssColDont{ background:rgba(255,80,80,.06); border:1px solid rgba(255,80,80,.22); }
.ssColHead{ font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.3px; margin-bottom:2px; }
.ssColDo .ssColHead{ color:var(--sb-mint); }
.ssColDont .ssColHead{ color:#ff8080; }
.ssItem{ font-size:13px; color:var(--muted); line-height:1.4; padding:7px 9px; border-radius:8px; background:rgba(0,0,0,.14); }

/* ===== Shift the Culture accordion ===== */
.scAccordion{ display:flex; flex-direction:column; gap:6px; }
.scItem{ border-radius:12px; border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.14); overflow:hidden; }
.scHeader{ width:100%; appearance:none; background:transparent; border:none; display:flex; align-items:center; gap:10px; padding:12px 14px; cursor:pointer; color:var(--sb-light); text-align:left; }
.scHeader:hover{ background:rgba(21,255,200,.06); }
.scHeader.scOpen{ background:rgba(21,255,200,.08); }
.scEmoji{ font-size:18px; flex-shrink:0; }
.scTitle{ flex:1; font-size:14px; font-weight:800; }
.scChev{ flex-shrink:0; transition:transform .18s ease; opacity:.7; }
.scHeader.scOpen .scChev{ transform:rotate(180deg); }
.scBody{ max-height:0; overflow:hidden; font-size:13px; color:var(--muted); line-height:1.5; transition:max-height .25s ease, padding .25s ease; padding:0 14px; }
.scBody.scOpen{ max-height:160px; padding:0 14px 12px 42px; }

/* ===== Bystander Intervention cards ===== */
.biCards{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:480px){ .biCards{ grid-template-columns:1fr; } }
.biCard{ border-radius:14px; border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.18); padding:14px; }
.biNum{ font-size:11px; font-weight:900; color:var(--sb-mint); letter-spacing:.4px; margin-bottom:4px; }
.biTitle{ font-size:15px; font-weight:900; margin-bottom:6px; }
.biBody{ font-size:13px; color:var(--muted); line-height:1.45; }

/* Allow taller modals for prevent tools */
.modal{ max-height:88vh; overflow-y:auto; }

/* ===== HEALTHY RELATIONSHIPS MODULE ===== */
.hrFlagRow {
  display: flex;
  gap: 10px;
  margin: 12px 0;
}
.hrFlagBtn {
  flex: 1;
  appearance: none;
  border-radius: 14px;
  padding: 14px 10px;
  cursor: pointer;
  font-weight: 900;
  font-size: 13px;
  border: 2px solid transparent;
  transition: all .18s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  text-align: center;
}
.hrFlagBtn.green {
  background: rgba(21,255,100,.08);
  border-color: rgba(21,255,100,.30);
  color: #b8ffcc;
}
.hrFlagBtn.green.active, .hrFlagBtn.green:hover {
  background: rgba(21,255,100,.18);
  border-color: rgba(21,255,100,.65);
  box-shadow: 0 0 14px rgba(21,255,100,.20);
}
.hrFlagBtn.red {
  background: rgba(255,80,80,.07);
  border-color: rgba(255,80,80,.28);
  color: #ffb8b8;
}
.hrFlagBtn.red.active, .hrFlagBtn.red:hover {
  background: rgba(255,80,80,.16);
  border-color: rgba(255,80,80,.60);
  box-shadow: 0 0 14px rgba(255,80,80,.18);
}
.hrFlagIcon { font-size: 28px; line-height: 1; }
.hrFlagLabel { font-size: 12px; font-weight: 900; letter-spacing: .4px; text-transform: uppercase; }

.hrSignGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin: 10px 0;
}
@media (max-width: 480px) { .hrSignGrid { grid-template-columns: 1fr; } }

.hrSign {
  border-radius: 12px;
  padding: 10px 12px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all .15s ease;
  text-align: left;
  appearance: none;
  font-family: inherit;
  font-weight: 600;
}
.hrSign.healthy {
  background: rgba(21,255,100,.06);
  border-color: rgba(21,255,100,.22);
  color: rgba(209,254,255,.85);
}
.hrSign.healthy:hover, .hrSign.healthy.selected {
  background: rgba(21,255,100,.15);
  border-color: rgba(21,255,100,.55);
  color: #d1feff;
}
.hrSign.unhealthy {
  background: rgba(255,80,80,.05);
  border-color: rgba(255,80,80,.20);
  color: rgba(209,254,255,.85);
}
.hrSign.unhealthy:hover, .hrSign.unhealthy.selected {
  background: rgba(255,80,80,.13);
  border-color: rgba(255,80,80,.52);
  color: #ffd1d1;
}

.hrEqualityWheel {
  margin: 12px auto;
  max-width: 300px;
  position: relative;
}
.hrEqualityWheel svg { width: 100%; height: auto; display: block; }

.hrAbuseTabs {
  display: flex;
  gap: 6px;
  margin: 12px 0 8px;
  flex-wrap: wrap;
}
.hrAbuseTab {
  appearance: none;
  border-radius: 999px;
  padding: 7px 13px;
  font-size: 12px;
  font-weight: 900;
  cursor: pointer;
  transition: all .15s ease;
  border: 1px solid rgba(209,254,255,.20);
  background: rgba(255,255,255,.04);
  color: var(--muted);
  letter-spacing: .2px;
}
.hrAbuseTab.active {
  background: rgba(21,255,200,.15);
  border-color: rgba(21,255,200,.55);
  color: var(--sb-mint);
}
.hrAbuseList {
  border-radius: 14px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.16);
  padding: 14px;
  min-height: 80px;
}
.hrAbuseItem {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 7px 0;
  border-bottom: 1px solid rgba(209,254,255,.07);
  font-size: 13px;
  color: var(--muted);
  line-height: 1.4;
}
.hrAbuseItem:last-child { border-bottom: none; }
.hrAbuseChev {
  flex-shrink: 0;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(255,80,80,.18);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 1px;
}

.hrCycleWrap {
  margin: 12px 0;
  border-radius: 16px;
  border: 1px solid rgba(209,254,255,.14);
  background: rgba(0,0,0,.16);
  padding: 14px;
}
.hrCycleGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin: 10px 0;
}
.hrCycleCard {
  border-radius: 12px;
  padding: 12px;
  border: 1px solid rgba(209,254,255,.14);
  cursor: pointer;
  transition: all .18s ease;
}
.hrCycleCard:hover, .hrCycleCard.active {
  border-color: rgba(21,255,200,.45);
  background: rgba(21,255,200,.08);
}
.hrCycleTitle {
  font-size: 12px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: .4px;
  color: var(--sb-mint);
  margin-bottom: 4px;
}
.hrCycleBody { font-size: 12px; color: var(--muted); line-height: 1.4; }
.hrCycleDetail {
  margin-top: 10px;
  padding: 12px;
  border-radius: 12px;
  background: rgba(21,255,200,.07);
  border: 1px solid rgba(21,255,200,.25);
  font-size: 13px;
  color: var(--sb-light);
  line-height: 1.5;
  display: none;
}
.hrCycleDetail.show { display: block; }

.hrSortGame {
  margin: 10px 0;
}
.hrSortRow {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.hrSortCard {
  appearance: none;
  border: 1px solid rgba(209,254,255,.22);
  background: rgba(255,255,255,.05);
  color: var(--sb-light);
  border-radius: 12px;
  padding: 9px 13px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all .15s ease;
  font-family: inherit;
}
.hrSortCard:hover { background: rgba(21,255,200,.12); border-color: rgba(21,255,200,.45); }
.hrSortCard.selected { background: rgba(21,255,200,.18); border-color: rgba(21,255,200,.80); box-shadow: 0 0 0 2px rgba(21,255,200,.40); color: #fff; }
.hrSortCard.placed-healthy { opacity: .5; background: rgba(21,255,100,.08); pointer-events:none; }
.hrSortCard.placed-unhealthy { opacity: .5; background: rgba(255,80,80,.08); pointer-events:none; }
.hrDropZone.zone-active.green-zone { border-color: rgba(21,255,100,.75); background: rgba(21,255,100,.10); box-shadow: 0 0 14px rgba(21,255,100,.18); }
.hrDropZone.zone-active.red-zone { border-color: rgba(255,80,80,.70); background: rgba(255,80,80,.10); box-shadow: 0 0 14px rgba(255,80,80,.15); }

.hrDropZone {
  border-radius: 14px;
  padding: 10px;
  min-height: 80px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-content: flex-start;
  align-items: flex-start;
  transition: border-color .15s, background .15s, box-shadow .15s;
}
.hrDropZone.green-zone {
  border: 2px dashed rgba(21,255,100,.35);
  background: rgba(21,255,100,.04);
}
.hrDropZone.red-zone {
  border: 2px dashed rgba(255,80,80,.30);
  background: rgba(255,80,80,.04);
}
.hrDropZoneLabel {
  font-size: 11px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: .4px;
  margin-bottom: 6px;
}
.hrDropZone.green-zone .hrDropZoneLabel { color: rgba(21,255,100,.80); }
.hrDropZone.red-zone .hrDropZoneLabel { color: rgba(255,80,80,.75); }
.hrPlacedTag {
  border-radius: 8px;
  padding: 5px 8px;
  font-size: 11px;
  font-weight: 700;
  line-height: 1.3;
  display: inline-block;
  word-break: break-word;
}
.hrPlacedTag.healthy { background: rgba(21,255,100,.14); color: #b8ffcc; border: 1px solid rgba(21,255,100,.35); }
.hrPlacedTag.unhealthy { background: rgba(255,80,80,.12); color: #ffd1d1; border: 1px solid rgba(255,80,80,.30); }

.hrScoreBox {
  margin-top: 10px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(21,255,200,.25);
  background: rgba(21,255,200,.07);
  font-size: 13px;
  color: var(--sb-light);
  line-height: 1.5;
  display: none;
}
.hrScoreBox.show { display: block; }




/* =====================================================
   RAIN WINDOW — Sad
   ===================================================== */
.rainWrap{
  position:relative;
  border-radius:16px;
  overflow:hidden;
  background:linear-gradient(180deg, rgba(5,15,25,.98), rgba(8,25,38,.97));
  border:1px solid rgba(209,254,255,.14);
  box-shadow:var(--shadow);
  height:260px;
  margin:12px 0;
  cursor:crosshair;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.rainCanvas{
  position:absolute;inset:0;
  width:100%;height:100%;
  display:block;
}
.rainGlass{
  position:absolute;inset:0;
  background:linear-gradient(180deg,
    rgba(209,254,255,.03) 0%,
    rgba(209,254,255,.01) 60%,
    rgba(19,132,143,.04) 100%
  );
  pointer-events:none;
}
.rainMsg{
  position:absolute;
  top:50%;left:0;right:0;
  transform:translateY(-50%);
  text-align:center;
  font-size:15px;font-weight:900;
  color:rgba(21,255,200,.0);
  padding:0 24px;
  line-height:1.5;
  transition:color 1s ease, opacity 1s ease;
  pointer-events:none;
  letter-spacing:.3px;
  text-shadow:0 0 20px rgba(21,255,200,.6), 0 0 40px rgba(21,255,200,.3);
}
.rainMsg.show{
  color:rgba(21,255,200,.92);
  animation: rainMsgRise .9s cubic-bezier(.22,.68,0,1.2) forwards;
}
@keyframes rainMsgRise{
  0%   { opacity:0; transform:translateY(calc(-50% + 28px)); }
  100% { opacity:1; transform:translateY(-50%); }
}
#rainContinue{ transition:opacity .5s ease; }

/* =====================================================
   CROWD VOLUME KNOB — Embarrassed
   ===================================================== */
.crowdKnobWrap{
  position:relative;
  margin:12px 0;
  border-radius:16px;
  border:1px solid rgba(209,254,255,.14);
  background:linear-gradient(180deg, rgba(8,20,28,.97), rgba(5,15,22,.99));
  overflow:hidden;
  padding:16px 16px 14px;
  min-height:280px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
/* Floating noise words */
.crowdWords{
  position:absolute;
  inset:0;
  pointer-events:none;
  overflow:hidden;
  z-index:1;
}
.crowdWord{
  position:absolute;
  font-size:11px;
  font-weight:700;
  color:rgba(255,100,80,0.7);
  letter-spacing:.3px;
  white-space:nowrap;
  animation:crowdFloat linear infinite;
  transition:opacity .4s ease, transform .4s ease;
  pointer-events:none;
  text-shadow:0 0 8px rgba(255,80,60,.35);
  max-width:40%;
  overflow:hidden;
  text-overflow:ellipsis;
}
@keyframes crowdFloat{
  0%   { transform:translateY(0px); }
  50%  { transform:translateY(-6px); }
  100% { transform:translateY(0px); }
}
/* Knob area */
.crowdKnobArea{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  z-index:3;
  margin-top:8px;
}
.crowdKnobLabel{
  font-size:10px;font-weight:900;
  text-transform:uppercase;letter-spacing:.6px;
  color:rgba(255,120,80,.75);
  transition:color .5s ease;
  min-height:14px;
  text-align:center;
}
.crowdKnobRing{
  position:relative;
  width:180px;height:180px;
  cursor:grab;
  touch-action:none;
  -webkit-tap-highlight-color:transparent;
  user-select:none;
}
.crowdKnobRing:active{ cursor:grabbing; }
#crowdKnobCanvas{
  display:block;
  width:180px;height:180px;
  border-radius:999px;
}
.crowdKnobHandle{
  position:absolute;
  inset:0;
  pointer-events:none;
}
.crowdVolNum{
  font-size:28px;font-weight:900;
  color:rgba(255,120,80,.85);
  font-variant-numeric:tabular-nums;
  letter-spacing:-.5px;
  transition:color .4s ease;
  line-height:1;
  min-width:60px;
  text-align:center;
}
.crowdMsg{
  text-align:center;
  font-size:13px;font-weight:900;
  color:rgba(21,255,200,.0);
  line-height:1.4;
  transition:color .6s ease;
  padding:0 6px;
  min-height:18px;
  z-index:4;
  position:relative;
  max-width:280px;
  background:linear-gradient(180deg, transparent, rgba(8,20,28,.85) 30%);
  border-radius:8px;
  padding:6px 10px;
}
.crowdMsg.show{ color:rgba(21,255,200,.90); }
#eyeContinue{ transition:opacity .5s ease; }

/* =====================================================
   VIBE JUKEBOX — Okay
   ===================================================== */
.vjWrap{ margin:12px 0; }
.vjTiles{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.vjTile{
  appearance:none;
  border:1px solid rgba(209,254,255,.18);
  background:rgba(255,255,255,.05);
  color:var(--text);
  border-radius:16px;
  padding:14px 12px;
  cursor:pointer;
  text-align:left;
  display:flex;
  flex-direction:column;
  gap:4px;
  transition:background .15s, border-color .15s, transform .08s;
  -webkit-tap-highlight-color:transparent;
}
.vjTile:hover{
  background:rgba(21,255,200,.12);
  border-color:rgba(21,255,200,.45);
}
.vjTile:active{ transform:scale(.97); }
.vjEmoji{ font-size:24px; line-height:1; margin-bottom:2px; }
.vjLabel{ font-size:14px; font-weight:900; color:rgba(209,254,255,.95); }
.vjSub{ font-size:11px; color:rgba(209,254,255,.58); line-height:1.35; }
.vjCardTitle{ font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(209,254,255,.55);margin-bottom:10px; }
.vjCard{
  border:1px solid rgba(209,254,255,.16);
  background:rgba(0,0,0,.18);
  border-radius:14px;
  padding:16px;
}
.vjCardPip{ font-size:11px;color:rgba(209,254,255,.45);font-weight:900;margin-bottom:8px; }
.vjCardHead{ font-size:16px;font-weight:900;color:rgba(209,254,255,.96);margin-bottom:8px;line-height:1.25; }
.vjCardBody{ font-size:13px;color:rgba(209,254,255,.80);line-height:1.5; }
/* ===== ACCUSED MODULE ===== */
.accFeelingGrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-bottom:6px;
}
.accFeeling{
  appearance:none;border:1px solid rgba(209,254,255,.18);
  background:rgba(255,255,255,.05);
  color:var(--text);border-radius:12px;
  padding:10px 12px;font-size:13px;font-weight:800;
  cursor:pointer;text-align:left;
  transition:background .15s,border-color .15s,transform .06s;
}
.accFeeling:hover{background:rgba(21,255,200,.12);border-color:rgba(21,255,200,.45);}
.accFeeling:active{transform:scale(.97);}
.accFeeling.on{background:rgba(21,255,200,.18);border-color:rgba(21,255,200,.65);color:#fff;}

/* Flip cards */
.accFlipRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.accFlipCard{perspective:600px;cursor:pointer;height:160px;}
.accFlipCardFull{perspective:600px;cursor:pointer;height:110px;grid-column:span 2;}
@media(max-width:400px){
  .accFlipCard{height:200px;}
  .accFlipCardFull{height:130px;}
}
.accFlipInner{
  position:relative;width:100%;height:100%;
  transform-style:preserve-3d;
  transition:transform .45s cubic-bezier(.4,0,.2,1);
}
.accFlipCard.flipped .accFlipInner{transform:rotateY(180deg);}
.accFlipFront,.accFlipBack{
  position:absolute;inset:0;backface-visibility:hidden;
  border-radius:14px;padding:14px;
  border:1px solid rgba(209,254,255,.18);
  background:rgba(255,255,255,.05);
  display:flex;flex-direction:column;justify-content:space-between;
  overflow-y:auto;
}
.accFlipBack{
  transform:rotateY(180deg);
  background:rgba(21,255,200,.10);
  border-color:rgba(21,255,200,.40);
  justify-content:center;
}
.accFlipLabel{font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(209,254,255,.55);margin-bottom:4px;}
.accFlipQ{font-size:14px;font-weight:900;color:rgba(209,254,255,.95);line-height:1.3;}
.accFlipHint{font-size:11px;color:rgba(21,255,200,.70);font-weight:800;margin-top:8px;}
.accFlipBackText{font-size:12px;color:rgba(209,254,255,.90);line-height:1.5;display:flex;align-items:center;}

/* Myth cards */
.accMythStack{display:grid;gap:10px;}
.accMyth{
  border-radius:14px;border:1px solid rgba(209,254,255,.18);
  background:rgba(255,255,255,.05);
  overflow:hidden;cursor:pointer;
  transition:border-color .2s;
}
.accMyth.open{border-color:rgba(21,255,200,.45);cursor:default;}
.accMythFront{padding:14px 16px;}
.accMythStatement{font-size:14px;font-weight:900;color:rgba(209,254,255,.95);margin-bottom:6px;line-height:1.3;}
.accMythTap{font-size:11px;color:rgba(21,255,200,.65);font-weight:800;}
.accMythBack{display:none;padding:14px 16px;background:rgba(21,255,200,.07);}
.accMyth.open .accMythFront .accMythTap{display:none;}
.accMyth.open .accMythBack{display:block;}
.accMythVerdict{
  display:inline-block;
  padding:3px 10px;border-radius:999px;
  font-size:11px;font-weight:900;
  margin-bottom:8px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(209,254,255,.20);
  color:rgba(209,254,255,.90);
}
.accMythVerdict.not-exactly{background:rgba(200,50,30,.20);border-color:rgba(200,80,60,.45);color:rgba(255,160,140,.95);}
.accMythVerdict.complicated{background:rgba(255,160,40,.15);border-color:rgba(255,180,60,.35);color:rgba(255,210,120,.95);}
.accMythVerdict.incomplete{background:rgba(255,160,40,.15);border-color:rgba(255,180,60,.35);color:rgba(255,210,120,.95);}
.accMythVerdict.rarely-true{background:rgba(200,50,30,.18);border-color:rgba(200,80,60,.38);color:rgba(255,160,140,.90);}
.accMythExplain{font-size:12px;color:rgba(209,254,255,.85);line-height:1.5;}

/* Signal list */
.accSignalList{display:grid;gap:8px;}
.accSignal{
  appearance:none;border:1px solid rgba(209,254,255,.18);
  background:rgba(255,255,255,.05);
  color:var(--text);border-radius:12px;
  padding:11px 14px;font-size:13px;font-weight:800;
  cursor:pointer;text-align:left;
  transition:background .15s,border-color .15s,transform .06s;
}
.accSignal:hover{background:rgba(21,255,200,.12);border-color:rgba(21,255,200,.45);}
.accSignal:active{transform:scale(.98);}
.accSignal.on{background:rgba(21,255,200,.18);border-color:rgba(21,255,200,.65);color:#fff;}
.accSignal[data-s="none"].on{background:rgba(21,255,200,.12);border-color:rgba(21,255,200,.35);}

/* Accountability steps */
.accAccSteps{display:grid;gap:0;}
.accAccStep{
  display:flex;align-items:flex-start;gap:14px;
  padding:14px 14px 14px 0;
  border-bottom:1px solid rgba(209,254,255,.08);
  opacity:.35;
  cursor:default;
  transition:opacity .3s;
}
.accAccStep.active{opacity:1;cursor:pointer;}
.accAccStep.done{opacity:.65;cursor:default;}
.accAccStep.active:hover .accAccDot{box-shadow:0 0 0 4px rgba(21,255,200,.25);}
.accAccDot{
  width:12px;height:12px;min-width:12px;
  border-radius:999px;
  border:2px solid rgba(209,254,255,.30);
  background:transparent;
  margin-top:4px;
  transition:background .2s,border-color .2s;
}
.accAccStep.active .accAccDot{border-color:rgba(21,255,200,.80);background:rgba(21,255,200,.25);}
.accAccStep.done .accAccDot{background:rgba(21,255,200,.60);border-color:rgba(21,255,200,.80);}
.accAccTitle{font-size:14px;font-weight:900;color:rgba(209,254,255,.95);margin-bottom:4px;line-height:1.2;}
.accAccText{font-size:12px;color:rgba(209,254,255,.75);line-height:1.5;}
.accAccStep.active .accAccTitle::after{content:" — tap to continue";font-size:11px;font-weight:600;color:rgba(21,255,200,.60);margin-left:4px;}
.accAccStep.done .accAccTitle::after{content:" ✓";color:rgba(21,255,200,.70);}

/* Resources */
.accResourceList{display:grid;gap:10px;}
.accResource{
  border:1px solid rgba(209,254,255,.14);
  background:rgba(0,0,0,.14);
  border-radius:14px;padding:14px 16px;
}
.accResourceHead{font-size:14px;font-weight:900;color:rgba(209,254,255,.95);margin-bottom:6px;}
.accResourceBody{font-size:12px;color:rgba(209,254,255,.78);line-height:1.5;}

/* ===== REJECTION MODULE ===== */
.rejHeader{
  text-align:center;
  padding: 10px 0 18px;
}
.rejHeader .rejEyebrow{
  font-size:11px;letter-spacing:.2em;text-transform:uppercase;
  color:var(--sb-mint);opacity:.7;margin-bottom:8px;
}
.rejHeader h2{
  font-size:22px;font-weight:900;line-height:1.2;margin:0 0 6px;
}
.rejHeader p{
  font-size:13px;color:var(--muted);line-height:1.45;
}

/* Step progress bar */
.rejProgress{
  display:flex;gap:4px;margin-bottom:20px;
}
.rejStep{
  flex:1;height:3px;border-radius:99px;
  background:rgba(209,254,255,.12);
  transition:background .4s;
}
.rejStep.done{ background:var(--sb-mint); }
.rejStep.active{ background:rgba(21,255,200,.5); }

/* Panel wrapper for each step */
.rejPanel{ display:none; }
.rejPanel.active{ display:block; animation: rejFadeIn .3s ease; }
@keyframes rejFadeIn{
  from{opacity:0;transform:translateY(8px)}
  to{opacity:1;transform:translateY(0)}
}

/* Feeling picker */
.rejFeelingGrid{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:8px;margin:14px 0;
}
@media(max-width:400px){.rejFeelingGrid{grid-template-columns:repeat(2,1fr)}}
.rejFeelingBtn{
  appearance:none;border:1px solid var(--border);
  background:rgba(255,255,255,.04);border-radius:14px;
  padding:14px 8px;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;gap:6px;
  transition:all .2s;color:var(--text);
  font-family:inherit;
}
.rejFeelingBtn:hover{
  border-color:rgba(21,255,200,.5);
  background:rgba(21,255,200,.07);
}
.rejFeelingBtn.sel{
  border-color:var(--sb-mint);
  background:rgba(21,255,200,.10);
  box-shadow:0 0 12px rgba(21,255,200,.15);
}
.rejFeelingBtn .rfe{ font-size:1.6rem;line-height:1; }
.rejFeelingBtn .rfl{ font-size:11px;font-weight:700;color:var(--muted); }
.rejFeelingBtn.sel .rfl{ color:var(--sb-light); }
.rejFeelingResponse{
  border-left:3px solid var(--sb-mint);
  background:rgba(21,255,200,.08);
  border-radius:12px;padding:12px 14px;
  font-size:13px;line-height:1.5;
  display:none;margin-bottom:14px;
}
.rejFeelingResponse.show{display:block;animation:rejFadeIn .3s ease;}
.rejFeelingResponse strong{color:var(--sb-light);display:block;margin-bottom:4px;font-size:14px;}

/* Myth/truth tap cards */
.rejMythGrid{ display:flex;flex-direction:column;gap:6px;margin:14px 0; }
.rejMythCard{
  border:1px solid var(--border);border-radius:14px;
  background:rgba(255,255,255,.04);overflow:hidden;
  cursor:pointer;transition:all .2s;
}
.rejMythCard:hover{ background:rgba(255,255,255,.06); }
.rejMythCard.open{ border-color:rgba(21,255,200,.35);background:rgba(21,255,200,.05); }
.rejMythHead{
  display:flex;align-items:center;gap:10px;
  padding:12px 14px;
}
.rejMythIcon{ font-size:1.2rem;flex-shrink:0; }
.rejMythTexts{ flex:1;min-width:0; }
.rejMythMuted{
  font-size:11px;color:var(--muted);
  text-decoration:line-through;line-height:1.3;
}
.rejMythTitle{ font-size:13px;font-weight:800;line-height:1.3;margin-top:2px; }
.rejMythChev{
  width:26px;height:26px;border-radius:999px;
  border:1px solid var(--border);background:rgba(0,0,0,.12);
  display:grid;place-items:center;font-size:12px;flex-shrink:0;
  transition:transform .2s;
}
.rejMythCard.open .rejMythChev{ transform:rotate(45deg);border-color:rgba(21,255,200,.3); }
.rejMythBody{
  max-height:0;overflow:hidden;
  transition:max-height .35s ease,padding .25s;
  font-size:12.5px;color:var(--muted);line-height:1.5;
  padding: 0 14px;
}
.rejMythCard.open .rejMythBody{ max-height:120px;padding:0 14px 14px; }

/* "NO" explorer */
.rejNoStage{
  text-align:center;padding:20px 0 10px;
}
.rejNoBig{
  font-size:clamp(5rem,20vw,8rem);font-weight:900;
  line-height:1;cursor:pointer;
  color:var(--sb-light);
  text-shadow:0 0 40px rgba(21,255,200,.2);
  transition:transform .2s,text-shadow .2s;
  user-select:none;display:inline-block;
}
.rejNoBig:hover{ transform:scale(1.06);text-shadow:0 0 60px rgba(21,255,200,.35); }
.rejNoBig.tapped{ color:var(--sb-mint);cursor:default; }
.rejNoHint{ font-size:11px;color:var(--muted);margin-top:6px;letter-spacing:.05em; }
.rejMeaningGrid{
  display:grid;grid-template-columns:1fr 1fr;gap:8px;
  margin-top:14px;
}
@media(max-width:400px){.rejMeaningGrid{grid-template-columns:1fr}}
.rejMeaningPill{
  border-radius:12px;padding:10px 12px;
  font-size:12px;line-height:1.5;
  opacity:0;transform:scale(.95);
  transition:opacity .3s,transform .3s;
}
.rejMeaningPill.show{opacity:1;transform:scale(1)}
.rejMeaningPill.fact{
  border:1px solid rgba(21,255,200,.3);
  background:rgba(21,255,200,.07);color:var(--sb-light);
}
.rejMeaningPill.myth{
  border:1px solid rgba(19,132,143,.4);
  background:rgba(19,132,143,.08);color:var(--muted);
}
.rejMeaningTag{
  display:block;font-size:10px;font-weight:800;
  letter-spacing:.1em;text-transform:uppercase;margin-bottom:4px;
}
.fact .rejMeaningTag{ color:var(--sb-mint); }
.myth .rejMeaningTag{ color:var(--sb-teal); }

/* Reasons accordion */
.rejReasonList{ display:flex;flex-direction:column;gap:5px;margin:14px 0; }
.rejReasonRow{
  border:1px solid var(--border);border-radius:14px;
  background:rgba(255,255,255,.04);overflow:hidden;
  cursor:pointer;transition:all .2s;
}
.rejReasonRow:hover{ background:rgba(255,255,255,.06); }
.rejReasonRow.open{ border-color:rgba(21,255,200,.35);background:rgba(21,255,200,.05); }
.rejReasonHead{
  display:flex;align-items:center;gap:10px;padding:12px 14px;
}
.rejReasonNum{
  font-size:1.4rem;font-weight:900;color:rgba(209,254,255,.15);
  width:28px;flex-shrink:0;font-family:ui-sans-serif;
  transition:color .2s;
}
.rejReasonRow.open .rejReasonNum{ color:var(--sb-mint); }
.rejReasonLabel{ flex:1;min-width:0; }
.rejReasonTag{ font-size:10px;font-weight:800;letter-spacing:.1em;text-transform:uppercase;color:var(--sb-mint);display:block; }
.rejReasonTitle{ font-size:13px;font-weight:700;line-height:1.3;margin-top:1px; }
.rejReasonChev{
  width:26px;height:26px;border-radius:999px;
  border:1px solid var(--border);background:rgba(0,0,0,.12);
  display:grid;place-items:center;font-size:12px;flex-shrink:0;
  transition:transform .2s;
}
.rejReasonRow.open .rejReasonChev{ transform:rotate(180deg);border-color:rgba(21,255,200,.3); }
.rejReasonBody{
  max-height:0;overflow:hidden;
  transition:max-height .35s ease,padding .25s;
  font-size:12.5px;color:var(--muted);line-height:1.55;
  padding:0 14px 0 52px;
}
.rejReasonRow.open .rejReasonBody{ max-height:100px;padding:0 14px 14px 52px; }

/* Stat */
.rejStatBlock{
  text-align:center;
  background:rgba(19,132,143,.15);
  border:1px solid rgba(19,132,143,.4);
  border-radius:16px;padding:24px 18px;margin:14px 0;
}
.rejStatNum{
  font-size:clamp(3.5rem,15vw,5.5rem);font-weight:900;
  color:var(--sb-mint);line-height:1;margin-bottom:6px;
}
.rejStatBody{ font-size:13px;line-height:1.55;margin-bottom:10px; }
.rejStatNote{
  font-size:12px;color:var(--muted);line-height:1.5;
  border-top:1px solid var(--border);padding-top:12px;font-style:italic;
}

/* Scenario */
.rejScenarioCard{
  border:1px solid var(--border);border-radius:16px;
  background:rgba(255,255,255,.04);padding:16px;margin-bottom:12px;
}
.rejScenarioText{
  font-size:14px;line-height:1.55;margin-bottom:14px;font-style:italic;color:var(--sb-light);
}
.rejScenarioQ{ font-size:12px;font-weight:700;color:var(--muted);margin-bottom:10px; }
.rejOptList{ display:flex;flex-direction:column;gap:7px; }
.rejOpt{
  appearance:none;border:1px solid var(--border);
  background:rgba(255,255,255,.04);border-radius:12px;
  padding:11px 14px;text-align:left;cursor:pointer;
  font-family:inherit;font-size:13px;color:var(--text);
  display:flex;align-items:flex-start;gap:10px;
  transition:all .2s;
}
.rejOpt:hover{ border-color:rgba(21,255,200,.4);background:rgba(21,255,200,.06); }
.rejOpt.good-chosen{ border-color:var(--sb-mint);background:rgba(21,255,200,.10);color:var(--sb-light); }
.rejOpt.bad-chosen{ border-color:rgba(200,80,80,.6);background:rgba(200,80,80,.08);color:#f7b8b8; }
.rejOpt.fade-good{ opacity:.35;border-color:rgba(21,255,200,.15); }
.rejOpt.fade-bad{ opacity:.35;border-color:rgba(200,80,80,.15); }
.rejOptEmoji{ flex-shrink:0;font-size:1rem; }
.rejFeedback{
  border-radius:12px;padding:12px 14px;margin-top:10px;
  font-size:12.5px;line-height:1.55;display:none;
  border-left:3px solid var(--fb,var(--sb-mint));
  background:rgba(21,255,200,.06);
}
.rejFeedback.show{display:block;animation:rejFadeIn .3s ease;}
.rejFeedback.bad{ background:rgba(200,80,80,.06);border-color:rgba(200,80,80,.5); }
.rejFeedback strong{ display:block;margin-bottom:4px;font-size:13px; }
.rejScenarioNav{
  display:flex;align-items:center;justify-content:space-between;
  font-size:12px;color:var(--muted);
}

/* Journal */
.rejJournalTabs{
  display:flex;gap:3px;
  background:rgba(255,255,255,.04);
  border-radius:12px;padding:3px;
  margin-bottom:14px;
}
.rejJTab{
  flex:1;padding:8px 4px;border-radius:9px;border:none;
  font-family:inherit;font-size:11px;font-weight:700;
  color:var(--muted);background:transparent;cursor:pointer;
  transition:all .2s;text-align:center;
}
.rejJTab.on{ background:rgba(21,255,200,.12);color:var(--sb-light); }
.rejJPanel{ display:none; }
.rejJPanel.on{ display:block;animation:rejFadeIn .25s ease; }
.rejJPrompt{
  font-size:14px;font-style:italic;font-weight:700;
  color:var(--sb-light);line-height:1.45;
  margin-bottom:8px;
}
.rejJHint{ font-size:12px;color:var(--muted);line-height:1.4;margin-bottom:10px; }
.rejJTa{
  width:100%;min-height:90px;
  background:rgba(0,0,0,.2);border:1px solid var(--border);
  border-radius:12px;padding:12px;
  font-family:inherit;font-size:13px;color:var(--text);
  resize:vertical;outline:none;line-height:1.6;
  transition:border-color .2s;
}
.rejJTa:focus{ border-color:rgba(21,255,200,.45); }
.rejJTa::placeholder{ color:rgba(209,254,255,.3); }
.rejWC{ font-size:11px;color:var(--muted);text-align:right;margin-top:4px; }
.rejJAffirm{
  margin-top:10px;padding:10px 12px;
  border-left:2px solid var(--sb-mint);
  background:rgba(21,255,200,.06);border-radius:10px;
  font-size:12px;color:var(--muted);line-height:1.5;
  display:none;
}
.rejJAffirm.show{display:block;animation:rejFadeIn .4s ease;}
.rejJAffirm b{ color:var(--sb-mint); }

/* Affirmations */
.rejAffirmCard{
  border:1px solid var(--border);border-radius:16px;
  padding:28px 20px;text-align:center;
  background:rgba(255,255,255,.04);margin:14px 0;
  position:relative;overflow:hidden;min-height:140px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
}
.rejAffirmCard::before{
  content:'';position:absolute;width:200px;height:200px;border-radius:50%;
  background:radial-gradient(circle,rgba(21,255,200,.06),transparent 70%);
  top:-60px;right:-60px;pointer-events:none;
}
.rejAffirmEmoji{ font-size:2rem;margin-bottom:10px;display:block; }
.rejAffirmText{
  font-size:15px;font-style:italic;font-weight:700;
  line-height:1.5;color:var(--sb-light);
  opacity:0;transition:opacity .4s;
}
.rejAffirmText.show{ opacity:1; }
.rejAffirmControls{
  display:flex;align-items:center;justify-content:center;gap:14px;margin-top:4px;
}
.rejAffirmArrow{
  width:36px;height:36px;border-radius:50%;
  border:1px solid var(--border);background:rgba(255,255,255,.04);
  color:var(--text);font-size:1rem;cursor:pointer;
  display:grid;place-items:center;transition:all .2s;
}
.rejAffirmArrow:hover{ border-color:rgba(21,255,200,.5);background:rgba(21,255,200,.08); }
.rejADots{ display:flex;gap:5px; }
.rejADot{ width:5px;height:5px;border-radius:50%;background:rgba(209,254,255,.2);cursor:pointer;transition:all .2s; }
.rejADot.on{ background:var(--sb-mint);transform:scale(1.5); }
.rejSaveBtn{
  appearance:none;border:1px solid var(--border);background:transparent;
  color:var(--muted);padding:8px 18px;border-radius:999px;
  font-family:inherit;font-size:12px;cursor:pointer;
  transition:all .2s;margin-top:8px;
}
.rejSaveBtn:hover{ border-color:rgba(21,255,200,.5);color:var(--sb-mint); }
.rejSaveBtn.saved{ border-color:rgba(21,255,200,.5);color:var(--sb-mint); }
.rejSavedList{
  margin-top:12px;background:rgba(0,0,0,.15);border-radius:14px;
  padding:12px;display:none;
}
.rejSavedList.show{display:block}
.rejSavedList h4{ font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:8px; }
.rejSavedItem{
  font-size:12px;font-style:italic;color:var(--sb-mint);
  padding:6px 0;border-bottom:1px solid var(--border);line-height:1.45;
}
.rejSavedItem:last-child{border:none}

/* Wrap up pills */
.rejWrapPills{
  display:flex;flex-wrap:wrap;gap:7px;margin:14px 0;justify-content:center;
}
.rejWrapPill{
  border:1px solid var(--border);background:rgba(255,255,255,.04);
  border-radius:999px;padding:7px 14px;font-size:12px;color:var(--muted);
  transition:all .2s;cursor:default;
}
.rejWrapPill:hover{ border-color:rgba(21,255,200,.4);color:var(--sb-light); }

/* Nav buttons inside rejection */
.rejNavRow{ display:flex;gap:8px;margin-top:16px; }
.rejNavRow .btn{ flex:1; }

/* ===== Bystander modal additions ===== */
.biSectionHead{
  font-size:13px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:.4px;
  color:var(--sb-mint);
  margin-bottom:8px;
}
.biNum{
  font-size:12px;
  font-weight:900;
  color:var(--sb-mint);
  letter-spacing:.3px;
  margin-bottom:5px;
  text-transform:uppercase;
}
.biBarriers{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  margin-bottom:4px;
}
@media(max-width:480px){ .biBarriers{ grid-template-columns:1fr; } }
.biBarrier{
  font-size:12px;
  color:var(--muted);
  padding:8px 10px;
  border-radius:8px;
  border:1px solid rgba(255,120,120,.2);
  background:rgba(255,80,80,.05);
  font-style:italic;
}
.biBaeCode{
  display:flex;
  flex-direction:column;
  gap:5px;
}
.biBaeItem{
  font-size:13px;
  color:var(--muted);
  padding:8px 12px;
  border-radius:8px;
  border:1px solid rgba(209,254,255,.12);
  background:rgba(21,255,200,.05);
  position:relative;
  padding-left:24px;
}
.biBaeItem::before{
  content:'✓';
  position:absolute;
  left:8px;
  color:var(--sb-mint);
  font-weight:900;
  font-size:11px;
}

/* ===== Signal Board ===== */
.sbIntro{
  font-size:13px; color:rgba(209,254,255,.65); line-height:1.5;
  margin-bottom:18px;
}
.sbIntro b{ color:rgba(209,254,255,.90); }
.sbGrid{
  display:grid; grid-template-columns:1fr 1fr; gap:9px; margin-bottom:20px;
}
.sbSignal{
  position:relative; border-radius:14px;
  border:1px solid rgba(209,254,255,.14);
  background:rgba(0,0,0,.18);
  padding:12px 12px 12px 14px; cursor:pointer;
  user-select:none; -webkit-tap-highlight-color:transparent;
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease, transform .1s ease;
  display:flex; flex-direction:column; gap:5px;
}
.sbSignal:hover{ background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.28); }
.sbSignal:active{ transform:scale(.97); }
.sbSignal.active{
  border-color:rgba(255,100,60,.60);
  background:linear-gradient(135deg, rgba(255,80,40,.12), rgba(29,65,78,.18));
  box-shadow:0 0 0 1px rgba(255,100,60,.20), 0 4px 14px rgba(0,0,0,.25);
}
.sbSignal.active .sbSignalCheck{ opacity:1; transform:scale(1); }
.sbSignalEmoji{ font-size:20px; line-height:1; }
.sbSignalLabel{ font-size:12px; font-weight:850; line-height:1.25; color:rgba(209,254,255,.88); }
.sbSignalSub{ font-size:11px; color:rgba(209,254,255,.48); line-height:1.3; }
.sbSignalCheck{
  position:absolute; top:8px; right:9px;
  width:18px; height:18px; border-radius:999px;
  background:rgba(255,100,60,.85); display:grid; place-items:center;
  opacity:0; transform:scale(.6);
  transition:opacity .15s ease, transform .18s cubic-bezier(.22,1.3,.36,1);
}
.sbMeterWrap{ margin-bottom:18px; }
.sbMeterLabel{ display:flex; justify-content:space-between; align-items:baseline; margin-bottom:8px; }
.sbMeterTitle{ font-size:11px; font-weight:900; letter-spacing:.5px; text-transform:uppercase; color:rgba(209,254,255,.55); }
.sbMeterPhrase{ font-size:12px; font-weight:850; transition:color .4s ease; }
.sbMeterTrack{
  height:10px; border-radius:999px; background:rgba(0,0,0,.25);
  border:1px solid rgba(209,254,255,.10); overflow:hidden; position:relative;
}
.sbMeterFill{
  height:100%; border-radius:999px; width:0%;
  transition:width .55s cubic-bezier(.22,1,.36,1), background .55s ease;
  background:rgba(21,255,200,.80); position:relative;
}
.sbMeterFill::after{
  content:''; position:absolute; inset:0;
  background:linear-gradient(90deg, transparent 60%, rgba(255,255,255,.25));
  border-radius:999px;
}
.sbReframe{
  border-radius:14px; padding:14px 16px;
  border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.14);
  min-height:64px; transition:border-color .4s ease, background .4s ease; margin-bottom:18px;
}
.sbReframe.warm{
  border-color:rgba(255,100,60,.35);
  background:linear-gradient(135deg, rgba(255,60,30,.08), rgba(29,65,78,.15));
}
.sbReframeInner{ font-size:13px; line-height:1.5; color:rgba(209,254,255,.82); transition:opacity .3s ease; }
.sbReframeInner b{ color:rgba(209,254,255,.96); }
.sbReframeTag{
  display:inline-block; font-size:10px; font-weight:900; letter-spacing:.5px; text-transform:uppercase;
  color:rgba(255,140,80,.85); background:rgba(255,100,60,.12); border:1px solid rgba(255,100,60,.28);
  border-radius:999px; padding:2px 9px; margin-bottom:8px;
  opacity:0; transform:translateY(4px); transition:opacity .3s ease .1s, transform .3s ease .1s;
}
.sbReframe.warm .sbReframeTag{ opacity:1; transform:translateY(0); }
.sbCountRow{ display:flex; gap:10px; margin-bottom:6px; flex-wrap:wrap; }
.sbCountPill{
  font-size:11px; font-weight:900; padding:3px 10px;
  border-radius:999px; border:1px solid rgba(209,254,255,.16);
  background:rgba(0,0,0,.16); color:rgba(209,254,255,.65);
  transition:border-color .3s ease, background .3s ease, color .3s ease;
}
.sbCountPill.lit{
  border-color:rgba(255,100,60,.45); background:rgba(255,80,40,.14); color:rgba(255,160,110,.95);
}
@media(prefers-reduced-motion:reduce){
  .sbSignal,.sbSignalCheck,.sbMeterFill,.sbReframe,.sbReframeTag,.sbCountPill{ transition:none !important; }
}

/* ===== Commitment Forge ===== */
.forgeWrap{
  margin-top: 18px;
}
.forgeLabel{
  font-size: 12px;
  letter-spacing: .5px;
  text-transform: uppercase;
  font-weight: 900;
  color: rgba(209,254,255,.60);
  margin-bottom: 8px;
}
.forgeTextarea{
  width:100%;
  min-height: 80px;
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(209,254,255,.20);
  border-radius: 12px;
  color: var(--sb-light);
  font-size: 14px;
  font-family: inherit;
  padding: 12px 14px;
  resize: vertical;
  outline: none;
  transition: border-color .2s ease, box-shadow .2s ease;
  line-height: 1.45;
}
.forgeTextarea::placeholder{ color: rgba(209,254,255,.35); }
.forgeTextarea:focus{
  border-color: rgba(21,255,200,.55);
  box-shadow: 0 0 0 3px rgba(21,255,200,.12);
}
.forgeBtn{
  margin-top: 10px;
  width: 100%;
  padding: 13px 18px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  font-family: inherit;
  font-weight: 900;
  font-size: 14px;
  background: linear-gradient(135deg, rgba(21,255,200,.95), rgba(19,132,143,.80));
  color: #041114;
  transition: transform .1s ease, box-shadow .2s ease, opacity .2s ease;
  box-shadow: 0 0 0 rgba(21,255,200,0);
}
.forgeBtn:hover{
  box-shadow: 0 0 20px rgba(21,255,200,.35);
  transform: translateY(-1px);
}
.forgeBtn:active{ transform: translateY(1px); }
.forgeBtn:disabled{ opacity: .4; cursor: default; transform: none; box-shadow: none; }

/* Forged Card */
.forgedCardWrap{
  display: none;
  margin-top: 16px;
  position: relative;
}
.forgedCardWrap.show{ display: block; }
.forgedCard{
  border-radius: 18px;
  padding: 20px 22px;
  background: linear-gradient(135deg,
    rgba(21,255,200,.12) 0%,
    rgba(19,132,143,.18) 50%,
    rgba(29,65,78,.30) 100%
  );
  border: 1px solid rgba(21,255,200,.45);
  box-shadow: 0 0 0 rgba(21,255,200,0);
  animation: forgeIn .55s cubic-bezier(.22,1.2,.36,1) forwards;
  position: relative;
  overflow: hidden;
}
@keyframes forgeIn{
  0%  { opacity:0; transform: scale(.88) translateY(12px); box-shadow: 0 0 0 rgba(21,255,200,0); }
  60% { box-shadow: 0 0 36px rgba(21,255,200,.30); }
  100%{ opacity:1; transform: scale(1) translateY(0); box-shadow: 0 0 18px rgba(21,255,200,.14); }
}
.forgedCard::before{
  content:"";
  position:absolute;
  inset:0;
  background: repeating-linear-gradient(
    -45deg,
    transparent 0px,
    transparent 18px,
    rgba(21,255,200,.025) 18px,
    rgba(21,255,200,.025) 20px
  );
  pointer-events:none;
}
.forgedCardMeta{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom: 10px;
}
.forgedCardBadge{
  font-size: 10px;
  font-weight: 900;
  letter-spacing: .7px;
  text-transform: uppercase;
  color: rgba(21,255,200,.85);
  background: rgba(21,255,200,.10);
  border: 1px solid rgba(21,255,200,.28);
  border-radius: 999px;
  padding: 3px 10px;
}
.forgedCardDate{
  font-size: 11px;
  color: rgba(209,254,255,.40);
}
.forgedCardText{
  font-size: 16px;
  font-weight: 800;
  line-height: 1.4;
  color: var(--sb-light);
}
.forgedCardGlow{
  position:absolute;
  bottom:-30px; right:-30px;
  width:120px; height:120px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(21,255,200,.22), transparent 70%);
  pointer-events:none;
}

/* Pulse on forge */
@keyframes mintPulse{
  0%   { box-shadow: 0 0 0 0 rgba(21,255,200,.55); }
  70%  { box-shadow: 0 0 0 16px rgba(21,255,200,0); }
  100% { box-shadow: 0 0 0 0 rgba(21,255,200,0); }
}
.forgePulse{ animation: mintPulse .7s ease-out; }

/* ===== Belief Shift =====*/
.bsColLabels{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.bsColLabel{padding:7px 12px;border-radius:999px;font-size:11px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;display:flex;align-items:center;gap:7px;}
.bsColLabel-reactive{background:rgba(255,100,100,.08);border:1px solid rgba(255,100,100,.22);color:rgba(255,160,160,.9);}
.bsColLabel-account{background:rgba(21,255,200,.08);border:1px solid rgba(21,255,200,.22);color:var(--sb-mint);justify-content:flex-end;}
.bsColDot{width:7px;height:7px;border-radius:999px;flex-shrink:0;}
.bsColLabel-reactive .bsColDot{background:rgba(255,120,120,.8);}
.bsColLabel-account .bsColDot{background:var(--sb-mint);box-shadow:0 0 0 3px rgba(21,255,200,.2);}
.bsStack{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.bsCard{position:relative;border-radius:14px;overflow:hidden;border:1px solid rgba(209,254,255,.16);box-shadow:0 10px 28px rgba(0,0,0,.38);user-select:none;-webkit-user-select:none;height:88px;}
.bsCard:focus-within{outline:2px solid var(--sb-mint);outline-offset:2px;}
.bsSide{position:absolute;inset:0;display:flex;align-items:center;padding:0 18px;}
.bsSideLeft{background:linear-gradient(110deg,rgba(30,18,18,.97) 0%,rgba(40,25,25,.93) 100%);}
.bsSideRight{background:linear-gradient(110deg,#0e2d28 0%,#0f3732 100%);}
.bsSideText{font-size:13px;font-weight:800;line-height:1.3;color:rgba(255,200,200,.88);padding-left:16px;padding-right:32px;}
.bsReframeText{font-size:13px;font-weight:800;line-height:1.3;color:rgba(209,254,255,.95);padding-left:16px;padding-right:32px;}
.bsRevealMask{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
.bsRevealInner{position:absolute;inset:0;}
.bsHandleTrack{position:absolute;top:0;bottom:0;width:0;pointer-events:none;}
.bsDividerLine{position:absolute;top:0;bottom:0;left:0;width:2px;transform:translateX(-50%);background:linear-gradient(to bottom,transparent,var(--sb-mint) 30%,var(--sb-mint) 70%,transparent);opacity:.8;}
.bsKnob{position:absolute;top:50%;left:0;transform:translate(-50%,-50%);width:36px;height:36px;border-radius:999px;background:rgba(20,50,55,.97);border:1.5px solid rgba(21,255,200,.5);box-shadow:0 0 0 5px rgba(21,255,200,.08),0 6px 18px rgba(0,0,0,.5);display:grid;place-items:center;pointer-events:auto;cursor:ew-resize;touch-action:none;transition:box-shadow .15s ease,border-color .15s ease;}
.bsKnob:hover,.bsKnob.bsDragging{border-color:rgba(21,255,200,.9);box-shadow:0 0 0 7px rgba(21,255,200,.14),0 6px 18px rgba(0,0,0,.5);}
.bsCardNum{position:absolute;top:7px;left:10px;font-size:9px;font-weight:800;letter-spacing:.1em;color:rgba(255,160,160,.35);pointer-events:none;}
.bsHint{text-align:center;font-size:11px;color:rgba(209,254,255,.3);letter-spacing:.04em;margin-bottom:14px;}


/* ===== Emotion Picker Cards (from index(12).html) ===== */
.emotionGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 14px;
}
.emotionCard {
  appearance: none;
  border: 1px solid rgba(209,254,255,.16);
  background: rgba(255,255,255,.05);
  color: var(--text);
  border-radius: 16px;
  padding: 18px 12px 14px;
  cursor: pointer;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  transition: transform .08s ease, background .16s ease, border-color .16s ease, box-shadow .16s ease;
  width: 100%;
  font-family: inherit;
  -webkit-tap-highlight-color: transparent;
  position: relative;
  overflow: hidden;
}
.emotionCard::before {
  content: \'\';
  position: absolute;
  inset: 0;
  border-radius: 16px;
  opacity: 0;
  transition: opacity .2s ease;
  pointer-events: none;
}
.emotionCard:hover { transform: translateY(-2px); }
.emotionCard:hover::before { opacity: 1; }
.emotionCard:active { transform: translateY(0); }

/* Per-emotion color themes */
.emotionCard[data-action="guilt"] { border-color: rgba(150,200,255,.20); }
.emotionCard[data-action="guilt"]::before { background: rgba(100,160,255,.10); box-shadow: inset 0 0 0 1px rgba(100,160,255,.45); }
.emotionCard[data-action="guilt"]:hover { box-shadow: 0 0 14px rgba(100,160,255,.22); }

.emotionCard[data-action="defensive"] { border-color: rgba(255,160,80,.20); }
.emotionCard[data-action="defensive"]::before { background: rgba(255,140,60,.10); box-shadow: inset 0 0 0 1px rgba(255,140,60,.45); }
.emotionCard[data-action="defensive"]:hover { box-shadow: 0 0 14px rgba(255,140,60,.22); }

.emotionCard[data-action="confused"] { border-color: rgba(180,180,255,.20); }
.emotionCard[data-action="confused"]::before { background: rgba(160,160,255,.08); box-shadow: inset 0 0 0 1px rgba(160,160,255,.40); }
.emotionCard[data-action="confused"]:hover { box-shadow: 0 0 14px rgba(160,160,255,.22); }

.emotionCard[data-action="ashamed"] { border-color: rgba(200,100,200,.20); }
.emotionCard[data-action="ashamed"]::before { background: rgba(180,80,180,.10); box-shadow: inset 0 0 0 1px rgba(180,80,180,.40); }
.emotionCard[data-action="ashamed"]:hover { box-shadow: 0 0 14px rgba(180,80,180,.22); }

.emotionCard[data-action="anxious"] { border-color: rgba(255,200,80,.22); }
.emotionCard[data-action="anxious"]::before { background: rgba(255,190,60,.08); box-shadow: inset 0 0 0 1px rgba(255,190,60,.45); }
.emotionCard[data-action="anxious"]:hover { box-shadow: 0 0 14px rgba(255,190,60,.22); }

.emotionCard[data-action="angry"] { border-color: rgba(255,80,60,.22); }
.emotionCard[data-action="angry"]::before { background: rgba(255,60,40,.08); box-shadow: inset 0 0 0 1px rgba(255,80,60,.45); }
.emotionCard[data-action="angry"]:hover { box-shadow: 0 0 14px rgba(255,80,60,.22); }

.emotionCard[data-action="numb"] { border-color: rgba(180,180,200,.18); }
.emotionCard[data-action="numb"]::before { background: rgba(160,160,180,.06); box-shadow: inset 0 0 0 1px rgba(160,160,180,.38); }
.emotionCard[data-action="numb"]:hover { box-shadow: 0 0 14px rgba(160,160,180,.18); }

.emotionCard[data-action="sad"] { border-color: rgba(100,160,220,.20); }
.emotionCard[data-action="sad"]::before { background: rgba(80,140,200,.08); box-shadow: inset 0 0 0 1px rgba(80,140,200,.42); }
.emotionCard[data-action="sad"]:hover { box-shadow: 0 0 14px rgba(80,140,200,.22); }

.emotionCard[data-action="embarrassed"] { border-color: rgba(255,140,160,.20); }
.emotionCard[data-action="embarrassed"]::before { background: rgba(255,120,140,.08); box-shadow: inset 0 0 0 1px rgba(255,120,140,.42); }
.emotionCard[data-action="embarrassed"]:hover { box-shadow: 0 0 14px rgba(255,120,140,.22); }

.emotionCard[data-action="okay"] { border-color: rgba(21,255,200,.22); }
.emotionCard[data-action="okay"]::before { background: rgba(21,255,200,.07); box-shadow: inset 0 0 0 1px rgba(21,255,200,.45); }
.emotionCard[data-action="okay"]:hover { box-shadow: 0 0 14px rgba(21,255,200,.22); }
.emotionEmoji { font-size: 34px; line-height: 1; display: block; }
.emotionLabel { font-size: 13px; font-weight: 800; color: var(--sb-light); display: block; line-height: 1.3; }
    /* ===== CRISIS BANNER ===== */
    .crisisBanner{
      background: rgba(255,80,80,.10);
      border: 1px solid rgba(255,80,80,.35);
      border-radius: 12px;
      padding: 10px 14px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 12.5px;
      color: rgba(255,200,200,.92);
      line-height: 1.4;
    }
    .crisisBanner a {
      color: rgba(255,180,180,1);
      font-weight: 900;
      text-decoration: underline;
      white-space: nowrap;
    }
    .crisisBanner button{
      appearance: none;
      border: none;
      background: transparent;
      color: rgba(255,180,180,.70);
      cursor: pointer;
      font-size: 14px;
      padding: 2px 6px;
      border-radius: 4px;
      flex-shrink: 0;
    }
    .crisisBanner button:hover{ background: rgba(255,255,255,.06); }

    /* ===== BREATHE FLOAT BUTTON ===== */
    #breatheFloatBtn{
      position: fixed;
      bottom: 24px;
      right: 18px;
      z-index: 800;
      appearance: none;
      border: 1px solid rgba(21,255,200,.40);
      background: rgba(29,65,78,.95);
      color: var(--sb-mint);
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 12px;
      font-weight: 800;
      cursor: pointer;
      font-family: inherit;
      box-shadow: 0 4px 20px rgba(0,0,0,.40), 0 0 12px rgba(21,255,200,.10);
      transition: all .2s;
      letter-spacing: .2px;
      display: none;
    }
    #breatheFloatBtn:hover{
      background: rgba(21,255,200,.15);
      box-shadow: 0 4px 24px rgba(0,0,0,.50), 0 0 20px rgba(21,255,200,.20);
      transform: translateY(-1px);
    }
    #breatheFloatBtn.visible{ display: block; }

/* ===== ALCOHOL / SUBSTANCE DEEP DIVE ===== */
.alcProgress{display:flex;gap:4px;margin:10px 0 16px;}.alcDot{flex:1;height:4px;border-radius:4px;background:rgba(255,255,255,.10);transition:background .3s ease;}.alcDot.active{background:rgba(255,160,80,.85);box-shadow:0 0 6px rgba(255,160,80,.5);}.alcDot.done{background:rgba(255,160,80,.40);}
.alcScenarioGrid{display:grid;gap:9px;margin:12px 0;}.alcScenarioBtn{appearance:none;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.06);color:var(--text);border-radius:14px;padding:14px 16px;cursor:pointer;text-align:left;font-family:inherit;font-weight:700;width:100%;display:flex;align-items:center;gap:12px;transition:transform .06s ease,background .16s ease,border-color .16s ease,box-shadow .16s ease;}.alcScenarioBtn:hover{background:rgba(255,160,80,.14);border-color:rgba(255,160,80,.50);box-shadow:0 0 10px rgba(255,160,80,.18);transform:translateY(-1px);}.alcScenarioBtn:active{transform:translateY(1px);}.alcScenarioIcon{font-size:20px;width:28px;text-align:center;flex-shrink:0;}.alcScenarioText{flex:1;min-width:0;}.alcScenarioLabel{font-size:14px;font-weight:850;color:var(--sb-light);display:block;}.alcScenarioSub{font-size:12px;color:var(--muted);margin-top:2px;display:block;line-height:1.3;}
.alcMythStack{display:grid;gap:10px;margin:12px 0;}.alcMyth{border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);overflow:hidden;cursor:pointer;transition:border-color .2s;}.alcMyth.open{border-color:rgba(255,160,80,.50);cursor:default;}.alcMythFront{padding:14px 16px;}.alcMythStatement{font-size:14px;font-weight:900;color:rgba(209,254,255,.95);margin-bottom:6px;line-height:1.3;}.alcMythTap{font-size:11px;color:rgba(255,180,100,.65);font-weight:800;}.alcMythBack{display:none;padding:14px 16px;background:rgba(255,160,80,.07);border-top:1px solid rgba(255,160,80,.18);}.alcMyth.open .alcMythFront .alcMythTap{display:none;}.alcMyth.open .alcMythBack{display:block;}.alcMythVerdict{display:inline-block;padding:3px 10px;border-radius:999px;font-size:11px;font-weight:900;margin-bottom:8px;}.alcMythVerdict.false{background:rgba(200,50,30,.20);border:1px solid rgba(200,80,60,.45);color:rgba(255,160,140,.95);}.alcMythVerdict.partial{background:rgba(255,160,40,.15);border:1px solid rgba(255,180,60,.35);color:rgba(255,210,120,.95);}.alcMythExplain{font-size:12.5px;color:rgba(209,254,255,.85);line-height:1.55;}
.bacGauge{margin:14px 0;padding:16px;border-radius:16px;border:1px solid rgba(255,180,100,.22);background:rgba(0,0,0,.18);}.bacBar{height:14px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid rgba(255,255,255,.10);margin:10px 0 6px;}.bacFill{height:100%;border-radius:999px;transition:width .3s ease,background .3s ease;}.bacLabels{display:flex;justify-content:space-between;font-size:10px;color:rgba(209,254,255,.50);}.bacSlider{width:100%;margin:12px 0 6px;accent-color:rgba(255,160,80,.85);}.bacZone{margin-top:10px;padding:12px 14px;border-radius:12px;font-size:13px;line-height:1.5;transition:background .3s ease,border-color .3s ease;}.bacConsentTag{display:inline-block;padding:3px 10px;border-radius:999px;font-size:11px;font-weight:900;margin-bottom:8px;}
.alcSignalGrid{display:grid;gap:8px;margin:12px 0;}.alcSignal{appearance:none;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);color:var(--text);border-radius:12px;padding:12px 14px;font-size:13px;font-weight:700;cursor:pointer;text-align:left;transition:background .15s,border-color .15s,transform .06s;display:flex;align-items:flex-start;gap:10px;font-family:inherit;line-height:1.4;}.alcSignal:hover{background:rgba(255,160,80,.12);border-color:rgba(255,160,80,.45);}.alcSignal:active{transform:scale(.98);}.alcSignal.checked{background:rgba(255,100,60,.14);border-color:rgba(255,100,60,.55);color:#fff;}.alcSignalCheck{width:20px;height:20px;min-width:20px;border-radius:6px;border:2px solid rgba(255,180,100,.35);background:transparent;margin-top:1px;display:flex;align-items:center;justify-content:center;transition:all .15s ease;font-size:11px;}.alcSignal.checked .alcSignalCheck{background:rgba(255,100,60,.30);border-color:rgba(255,100,60,.70);}.alcResultBox{margin-top:14px;padding:14px 16px;border-radius:14px;font-size:13px;line-height:1.55;display:none;animation:rejFadeIn .3s ease;}.alcResultBox.show{display:block;}
.alcReframeCard{border-radius:16px;border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.18);padding:16px;margin:12px 0;}.alcReframeSide{padding:12px 14px;border-radius:12px;font-size:13px;line-height:1.5;margin-top:10px;}.alcReframeSide.myth{background:rgba(255,100,60,.08);border:1px solid rgba(255,100,60,.25);color:rgba(255,180,160,.92);}.alcReframeSide.truth{background:rgba(21,255,200,.08);border:1px solid rgba(21,255,200,.25);color:var(--sb-light);}

/* ============================================================
   MOBILE RESPONSIVE FIXES
   ============================================================ */

/* --- Fix 2-column grids that lack mobile breakpoints --- */
@media (max-width: 480px) {
  /* Power Dynamics type picker */
  .pdTypeGrid { grid-template-columns: 1fr !important; }

  /* Healthy Relationships cycle of abuse grid */
  .hrCycleGrid { grid-template-columns: 1fr !important; }

  /* Vibe Jukebox tiles */
  .vjTiles { grid-template-columns: 1fr !important; }

  /* Accused module feeling grid */
  .accFeelingGrid { grid-template-columns: 1fr !important; }

  /* Signal Boost grid */
  .sbGrid { grid-template-columns: 1fr !important; }

  /* Belief Shift column labels */
  .bsColLabels { grid-template-columns: 1fr !important; }

  /* Emotion picker cards */
  .emotionGrid { grid-template-columns: 1fr !important; }

  /* Accused flip row */
  .accFlipRow { grid-template-columns: 1fr !important; }

  /* Fix inline-style 2-column grids (need !important to override inline styles) */
  .nextGrid,
  [style*="grid-template-columns:1fr 1fr"],
  [style*="grid-template-columns: 1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }
}

/* --- Fix dsNavRow button overflow on narrow screens --- */
@media (max-width: 400px) {
  .dsNavRow {
    flex-direction: column;
    gap: 8px;
  }
  .dsNavRow .btn {
    flex: none;
    width: 100%;
    text-align: center;
    font-size: 13px;
    padding: 12px 10px;
  }
}

/* --- Accordion content clipping fix --- */
@media (max-width: 480px) {
  .scBody.scOpen { max-height: 280px; }
  .fpConvoCard.open .fpConvoBody { max-height: 600px; }
  .fpEnabling.open .fpEnablingBody { max-height: 500px; }
  .fpDecNode.open .fpDecNodeBody { max-height: 600px; }
  .dsConsentCard.open .dsConsentBody { max-height: 500px; }
  .siWrap .panel.open .panelBody { max-height: 700px; }
  .bwWrap .panel.open .panelBody { max-height: 800px; }
  .nrmWrap .panel.open .panelBody { max-height: 900px; }
  .repairPanel.open .panelBody { max-height: 1200px; }
}

/* --- Modal: better mobile spacing --- */
@media (max-width: 480px) {
  .modalOverlay { padding: 10px; }
  .modal {
    padding: 16px;
    border-radius: 14px;
    max-height: 92vh;
  }
  .modalTitle { font-size: 16px; }
}

/* --- Touch target minimum sizing (44px recommended by Apple/Google) --- */
@media (pointer: coarse) {
  .dsScriptChip { min-height: 44px; display: inline-flex; align-items: center; }
  .hrAbuseTab { min-height: 44px; display: inline-flex; align-items: center; }
  .ocBtn { min-height: 44px; }
  .nrmBtn { min-height: 44px; }
  .rbBtn { min-height: 44px; }
  .btnSmall { min-height: 44px; display: inline-flex; align-items: center; }
  .pdScenario { min-height: 44px; }
  .fpSitBtn { min-height: 44px; }
  .alcSignal { min-height: 44px; }
  .hrSign { min-height: 44px; }
  .hrSortCard { min-height: 44px; display: inline-flex; align-items: center; }
  .tsCard { min-height: 44px; }
  .ttCardHeader { min-height: 44px; }
}

/* --- Prevent horizontal overflow on small screens --- */
@media (max-width: 380px) {
  body { padding: 16px 8px 48px; }
  .card { padding: 14px; }
  .h1 { font-size: 19px; }
  .topbar { gap: 8px; }
  .brand .title { font-size: 14px; }

  /* Pressure meter ticks can overflow */
  .pressureTicks { font-size: 10px; }
  .pressureValue { font-size: 11px; padding: 5px 8px; }

  /* NRM path nodes can get cramped */
  .nrmNode { width: 28px; height: 28px; }
  .nrmNode span { font-size: 10px; }
  .nrmMove { font-size: 16px; }
}

/* --- Ongoing Consent Road mobile refinements --- */
@media (max-width: 480px) {
  .ocBubble {
    max-width: 120px !important;
    min-width: 80px !important;
    font-size: 11px !important;
    padding: 7px 9px !important;
  }
  .ocRoadWrap { height: 340px !important; }
  .ocRoadInner { height: 340px !important; min-height: 340px !important; }
}

/* --- Fix topActions wrapping on small screens --- */
@media (max-width: 360px) {
  .topActions { width: 100%; justify-content: flex-start; }
  .topActions .btnSmall { flex: 1; text-align: center; }
}

/* --- Breathing exercise sizing on small screens --- */
@media (max-width: 380px) {
  .breathe { width: 120px; height: 120px; }
  .spiralStage { width: 180px !important; height: 180px !important; }
  #spiral { width: 150px !important; height: 150px !important; }
}

/* --- Ensure long words don't cause horizontal overflow --- */
.dsScriptText,
.fpConvoBody,
.fpBoundaryBox,
.pdScText,
.ttSectionText,
.nrmDesc,
.nrmChallengeText,
.hrAbuseItem,
.alcMythExplain,
.note,
.p,
.rbOutput,
.ssItem,
.biBody {
  overflow-wrap: break-word;
  word-break: break-word;
}

/* --- Safe area insets for notched devices --- */
@supports (padding: env(safe-area-inset-bottom)) {
  body {
    padding-bottom: calc(60px + env(safe-area-inset-bottom));
    padding-left: calc(14px + env(safe-area-inset-left));
    padding-right: calc(14px + env(safe-area-inset-right));
  }
}

</style>

</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo">
          <svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
            <!-- Stem -->
            <line x1="50" y1="64" x2="50" y2="130" stroke="#15FFC8" stroke-width="6" stroke-linecap="round" />
            <!-- Center -->
            <circle cx="50" cy="50" r="14" fill="#15FFC8" />
            <!-- Petals -->
            <g fill="#D1FEFF">
              <ellipse cx="50" cy="20" rx="10" ry="18"/>
              <ellipse cx="50" cy="80" rx="10" ry="18"/>
              <ellipse cx="20" cy="50" rx="18" ry="10"/>
              <ellipse cx="80" cy="50" rx="18" ry="10"/>
              <ellipse cx="30" cy="30" rx="12" ry="18" transform="rotate(-45 30 30)"/>
              <ellipse cx="70" cy="30" rx="12" ry="18" transform="rotate(45 70 30)"/>
              <ellipse cx="30" cy="70" rx="12" ry="18" transform="rotate(45 30 70)"/>
              <ellipse cx="70" cy="70" rx="12" ry="18" transform="rotate(-45 70 70)"/>
            </g>
          </svg>
        </div>
        <div class="title"><span class="neon-underline">BAE Check</span></div>
        <div class="subtitle">Reflection & Accountability</div>
      </div>
      <div class="topActions">
        <button class="btn btnSmall btnDanger" data-action="quickExit" title="Leave this page immediately" style="font-weight:900; letter-spacing:.2px;">⚡ Exit</button>
        <button class="btn btnSmall" data-action="needResources" title="Skip to resources &amp; next steps" style="font-size:11px; padding:8px 10px; background:rgba(21,255,200,.10); border-color:rgba(21,255,200,.30); color:var(--sb-mint); font-weight:700; letter-spacing:.2px;">📋 Resources</button>
        <button class="btn btnSmall" id="btnCrisis" onclick="toggleCrisisBanner()" title="Show crisis resources" style="font-size:11px; padding:8px 10px; background:rgba(255,80,80,.10); border-color:rgba(255,80,80,.30); color:rgba(255,180,180,.95); font-weight:700;">🆘 In crisis?</button>
        <button class="btn btnSmall" data-action="restart">↺ Restart</button>
      </div>
    </div>

    <!-- Crisis banner (hidden by default) -->
    <div class="crisisBanner" id="crisisBanner" style="display:none;">
      <span>If you're in crisis, help is available now. <a href="https://988lifeline.org" target="_blank" rel="noopener">Call/text 988</a> · <a href="https://www.crisistextline.org" target="_blank" rel="noopener">Text HOME to 741741</a></span>
      <button onclick="toggleCrisisBanner()" aria-label="Dismiss">✕</button>
    </div>

    <div class="card" id="screen"></div>

    <!-- Floating breathe button (shown after landing) -->
    <button id="breatheFloatBtn" onclick="openGroundingFloat()" aria-label="Quick grounding exercise">🫧 Breathe</button>

    <div class="footer">
      <div>No Account. No Names. No Judgment. Just Unfiltered Answers.</div>
      <div><a class="link" href="#" data-action="about">About</a></div>
    </div>

    <div style="text-align:center; margin-top:14px; font-size:12px; color: var(--muted);">
      A Project of SafeBAE
    </div>
<div style="text-align:center; margin-top:18px;">
  <img 
    src="safebae-logo.png"
    alt="SafeBAE Logo"
    style="
      max-width: 280px;
      width: 80%;
      height: auto;
      opacity: 0.9;
    "
  />
</div>

  </div>

<script>

const state = { entry:null, scenario:null, emotion:null, path:null, screenId:"landing", showWhyModal: true, history:[] };
const screen = document.getElementById("screen");

function go(id){ if(state.screenId !== id) state.history.push(state.screenId); state.screenId=id; render(); triggerTransition(); updateFloatBtn(id); }

let crisisBannerVisible = false;
function toggleCrisisBanner(){
  crisisBannerVisible = !crisisBannerVisible;
  const banner = document.getElementById('crisisBanner');
  if(banner) banner.style.display = crisisBannerVisible ? 'flex' : 'none';
  const btn = document.getElementById('btnCrisis');
  if(btn) btn.style.background = crisisBannerVisible ? 'rgba(255,80,80,.25)' : 'rgba(255,80,80,.10)';
}

// Show/hide floating breathe button based on screen
function updateFloatBtn(screenId){
  const btn = document.getElementById('breatheFloatBtn');
  if(!btn) return;
  const hideOn = ['landing','whyThisExists','grounding','pathMenu','about','decoy'];
  btn.classList.toggle('visible', !hideOn.includes(screenId));
}

function openGroundingFloat(){
  go('grounding');
}
function goBack(){ if(state.history.length){ state.screenId=state.history.pop(); render(); triggerTransition(); } }
function triggerTransition(){
  screen.classList.remove('pageTransition');
  void screen.offsetWidth; // force reflow
  screen.classList.add('pageTransition');
}
function reset(){ state.entry=null; state.scenario=null; state.emotion=null; state.path=null; state.history=[]; go("landing"); }

document.addEventListener("click", (e)=>{
  const el = e.target.closest("[data-action]");
  if(!el) return;
  e.preventDefault();
  const a = el.getAttribute("data-action");
  actions[a]?.();
});

const actions = {
  start: ()=>go("bringsYouHere"),
  whyBtn: ()=>go("whyThisExists"),
  pathMenu: ()=>go("pathMenu"),
  about: ()=>go("about"),
  restart: ()=>reset(),
  quickExit: ()=>{
    // Replace every history entry we can reach with a neutral URL, then redirect
    try {
      const neutral = "https://www.google.com/search?q=weather+today";
      // Overwrite as many back-stack entries as possible
      for(let i = 0; i < (window.history.length || 1); i++){
        window.history.replaceState(null, "", neutral);
      }
    } catch(e){}
    window.location.replace("https://www.google.com/search?q=weather+today");
  },
  needResources: ()=>go("nextSteps"),
  goBack: ()=>goBack(),

  // Repair page: "What if they don't forgive me?" explainer
  openForgiveModal: ()=>openModal(
    "What If They Don’t Forgive Me?",
    `
      <div class="p" style="margin:0 0 10px; color: var(--muted);">
        They might not — and that can hurt. But forgiveness isn’t something you’re owed, and it isn’t proof that you “did accountability right.”
      </div>

      <div class="p" style="margin:0 0 10px; color: var(--muted);">
        A solid repair attempt is about <b>responsibility</b> and <b>respecting boundaries</b>, not getting emotional relief.
      </div>

      <div class="note" style="margin:10px 0 0;">
        <b>What accountability looks like either way:</b><br>
        • Accept their response — including no response.<br>
        • Don’t argue, minimize, or ask them to reassure you.<br>
        • Change your behavior even if you never get closure.<br>
        • Give space, and don’t keep “checking in” to see if they’re over it.
      </div>

      <div class="mutedBox" style="margin-top:10px;">
        <b>Reality check:</b> You can’t control whether someone forgives you. You <i>can</i> control whether you repeat harm.
      </div>
    `
  ),
  closeModal: ()=>closeModal(),
};


// --- Simple modal helpers (uses existing .modalOverlay/.modal CSS) ---
let __modalEl = null;

function openModal(title, innerHtml){
  closeModal(); // ensure one at a time
  const wrap = document.createElement("div");
  wrap.className = "modalOverlay";
  wrap.setAttribute("role","dialog");
  wrap.setAttribute("aria-modal","true");
  wrap.innerHTML = `
    <div class="modal">
      <div class="modalHeader">
        <div class="modalTitle">${title}</div>
        <button class="btn btnSmall modalClose" data-action="closeModal" aria-label="Close">Close</button>
      </div>
      <div>${innerHtml}</div>
      <div class="modalActions">
        <button class="btn btnPrimary" data-action="closeModal">Done</button>
      </div>
    </div>
  `;
  // click outside closes
  wrap.addEventListener("click", (e)=>{
    if(e.target === wrap) closeModal();
  });
  document.body.appendChild(wrap);
  __modalEl = wrap;
}

function closeModal(){
  if(__modalEl){
    __modalEl.remove();
    __modalEl = null;
  }
}

// ESC closes
window.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") closeModal();
});

function backBtn(){ return `<button class="btn btnBack" data-action="${state.history.length ? 'goBack' : 'nextSteps'}">&#8592; Back</button>`; }

function card(h1, ps=[], note=null, content=""){
  return `
    <div class="h1">${h1}</div>
    ${ps.map(p=>`<div class="p">${p}</div>`).join("")}
    ${note?`<div class="note">${note}</div>`:""}
    ${content}
  `;
}
function btn(label, action, cls="btn"){ return `<button class="${cls}" data-action="${action}">${label}</button>`; }
function btnIcon(label, action, icon, cls="btn"){
  return `<button class="${cls}" data-action="${action}">
    <span class="btnContent">
      <span class="btnIcon" aria-hidden="true">${icon}</span>
      <span class="btnLabel">${label}</span>
    </span>
  </button>`;
}
function grid(inner){ return `<div class="grid">${inner}</div>`; }


function breatheWidget(){
  return `
<div class="breatheWrap" role="img" aria-label="Breathing guide: breathe in as it grows, breathe out as it shrinks">
  <svg class="breathe" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">

    <!-- Outer halo (very subtle) -->
    <g class="breatheHalo">
      <circle cx="100" cy="100" r="82" fill="none" stroke="rgba(209,254,255,.35)" stroke-width="2"/>
    </g>

    <!-- Middle ring (tracks breath) -->
    <g class="breatheRing">
      <circle cx="100" cy="100" r="68" fill="none" stroke="rgba(21,255,200,.55)" stroke-width="3"/>
    </g>

    <!-- Core (tracks breath) -->
    <g class="breatheCore">
      <circle cx="100" cy="100" r="54" fill="rgba(21,255,200,.22)" stroke="rgba(21,255,200,.92)" stroke-width="3"/>
    </g>

  </svg>
</div>
  `;
}


// =====================================================
// RAIN WINDOW — Sad emotion
// =====================================================
let rainWindowCleanup = null;

function rainWindowMarkup(){
  return `
    <div class="note"><b>Tap the rain</b> if you want. This is what it feels like when something mattered.</div>
    <div class="rainWrap" id="rainWrap">
      <canvas id="rainCanvas" class="rainCanvas"></canvas>
      <div class="rainGlass" id="rainGlass"></div>
      <div class="rainMsg" id="rainMsg"></div>
    </div>
    <div id="rainContinue" style="margin-top:12px;opacity:1;pointer-events:auto;transition:opacity .6s ease;">
      <button class="btn btnPrimary" data-action="nextSteps" style="width:100%;">Continue →</button>
    </div>
  `;
}

function initRainWindow(){
  if(rainWindowCleanup) rainWindowCleanup();
  const wrap   = document.getElementById('rainWrap');
  const canvas = document.getElementById('rainCanvas');
  const msgEl  = document.getElementById('rainMsg');
  if(!canvas || !wrap) return;

  const ctx = canvas.getContext('2d');
  let W, H, raf;

  // --- State ---
  // progress: 0 = full storm, 1 = full stillness
  let progress   = 0;
  let taps        = 0;
  const TAP_GOAL  = 8;   // taps to reach full still pool
  let msgStage    = 0;    // 0 = none, 1 = mid, 2 = final
  let puddleR     = 0;    // current puddle radius
  let ripples     = [];   // tap ripples on puddle surface

  function resize(){
    W = canvas.width  = wrap.clientWidth;
    H = canvas.height = wrap.clientHeight || 240;
  }
  resize();
  window.addEventListener('resize', resize);

  // --- Rain drops ---
  const drops = Array.from({length: 120}, ()=>({
    x: Math.random() * 1000,
    y: Math.random() * 300,
    len:   18 + Math.random() * 28,
    speed: 4.5 + Math.random() * 5.5,
    op:    0.25 + Math.random() * 0.45,
    w:     0.8 + Math.random() * 1.4
  }));

  // --- Puddle target: bottom-centre ---
  function puddleCX(){ return W * 0.5; }
  function puddleCY(){ return H - 32; }
  const PUDDLE_MAX_R = () => Math.min(W * 0.38, 110);

  // --- Reflection shimmer particles inside puddle ---
  const shimmer = Array.from({length: 28}, (_, i)=>({
    angle: (i / 28) * Math.PI * 2,
    r:     0.2 + Math.random() * 0.7,   // fraction of puddle radius
    size:  0.8 + Math.random() * 1.8,
    speed: 0.004 + Math.random() * 0.008,
    phase: Math.random() * Math.PI * 2
  }));

  let t = 0; // global tick for animation

  function drawFrame(){
    t += 0.016;
    ctx.clearRect(0, 0, W, H);

    const p = progress; // 0..1

    // ---- RAIN ----
    // Rain slows and fades as progress increases
    const rainAlpha  = 1 - p * 0.95;
    const speedMult  = 1 - p * 0.85;

    if(rainAlpha > 0.02){
      drops.forEach(d => {
        const op = d.op * rainAlpha;
        if(op < 0.015) return;
        ctx.beginPath();
        ctx.strokeStyle = `rgba(209,254,255,${op})`;
        ctx.lineWidth = d.w;
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(d.x - d.len * 0.32, d.y + d.len * (0.3 + speedMult * 0.7));
        ctx.stroke();
        d.y += d.speed * speedMult;
        if(d.y > H + d.len){ d.y = -d.len; d.x = Math.random() * W; }
      });
    }

    // ---- PUDDLE ----
    // Puddle grows from radius 0 to PUDDLE_MAX_R as progress increases
    const targetR = PUDDLE_MAX_R() * p;
    puddleR += (targetR - puddleR) * 0.06; // smooth growth

    if(puddleR > 2){
      const cx = puddleCX(), cy = puddleCY();

      // Puddle body — ellipse (wider than tall for realism)
      const rx = puddleR, ry = puddleR * 0.38;

      // Dark water fill
      const waterGrad = ctx.createRadialGradient(cx, cy - ry*0.2, 0, cx, cy, rx);
      waterGrad.addColorStop(0,   `rgba(19,132,143,${0.55 * p})`);
      waterGrad.addColorStop(0.6, `rgba(10, 55, 70, ${0.70 * p})`);
      waterGrad.addColorStop(1,   `rgba( 5, 20, 30, ${0.80 * p})`);

      ctx.save();
      ctx.scale(1, 0.38); // squish to ellipse
      ctx.beginPath();
      ctx.arc(cx, cy / 0.38, rx, 0, Math.PI * 2);
      ctx.fillStyle = waterGrad;
      ctx.fill();
      ctx.restore();

      // Puddle rim glow
      ctx.save();
      ctx.scale(1, 0.38);
      ctx.beginPath();
      ctx.arc(cx, cy / 0.38, rx, 0, Math.PI * 2);
      ctx.strokeStyle = `rgba(21,255,200,${0.18 * p})`;
      ctx.lineWidth = 1.5;
      ctx.stroke();
      ctx.restore();

      // ---- REFLECTION SHIMMER inside puddle ----
      if(p > 0.25){
        const shimAlpha = Math.min(1, (p - 0.25) / 0.4);
        shimmer.forEach(s => {
          s.angle += s.speed;
          const pulse = 0.7 + 0.3 * Math.sin(t * 1.8 + s.phase);
          const sx = cx + Math.cos(s.angle) * rx * s.r * 0.82;
          const sy = cy + Math.sin(s.angle) * ry * s.r * 0.82;
          const sz = s.size * pulse * shimAlpha * p;
          if(sz < 0.3) return;
          ctx.beginPath();
          ctx.arc(sx, sy, sz, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(21,255,200,${0.55 * shimAlpha * pulse})`;
          ctx.fill();
        });

        // Centre star reflection
        const starPulse = 0.6 + 0.4 * Math.sin(t * 2.2);
        const starAlpha = Math.min(1, (p - 0.4) / 0.35) * starPulse;
        if(starAlpha > 0.05){
          ctx.save();
          ctx.globalAlpha = starAlpha * 0.7;
          ctx.fillStyle = 'rgba(209,254,255,0.9)';
          ctx.beginPath();
          ctx.arc(cx, cy - ry * 0.1, 2.2 * starPulse, 0, Math.PI * 2);
          ctx.fill();
          // cross gleam
          ctx.strokeStyle = 'rgba(209,254,255,0.5)';
          ctx.lineWidth = 0.8;
          for(let a = 0; a < Math.PI; a += Math.PI/4){
            ctx.beginPath();
            ctx.moveTo(cx + Math.cos(a) * 4 * starPulse, cy - ry*0.1 + Math.sin(a) * 4 * starPulse * 0.38);
            ctx.lineTo(cx - Math.cos(a) * 4 * starPulse, cy - ry*0.1 - Math.sin(a) * 4 * starPulse * 0.38);
            ctx.stroke();
          }
          ctx.restore();
        }
      }

      // ---- RIPPLES from taps ----
      ripples = ripples.filter(r => r.life > 0);
      ripples.forEach(r => {
        const rp = 1 - r.life;
        const rRadius = rx * rp * 0.85;
        ctx.save();
        ctx.scale(1, 0.38);
        ctx.beginPath();
        ctx.arc(cx, cy / 0.38, rRadius, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(21,255,200,${r.life * 0.5})`;
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.restore();
        r.life -= 0.025;
      });
    }

    raf = requestAnimationFrame(drawFrame);
  }
  drawFrame();

  // --- Tap handler ---
  function onTap(e){
    e.preventDefault();
    taps = Math.min(taps + 1, TAP_GOAL);
    progress = taps / TAP_GOAL;

    // Add ripple if puddle is visible
    if(progress > 0.15) ripples.push({ life: 1 });

    // Message milestones
    if(taps >= 4 && msgStage === 0){
      msgStage = 1;
      msgEl.textContent = 'You’re not pushing it away. That counts.';
      msgEl.classList.add('show');
    }
    if(taps >= TAP_GOAL && msgStage < 2){
      msgStage = 2;
      msgEl.textContent = 'When the storm slows, you can see more clearly. Clarity is what accountability needs — and where better choices begin.';
      setTimeout(()=>{
        const cont = document.getElementById('rainContinue');
        if(cont){ cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
      }, 800);
    }
  }

  canvas.addEventListener('click',      onTap);
  canvas.addEventListener('touchstart', onTap, {passive: false});

  rainWindowCleanup = ()=>{
    cancelAnimationFrame(raf);
    window.removeEventListener('resize', resize);
    canvas.removeEventListener('click',      onTap);
    canvas.removeEventListener('touchstart', onTap);
    rainWindowCleanup = null;
  };
}


// =====================================================
// EYE GRID — Embarrassed emotion
// =====================================================
let eyeGridCleanup = null;

function eyeGridMarkup(){
  return `
    <div class="note"><b>Turn it down</b> if you want. Drag the knob counterclockwise to quiet the noise.</div>
    <div class="crowdKnobWrap" id="crowdKnobWrap">
      <div class="crowdWords" id="crowdWords"></div>
      <div class="crowdKnobArea">
        <div class="crowdKnobLabel" id="crowdKnobLabel">THE NOISE</div>
        <div class="crowdKnobRing" id="crowdKnobRing">
          <canvas id="crowdKnobCanvas" width="180" height="180"></canvas>
          <div class="crowdKnobHandle" id="crowdKnobHandle"></div>
        </div>
        <div class="crowdVolNum" id="crowdVolNum">100</div>
      </div>
      <div class="crowdMsg" id="crowdMsg"></div>
    </div>
    <div id="eyeContinue" style="margin-top:12px;opacity:1;pointer-events:auto;transition:opacity .6s ease;">
      <button class="btn btnPrimary" data-action="nextSteps" style="width:100%;">Continue →</button>
    </div>
  `;
}

function initEyeGrid(){
  if(eyeGridCleanup) eyeGridCleanup();

  const wrap      = document.getElementById('crowdKnobWrap');
  const wordsEl   = document.getElementById('crowdWords');
  const canvas    = document.getElementById('crowdKnobCanvas');
  const handleEl  = document.getElementById('crowdKnobHandle');
  const volNumEl  = document.getElementById('crowdVolNum');
  const labelEl   = document.getElementById('crowdKnobLabel');
  const msgEl     = document.getElementById('crowdMsg');
  if(!wrap || !canvas) return;

  const ctx = canvas.getContext('2d');
  const CX = 90, CY = 90, R = 70;

  // Words that float around — things said / thought about you
  const WORDS = [
    "everyone knows", "did you hear", "seriously though",
    "awkward", "embarrassing",
    "they're talking", "people saw", "drama", "lol",
    "heard about that", "oh wow", "messy", "yikes",
    "can't believe", "totally", "wild", "so cringe"
  ];

  // Place words in evenly distributed positions around the edges
  // avoiding the center knob area and the bottom message area
  let wordEls = [];
  // Pre-defined positions: spread around perimeter in 3 rows, avoiding center & bottom
  const POSITIONS = [
    // Top row
    {x:5,  y:4},  {x:20, y:3},  {x:36, y:6},  {x:52, y:3},  {x:66, y:5},  {x:78, y:4},
    // Upper-mid row (sides only, avoiding center where knob is)
    {x:3,  y:20}, {x:15, y:24}, {x:68, y:22}, {x:78, y:18},
    // Mid row (far sides only)
    {x:2,  y:40}, {x:74, y:38}, {x:3,  y:56}, {x:72, y:53},
    // Lower-mid row (sides only, above message area)
    {x:5,  y:70}, {x:18, y:74}, {x:64, y:72},
  ];
  WORDS.forEach((w, i) => {
    const el = document.createElement('div');
    el.className = 'crowdWord';
    el.textContent = w;
    const pos = POSITIONS[i % POSITIONS.length];
    el.style.left = pos.x + '%';
    el.style.top  = pos.y + '%';
    el.style.transform = 'translate(0, 0)'; // anchor from top-left, not center
    el.style.animationDelay = (i * 0.18) + 's';
    el.style.animationDuration = (3.5 + (i % 4) * 0.8) + 's';
    wordsEl.appendChild(el);
    wordEls.push(el);
  });

  // Knob state
  // Range: 150° (max, bottom-left) → 390° (min, bottom-right), going counterclockwise
  // We'll use angle in degrees where 0 = right
  // Min angle (max vol) = 220°, Max angle (min vol) = 320° going CCW
  // Simpler: volume 0–100 mapped to knob rotation -140° to +140° from top (12 o'clock)
  const MIN_DEG = -140; // fully CCW = quiet
  const MAX_DEG = 140;  // fully CW  = loud
  let volDeg = MAX_DEG; // start loud
  let isDragging = false;
  let lastAngle = null;
  let milestoneShown = new Set();

  function degToVol(deg) {
    return Math.round(((deg - MIN_DEG) / (MAX_DEG - MIN_DEG)) * 100);
  }

  function drawKnob(deg) {
    ctx.clearRect(0, 0, 180, 180);

    // Track arc - background
    const arcStart = (MIN_DEG - 90) * Math.PI / 180;
    const arcEnd   = (MAX_DEG - 90) * Math.PI / 180;
    ctx.arc(CX, CY, R, arcStart, arcEnd);
    ctx.strokeStyle = 'rgba(209,254,255,0.12)';
    ctx.lineWidth = 6;
    ctx.lineCap = 'round';
    ctx.stroke();

    // Filled arc (current value, from min to current)
    const vol = degToVol(deg);
    const filledEnd = (deg - 90) * Math.PI / 180;
    if(vol > 0){
      const r = Math.min(255, Math.round(255 * (vol/100) * 1.8));
      const g = Math.max(40, Math.round(255 - vol * 2.2));
      ctx.beginPath();
      ctx.arc(CX, CY, R, arcStart, filledEnd);
      ctx.strokeStyle = `rgba(${r},${g},60,0.85)`;
      ctx.lineWidth = 6;
      ctx.lineCap = 'round';
      ctx.stroke();
    }

    // Knob body
    const grad = ctx.createRadialGradient(CX-8, CY-8, 4, CX, CY, 52);
    grad.addColorStop(0, 'rgba(60,90,100,0.95)');
    grad.addColorStop(1, 'rgba(15,35,45,0.98)');
    ctx.beginPath();
    ctx.arc(CX, CY, 52, 0, Math.PI*2);
    ctx.fillStyle = grad;
    ctx.fill();
    ctx.strokeStyle = 'rgba(209,254,255,0.18)';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    // Indicator dot
    const dotRad = (deg - 90) * Math.PI / 180;
    const dotX = CX + Math.cos(dotRad) * 36;
    const dotY = CY + Math.sin(dotRad) * 36;
    ctx.beginPath();
    ctx.arc(dotX, dotY, 5, 0, Math.PI*2);
    ctx.fillStyle = vol < 5 ? 'rgba(21,255,200,0.9)' : `rgba(${Math.min(255,180+Math.round(vol*.75))},${Math.max(40,200-Math.round(vol*1.6))},80,0.9)`;
    ctx.fill();
  }

  function updateAll(deg) {
    volDeg = Math.max(MIN_DEG, Math.min(MAX_DEG, deg));
    const vol = degToVol(volDeg);

    drawKnob(volDeg);
    volNumEl.textContent = vol;

    // Update handle rotation for CSS
    handleEl.style.transform = `rotate(${volDeg}deg)`;

    // Word opacity — fully gone at vol 0
    wordEls.forEach((el, i) => {
      const base = (vol / 100) * 0.90;
      const jitter = (Math.sin(i * 1.7) * 0.12);
      el.style.opacity = Math.max(0, Math.min(1, base + jitter));
      const scale = 0.65 + (vol / 100) * 0.45;
      el.style.transform = `scale(${scale + Math.sin(i)*0.04})`;
      el.style.transformOrigin = 'top left';
    });

    // Label
    if(vol > 66) labelEl.textContent = 'THE NOISE';
    else if(vol > 33) labelEl.textContent = 'getting quieter...';
    else if(vol > 5)  labelEl.textContent = 'almost there';
    else              labelEl.textContent = 'silence';

    // Vol num color
    volNumEl.style.color = vol < 10 ? 'rgba(21,255,200,.9)' : vol < 40 ? 'rgba(255,210,100,.8)' : 'rgba(255,120,80,.85)';

    // Milestones
    if(vol <= 50 && !milestoneShown.has(50)){
      milestoneShown.add(50);
      msgEl.textContent = "Most of this noise lives in your head, not the room.";
      msgEl.classList.add('show');
    }
    if(vol <= 10 && !milestoneShown.has(10)){
      milestoneShown.add(10);
      msgEl.textContent = "That's it. Your next move is what actually matters.";
      msgEl.classList.add('show');
      const cont = document.getElementById('eyeContinue');
      if(cont){ cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
    }
    // Show/hide messages and continue button reactively based on current vol
    if(milestoneShown.has(10)){
      if(vol <= 10){
        msgEl.textContent = "That's it. Your next move is what actually matters.";
        msgEl.classList.add('show');
        const cont = document.getElementById('eyeContinue');
        if(cont){ cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
      } else if(vol <= 50){
        msgEl.textContent = "Most of this noise lives in your head, not the room.";
        msgEl.classList.add('show');
      } else {
        msgEl.classList.remove('show');
      }
    } else if(milestoneShown.has(50)){
      if(vol <= 50){
        msgEl.textContent = "Most of this noise lives in your head, not the room.";
        msgEl.classList.add('show');
      } else {
        msgEl.classList.remove('show');
      }
    }
  }

  // Initial draw
  updateAll(MAX_DEG);

  // Drag logic — get angle from center
  function getAngleDeg(e, rect) {
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const x = clientX - rect.left - rect.width/2;
    const y = clientY - rect.top  - rect.height/2;
    return Math.atan2(y, x) * 180 / Math.PI + 90; // 0 = top
  }

  function onStart(e) {
    e.preventDefault();
    isDragging = true;
    const rect = canvas.getBoundingClientRect();
    lastAngle = getAngleDeg(e, rect);
  }

  function onMove(e) {
    if(!isDragging) return;
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const angle = getAngleDeg(e, rect);
    let delta = angle - lastAngle;
    // Handle wrap-around
    if(delta > 180) delta -= 360;
    if(delta < -180) delta += 360;
    lastAngle = angle;
    updateAll(volDeg + delta);
  }

  function onEnd() { isDragging = false; lastAngle = null; }

  canvas.addEventListener('mousedown',  onStart);
  canvas.addEventListener('touchstart', onStart, {passive:false});
  window.addEventListener('mousemove',  onMove);
  window.addEventListener('touchmove',  onMove, {passive:false});
  window.addEventListener('mouseup',    onEnd);
  window.addEventListener('touchend',   onEnd);

  eyeGridCleanup = () => {
    canvas.removeEventListener('mousedown',  onStart);
    canvas.removeEventListener('touchstart', onStart);
    window.removeEventListener('mousemove',  onMove);
    window.removeEventListener('touchmove',  onMove);
    window.removeEventListener('mouseup',    onEnd);
    window.removeEventListener('touchend',   onEnd);
    eyeGridCleanup = null;
  };
}


// =====================================================
// VIBE JUKEBOX — Okay emotion
// =====================================================
let vibeJukeboxCleanup = null;

function vibeJukeboxMarkup(){
  return `
    <div class="note"><b>Pick your exit vibe.</b> You're okay — you get to choose how you leave.</div>
    <div class="vjWrap" id="vjWrap">
      <div class="vjTiles" id="vjTiles">
        <button class="vjTile" data-vibe="sharp">
          <span class="vjEmoji">⚡</span>
          <span class="vjLabel">Sharp</span>
          <span class="vjSub">Quick consent refresher before I go</span>
        </button>
        <button class="vjTile" data-vibe="chill">
          <span class="vjEmoji">🌊</span>
          <span class="vjLabel">Chill</span>
          <span class="vjSub">An affirmation or two, then I'm out</span>
        </button>
        <button class="vjTile" data-vibe="curious">
          <span class="vjEmoji">🔍</span>
          <span class="vjLabel">Curious</span>
          <span class="vjSub">One thing I probably didn't know</span>
        </button>
        <button class="vjTile" data-vibe="ready">
          <span class="vjEmoji">✅</span>
          <span class="vjLabel">Ready</span>
          <span class="vjSub">I'm good — take me to next steps</span>
        </button>
      </div>
      <div class="vjContent" id="vjContent" style="display:none;"></div>
    </div>
  `;
}

function initVibeJukebox(){
  if(vibeJukeboxCleanup) vibeJukeboxCleanup();
  const tiles = document.getElementById('vjTiles');
  const content = document.getElementById('vjContent');
  if(!tiles || !content) return;

  const VIBES = {
    sharp: {
      title: '⚡ Three things that actually matter',
      cards: [
        { head: 'Silence ≠ yes', body: 'No response, going quiet, or freezing up — none of those are consent. A real yes sounds enthusiastic.' },
        { head: 'You can stop at any point', body: '"I thought we were already going" is not a reason to keep going. Either person can stop anything, anytime.' },
        { head: 'Check in. Always.', body: '"Are you good?" takes two seconds. It changes everything. Make it a habit, not an exception.' },
      ]
    },
    chill: {
      title: '🌊 Take these with you',
      cards: [
        { head: 'You showed up today.', body: 'Coming here and going through this — even when it was uncomfortable — means something.' },
        { head: 'You can care about someone and still have let them down.', body: 'Those aren\'t contradictions. That tension is where growth lives.' },
        { head: 'The way you respond now matters more than what happened.', body: 'Not more than accountability — but the next chapter is still being written.' },
      ]
    },
    curious: {
      title: '🔍 One thing worth knowing',
      cards: [
        { head: 'Most people don\'t report.', body: 'Over 70% of sexual violence goes unreported. That\'s not because it didn\'t happen — it\'s because reporting is hard, scary, and often not believed. When someone says something, it cost them something.' },
        { head: 'Consent is a skill, not a rule.', body: 'It\'s not a legal checkbox. It\'s a habit of paying attention — to signals, to hesitation, to your own assumptions. Skills get better with practice.' },
        { head: 'The hardest part isn\'t knowing the rules.', body: 'It\'s noticing. Most harm doesn\'t come from people who knew what they were doing. It comes from people who weren\'t paying attention. Awareness is the work.' },
      ]
    },
    ready: null
  };

  let currentVibe = null;
  let cardIdx = 0;

  function renderCards(vibe){
    const v = VIBES[vibe];
    if(!v){ 
      // ready — just go to next steps
      const nextBtn = document.querySelector('[data-action="nextSteps"]');
      if(nextBtn) nextBtn.click();
      return;
    }
    currentVibe = vibe;
    cardIdx = 0;
    tiles.style.display = 'none';
    content.style.display = 'block';
    renderCard();
  }

  function renderCard(){
    const v = VIBES[currentVibe];
    const card = v.cards[cardIdx];
    const isLast = cardIdx === v.cards.length - 1;
    content.innerHTML = `
      <div class="vjCardWrap">
        <div class="vjCardTitle">${v.title}</div>
        <div class="vjCard">
          <div class="vjCardPip">${cardIdx+1} / ${v.cards.length}</div>
          <div class="vjCardHead">${card.head}</div>
          <div class="vjCardBody">${card.body}</div>
        </div>
        <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
          ${!isLast ? `<button class="btn btnPrimary" id="vjNext" style="flex:1;">Next →</button>` : `<button class="btn btnPrimary" id="vjDone" style="flex:1;">Continue to next steps →</button>`}
          <button class="btn" id="vjBack" style="flex:0 0 auto;">← Change vibe</button>
        </div>
      </div>
    `;
    document.getElementById('vjNext')?.addEventListener('click',()=>{ cardIdx++; renderCard(); });
    document.getElementById('vjDone')?.addEventListener('click',()=>{ 
      const nb = document.querySelector('[data-action="nextSteps"]');
      if(nb) nb.click();
    });
    document.getElementById('vjBack')?.addEventListener('click',()=>{
      tiles.style.display = 'grid';
      content.style.display = 'none';
    });
  }

  tiles.querySelectorAll('.vjTile').forEach(tile=>{
    tile.addEventListener('click',()=>{ renderCards(tile.dataset.vibe); });
  });

  vibeJukeboxCleanup = ()=>{ vibeJukeboxCleanup = null; };
}

function catRunnerMarkup(){
  return `
    <div class="note">
      <b>Reset break:</b> play for 20–30 seconds, then come back to your next step.<br>
      <span style="font-size:12px; color: var(--muted);">
      </span>
    </div>

    <div style="
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
    ">
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;">
        <div style="border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:900; font-size:12px;">
          Score: <span id="cr_score" style="color:var(--sb-mint)">0</span>
        </div>
        <div style="border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:900; font-size:12px;">
          Speed: <span id="cr_speed" style="color:var(--sb-mint)">1.0</span>x
        </div>
        <button class="btn btnSmall" type="button" id="cr_restart" style="margin-left:auto;">Restart</button>
      </div>

      <canvas id="cr_game" width="900" height="260"
        style="
          width:100%;
          height:auto;
          border-radius: 14px;
          border: 1px solid var(--border);
          background: rgba(0,0,0,.18);
          touch-action: manipulation;
          display:block;
        "
        aria-label="Runner game"
      ></canvas>

      <div style="margin-top:10px; font-size:12px; color: var(--muted); line-height:1.35;">
        Controls: <b>Space</b>/<b>↑</b> jump • <b>↓</b> fast-drop • tap to jump on mobile • <b>R</b> restart
      </div>
    </div>
  `;
}


function fogFeature(){
  return `
    <div style="position:relative;">
      <div id="fogMount"></div>

      <div class="h1">Confused / Unsure</div>
      <div class="p">Confusion here is common. But it's worth unpacking what exactly is unclear.</div>

      <div style="display:flex; flex-direction:column; gap:10px; margin:14px 0;">
        <div style="padding:12px 14px; border-radius:12px; border:1px solid rgba(160,160,255,.22); background:rgba(160,160,255,.06); font-size:13.5px; color:var(--sb-light); line-height:1.55;">
          <b>Confused about what happened?</b><br>
          <span style="color:var(--muted);">Memory gaps, mixed signals, or a night that's hard to reconstruct. Uncertainty doesn't remove responsibility — it means sitting with it honestly, not filling gaps with the version that makes you feel better.</span>
        </div>
        <div style="padding:12px 14px; border-radius:12px; border:1px solid rgba(160,160,255,.22); background:rgba(160,160,255,.06); font-size:13.5px; color:var(--sb-light); line-height:1.55;">
          <b>Confused about whether it was okay?</b><br>
          <span style="color:var(--muted);">Was there a clear, enthusiastic yes at each step? Not silence, going along, or "I guess." If you're not sure — the answer was probably no.</span>
        </div>
        <div style="padding:12px 14px; border-radius:12px; border:1px solid rgba(160,160,255,.22); background:rgba(160,160,255,.06); font-size:13.5px; color:var(--sb-light); line-height:1.55;">
          <b>Confused about why it matters?</b><br>
          <span style="color:var(--muted);">That confusion often comes from myths about consent. Consent isn't just the absence of a "no." It's the presence of a genuine, ongoing "yes."</span>
        </div>
      </div>

      <div class="note">
        <b>Ask yourself:</b> What do I actually <em>know</em> happened vs. what am I assuming? The gap between those two things is worth paying attention to.
      </div>

      <div class="grid">
        <button class="btn" data-action="replayFog">Replay fog</button>
        <button class="btn btnPrimary" data-action="nextSteps">Continue</button>
      </div>

      <div style="margin-top:12px; font-size:12px; opacity:.62;">
        Clear consent should feel clear. If it doesn't — that's information.
      </div>
    </div>
  `;
}

function startFog(){
  const fogMount = document.getElementById("fogMount");
  if(!fogMount) return;

  const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  fogMount.innerHTML = ""; // reset

  if(prefersReducedMotion) return;

  fogMount.innerHTML = `
    <div class="fogOverlay" aria-hidden="true">
      <div class="fogLayer fog1"></div>
      <div class="fogLayer fog2"></div>
      <div class="fogLayer fog3"></div>
    </div>
  `;

  // Remove after last animation completes
  setTimeout(()=>{ if(fogMount) fogMount.innerHTML = ""; }, 6800);
}


let catRunnerCleanup = null;

function initCatRunner(){
  // Prevent double-mount if user re-renders the same screen
  if (catRunnerCleanup) catRunnerCleanup();

  const canvas = document.getElementById("cr_game");
  const ctx = canvas?.getContext("2d");
  if (!canvas || !ctx) return;

  const scoreEl = document.getElementById("cr_score");
  const speedEl = document.getElementById("cr_speed");
  const restartBtn = document.getElementById("cr_restart");


  // --- Cat SVG sprite (embedded) ---
  const CAT_SVG_RAW = `<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.0196 14.9374C11.7284 14.9374 11.4307 14.9818 11.1784 15.0796C11.0546 15.1275 10.9032 15.2031 10.7699 15.3252C10.6361 15.4479 10.4632 15.6749 10.4632 15.9999C10.4632 16.3249 10.6361 16.5519 10.7699 16.6745C10.9032 16.7967 11.0546 16.8722 11.1784 16.9202C11.4307 17.018 11.7284 17.0624 12.0196 17.0624C12.3109 17.0624 12.6085 17.018 12.8609 16.9202C12.9846 16.8722 13.136 16.7967 13.2693 16.6745C13.4032 16.5519 13.5761 16.3249 13.5761 15.9999C13.5761 15.6749 13.4032 15.4479 13.2693 15.3252C13.136 15.2031 12.9846 15.1275 12.8609 15.0796C12.6085 14.9818 12.3109 14.9374 12.0196 14.9374Z" fill="#1C274C"/>
<path d="M14.0365 12.6464C14.2015 12.38 14.5274 12.0625 15.0163 12.0625C15.5051 12.0625 15.831 12.38 15.996 12.6464C16.1681 12.9243 16.2501 13.2612 16.2501 13.5938C16.2501 13.9263 16.1681 14.2632 15.996 14.5411C15.831 14.8075 15.5051 15.125 15.0163 15.125C14.5274 15.125 14.2015 14.8075 14.0365 14.5411C13.8644 14.2632 13.7824 13.9263 13.7824 13.5938C13.7824 13.2612 13.8644 12.9243 14.0365 12.6464Z" fill="#1C274C"/>
<path d="M9.01634 12.0625C8.52751 12.0625 8.20161 12.38 8.03658 12.6464C7.86445 12.9243 7.78247 13.2612 7.78247 13.5938C7.78247 13.9263 7.86445 14.2632 8.03658 14.5411C8.20161 14.8075 8.52751 15.125 9.01634 15.125C9.50518 15.125 9.83108 14.8075 9.9961 14.5411C10.1682 14.2632 10.2502 13.9263 10.2502 13.5938C10.2502 13.2612 10.1682 12.9243 9.9961 12.6464C9.83108 12.38 9.50518 12.0625 9.01634 12.0625Z" fill="#1C274C"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.09485 4.25C5.48148 4.25 4.77463 4.42871 4.20882 4.91616C3.62226 5.4215 3.27004 6.18781 3.27004 7.1875V9.0625L3.27005 9.06545C3.2712 9.35941 3.3211 9.94757 3.4888 10.4392C3.54365 10.6001 3.63129 10.8134 3.77764 11.0058C3.49364 11.5688 3.35904 12.1495 3.29787 12.7095C3.2468 13.1771 3.24611 13.6679 3.25424 14.1211C2.5932 14.3507 1.90877 14.6349 1.5932 14.8387C1.24524 15.0634 1.14534 15.5277 1.37006 15.8756C1.59478 16.2236 2.05903 16.3235 2.40698 16.0988C2.5234 16.0236 2.86686 15.8664 3.31867 15.6939C3.38755 16.173 3.52716 16.6095 3.7221 17.0063C3.56621 17.1035 3.42847 17.1935 3.31889 17.2652C3.27694 17.2926 3.23912 17.3173 3.20599 17.3387C2.85803 17.5634 2.75813 18.0277 2.98285 18.3756C3.20757 18.7236 3.67182 18.8235 4.01978 18.5988C4.0609 18.5722 4.10473 18.5436 4.15098 18.5134C4.28216 18.4278 4.43287 18.3294 4.59701 18.2288C5.18653 18.8313 5.91865 19.2964 6.67916 19.6462C8.45998 20.4654 10.569 20.75 12.0001 20.75C13.4311 20.75 15.5402 20.4654 17.321 19.6462C18.0815 19.2964 18.8136 18.8313 19.4031 18.2288C19.5673 18.3294 19.718 18.4278 19.8491 18.5134C19.8954 18.5436 19.9392 18.5722 19.9803 18.5988C20.3283 18.8235 20.7925 18.7236 21.0173 18.3756C21.242 18.0277 21.1421 17.5634 20.7941 17.3387C20.761 17.3173 20.7232 17.2926 20.6812 17.2652C20.5716 17.1935 20.4339 17.1035 20.2781 17.0063C20.473 16.6095 20.6127 16.173 20.6815 15.6938C21.1335 15.8663 21.4771 16.0236 21.5936 16.0988C21.9415 16.3235 22.4058 16.2236 22.6305 15.8756C22.8552 15.5277 22.7553 15.0634 22.4074 14.8387C22.0917 14.6349 21.4071 14.3506 20.7459 14.121C20.7541 13.6678 20.7534 13.177 20.7023 12.7095C20.6412 12.1495 20.5065 11.5688 20.2225 11.0058C20.3689 10.8134 20.4565 10.6001 20.5114 10.4392C20.6791 9.94758 20.729 9.35941 20.7301 9.06545L20.7302 9.0625V7.18761C20.7302 6.18792 20.3779 5.42162 19.7914 4.91628C19.2256 4.42882 18.5187 4.25011 17.9054 4.25011C17.4969 4.25011 17.0744 4.40685 16.7337 4.56076C16.3726 4.72392 15.9952 4.9359 15.6558 5.13136C15.5828 5.17339 15.5119 5.21444 15.443 5.25432L15.441 5.25548C15.177 5.4084 14.9427 5.5441 14.7339 5.65167C14.6042 5.7185 14.5035 5.7643 14.4285 5.79206C14.3969 5.80377 14.3767 5.80966 14.3663 5.81242C14.1129 5.81102 13.9514 5.79033 13.7181 5.76044C13.6681 5.75403 13.6147 5.74719 13.5564 5.74003C13.2098 5.69743 12.7722 5.65636 12.0001 5.65636C11.228 5.65636 10.7905 5.69743 10.4438 5.74003C10.3855 5.74719 10.3322 5.75403 10.2821 5.76044C10.0489 5.79033 9.88738 5.81102 9.63388 5.81242C9.62352 5.80966 9.60332 5.80376 9.57174 5.79206C9.49678 5.7643 9.39604 5.71849 9.26633 5.65166C9.05755 5.54408 8.82331 5.40842 8.55926 5.25548C8.48975 5.21523 8.41818 5.17377 8.34446 5.13132C8.00502 4.93584 7.62764 4.72384 7.26652 4.56067C6.92587 4.40675 6.50329 4.25 6.09485 4.25ZM6.16192 17.6138C6.49595 17.8657 6.8808 18.0879 7.30604 18.2835C8.83694 18.9877 10.7179 19.25 12.0001 19.25C13.2823 19.25 15.1632 18.9877 16.6941 18.2835C17.1194 18.0879 17.5042 17.8657 17.8382 17.6138C17.4858 17.5524 17.2179 17.245 17.2179 16.875C17.2179 16.4608 17.5537 16.125 17.9679 16.125C18.2951 16.125 18.6295 16.2068 18.9399 16.3204C19.0985 15.9885 19.1959 15.625 19.2226 15.2271C18.9249 15.1544 18.7193 15.125 18.6134 15.125C18.1992 15.125 17.8634 14.7892 17.8634 14.375C17.8634 13.9608 18.1992 13.625 18.6134 13.625C18.8081 13.625 19.0284 13.6542 19.2504 13.6974C19.2505 13.4213 19.2415 13.1502 19.2112 12.8724C19.1407 12.227 18.958 11.6541 18.5269 11.1447C18.3727 10.9625 18.1809 10.7813 17.9402 10.6045C17.6063 10.3594 17.5344 9.88999 17.7796 9.55611C18.0247 9.22224 18.4941 9.15031 18.828 9.39546C18.9471 9.48292 19.0597 9.57282 19.1659 9.66506C19.2099 9.43686 19.2295 9.19817 19.2302 9.06087V7.18761C19.2302 6.56231 19.0238 6.23486 18.8123 6.0527C18.5801 5.85266 18.2496 5.75011 17.9054 5.75011C17.835 5.75011 17.659 5.78868 17.3513 5.92771C17.064 6.0575 16.7432 6.23612 16.4043 6.43125C16.3407 6.4679 16.2759 6.50544 16.2106 6.54328C15.9428 6.69843 15.666 6.85883 15.4209 6.98509C15.2663 7.06473 15.1052 7.14099 14.9495 7.19867C14.8058 7.25192 14.607 7.3125 14.3941 7.3125C14.0223 7.3125 13.7617 7.27877 13.5115 7.2464C13.4654 7.24043 13.4196 7.23449 13.3735 7.22883C13.0848 7.19336 12.7084 7.15636 12.0001 7.15636C11.2919 7.15636 10.9154 7.19336 10.6267 7.22883C10.5807 7.23449 10.5349 7.24042 10.4887 7.24639C10.2386 7.27877 9.97796 7.3125 9.6061 7.3125C9.39326 7.3125 9.19445 7.25191 9.05069 7.19866C8.89497 7.14098 8.73386 7.06471 8.57928 6.98506C8.33423 6.8588 8.05742 6.69839 7.78968 6.54325C7.72435 6.50539 7.65955 6.46784 7.59589 6.43118C7.25702 6.23603 6.93614 6.05741 6.64888 5.92761C6.34115 5.78856 6.16522 5.75 6.09485 5.75C5.75062 5.75 5.42007 5.85254 5.18787 6.05259C4.97643 6.23475 4.77004 6.56219 4.77004 7.1875V9.06088C4.7707 9.19819 4.79025 9.43686 4.83425 9.66506C4.94053 9.57281 5.05309 9.48292 5.1722 9.39546C5.50608 9.15031 5.97547 9.22224 6.22062 9.55612C6.46577 9.88999 6.39385 10.3594 6.05997 10.6045C5.81926 10.7813 5.62748 10.9625 5.47331 11.1447C5.04223 11.6541 4.85949 12.227 4.789 12.8724C4.75865 13.1502 4.74966 13.4213 4.74975 13.6975C4.97192 13.6543 5.19231 13.625 5.38719 13.625C5.80141 13.625 6.13719 13.9608 6.13719 14.375C6.13719 14.7892 5.80141 15.125 5.38719 15.125C5.28121 15.125 5.07549 15.1544 4.77758 15.2271C4.80434 15.625 4.90168 15.9885 5.06027 16.3203C5.37069 16.2068 5.70504 16.125 6.03224 16.125C6.44646 16.125 6.78224 16.4608 6.78224 16.875C6.78224 17.245 6.51433 17.5524 6.16192 17.6138Z" fill="#1C274C"/>
</svg>`;

  function recolorSvg(svg, fill) {
    return svg
      .replace(/fill="(?!none)[^"]*"/g, `fill="${fill}"`)
      .replace(/stroke="(?!none)[^"]*"/g, `stroke="${fill}"`);
  }
  function makeSvgDataUri(svgString) {
    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgString);
  }

  const catImg = new Image();
  catImg.decoding = "async";
  catImg.src = makeSvgDataUri(recolorSvg(CAT_SVG_RAW, "#15FFC8"));

  const W = canvas.width, H = canvas.height;
  const groundY = Math.round(H * 0.78);

  const gravity = 2200;
  const jumpVel = -780;
  const dropVel = 900;

  let running = true;
let started = false;
  let time = 0;
  let score = 0;
  let speed = 520;
  let speedMult = 1;
  let spawnTimer = 0;
  let nextSpawn = 0.9;

  const player = { x: 110, y: groundY, w: 46, h: 46, vy: 0, onGround: true };
  const obstacles = [];

  // --- Cosmic background data ---
  const STAR_COUNT = 90;
  const stars = Array.from({length: STAR_COUNT}, () => ({
    x: Math.random() * W,
    y: Math.random() * groundY * 0.92,
    r: Math.random() * 1.6 + 0.3,
    speed: Math.random() * 0.18 + 0.02,
    phase: Math.random() * Math.PI * 2,
    twinkleSpeed: Math.random() * 3 + 1,
  }));
  const moon = { x: W * 0.83, y: H * 0.20, r: 22 };

  function rand(min, max){ return Math.random() * (max - min) + min; }

  function spawnObstacle() {
    const tall = Math.random() < 0.45;
    const w = tall ? rand(18, 28) : rand(16, 24);
    const h = tall ? rand(42, 66) : rand(28, 42);
    obstacles.push({ x: W + 20, y: groundY, w, h });
  }

  function aabb(ax, ay, aw, ah, bx, by, bw, bh) {
    const aTop = ay - ah, aLeft = ax, aRight = ax + aw, aBottom = ay;
    const bTop = by - bh, bLeft = bx, bRight = bx + bw, bBottom = by;
    return !(aRight < bLeft || aLeft > bRight || aBottom < bTop || aTop > bBottom);
  }

  function resetGame() {
    running = true;
    time = 0;
    score = 0;
    speed = 520;
    speedMult = 1;
    spawnTimer = 0;
    nextSpawn = 0.9;
    obstacles.length = 0;

    player.y = groundY;
    player.vy = 0;
    player.onGround = true;

    scoreEl.textContent = "0";
    speedEl.textContent = "1.0";
  }

  function jump() {
  if (!started) {
    started = true;
    running = true;
    last = performance.now();
    raf = requestAnimationFrame(loop);
    return;
  }

  if (!running) {
    resetGame();
    drawStartOverlay();
    started = false;
    return;
  }

  if (player.onGround) {
    player.vy = jumpVel;
    player.onGround = false;
  }
}

  function fastDrop() {
    if (!player.onGround) player.vy = Math.max(player.vy, dropVel);
  }

  // Draw helpers
  function roundRect(ctx, x, y, w, h, r) {
    const radius = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + w - radius, y);
    ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
    ctx.lineTo(x + w, y + h - radius);
    ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
    ctx.lineTo(x + radius, y + h);
    ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
  }

  function drawBackground() {
    // Deep space gradient fill
    const grad = ctx.createLinearGradient(0, 0, 0, groundY);
    grad.addColorStop(0, "#04091a");
    grad.addColorStop(0.55, "#080f24");
    grad.addColorStop(1, "#0b1830");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, W, H);

    // Ground-area dark fill
    ctx.fillStyle = "#03060f";
    ctx.fillRect(0, groundY, W, H - groundY);

    // Nebula glow (purple-blue)
    const neb = ctx.createRadialGradient(W * 0.64, H * 0.28, 0, W * 0.64, H * 0.28, 200);
    neb.addColorStop(0, "rgba(80, 0, 130, 0.13)");
    neb.addColorStop(0.45, "rgba(0, 40, 120, 0.09)");
    neb.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = neb;
    ctx.fillRect(0, 0, W, groundY);

    // Secondary nebula (teal hint, near left)
    const neb2 = ctx.createRadialGradient(W * 0.18, H * 0.5, 0, W * 0.18, H * 0.5, 130);
    neb2.addColorStop(0, "rgba(0, 100, 120, 0.10)");
    neb2.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = neb2;
    ctx.fillRect(0, 0, W, groundY);

    // Moon
    ctx.save();
    const moonGrad = ctx.createRadialGradient(
      moon.x - moon.r * 0.32, moon.y - moon.r * 0.32, moon.r * 0.08,
      moon.x, moon.y, moon.r
    );
    moonGrad.addColorStop(0, "rgba(225, 245, 255, 0.95)");
    moonGrad.addColorStop(0.55, "rgba(160, 200, 230, 0.75)");
    moonGrad.addColorStop(1, "rgba(80, 140, 190, 0.35)");
    ctx.beginPath();
    ctx.arc(moon.x, moon.y, moon.r, 0, Math.PI * 2);
    ctx.fillStyle = moonGrad;
    ctx.fill();
    // Moon outer glow
    const moonGlow = ctx.createRadialGradient(moon.x, moon.y, moon.r * 0.9, moon.x, moon.y, moon.r * 2.8);
    moonGlow.addColorStop(0, "rgba(150, 210, 255, 0.14)");
    moonGlow.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = moonGlow;
    ctx.beginPath();
    ctx.arc(moon.x, moon.y, moon.r * 2.8, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // Stars with parallax scrolling + twinkling
    ctx.save();
    for (const s of stars) {
      const sx = ((s.x - time * speed * s.speed) % W + W) % W;
      const twinkle = 0.45 + 0.55 * Math.sin(time * s.twinkleSpeed + s.phase);
      ctx.globalAlpha = twinkle;
      ctx.fillStyle = "rgba(209, 254, 255, 1)";
      ctx.beginPath();
      ctx.arc(sx, s.y, s.r, 0, Math.PI * 2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;
    ctx.restore();
  }

  function drawGround() {
    ctx.save();
    ctx.strokeStyle = "rgba(209,254,255,.45)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, groundY + 1);
    ctx.lineTo(W, groundY + 1);
    ctx.stroke();

    const tickCount = 26;
    ctx.strokeStyle = "rgba(21,255,200,.25)";
    ctx.lineWidth = 2;
    for (let i = 0; i < tickCount; i++) {
      const seg = (W / tickCount);
      const x = (i * seg - (time * speed * 0.25) % seg);
      ctx.beginPath();
      ctx.moveTo(x, groundY + 10);
      ctx.lineTo(x + 14, groundY + 10);
      ctx.stroke();
    }
    ctx.restore();
  }

  function drawObstacle(o) {
    ctx.save();
    ctx.translate(o.x, o.y - o.h);

    ctx.fillStyle = "rgba(19,132,143,.22)";
    ctx.strokeStyle = "rgba(209,254,255,.70)";
    ctx.lineWidth = 3;

    roundRect(ctx, 0, 0, o.w, o.h, 10);
    ctx.fill(); ctx.stroke();

    if (o.h > 44) {
      ctx.fillStyle = "rgba(21,255,200,.14)";
      ctx.strokeStyle = "rgba(21,255,200,.75)";
      const bh = Math.min(18, o.h*0.35);
      roundRect(ctx, -Math.min(14, o.w*0.6), o.h*0.38, Math.min(18, o.w*0.9), bh, 10);
      ctx.fill(); ctx.stroke();
    }

    ctx.restore();
  }

function drawStartOverlay(){
  ctx.clearRect(0, 0, W, H);
  drawBackground();
  drawGround();
  drawPlayer();

  // Soft tint so the text reads, without wiping the background
  ctx.save();
  ctx.fillStyle = "rgba(0,0,0,.35)";
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = "rgba(209,254,255,.95)";
  ctx.font = "950 22px ui-sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("Tap or Press Space to Start", W/2, H*0.48);

  ctx.fillStyle = "rgba(209,254,255,.7)";
  ctx.font = "900 13px ui-sans-serif";
  ctx.fillText("This is just a reset break.", W/2, H*0.62);

  ctx.restore();
}

  function drawPlayer() {
    const { x, y, w, h } = player;

    ctx.save();
    ctx.fillStyle = "rgba(0,0,0,.18)";
    ctx.beginPath();
    ctx.ellipse(x + w*0.55, y + 10, w*0.55, 6, 0, 0, Math.PI*2);
    ctx.fill();

    if (!catImg.complete || catImg.naturalWidth === 0) {
      ctx.fillStyle = "rgba(21,255,200,.18)";
      ctx.strokeStyle = "rgba(21,255,200,.95)";
      ctx.lineWidth = 3;
      roundRect(ctx, x, y - h, w, h, 12);
      ctx.fill(); ctx.stroke();
      ctx.restore();
      return;
    }

    const bob = player.onGround ? Math.sin(time * 12) * 1.5 : -2;
    ctx.drawImage(catImg, x - 2, (y - h) + bob, w + 10, h + 10);
    ctx.restore();
  }

  function drawOverlay(text) {
    ctx.save();
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.fillRect(0, 0, W, H);

    ctx.fillStyle = "rgba(209,254,255,.95)";
    ctx.font = "950 22px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
    ctx.textAlign = "center";
    ctx.fillText(text, W/2, H*0.46);

    ctx.fillStyle = "rgba(209,254,255,.75)";
    ctx.font = "900 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
    ctx.fillText("Press Space / Tap to restart", W/2, H*0.62);
    ctx.restore();
  }

  function step(dt) {
    time += dt;

    speed += 18 * dt;
    speedMult = 1 + (speed - 520) / 900;
    speedEl.textContent = speedMult.toFixed(1);

    score += (dt * 10) * speedMult;
    scoreEl.textContent = String(Math.floor(score));

    player.vy += gravity * dt;
    player.y += player.vy * dt;

    if (player.y >= groundY) {
      player.y = groundY;
      player.vy = 0;
      player.onGround = true;
    } else {
      player.onGround = false;
    }

    spawnTimer += dt;
    if (spawnTimer >= nextSpawn) {
      spawnTimer = 0;
      nextSpawn = rand(0.65, 1.15) / Math.max(1, speedMult * 0.85);
      spawnObstacle();
    }

    for (let i = obstacles.length - 1; i >= 0; i--) {
      obstacles[i].x -= speed * dt;
      if (obstacles[i].x < -80) obstacles.splice(i, 1);
    }

    for (const o of obstacles) {
      if (aabb(player.x, player.y, player.w, player.h, o.x, o.y, o.w, o.h)) {
        running = false;
        break;
      }
    }

    if (!running) {
      const finalScore = Math.floor(score);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);

    // Cosmic background (sky/stars/moon) — draw first, then game elements on top
    drawBackground();

    drawGround();
    for (const o of obstacles) drawObstacle(o);
    drawPlayer();
    if (!running) drawOverlay("Game Over");
  }

  let raf = null;
  let last = performance.now();
  function loop(now) {
    const dt = Math.min(0.033, (now - last) / 1000);
    last = now;
    if (running) step(dt);
    draw();
    raf = requestAnimationFrame(loop);
  }

  // Input (scoped + cleanup)
  const onKeyDown = (e) => {
    // If the user is typing in a field, don't hijack keys like Space.
    const active = document.activeElement;
    const tag = active && active.tagName;
    const isTypingField = tag === "INPUT" || tag === "TEXTAREA" || (active && active.isContentEditable);
    if (isTypingField) return;

    if (e.code === "Space" || e.code === "ArrowUp") { e.preventDefault(); jump(); }
    if (e.code === "ArrowDown") { e.preventDefault(); fastDrop(); }
    if (e.code === "KeyR") { e.preventDefault(); resetGame(); }
  };

  window.addEventListener("keydown", onKeyDown);
  canvas.addEventListener("pointerdown", jump);
  restartBtn.addEventListener("click", resetGame);

  resetGame();
drawStartOverlay();   // show start screen

  // cleanup for SPA screen switches
  catRunnerCleanup = () => {
    if (raf) cancelAnimationFrame(raf);
    window.removeEventListener("keydown", onKeyDown);
    canvas.removeEventListener("pointerdown", jump);
    restartBtn.removeEventListener("click", resetGame);
    catRunnerCleanup = null;
  };
}

function entryLabel(e){
  return ({
    crossed_boundary:"Worried I crossed a boundary",
    they_mad:"They’re mad and I think I did something wrong",
    not_sure_ok:"Not sure if what happened was okay",
    made_uncomfortable:"Someone said I made them uncomfortable",
    cant_explain:"I don’t know how to explain it",
    learn_consent:"I want to understand consent better",
    accidental_assault:"I think I accidentally sexually assaulted someone"
  })[e] || "—";
}
function scenarioLabel(s){
  return ({
    freeze:"They froze or got quiet",
    pulled_away:"They pulled away",
    drinking:"We were drinking",
    not_sure_wanted:"Not sure they wanted it",
    upset_after:"They seemed upset afterward",
    not_sure_what:"I’m still not sure what happened",
    pressure:"I kept persuading or pressuring them",
    age_power:"There was an age or power difference",
    digital:"Something happened digitally (photos/messages)",
    coercion:"I ignored a clear ‘no’",
    relationship:"We were in a relationship and I assumed consent"
  })[s] || "—";
}

function routeScenario(s){
  state.scenario = s;

  // Always show an explanation screen for every selection.
  // (These screens then route into the shared emotion → next steps flow.)

  // Core behavioral-signal scenarios
  if(s === "freeze") return go("A_freeze_whatItMeans");
  if(s === "pulled_away") return go("C_pulledAway_signal");
  if(s === "drinking") return go("B_drinking_basics");

  // Wide-branch scenarios
  if(s === "pressure") return go("D_pressure");
  if(s === "asleep") return go("L_asleep");
  if(s === "age_power") return go("E_age_power");
  if(s === "digital") return go("F_digital");
  if(s === "coercion") return go("G_coercion");
  if(s === "relationship") return go("H_relationship");

  // Ambiguity / aftermath scenarios
  if(s === "not_sure_wanted") return go("I_not_sure_wanted");
  if(s === "upset_after") return go("J_upset_after");
  if(s === "not_sure_what") return go("K_not_sure_what");

  // If we somehow reach an unknown key, default to emotion (safe fallback).
  return go("emotion");
}


// ===== Spiral Interrupt (Ashamed) =====
let spiralCleanup = null;

function spiralInterruptMarkup(){
  return `
  <div class="siWrap" style="margin-top:14px;">
    <div class="panel" id="si_panel">
      <div class="panelHeader" id="si_header" tabindex="0" role="button" aria-expanded="false" aria-controls="si_body">
        <div class="titleBlock">
          <div class="panelTitle">Spiral Interrupt</div>
          <div class="panelSub">Click to open. Tap the spiral to steady it.</div>
        </div>
        <div class="chev" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="rgba(209,254,255,.9)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="panelBody" id="si_body">
        <div class="inner">
          <div class="spiralStage" id="si_stage" tabindex="0" aria-label="Tap to steady the spiral">
            <svg id="si_spiral" viewBox="0 0 200 200" aria-hidden="true">
              <path d="M100 100
                       m -5, 0
                       a 5,5 0 1,0 10,0
                       a 15,15 0 1,1 -30,0
                       a 25,25 0 1,0 50,0
                       a 35,35 0 1,1 -70,0
                       a 45,45 0 1,0 90,0
                       a 55,55 0 1,1 -110,0"
                    fill="none"
                    stroke="#15FFC8"
                    stroke-width="3"
                    stroke-linecap="round"/>
            </svg>
          </div>

          <div class="msg" id="si_msg">When you’re ready, tap the spiral to slow it down.</div>

          <div class="footer">Spiraling feels productive. It isn’t.</div>
        </div>
      </div>
    </div>
  </div>
  `;
}

function initSpiralInterrupt(){
  // Cleanup old listeners if re-rendered
  if(spiralCleanup) spiralCleanup();

  const panel = document.getElementById('si_panel');
  const header = document.getElementById('si_header');

  const reducedTag = document.getElementById('si_reducedTag');
  const spiral = document.getElementById('si_spiral');
  const stage = document.getElementById('si_stage');
  const msg = document.getElementById('si_msg');

  if(!panel || !header || !spiral || !stage || !msg) return;

  const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if(prefersReducedMotion && reducedTag) reducedTag.style.display = 'inline-block';

  // Motion state
  let angle = 0;
  const spinSpeedStart = prefersReducedMotion ? 6 : 12;
  let spinSpeed = 0;
  let taps = 0;
  let spinning = false;
  let rafId = null;

  function renderAngle(){ spiral.style.transform = `rotate(${angle}deg)`; }

  function animate(){
    if(!spinning) return;
    angle += spinSpeed;
    renderAngle();
    rafId = requestAnimationFrame(animate);
  }

  function startSpin(){
    if(spinning) return;
    if(spinSpeed === 0 && taps > 0){
      taps = 0;
      msg.textContent = 'Tap the spiral to slow it down.';
    }
    spinSpeed = spinSpeedStart;
    spinning = true;
    animate();
  }

  function stopSpin(){
    spinning = false;
    spinSpeed = 0;
    if(rafId) cancelAnimationFrame(rafId);
    rafId = null;
  }

  function resetSpiral(){
    stopSpin();
    angle = 0;
    taps = 0;
    renderAngle();
    msg.textContent = 'When you’re ready, tap the spiral to slow it down.';
  }

  function openPanel(){
    panel.classList.add('open');
    header.setAttribute('aria-expanded', 'true');
    startSpin();
  }

  function closePanel(){
    panel.classList.remove('open');
    header.setAttribute('aria-expanded', 'false');
    stopSpin();
    taps = 0;
    msg.textContent = 'When you’re ready, tap the spiral to slow it down.';
  }

  function togglePanel(){
    const isOpen = panel.classList.contains('open');
    if(isOpen) closePanel(); else openPanel();
  }

  function tapToSteady(){
    if(!spinning) return;
    taps++;
    const factor = prefersReducedMotion ? 0.92 : 0.88;
    spinSpeed *= factor;

    if(taps === 5) msg.textContent = 'Keep going.';
    if(taps === 12) msg.textContent = 'You’re interrupting the spiral.';

    if(spinSpeed < 0.6){
      stopSpin();
      msg.innerHTML = 'You can face what happened<br>without collapsing into it.';
    }
  }

  const onHeaderKey = (e)=>{
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      togglePanel();
    }
  };
  const onStageKey = (e)=>{
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      tapToSteady();
    }
  };

  header.addEventListener('click', togglePanel);
  header.addEventListener('keydown', onHeaderKey);
  stage.addEventListener('click', tapToSteady);
  stage.addEventListener('keydown', onStageKey);

  resetSpiral();

  spiralCleanup = ()=>{
    if(rafId) cancelAnimationFrame(rafId);
    header.removeEventListener('click', togglePanel);
    header.removeEventListener('keydown', onHeaderKey);
    stage.removeEventListener('click', tapToSteady);
    stage.removeEventListener('keydown', onStageKey);
    spiralCleanup = null;
  };
}



// ===== Brick Wall Reveal (Defensive) =====
let brickWallCleanup = null;

function brickWallMarkup(){
  return `
  <div class="bwWrap">
    <div class="panel" id="bw_panel">
      <div class="panelHeader" id="bw_header" tabindex="0" role="button" aria-expanded="false" aria-controls="bw_body">
        <div class="titleBlock">
          <div class="panelTitle">Lower the Wall</div>
          <div class="panelSub">Drag or tap bricks into the pile to reveal what's underneath.</div>
        </div>
        <div class="chev" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="rgba(209,254,255,.9)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="panelBody" id="bw_body">
        <div class="inner">
          <div class="bwLayout">
            <div>
              <div class="bwWall">
                <div id="bw_message" class="bwMessage" style="--bw-reveal:0; --bw-blur:10px;">
                  <div class="bwMessageInner">
                    You can listen without agreeing.<br/>
                    You can take responsibility without losing yourself.
                    <span class="small">Try: "I hear you. I'm taking this seriously."</span>
                  </div>
                </div>
                <div id="bw_bricks" class="bwBricks"></div>
              </div>
              <div class="bwProgress">
                <span id="bw_progressText">0 / 9 bricks moved</span>
                <span id="bw_revealText">Message: 0% revealed</span>
              </div>
            </div>
            <div class="bwPile">
              <div class="bwPileTitle">Brick Pile</div>
              <div class="bwPileHint">Drag or tap any brick to set it down.</div>
              <div id="bw_drop" class="bwDropZone">Drop bricks here</div>
            </div>
          </div>
          <div class="bwFooter">Defensiveness protects you. It can also block growth.</div>
        </div>
      </div>
    </div>
  </div>
  `;
}

function initBrickWall(){
  if(brickWallCleanup) brickWallCleanup();

  const panel     = document.getElementById('bw_panel');
  const header    = document.getElementById('bw_header');
  const body      = document.getElementById('bw_body');
  const brickCont = document.getElementById('bw_bricks');
  const message   = document.getElementById('bw_message');
  const dropZone  = document.getElementById('bw_drop');
  const progText  = document.getElementById('bw_progressText');
  const revText   = document.getElementById('bw_revealText');

  if(!panel || !header || !brickCont || !message || !dropZone) return;

  const TOTAL = 9;
  let removed = 0;

  function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }

  function setReveal(){
    const r = removed / TOTAL;
    message.style.setProperty('--bw-reveal', clamp(r,0,1).toFixed(3));
    message.style.setProperty('--bw-blur', ((1-r)*10).toFixed(2)+'px');
    progText.textContent = `${removed} / ${TOTAL} bricks moved`;
    revText.textContent  = `Message: ${Math.round(r*100)}% revealed`;
  }

  function removeBrick(brick){
    if(brick.dataset.removed === '1') return;
    brick.dataset.removed = '1';
    brick.style.visibility = 'hidden';
    brick.setAttribute('draggable','false');
    removed++;
    setReveal();
  }

  // Build bricks
  for(let i=0;i<TOTAL;i++){
    const b = document.createElement('div');
    b.className = 'bwBrick';
    b.setAttribute('draggable','true');
    b.dataset.id = i;
    b.dataset.removed = '0';

    // Drag API
    b.addEventListener('dragstart', (e)=>{
      if(b.dataset.removed==='1'){ e.preventDefault(); return; }
      e.dataTransfer.setData('text/plain', b.dataset.id);
    });

    // Touch / click fallback
    b.addEventListener('click', ()=>{ removeBrick(b); });

    brickCont.appendChild(b);
  }

  // Drop zone
  const onDragOver = (e)=>{ e.preventDefault(); dropZone.classList.add('dragOver'); };
  const onDragLeave = ()=>{ dropZone.classList.remove('dragOver'); };
  const onDrop = (e)=>{
    e.preventDefault();
    dropZone.classList.remove('dragOver');
    const id = e.dataTransfer.getData('text/plain');
    const brick = brickCont.querySelector(`.bwBrick[data-id="${id}"]`);
    if(brick) removeBrick(brick);
  };
  dropZone.addEventListener('dragover', onDragOver);
  dropZone.addEventListener('dragleave', onDragLeave);
  dropZone.addEventListener('drop', onDrop);

  // Panel toggle
  function openPanel(){
    panel.classList.add('open');
    header.setAttribute('aria-expanded','true');
  }
  function togglePanel(){
    const isOpen = panel.classList.contains('open');
    isOpen ? panel.classList.remove('open') && header.setAttribute('aria-expanded','false')
           : openPanel();
    header.setAttribute('aria-expanded', !isOpen ? 'true' : 'false');
  }
  const onHeaderKey = (e)=>{
    if(e.key==='Enter'||e.key===' '){ e.preventDefault(); togglePanel(); }
  };
  header.addEventListener('click', togglePanel);
  header.addEventListener('keydown', onHeaderKey);

  setReveal();

  brickWallCleanup = ()=>{
    header.removeEventListener('click', togglePanel);
    header.removeEventListener('keydown', onHeaderKey);
    dropZone.removeEventListener('dragover', onDragOver);
    dropZone.removeEventListener('dragleave', onDragLeave);
    dropZone.removeEventListener('drop', onDrop);
    brickWallCleanup = null;
  };
}

let __angerResetTimer = null;
let angerPressureCleanup = null;

// ===== Next Right Move (Guilt) =====
let nextRightMoveCleanup = null;

function nextRightMoveMarkup(){
  return `
  <div class="nrmWrap">
    <div class="panel" id="nrmPanel">
      <div class="panelHeader" id="nrmPanelHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="nrmPanelBody">
        <div class="titleBlock">
          <div class="panelTitle">Next right move</div>
          <div class="panelSub">Guilt becomes useful when it turns into a concrete next step</div>
        </div>
        <div class="chev" aria-hidden="true">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <div class="panelBody" id="nrmPanelBody">
        <div class="inner">
          <div class="nrmCard">
            <p style="font-size:13px;color:rgba(209,254,255,.82);margin:0 0 10px 0;line-height:1.4;">Tap through 5 moves — one at a time.</p>

            <div class="nrmPathWrap" aria-label="Progress path">
              <div class="nrmPath">
                <div class="nrmLine"><div class="nrmLineFill" id="nrmLineFill"></div></div>
                <div class="nrmNode" id="nrmN0"><span>1</span></div>
                <div class="nrmNode" id="nrmN1"><span>2</span></div>
                <div class="nrmNode" id="nrmN2"><span>3</span></div>
                <div class="nrmNode" id="nrmN3"><span>4</span></div>
                <div class="nrmNode" id="nrmN4"><span>5</span></div>
              </div>
            </div>

            <div class="nrmMoveBox" aria-live="polite">
              <div class="nrmLabelRow">
                <div class="nrmLabel">Right now</div>
                <div class="nrmBadge"><span class="nrmBadgeDot"></span><span id="nrmBadgeText">Ready</span></div>
              </div>
              <div id="nrmMove" class="nrmMove">Press the button.</div>
              <div id="nrmDesc" class="nrmDesc">You'll get one next move at a time.</div>
              <div class="nrmChallenge" id="nrmChallenge" style="display:none;">
                <div class="nrmChallengeTitle">Mini challenge</div>
                <div class="nrmChallengeText" id="nrmChallengeText"></div>
              </div>
            </div>

            <div class="nrmControls">
              <button id="nrmNextBtn" class="nrmBtn" type="button">What's the next right move?</button>
              <button id="nrmResetBtn" class="nrmBtn nrmBtnGhost" type="button">Reset</button>
            </div>
            <div style="text-align:center;"><div class="nrmStamp" id="nrmStamp">LOCKED IN</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  `;
}

function initNextRightMove(){
  if(nextRightMoveCleanup) nextRightMoveCleanup();

  // Panel toggle (dropdown)
  const panel  = document.getElementById("nrmPanel");
  const header = document.getElementById("nrmPanelHeader");
  if(panel && header){
    function openNrmPanel(){
      panel.classList.add('open');
      header.setAttribute('aria-expanded','true');
    }
    function toggleNrmPanel(){
      const isOpen = panel.classList.contains('open');
      if(isOpen){ panel.classList.remove('open'); header.setAttribute('aria-expanded','false'); }
      else { openNrmPanel(); }
    }
    const onHeaderKey = (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggleNrmPanel(); } };
    header.addEventListener('click', toggleNrmPanel);
    header.addEventListener('keydown', onHeaderKey);
    var _panelCleanup = ()=>{
      header.removeEventListener('click', toggleNrmPanel);
      header.removeEventListener('keydown', onHeaderKey);
    };
  }

  const moves = [
    {
      title: "Pause.",
      desc: "Stop the momentum. Put your phone down for 60 seconds. Let your body cool before you act.",
      challenges: [
        "Count 10 slow breaths. Don't do anything else while you count.",
        "Unclench your jaw. Drop your shoulders. Exhale longer than you inhale.",
        "Put your phone face-down for one minute."
      ]
    },
    {
      title: "Acknowledge.",
      desc: "Name what happened without minimizing: what you did, what you didn't do, and what you should have done.",
      challenges: [
        "Write one sentence: \"I did ___.\" No excuses, no backstory.",
        "Replace \"but\" with \"and\" once. Example: \"I didn't mean to — and it still hurt.\"",
        "Name the exact moment things shifted (one phrase)."
      ]
    },
    {
      title: "Apologize (if appropriate).",
      desc: "Keep it short. Don't ask for comfort. Don't ask for forgiveness. Respect whatever response you get.",
      challenges: [
        "Draft a 2-sentence apology. Delete anything that asks for reassurance.",
        "Add one line: \"I'll respect whatever space you want.\"",
        "If you're not sure it's appropriate: don't send. Save a draft."
      ]
    },
    {
      title: "Respect space.",
      desc: "If they want distance, give it. No follow-ups. No pressure. Space is part of repair.",
      challenges: [
        "Set a 24-hour rule: no contacting them today.",
        "Resist the urge to check in or explain yourself further. Silence is not abandonment — it's respect.",
        "Ask yourself: \"What boundary do I need to respect?\""
      ]
    },
    {
      title: "Change behavior.",
      desc: "Pick one concrete change you'll make next time. If you need education or support, go get it.",
      challenges: [
        "Choose ONE rule for yourself: \"If there's uncertainty, I pause and ask.\"",
        "Write one sentence: \"Next time, I will ___.\". Make it specific.",
        "Pick one resource you'll actually use (training, reading, conversation)."
      ]
    }
  ];

  let idx = -1;

  const moveEl      = document.getElementById("nrmMove");
  const descEl      = document.getElementById("nrmDesc");
  const nextBtn     = document.getElementById("nrmNextBtn");
  const resetBtn    = document.getElementById("nrmResetBtn");
  const badgeText   = document.getElementById("nrmBadgeText");
  const challengeBox= document.getElementById("nrmChallenge");
  const challengeText = document.getElementById("nrmChallengeText");
  const lineFill    = document.getElementById("nrmLineFill");
  const stamp       = document.getElementById("nrmStamp");
  const nodes       = [0,1,2,3,4].map(i=>document.getElementById("nrmN"+i));

  if(!moveEl || !nextBtn) return;

  function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function showStamp(text){
    stamp.textContent = text || "LOCKED IN";
    stamp.classList.remove("show");
    void stamp.offsetWidth;
    stamp.classList.add("show");
    setTimeout(()=>stamp.classList.remove("show"), 900);
  }

  function render(){
    if(idx < 0){
      moveEl.textContent = "Press the button.";
      descEl.textContent = "You'll get one next move at a time.";
      badgeText.textContent = "Ready";
      challengeBox.style.display = "none";
      lineFill.style.width = "0%";
      nodes.forEach(n=>{ n.classList.remove("active","done"); });
      return;
    }
    const m = moves[idx];
    moveEl.textContent = m.title;
    descEl.textContent = m.desc;
    badgeText.textContent = `Step ${idx+1} / ${moves.length}`;
    const pct = (idx)/(moves.length-1)*100;
    lineFill.style.width = (idx===0 ? 0 : pct) + "%";
    nodes.forEach((n,i)=>{
      n.classList.toggle("done", i < idx);
      n.classList.toggle("active", i === idx);
    });
    challengeBox.style.display = "block";
    challengeText.textContent = rand(m.challenges);
    showStamp(idx === moves.length-1 ? "NEXT TIME" : "GOOD");
  }

  function onNext(){
    idx = (idx+1) % moves.length;
    render();
  }
  function onReset(){
    idx = -1;
    render();
    showStamp("RESET");
  }

  nextBtn.addEventListener("click", onNext);
  resetBtn.addEventListener("click", onReset);

  nextRightMoveCleanup = ()=>{
    nextBtn.removeEventListener("click", onNext);
    resetBtn.removeEventListener("click", onReset);
    if(typeof _panelCleanup === 'function') _panelCleanup();
    nextRightMoveCleanup = null;
  };

  render();
}

function angerPressureMarkup(){
  return `
  <div class="pressureWrap" aria-label="Anger pressure meter">
    <div class="pressureTop">
      <div class="pressureLabel">Pressure meter (how activated are you?)</div>
      <div class="pressureValue">Level: <span id="angerLevel">5</span>/10</div>
    </div>
    <div class="pressureBar" aria-hidden="true">
      <div class="pressureFill" id="angerFill" style="width:50%"></div>
    </div>
    <input
      class="pressureSlider"
      id="angerMeter"
      type="range"
      min="1" max="10" step="1" value="5"
      aria-label="Set anger level from 1 to 10"
    />
    <div class="pressureTicks" id="pressureTicks" aria-hidden="true"></div>
    <div class="pressureCopy" id="angerCopy">
      Somewhere in the middle. Enough heat to feel it — enough space to choose what you do next.
    </div>
    <div class="pressurePrompt" id="angerPrompt" style="display:none;">
      <b>High heat.</b> Before you text, post, argue, or do anything: take a 20–40 second reset.
      <div style="margin-top:8px;">
        <button class="btn btnSmall" type="button" id="angerResetBtn">Do a 20s reset</button>
      </div>
    </div>
  </div>
  `;
}

function initAngerPressure(){
  if(angerPressureCleanup) angerPressureCleanup();
  if(__angerResetTimer){ clearInterval(__angerResetTimer); __angerResetTimer = null; }

  const meter    = document.getElementById("angerMeter");
  const levelEl  = document.getElementById("angerLevel");
  const fill     = document.getElementById("angerFill");
  const copy     = document.getElementById("angerCopy");
  const prompt   = document.getElementById("angerPrompt");
  const resetBtn = document.getElementById("angerResetBtn");
  const ticksEl  = document.getElementById("pressureTicks");

  if(!meter || !levelEl || !fill || !copy) return;

  function setCopy(n){
    if(n <= 2) return "Low heat. You might be irritated or keyed up — but you still have a lot of control.";
    if(n <= 4) return "Moderate heat. Something feels unfair, disrespectful, or misunderstood.";
    if(n <= 6) return "Rising heat. Your body is activated — slow down before you decide what to do.";
    if(n <= 8) return "High heat. This is where people say or do things they regret. Delay any action.";
    return "Overheated. Your nervous system is in fight mode. Don't engage — regulate first.";
  }

  function paint(n){
    const pct = Math.round((n/10)*100);
    levelEl.textContent = String(n);
    fill.style.width = pct + "%";
    copy.textContent = setCopy(n);
    if(prompt) prompt.style.display = n >= 7 ? "block" : "none";
  }

  function update(){
    const n = Number(meter.value || 5);
    paint(n);
  }

  function positionTicks(){
    if(!ticksEl) return;
    const min = 1, max = 10;
    const trackW = meter.offsetWidth;
    const thumbR = 10;
    const usable = trackW - thumbR * 2;
    ticksEl.innerHTML = "";
    [1,2,3,4,5,6,7,8,9,10].forEach(val => {
      const frac = (val - min) / (max - min);
      const px = thumbR + frac * usable;
      const span = document.createElement("span");
      span.textContent = String(val);
      span.style.left = px + "px";
      ticksEl.appendChild(span);
    });
  }

  positionTicks();
  const onResize = ()=> positionTicks();
  window.addEventListener("resize", onResize);
  meter.addEventListener("input", update);

  if(resetBtn){
    const onReset = ()=>{
      if(__angerResetTimer) clearInterval(__angerResetTimer);
      let t = 20;
      resetBtn.disabled = true;
      const original = resetBtn.textContent;
      resetBtn.textContent = `Reset: ${t}s`;
      __angerResetTimer = setInterval(()=>{
        t -= 1;
        if(t <= 0){
          clearInterval(__angerResetTimer);
          __angerResetTimer = null;
          resetBtn.disabled = false;
          resetBtn.textContent = "Done. Continue.";
          const n = Math.max(1, Number(meter.value) - 1);
          meter.value = String(n);
          update();
          setTimeout(()=>{ resetBtn.textContent = original; }, 1400);
          return;
        }
        resetBtn.textContent = `Reset: ${t}s`;
      }, 1000);
    };
    resetBtn.addEventListener("click", onReset);
    angerPressureCleanup = ()=>{
      meter.removeEventListener("input", update);
      window.removeEventListener("resize", onResize);
      resetBtn.removeEventListener("click", onReset);
      if(__angerResetTimer){ clearInterval(__angerResetTimer); __angerResetTimer = null; }
      angerPressureCleanup = null;
    };
  } else {
    angerPressureCleanup = ()=>{
      meter.removeEventListener("input", update);
      window.removeEventListener("resize", onResize);
      angerPressureCleanup = null;
    };
  }

  update();
}

// ===== Ongoing Consent Road (Relationship) =====
let ongoingConsentCleanup = null;

function ongoingConsentMarkup(){
  return `
    <div class="ocWrap">
      <div class="repairPanel" id="ocPanel">
        <div class="panelHeader" id="ocPanelHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="ocPanelBody">
          <div class="titleBlock">
            <div class="panelTitle">🛣️ Ongoing Consent Road</div>
            <div class="panelSub">Build the check-in habit, one step at a time</div>
          </div>
          <div class="chev" aria-hidden="true">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <div class="panelBody" id="ocPanelBody">
          <div class="inner" style="padding:0 18px 18px 18px;">

            <div class="ocTopCopy" style="margin-top:4px; border-color:rgba(21,255,200,.16); background:rgba(13,40,50,.60);">
              <p><b>Consent doesn’t carry over.</b> It has to be present throughout an interaction — and revisited over time.</p>
              <p><b>Over a single interaction:</b> check in when things change — pace, intensity, location, or comfort. <b>Over the relationship:</b> what felt okay before might not feel okay today.</p>
              <p>The prevention habit: <b>ask clearly</b>, listen carefully, and stop the moment anything feels uncertain.</p>
            </div>

            <div style="margin: 0 0 10px 0; font-size: 11px; color: rgba(21,255,200,.55); letter-spacing:.4px; text-transform: uppercase; font-weight: 900; text-align:center;">
              ← Scroll the road to explore →
            </div>

            <div class="ocLayout">
              <div class="ocRoadContainer">
                <div class="ocRoadTitle">🛣️ &nbsp;Ongoing Consent Road — Each tap builds the habit</div>
                <div class="ocRoadWrap" id="ocRoadWrap" aria-label="Ongoing consent roadmap">
                <div class="ocRoadInner" id="ocRoadInner">
                  <div class="ocRoad" aria-hidden="true"></div>
                  <div id="ocProgressLine"></div>
                  <div id="ocMileLayer"></div>
                </div>
              </div>
              </div>

              <div class="ocSide">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                  <h2 style="margin:0;">Build the habit</h2>
                  <span id="ocCount" style="font-size:12px; color:rgba(21,255,200,.80); font-weight:800; padding:3px 8px; border-radius:999px; border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.08);">0 / 11</span>
                </div>
                <p>Each tap adds a real check-in phrase to the road. Consent is a <em>repeated practice</em>, not a one-time question.</p>

                <div class="ocControls">
                  <button id="ocAddBtn" class="ocBtn" type="button">➕ Add check-in</button>
                  <button id="ocResetBtn" class="ocBtn ocBtnGhost" type="button">↺ Reset</button>
                </div>

                <div class="ocProgressTrack">
                  <div class="ocProgressFill" id="ocProgressFill"></div>
                </div>

                <div style="margin-top:8px;">
                  <span id="ocTip" style="font-size:12px; color:rgba(209,254,255,.65); font-style:italic;">Tip: check in when things change.</span>
                </div>

                <div id="ocEndNote" class="ocEndNote" style="border-color:rgba(21,255,200,.45); background:rgba(21,255,200,.08);">
                  ✅ <b>Road complete.</b> If clarity ever drops, pause and check in — or stop. Ongoing consent is a <em>pattern</em>, not a moment.
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  `;
}

let _roadListenersCleanup = null;

function initOngoingConsentRoad(){
  // Only clean up road-internal listeners (not the panel toggle stored in ongoingConsentCleanup)
  if(_roadListenersCleanup){ _roadListenersCleanup(); _roadListenersCleanup = null; }

  const PHRASES = [
    { text: "Are you okay?",                          emoji: "\uD83D\uDCAC" },
    { text: "Do you want to?",                        emoji: "\uD83E\uDD1D" },
    { text: "Does this feel good?",                   emoji: "\uD83D\uDC9A" },
    { text: "What do you like?",                      emoji: "\u2728" },
    { text: "Should we stop?",                        emoji: "\u270B" },
    { text: "Show me what feels good.",               emoji: "\uD83D\uDCAC" },
    { text: "I like this \u2014 what do you like?",  emoji: "\uD83D\uDC9A" },
    { text: "You seem nervous. Slow down?",           emoji: "\uD83C\uDF3F" },
    { text: "Let's take our time.",                   emoji: "\u23F8\uFE0F" },
    { text: "I need to stop for a minute.",           emoji: "\u270B" },
    { text: "I'm nervous \u2014 I've never done this.", emoji: "\uD83D\uDCAC" }
  ];

  const roadWrap     = document.getElementById('ocRoadWrap');
  const roadInner    = document.getElementById('ocRoadInner');
  const progressLine = document.getElementById('ocProgressLine');
  const mileLayer    = document.getElementById('ocMileLayer');
  const addBtn       = document.getElementById('ocAddBtn');
  const resetBtn     = document.getElementById('ocResetBtn');
  const countEl      = document.getElementById('ocCount');
  const endNote      = document.getElementById('ocEndNote');
  const tipEl        = document.getElementById('ocTip');
  const progressFill = document.getElementById('ocProgressFill');

  if(!roadWrap || !roadInner || !mileLayer || !addBtn || !resetBtn || !countEl || !endNote) return;

  let idx   = 0;
  let timer = null;

  const STEP    = 160;
  const PADDING = 80;

  const TIPS = [
    "Tip: check in when things change.",
    "Tip: slow down if you're unsure.",
    "Tip: a pause is never the wrong move.",
    "Tip: enthusiasm > silence.",
    "Tip: one question can change everything."
  ];
  let tipIdx = 0;

  function setRoadWidth(){
    // Inner div grows to just past the last placed dot
    // First dot at PADDING, last dot at PADDING + (idx-1)*STEP
    // Add a small tail (PADDING/2) after the last dot
    var lastDotX = idx > 0 ? (PADDING + (idx - 1) * STEP) : PADDING;
    var total = lastDotX + PADDING;
    roadInner.style.minWidth = Math.max(300, total) + "px";
  }

  function updateCount(){
    countEl.textContent = idx + " / " + PHRASES.length + " check-ins";
    if(idx >= PHRASES.length){
      endNote.style.display = "block";
      addBtn.disabled = true;
      if(timer){ clearInterval(timer); timer = null; }
    } else {
      endNote.style.display = "none";
      addBtn.disabled = false;
    }
  }

  function rotateTip(){
    if(!tipEl) return;
    tipIdx = (tipIdx + 1) % TIPS.length;
    tipEl.style.opacity = "0";
    setTimeout(function(){
      tipEl.textContent = TIPS[tipIdx];
      tipEl.style.opacity = "1";
    }, 200);
  }

  function scrollToEnd(){
    var reduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    var target = roadInner.scrollWidth - roadWrap.clientWidth;
    if(target <= roadWrap.scrollLeft) return;
    if(reduce) roadWrap.scrollLeft = target;
    else roadWrap.scrollTo({ left: target, behavior: "smooth" });
  }

  function addOne(){
    if(idx >= PHRASES.length) return;

    var x    = PADDING + idx * STEP;
    var side = (idx % 2 === 0) ? "top" : "bottom";

    var mile = document.createElement("div");
    mile.className = "ocMile";
    mile.style.left = x + "px";

    var pin = document.createElement("div");
    pin.className = "ocPin";
    pin.setAttribute("aria-hidden", "true");

    // Milestone number badge
    var numBadge = document.createElement("div");
    numBadge.className = "ocMileNum";
    numBadge.textContent = (idx + 1);

    var bubble = document.createElement("div");
    bubble.className = "ocBubble " + side;
    var phrase = PHRASES[idx];
    bubble.innerHTML = '<span style="font-size:16px;display:block;margin-bottom:4px;">' + phrase.emoji + "</span>" + phrase.text;

    mile.appendChild(pin);
    mile.appendChild(numBadge);
    mile.appendChild(bubble);
    mileLayer.appendChild(mile);

    requestAnimationFrame(function(){
      requestAnimationFrame(function(){ bubble.classList.add("show"); });
    });

    idx++;
    setRoadWidth();

    if(progressLine){
      progressLine.style.left = PADDING + "px";
      progressLine.style.width = (Math.max(0, idx - 1) * STEP) + "px";
    }

    // Update side progress fill
    if(progressFill){
      progressFill.style.width = Math.round((idx / PHRASES.length) * 100) + "%";
    }

    updateCount();
    rotateTip();
    setTimeout(scrollToEnd, 60);
  }

  function reset(){
    idx = 0;
    mileLayer.innerHTML = "";
    endNote.style.display = "none";
    addBtn.disabled = false;
    if(timer){ clearInterval(timer); timer = null; }
    if(progressLine){ progressLine.style.width = "0px"; progressLine.style.left = PADDING + "px"; }    if(progressFill){ progressFill.style.width = "0%"; }
    setRoadWidth();
    roadWrap.scrollLeft = 0;
    updateCount();
    if(tipEl){
      tipIdx = 0;
      tipEl.style.opacity = "1";
      tipEl.textContent = TIPS[0];
    }
  }

  if(tipEl) tipEl.style.transition = "opacity .2s ease";

  addBtn.addEventListener("click", addOne);
  resetBtn.addEventListener("click", reset);

  setRoadWidth();
  updateCount();

  _roadListenersCleanup = function(){
    if(timer){ clearInterval(timer); timer = null; }
    addBtn.removeEventListener("click", addOne);
    resetBtn.removeEventListener("click", reset);
    _roadListenersCleanup = null;
  };
}

// ===== Grounding (5-4-3-2-1 + breath/body scan) =====
let groundingCleanup = null;
let __groundBreathTimer = null;

function groundingMarkup(){
  return `
    <div class="h1">Grounding (reset your body)</div>
    <div class="p">If you feel activated, it’s okay to pause. Grounding helps pull your attention back into the present moment.</div>

    <div class="note">
      <b>What you’re doing:</b> redirecting attention to your senses + body to reduce panic, fear, or stress.
    </div>

    <details class="expando">
      <summary>
        <div class="expandoMeta">
          <div class="expandoTitle">5-4-3-2-1</div>
          <div class="expandoSub">Orient using your senses</div>
        </div>
        <div class="expandoArrow">▾</div>
      </summary>
      <div class="expandoBody">
        <div id="gtSenses" style="display:grid;gap:10px;"></div>
        <div class="mutedBox" style="margin-top:10px;">
          Tip: keep your answers simple. “Blue chair.” “Cool air.” “My hoodie.” You’re not performing — you’re orienting.
        </div>
      </div>
    </details>

    <details class="expando">
      <summary>
        <div class="expandoMeta">
          <div class="expandoTitle">Breathing</div>
          <div class="expandoSub">5 slow breaths</div>
        </div>
        <div class="expandoArrow">▾</div>
      </summary>
      <div class="expandoBody">
        <div id="gtBreatheWrap">${breatheWidget()}</div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:10px;">
          <button class="btn btnSmall btnPrimary" type="button" id="gtBreathStart">Start 5 breaths</button>
          <button class="btn btnSmall" type="button" id="gtBreathReset">Reset</button>
          <span id="gtBreathCount" style="font-size:12px;color:rgba(209,254,255,.75);font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid rgba(209,254,255,.16);background:rgba(0,0,0,.14);">0 / 5</span>
        </div>

        <div id="gtBreathHint" style="text-align:center;margin-top:10px;font-size:12px;color:var(--muted);line-height:1.35;">
          Inhale as the circle grows. Exhale as it shrinks.
        </div>
      </div>
    </details>

    <details class="expando">
      <summary>
        <div class="expandoMeta">
          <div class="expandoTitle">Body scan</div>
          <div class="expandoSub">30–60 seconds</div>
        </div>
        <div class="expandoArrow">▾</div>
      </summary>
      <div class="expandoBody">
        <div class="p" style="margin:0 0 10px;color:rgba(209,254,255,.88);">
          Close your eyes (if safe). Scan head → shoulders → chest → stomach → hands → legs → feet.
          Notice where there’s tension. See if you can soften one spot by 5%.
        </div>

        <div id="gtBody" style="display:grid;gap:8px;margin-top:10px;"></div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
          <button class="btn btnSmall" type="button" id="gtBodyDone">Mark scan as done</button>
          <span id="gtBodyStatus" style="font-size:12px;color:rgba(209,254,255,.75);font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid rgba(209,254,255,.16);background:rgba(0,0,0,.14);">Not started</span>
        </div>
      </div>
    </details>

    <details class="expando">
      <summary>
        <div class="expandoMeta">
          <div class="expandoTitle">Positive repetition</div>
          <div class="expandoSub">Repeat 5 times</div>
        </div>
        <div class="expandoArrow">▾</div>
      </summary>
      <div class="expandoBody">
        <div class="p" style="margin:0 0 10px;color:rgba(209,254,255,.88);">
          Choose a supportive phrase — or write your own — and repeat it quietly five times.
        </div>

        <div style="display:grid;gap:10px;">
          <select id="gtAffirmSelect" class="rbTextarea" style="min-height:auto;resize:none;">
            <option value="I deserve to be loved and happy.">I deserve to be loved and happy.</option>
            <option value="I am safe in this moment.">I am safe in this moment.</option>
            <option value="I can slow down and choose my next step.">I can slow down and choose my next step.</option>
            <option value="I can pause without making it worse.">I can pause without making it worse.</option>
            <option value="I can learn and do better next time.">I can learn and do better next time.</option>
          </select>

          <input id="gtAffirmCustom" class="rbTextarea" style="min-height:auto;resize:none;" placeholder="Or write your own phrase…" />

          <div id="gtAffirmText" style="text-align:center;font-size:16px;font-weight:950;color:rgba(209,254,255,.95);padding:10px 12px;border-radius:14px;border:1px solid rgba(209,254,255,.14);background:rgba(255,255,255,.04);">
            “I deserve to be loved and happy.”
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;">
            <button class="btn btnSmall btnPrimary" type="button" id="gtAffirmTap">Tap to Repeat</button>
            <button class="btn btnSmall" type="button" id="gtAffirmReset">Reset</button>
            <span id="gtAffirmCount" style="font-size:12px;color:rgba(209,254,255,.75);font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid rgba(209,254,255,.16);background:rgba(0,0,0,.14);">0 / 5</span>
          </div>

          <div id="gtAffirmHint" style="text-align:center;margin-top:4px;font-size:12px;color:var(--muted);line-height:1.35;">
            Tap each time you repeat it.
          </div>
        </div>
      </div>
    </details>
  `;
}

function initGrounding(){
  if(groundingCleanup) groundingCleanup();
  if(__groundBreathTimer){ clearInterval(__groundBreathTimer); __groundBreathTimer = null; }

  const sensesMount = document.getElementById("gtSenses");
  const bodyMount   = document.getElementById("gtBody");

  const breathStart = document.getElementById("gtBreathStart");
  const breathReset = document.getElementById("gtBreathReset");
  const breathCount = document.getElementById("gtBreathCount");
  const breathHint  = document.getElementById("gtBreathHint");
  const breatheWrap = document.querySelector("#gtBreatheWrap .breatheWrap");
  // Start paused — circle only animates after user presses Start
  if(breatheWrap) breatheWrap.classList.add("paused");

  const affirmSelect= document.getElementById("gtAffirmSelect");
  const affirmCustom= document.getElementById("gtAffirmCustom");
  const affirmTap   = document.getElementById("gtAffirmTap");
  const affirmReset = document.getElementById("gtAffirmReset");
  const affirmCount = document.getElementById("gtAffirmCount");
  const affirmText  = document.getElementById("gtAffirmText");

  const bodyDone    = document.getElementById("gtBodyDone");
  const bodyStatus  = document.getElementById("gtBodyStatus");

  if(!sensesMount) return;

  const STEPS = [
    { key:"see",   label:"Notice 5 things you can see",   n:5, emoji:"👀" },
    { key:"touch", label:"Notice 4 things you can touch", n:4, emoji:"✋" },
    { key:"hear",  label:"Notice 3 things you can hear",  n:3, emoji:"👂" },
    { key:"smell", label:"Notice 2 things you can smell", n:2, emoji:"👃" },
    { key:"taste", label:"Notice 1 thing you can taste",  n:1, emoji:"👅" }
  ];

  const stateLocal = {
    senses: { see:[], touch:[], hear:[], smell:[], taste:[] },
    breaths: 0,
    affirm: 0,
    bodyDone: false
  };

  function esc(s){ return String(s||"").replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  function senseCard(step){
    const items = stateLocal.senses[step.key];
    const done = items.length >= step.n;
    return `
      <div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.14);border-radius:16px;padding:14px;">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;">
          <div style="min-width:0;">
            <div style="font-weight:950;font-size:14px;letter-spacing:.1px;">${step.emoji} ${step.label}</div>
            <div style="margin-top:4px;font-size:12px;color:var(--muted);line-height:1.35;">${items.length} / ${step.n}</div>
          </div>
          <span style="font-size:12px;font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid rgba(209,254,255,.16);background:rgba(0,0,0,.14);color:${done ? "rgba(21,255,200,.95)" : "rgba(209,254,255,.75)"};">
            ${done ? "Done" : "In progress"}
          </span>
        </div>

        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
          <input id="gt_${step.key}_in" class="rbTextarea" style="min-height:auto;resize:none;flex:1;" placeholder="Type one thing…" />
          <button class="btn btnSmall" type="button" data-gt-add="${step.key}">Add</button>
          <button class="btn btnSmall" type="button" data-gt-clear="${step.key}">Clear</button>
        </div>

        <div style="margin-top:10px;display:grid;gap:6px;">
          ${items.map((t,i)=>`
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid rgba(209,254,255,.10);background:rgba(0,0,0,.12);padding:8px 10px;border-radius:12px;">
              <div style="font-size:13px;color:rgba(209,254,255,.92);line-height:1.3;">${esc(t)}</div>
              <button class="btn btnSmall" type="button" data-gt-del="${step.key}" data-gt-idx="${i}" aria-label="Remove">✕</button>
            </div>
          `).join("")}
          ${items.length===0 ? `<div style="font-size:12px;color:rgba(209,254,255,.55);padding:6px 2px;">Nothing added yet.</div>` : ``}
        </div>
      </div>
    `;
  }

  function renderSenses(){
    sensesMount.innerHTML = STEPS.map(s=>senseCard(s)).join("");
  }

  function setAffirmText(){
    const chosen = (affirmCustom && affirmCustom.value.trim()) ? affirmCustom.value.trim() : (affirmSelect ? affirmSelect.value : "");
    if(affirmText) affirmText.textContent = `“${chosen || "…" }”`;
    return chosen;
  }

  function updateBreathUI(){
    if(breathCount) breathCount.textContent = `${stateLocal.breaths} / 5`;
    if(breathHint){
      breathHint.textContent = stateLocal.breaths >= 5
        ? "Done. Notice any small change in your body."
        : "Inhale as the circle grows. Exhale as it shrinks.";
    }
    if(breathStart) breathStart.disabled = stateLocal.breaths >= 5;
  }

  function updateAffirmUI(){
    if(affirmCount) affirmCount.textContent = `${stateLocal.affirm} / 5`;
    if(affirmTap) affirmTap.disabled = stateLocal.affirm >= 5;
  }

  function updateBodyUI(){
    if(!bodyStatus) return;
    bodyStatus.textContent = stateLocal.bodyDone ? "Done" : "Not started";
    bodyStatus.style.color = stateLocal.bodyDone ? "rgba(21,255,200,.95)" : "rgba(209,254,255,.75)";
  }

  function renderBody(){
    if(!bodyMount) return;
    const spots = ["Jaw", "Shoulders", "Chest", "Stomach", "Hands", "Legs", "Feet"];
    bodyMount.innerHTML = spots.map(s=>`
      <label style="display:flex;align-items:center;gap:10px;border:1px solid rgba(209,254,255,.10);background:rgba(0,0,0,.12);padding:10px 12px;border-radius:12px;">
        <input type="checkbox" data-gt-body="${esc(s)}" style="accent-color: var(--sb-mint);" />
        <span style="font-size:13px;color:rgba(209,254,255,.92);font-weight:800;">${esc(s)}</span>
        <span style="font-size:12px;color:var(--muted);margin-left:auto;">soften 5%</span>
      </label>
    `).join("");
  }

  // Initial render
  renderSenses();
  renderBody();
  setAffirmText();
  updateBreathUI();
  updateAffirmUI();
  updateBodyUI();

  // Handlers
  const onSensesClick = (e)=>{
    const addKey = e.target.closest("[data-gt-add]")?.getAttribute("data-gt-add");
    const clearKey = e.target.closest("[data-gt-clear]")?.getAttribute("data-gt-clear");
    const delKey = e.target.closest("[data-gt-del]")?.getAttribute("data-gt-del");
    if(addKey){
      const input = document.getElementById("gt_"+addKey+"_in");
      const val = input?.value?.trim();
      if(!val) return;
      stateLocal.senses[addKey].push(val);
      input.value = "";
      renderSenses();
      return;
    }
    if(clearKey){
      stateLocal.senses[clearKey] = [];
      renderSenses();
      return;
    }
    if(delKey){
      const idx = Number(e.target.closest("[data-gt-idx]")?.getAttribute("data-gt-idx"));
      if(Number.isFinite(idx)) stateLocal.senses[delKey].splice(idx,1);
      renderSenses();
      return;
    }
  };

  sensesMount.addEventListener("click", onSensesClick);

  const onAffirmChange = ()=>{
    setAffirmText();
  };
  if(affirmSelect) affirmSelect.addEventListener("change", onAffirmChange);
  if(affirmCustom) affirmCustom.addEventListener("input", onAffirmChange);

  const onAffirmTap = ()=>{
    setAffirmText();
    stateLocal.affirm = Math.min(5, stateLocal.affirm + 1);
    updateAffirmUI();
  };
  const onAffirmReset = ()=>{
    stateLocal.affirm = 0;
    updateAffirmUI();
  };
  if(affirmTap) affirmTap.addEventListener("click", onAffirmTap);
  if(affirmReset) affirmReset.addEventListener("click", onAffirmReset);

  const onBreathStart = ()=>{
    if(__groundBreathTimer) return;
    // Each cycle = ~10s (4s in, 6s out), but we count breaths simply on a timer.
    let remaining = 5 - stateLocal.breaths;
    if(remaining <= 0) return;
    // Start the animation
    if(breatheWrap) breatheWrap.classList.remove("paused");
    breathStart.disabled = true;
    breathReset.disabled = true;

    let tick = 0;
    __groundBreathTimer = setInterval(()=>{
      tick += 1;
      // count a "breath" every 10 seconds
      if(tick % 10 === 0){
        stateLocal.breaths = Math.min(5, stateLocal.breaths + 1);
        updateBreathUI();
        remaining = 5 - stateLocal.breaths;
        if(remaining <= 0){
          clearInterval(__groundBreathTimer);
          __groundBreathTimer = null;
          breathReset.disabled = false;
          if(breatheWrap) breatheWrap.classList.add("paused");
        }
      }
    }, 1000);
  };

  const onBreathReset = ()=>{
    if(__groundBreathTimer){ clearInterval(__groundBreathTimer); __groundBreathTimer = null; }
    stateLocal.breaths = 0;
    if(breathStart) breathStart.disabled = false;
    if(breathReset) breathReset.disabled = false;
    // Pause the animation again
    if(breatheWrap) breatheWrap.classList.add("paused");
    updateBreathUI();
  };

  if(breathStart) breathStart.addEventListener("click", onBreathStart);
  if(breathReset) breathReset.addEventListener("click", onBreathReset);

  const onBodyDone = ()=>{
    stateLocal.bodyDone = true;
    updateBodyUI();
  };
  if(bodyDone) bodyDone.addEventListener("click", onBodyDone);

  groundingCleanup = ()=>{
    sensesMount.removeEventListener("click", onSensesClick);
    if(affirmSelect) affirmSelect.removeEventListener("change", onAffirmChange);
    if(affirmCustom) affirmCustom.removeEventListener("input", onAffirmChange);
    if(affirmTap) affirmTap.removeEventListener("click", onAffirmTap);
    if(affirmReset) affirmReset.removeEventListener("click", onAffirmReset);
    if(breathStart) breathStart.removeEventListener("click", onBreathStart);
    if(breathReset) breathReset.removeEventListener("click", onBreathReset);
    if(bodyDone) bodyDone.removeEventListener("click", onBodyDone);
    if(__groundBreathTimer){ clearInterval(__groundBreathTimer); __groundBreathTimer = null; }
    groundingCleanup = null;
  };
}


function render(){
  // Simple progress indicator map
  const progressMap = {
    landing: 0,
    bringsYouHere: 1,
    entryDeescalate: 2,
    topScenario: 2,
    A_freeze_whatItMeans: 3,
    A_freeze_mostCommon: 3,
    A_freeze_impact: 4,
    B_drinking_basics: 3,
    B_drinking_rule: 4,
    B_drinking_scenario: 3,
    B_both_drunk: 3,
    B_they_drunk: 3,
    B_i_drunk: 3,
    B_drugs: 3,
    B_spiked: 3,
    B_bac_awareness: 3,
    B_signal_check: 4,
    B_myths: 4,
    B_safety_plan: 4,
    C_pulledAway_signal: 3,
    C_pulledAway_script: 4,
    D_pressure: 3,
    E_age_power: 3,
    F_digital: 3,
    F_digital_overview: 3,
    F_shared: 3,
    F_saved: 3,
    F_pressured: 3,
    F_posted: 3,
    F_blackmail: 3,
    G_coercion: 3,
    G_verbal_no: 3,
    G_stopped_restarted: 3,
    G_persuaded: 3,
    G_nonverbal: 3,
    H_relationship: 3,
    H_relationship_ongoing: 3,
    I_not_sure_wanted: 3,
    J_upset_after: 3,
    K_not_sure_what: 3,
    emotion: 4,
    emotionMessage: 4,
    nextSteps: 5,
    accused_landing: 1,
    accused_twosides: 2,
    accused_grayzone: 3,
    accused_signals: 3,
    accused_fork: 4,
    accused_accountability: 4,
    accused_stilldenying: 4,
    accused_unsure: 4,
    accused_resources: 5,
    accused_commitment: 5,
    learn: 6,
    prevent: 6,
    repair: 6,
    support: 6,
    beliefShift: 6,
    closing: 7,
    grounding: 4,
    digitalSafety: 6,
    maleYouth: 6,
    healthyRelationships: 6
  };
  const totalSteps = 7;
  function progressBar(step){
    if(!step) return '';
    const percent = Math.round((step/totalSteps)*100);
    return `<div style="margin-bottom:12px;">
      <div style="font-size:12px;color:var(--muted);margin-bottom:4px;">Step ${step} of ${totalSteps}</div>
      <div style="height:6px;background:rgba(255,255,255,.08);border-radius:6px;overflow:hidden;">
        <div style="height:100%;width:${percent}%;background:var(--accent);transition:width .3s ease;"></div>
      </div>
    </div>`;
  }
  const id = state.screenId;

  // Cleanup: stop ongoing-consent timers/listeners when leaving that screen
  if(id !== "H_relationship" && id !== "H_relationship_ongoing"){
    if(_roadListenersCleanup){ _roadListenersCleanup(); }
    if(ongoingConsentCleanup){ ongoingConsentCleanup(); }
  }

  // Cleanup: stop grounding timers/listeners when leaving grounding screen
  if(id !== "grounding"){
    if(groundingCleanup){ groundingCleanup(); }
  }

  // Make background subtly lighten as users move forward (spiral → calm)
  const stepNow = progressMap[id] || 0;
  const t = Math.max(0, Math.min(1, stepNow / totalSteps));
  // Interpolate from deep background to lighter teal as progress increases
  // Start: #1D414E (29,65,78)  → End: #13848F (19,132,143)
  const r = Math.round(29 + (19-29)*t);
  const g = Math.round(65 + (132-65)*t);
  const b = Math.round(78 + (143-78)*t);
  const base = `rgb(${r},${g},${b})`;
  // Keep your existing SafeBAE gradient vibe, but brighten the base over time
  const glow1 = 0.18 + 0.10*t; // mint glow increases
  const glow2 = 0.22 + 0.06*t; // teal glow increases
  const glow3 = 0.10 + 0.06*t; // light glow increases
  document.body.style.background = `
    radial-gradient(1200px 800px at 20% 10%, rgba(21,255,200,${glow1}), transparent 55%),
    radial-gradient(1000px 700px at 90% 20%, rgba(19,132,143,${glow2}), transparent 60%),
    radial-gradient(900px 600px at 40% 100%, rgba(209,254,255,${glow3}), transparent 55%),
    ${base}
  `;

  if(id==="landing"){
    const spiral = `
      <div style="display:flex; align-items:flex-start; gap:20px; margin-bottom:18px;">
        <div class="h1" style="opacity:.85; line-height:1.3; flex:1;">
          <div style="position:relative;">
            <div style="font-size:20px; filter:blur(0px); opacity:.85;">Did I harm someone?</div>
            <div style="font-size:20px; transform:rotate(-2deg); opacity:.8;">Was that consent?</div>
            <div style="font-size:20px; transform:rotate(1.5deg); opacity:.75;">Did I cross a boundary?</div>
            <div style="font-size:20px; transform:rotate(-1deg); opacity:.7;">Am I a bad person?</div>
            <div style="font-size:20px; transform:rotate(2deg); opacity:.65;">Am I a rapist?</div>
          </div>
        </div>
        <div style="width:120px; opacity:.6;">
          <svg viewBox="0 0 160 160" width="100%" height="100%" fill="none" stroke="#15FFC8" stroke-linecap="round" stroke-linejoin="round" opacity="0.85">
            <!-- Dense chaotic scribble cluster -->
            <g stroke-width="1.6">
              <path d="M80 20 C140 10,150 70,100 90 C50 110,10 60,60 40 C110 20,150 120,80 130 C10 140,20 20,120 50 C150 70,120 160,60 150 C0 140,40 10,140 60" />
              <path d="M70 30 C130 50,120 110,70 90 C20 70,90 20,130 80 C170 140,40 150,50 80 C60 10,140 30,110 120" />
              <path d="M60 40 C120 20,160 80,90 100 C20 120,10 60,80 50 C150 40,130 150,50 130" />
              <path d="M90 35 C140 60,100 130,60 95 C20 60,110 30,140 100 C160 150,30 120,70 60" />
              <path d="M50 50 C120 40,150 90,100 110 C50 130,20 80,80 60 C140 40,120 150,60 140" />
            </g>
            <g stroke-width="1.2" opacity="0.7">
              <path d="M85 25 C120 30,135 75,95 95 C55 115,30 70,70 55 C110 40,130 125,75 120" />
              <path d="M75 45 C125 55,115 115,70 100 C25 85,95 35,125 105" />
              <path d="M65 60 C110 65,100 120,60 110 C20 100,85 50,110 115" />
            </g>
          </svg>
        </div>
      </div>
      <div class="p"></div>
      </div>
    `;

    const mainCard = card(
      "Not sure if you crossed a line?",
      [
        "This is a <b>private</b>, non-punitive reflection tool. You can leave anytime.",
        "We're not here to judge you. We're here to help you slow down, learn, and choose safer next steps."
      ],
      "<b>Privacy:</b> This prototype collects no names, no account info, and stores nothing.",
      
`
      <div style="display:flex; flex-direction:column; gap:10px; margin-top:14px;">
        <button class="btn btnPrimary" data-action="start" style="padding:16px 18px; font-size:16px; font-weight:900; border-radius:16px; width:100%;">
          Start
        </button>
        <button class="btn btnSmall" data-action="whyBtn" style="border-radius:14px; width:100%; padding:12px 14px; font-weight:850;">
          Why this exists
        </button>
        <button class="btn btnSmall" data-action="pathMenu" style="border-radius:14px; width:100%; padding:12px 14px; font-weight:850;">
          Jump to pathways (demo only)
        </button>
      </div>
    `

    );

    screen.innerHTML = progressBar(progressMap[id]) + spiral + mainCard;
    return;
  }

  if(id==="whyThisExists"){
    screen.innerHTML = backBtn() + card(
      "Why this exists",
      [
        "This tool exists because many people have questions about moments that didn’t feel clear — and want to do better, but aren’t sure where to start.",
        "Instead of spiraling alone or searching random forums, you can slow down here and think it through step by step.",
        "This space is built for reflection, accountability, and growth — not judgment."
      ],
      null,
      grid(btn("Continue","toBrings","btn btnPrimary"))
    );
    actions.toBrings=()=>go("bringsYouHere");
    return;
  }

  if(id==="bringsYouHere"){
    screen.innerHTML = backBtn() + card(
      "What brings you here?",
      ["It’s okay to not have a clear answer yet."],
      null,
      grid(
        btn("I’m worried I might have crossed a boundary","e1") +
        btn("I think I accidentally sexually assaulted someone","e7") +
        btn("The person I was with is mad and I’m worried I did something wrong","e2") +
        btn("I’m not sure if what happened was okay","e3") +
        btn("Someone said I made them uncomfortable","e4") +
        btn("I\'m being accused of something I didn\'t do","e8") +
        btn("I don’t know how to explain it","e5") +
        btn("I just want to understand consent better","e6") +
        btn("I think my friend did something — and I don't know what to do","e9")
      )
    );
    actions.e1=()=>{state.entry="crossed_boundary"; go("topScenario");};
    actions.e2=()=>{state.entry="they_mad"; go("topScenario");};
    actions.e3=()=>{state.entry="not_sure_ok"; go("topScenario");};
    actions.e4=()=>{state.entry="made_uncomfortable"; go("topScenario");};
    actions.e5=()=>{state.entry="cant_explain"; go("topScenario");};
    actions.e6=()=>{state.entry="learn_consent"; go("consentEdu");};
    actions.e7=()=>{state.entry="accidental_assault"; go("entryDeescalate");};
    actions.e8=()=>{state.entry="accused"; go("accused_landing");};
    actions.e9=()=>{state.entry="friend_pathway"; go("friend_landing");};
    return;
  }


  // ===== FRIEND PATHWAY =====

  if(id==="friend_landing"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="fpHero">
          <div class="fpHeroIcon">👥</div>
          <div class="fpHeroTitle">I think my friend did something</div>
          <div class="fpHeroSub">You're here because you're worried about something a friend did — and you care enough to not just ignore it. That matters.</div>
        </div>
        <div class="note" style="margin:0 0 16px;">
          This is a genuinely hard position. You're not the one who caused harm, and you're not the person affected.
          But you're connected to both — and what you do next can make a real difference.
        </div>
        <div class="fpStepHead">What's your situation right now?</div>
        <div class="fpSituationGrid">
          <button class="fpSitBtn" data-action="fp_saw_it">
            <span class="fpSitIcon">👁️</span>
            <span class="fpSitText">
              I witnessed something happen
              <span class="fpSitSub">You saw it in person or online</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_told">
            <span class="fpSitIcon">💬</span>
            <span class="fpSitText">
              Someone told me about it
              <span class="fpSitSub">The person affected told you, or someone else did</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_heard">
            <span class="fpSitIcon">📣</span>
            <span class="fpSitText">
              I heard about it secondhand
              <span class="fpSitSub">Rumour, group chat, or someone mentioned it</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_my_friend_told">
            <span class="fpSitIcon">🙋</span>
            <span class="fpSitText">
              My friend told me they did it
              <span class="fpSitSub">They came to you themselves</span>
            </span>
          </button>
        </div>
        <div class="grid" style="margin-top:4px;">
          <button class="btn" data-action="goBack">← Back</button>
        </div>
      </div>
    `;
    actions.fp_saw_it = ()=>go("fp_what_type");
    actions.fp_told = ()=>go("fp_what_type");
    actions.fp_heard = ()=>go("fp_secondhand");
    actions.fp_my_friend_told = ()=>go("fp_friend_told");
    return;
  }

  if(id==="fp_secondhand"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Secondhand info is complicated.</div>
        <div class="p">Before you act, it's worth being honest about what you actually know versus what you've heard.</div>
        <div class="fpSignalList">
          <div class="fpSignal">
            <span class="fpSignalIcon">⚠️</span>
            <span>Rumours and group chats can distort details — sometimes dramatically. The "story" may be exaggerated, misunderstood, or missing important context.</span>
          </div>
          <div class="fpSignal">
            <span class="fpSignalIcon">🧠</span>
            <span>That said: where there's smoke, there's often fire. A pattern of rumours about the same person and similar behaviour is worth taking seriously.</span>
          </div>
          <div class="fpSignal">
            <span class="fpSignalIcon">🚫</span>
            <span>Don't confront your friend based on secondhand info alone — it can backfire badly and may harm the person who was actually affected.</span>
          </div>
          <div class="fpSignal">
            <span class="fpSignalIcon">✅</span>
            <span>What you CAN do: stay alert, avoid enabling behaviour going forward, and be a safe person for the affected individual to talk to if they choose.</span>
          </div>
        </div>
        <div class="fpBoundaryBox">
          <h4>The most useful question to ask yourself:</h4>
          "Does what I've heard fit a pattern I've already noticed in how my friend treats people?" If yes — that's information worth sitting with.
        </div>
        <div class="grid" style="margin-top:4px;">
          <button class="btn btnPrimary" data-action="fp_what_type">Keep going — this still applies to me</button>
          <button class="btn" data-action="fp_support_affected">I want to support the person who was affected</button>
          <button class="btn" data-action="goBack">← Back</button>
        </div>
      </div>
    `;
    actions.fp_what_type = ()=>go("fp_what_type");
    actions.fp_support_affected = ()=>go("fp_support_affected");
    return;
  }

  if(id==="fp_friend_told"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Your friend came to you.</div>
        <div class="p">That took something. They're likely a mix of relieved, scared, and looking to you to tell them it's okay. Here's the thing: how you respond right now will shape what they do next.</div>

        <div class="note" style="margin:12px 0 16px;">
          Your job is not to be their lawyer, their judge, or their hype person.
          Your job is to be honest with them — and stay connected enough to be part of their accountability.
        </div>

        <div class="fpStepHead">What to do in that first conversation</div>
        <div class="fpConvoCards" id="fpFriendToldCards">
          <div class="fpConvoCard">
            <div class="fpConvoCardHead" data-fc="0">
              <span>Don't minimise it immediately</span>
              <span class="fpConvoCardTag fpTagAvoid">Avoid</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              "I'm sure it wasn't that bad" or "she's probably overreacting" are the first things people say when they're trying to protect a friend. But they shut down accountability before it starts.
              If your friend is telling you, something happened. Start from that — not from damage control.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead" data-fc="1">
              <span>Ask, don't tell</span>
              <span class="fpConvoCardTag fpTagSay">Try this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              "What happened from your side?" → Let them talk. Then: "What do you think the other person experienced?"
              That second question is the one that opens the accountability door. Most people haven't asked it of themselves yet.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead" data-fc="2">
              <span>Name what you're hearing</span>
              <span class="fpConvoCardTag fpTagSay">Try this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              "It sounds like they might not have been fully okay with it." You don't have to use big labels. Just reflect back what you're genuinely hearing — calmly and without drama.
              This is often the first time someone hears it said clearly, and it lands differently coming from a friend than from a stranger.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead" data-fc="3">
              <span>Don't promise to keep it secret</span>
              <span class="fpConvoCardTag fpTagAvoid">Avoid</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              If they ask you to swear secrecy before they've told you what happened — pause. You can say: "I care about you and I want to hear what's going on, but I can't promise to keep something secret if someone was seriously hurt."
              That's honest. It may feel hard. It's the right thing.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead" data-fc="4">
              <span>Point them toward accountability, not punishment</span>
              <span class="fpConvoCardTag fpTagBoth">Important</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              Your friend needs to know there's a path forward that isn't about being destroyed — but it does require taking responsibility.
              You can share this tool with them. You can offer to sit with them while they work through it. Being a friend through accountability isn't about choosing between them and doing the right thing. It's both.
            </div>
          </div>
        </div>

        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="fp_enabling">What does enabling look like — and how do I avoid it?</button>
          <button class="btn" data-action="fp_support_affected">What about supporting the person who was affected?</button>
          <button class="btn" data-action="nextSteps">Finish — go to next steps</button>
        </div>
      </div>
    `;
    setTimeout(function(){
      document.querySelectorAll('#fpFriendToldCards .fpConvoCardHead').forEach(function(h){
        h.addEventListener('click', function(){
          const card = h.closest('.fpConvoCard');
          card.classList.toggle('open');
        });
      });
    }, 0);
    actions.fp_enabling = ()=>go("fp_enabling");
    actions.fp_support_affected = ()=>go("fp_support_affected");
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }

  if(id==="fp_what_type"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">What kind of thing happened?</div>
        <div class="p">You don't need to know all the details. Pick what feels closest to what you understand occurred.</div>
        <div class="fpSituationGrid">
          <button class="fpSitBtn" data-action="fp_physical">
            <span class="fpSitIcon">🛑</span>
            <span class="fpSitText">
              Physical — sexual contact that may not have been consensual
              <span class="fpSitSub">Touching, sexual activity, assault</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_pressure">
            <span class="fpSitIcon">⬇️</span>
            <span class="fpSitText">
              Pressure or coercion
              <span class="fpSitSub">Convincing, guilting, not stopping when asked</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_digital">
            <span class="fpSitIcon">📱</span>
            <span class="fpSitText">
              Digital — images, messages, or online behaviour
              <span class="fpSitSub">Sharing photos, harassment, unwanted content</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_power">
            <span class="fpSitIcon">⚖️</span>
            <span class="fpSitText">
              Power dynamic — using status, age, or position
              <span class="fpSitSub">Popularity, financial, emotional, or housing leverage</span>
            </span>
          </button>
          <button class="fpSitBtn" data-action="fp_not_sure_type">
            <span class="fpSitIcon">❓</span>
            <span class="fpSitText">
              Not sure — something felt wrong but I can't name it
              <span class="fpSitSub">Trust what you sensed</span>
            </span>
          </button>
        </div>
        <div class="grid" style="margin-top:4px;">
          <button class="btn" data-action="goBack">← Back</button>
        </div>
      </div>
    `;
    actions.fp_physical = ()=>go("fp_talk_to_friend");
    actions.fp_pressure = ()=>go("fp_talk_to_friend");
    actions.fp_digital = ()=>go("fp_digital_harm");
    actions.fp_power = ()=>go("fp_talk_to_friend");
    actions.fp_not_sure_type = ()=>go("fp_trust_instinct");
    return;
  }

  if(id==="fp_trust_instinct"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Something felt wrong. Trust that.</div>
        <div class="p">You don't need a label or a perfect description to act on what you noticed. The fact that something registered as wrong is itself meaningful information.</div>
        <div class="fpSignalList">
          <div class="fpSignal"><span class="fpSignalIcon">🔍</span><span>You may have noticed a power imbalance, a look on someone's face, a comment that landed badly, or a situation that escalated faster than felt right.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">🧠</span><span>Bystanders often sense something is off before anyone articulates it. That instinct has value — take it seriously.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">💬</span><span>You don't need a complete picture to check in with the person affected, to gently raise something with your friend, or to stay more alert going forward.</span></div>
        </div>
        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="fp_talk_to_friend">How do I talk to my friend about what I noticed?</button>
          <button class="btn" data-action="fp_support_affected">How do I check in with the person who may have been affected?</button>
          <button class="btn" data-action="nextSteps">Go to next steps</button>
        </div>
      </div>
    `;
    actions.fp_talk_to_friend = ()=>go("fp_talk_to_friend");
    actions.fp_support_affected = ()=>go("fp_support_affected");
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }

  if(id==="fp_digital_harm"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">📱 Digital harm is real harm.</div>
        <div class="p">If your friend shared, saved, or distributed intimate content without consent — or harassed someone online — the person affected has experienced a real violation, even if nothing physical happened.</div>
        <div class="fpBoundaryBox">
          <h4>What makes digital harm serious:</h4>
          Unlike a physical incident, images and messages can spread indefinitely. The affected person loses control permanently. The harm compounds every time content is viewed or shared. This is also illegal in most jurisdictions under non-consensual intimate image laws.
        </div>
        <div class="fpSignalList">
          <div class="fpSignal"><span class="fpSignalIcon">🛑</span><span>If images or content still exist on your friend's device or accounts — they need to delete them. Not as an option. As an immediate obligation.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">🚫</span><span>Do not share, view, or engage with content you've seen. Don't encourage others to find it.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">⚖️</span><span>Depending on what happened and the ages involved, criminal law may apply. Your friend needs to understand this is a legal matter, not just a personal one.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">💬</span><span>The affected person may not know content exists. That's a conversation that needs to happen through a trusted adult or counsellor — carefully, with the person's wellbeing at the centre.</span></div>
        </div>
        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="fp_talk_to_friend">How do I talk to my friend about this?</button>
          <button class="btn" data-action="fp_support_affected">Supporting the person who was affected</button>
          <button class="btn" data-action="nextSteps">Go to next steps & resources</button>
        </div>
      </div>
    `;
    actions.fp_talk_to_friend = ()=>go("fp_talk_to_friend");
    actions.fp_support_affected = ()=>go("fp_support_affected");
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }

  if(id==="fp_talk_to_friend"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Talking to your friend about it</div>
        <div class="p">This might be one of the hardest conversations you have — and one of the most important ones. Here's how to approach it without it blowing up or shutting down.</div>

        <div class="fpStepHead">Before you say anything</div>
        <div class="fpSignalList" style="margin-bottom:16px;">
          <div class="fpSignal"><span class="fpSignalIcon">🧘</span><span>Don't have this conversation when either of you is drunk, in a group, or when you're angry. Private, calm, and sober is the only way this works.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">🎯</span><span>Know what you're trying to do: not punish them, not forgive them, not settle the question. You're trying to get them to look at what happened clearly.</span></div>
          <div class="fpSignal"><span class="fpSignalIcon">🛡️</span><span>You can be on their side as a person while not being on their side about this specific behaviour. Those aren't the same thing.</span></div>
        </div>

        <div class="fpStepHead">What to say — and what to avoid</div>
        <div class="fpConvoCards" id="fpTalkCards">
          <div class="fpConvoCard">
            <div class="fpConvoCardHead">
              <span>"I need to talk to you about what happened with [person]."</span>
              <span class="fpConvoCardTag fpTagSay">Try this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              Start direct. Don't build up with small talk — it makes the moment awkward and signals that you're nervous about saying it. Say it plainly. You're not accusing them of being a monster. You're raising something that matters.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead">
              <span>"I'm not here to judge you — I want to understand what happened."</span>
              <span class="fpConvoCardTag fpTagSay">Try this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              This framing keeps them from going defensive immediately. Most people shut down when they feel attacked. Curiosity opens more than accusation. Ask them to walk you through it from their side — and genuinely listen.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead">
              <span>"Have you thought about how [person] experienced that?"</span>
              <span class="fpConvoCardTag fpTagSay">Try this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              This is the pivot question. Most people in this situation have only thought about their own experience, intentions, and feelings. This question asks them to step into the other person's shoes — and it often lands like a small earthquake when asked by someone they trust.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead">
              <span>"She was into it / She didn't say no / Nothing happened"</span>
              <span class="fpConvoCardTag fpTagAvoid">Don't accept this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              These are deflections, not explanations. You don't have to argue with them — just don't let it close the conversation.
              Try: "Maybe — but I still want you to think about how they experienced it, not just how you did."
              You're not demanding a confession. You're asking for reflection.
            </div>
          </div>
          <div class="fpConvoCard">
            <div class="fpConvoCardHead">
              <span>"I think you should talk to someone about this."</span>
              <span class="fpConvoCardTag fpTagBoth">When to say this</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpConvoBody">
              If what you heard was serious — if real harm occurred — the conversation with you is a starting point, not a finish line. Point them toward a counsellor, a trusted adult, or this tool.
              You can say: "I care about you too much to pretend this doesn't need more than just a talk between us."
            </div>
          </div>
        </div>

        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="fp_enabling">What if I'm enabling instead of helping?</button>
          <button class="btn" data-action="fp_support_affected">I also want to support the person who was affected</button>
          <button class="btn" data-action="nextSteps">Go to next steps & resources</button>
        </div>
      </div>
    `;
    setTimeout(function(){
      document.querySelectorAll('#fpTalkCards .fpConvoCardHead').forEach(function(h){
        h.addEventListener('click', function(){
          h.closest('.fpConvoCard').classList.toggle('open');
        });
      });
    }, 0);
    actions.fp_enabling = ()=>go("fp_enabling");
    actions.fp_support_affected = ()=>go("fp_support_affected");
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }

  if(id==="fp_enabling"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Are you enabling — or supporting?</div>
        <div class="p">There's a real difference. Both feel like loyalty. Only one actually is.</div>

        <div class="fpEnablingList" id="fpEnablingList">
          <div class="fpEnabling">
            <div class="fpEnablingHead">
              <span>🚩 "They would never do something like that."</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpEnablingBody">
              You're defending their character before you've looked at what they actually did. Character and behaviour aren't the same thing. Good people cause harm — and saying they're a good person doesn't address what happened.
            </div>
          </div>
          <div class="fpEnabling">
            <div class="fpEnablingHead">
              <span>🚩 Telling them what to say (or not say) to the other person</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpEnablingBody">
              Coaching your friend on how to handle the other person — especially if it's about managing their perception or avoiding consequences — is putting your loyalty to your friend above the wellbeing of the person who was hurt.
              Your friend needs to hear the truth, not a better script.
            </div>
          </div>
          <div class="fpEnabling">
            <div class="fpEnablingHead">
              <span>🚩 "Just don't bring it up and it'll go away."</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpEnablingBody">
              It won't go away for the person who was affected. Advising silence is advising them to prioritise your friend's comfort over someone else's healing. That's not neutral — it's actively choosing a side.
            </div>
          </div>
          <div class="fpEnabling">
            <div class="fpEnablingHead">
              <span>🚩 Keeping them in situations where they can harm again</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpEnablingBody">
              If your friend has a pattern — not a one-off — and you continue to bring them into situations with people they could harm, you're not just witnessing the pattern. You're enabling it.
              Being a real friend means having the hard conversation and, if necessary, creating distance until they've done some real work.
            </div>
          </div>
          <div class="fpEnabling">
            <div class="fpEnablingHead">
              <span>✅ Real friendship looks like this instead</span>
              <span class="fpConvoChev">▾</span>
            </div>
            <div class="fpEnablingBody">
              → Telling them the truth about what you saw or heard<br>
              → Not providing cover stories or alibi assistance<br>
              → Pointing them toward accountability resources (including this tool)<br>
              → Supporting them through the process of taking responsibility — not the process of avoiding it<br>
              → Being honest that you won't pretend nothing happened
              <br><br>
              <b>Real loyalty isn't protecting someone from consequences. It's caring enough to tell the truth.</b>
            </div>
          </div>
        </div>

        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="fp_support_affected">Supporting the person who was affected</button>
          <button class="btn" data-action="nextSteps">Go to next steps & resources</button>
        </div>
      </div>
    `;
    setTimeout(function(){
      document.querySelectorAll('#fpEnablingList .fpEnabling').forEach(function(el){
        el.querySelector('.fpEnablingHead').addEventListener('click', function(){
          el.classList.toggle('open');
        });
      });
    }, 0);
    actions.fp_support_affected = ()=>go("fp_support_affected");
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }

  if(id==="fp_support_affected"){
    screen.innerHTML = backBtn() + `
      <div class="card">
        <div class="h1">Supporting the person who was affected</div>
        <div class="p">You're connected to someone who was hurt. What you do — and don't do — in the days and weeks ahead matters more than you might think.</div>

        <div class="fpAffectedBox">
          <h4>If they haven't told you directly:</h4>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">💬</span><span>A simple check-in — "Hey, I heard something happened and I just wanted to check in on you, no pressure" — can mean everything. You don't need to name what you know. Just open the door.</span></div>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">🚫</span><span>Don't tell them what you know unless they ask — they may not be ready, and having information shared without their control can feel like another violation.</span></div>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">🎧</span><span>If they do bring it up: listen without steering. Don't tell them what to do. Ask "What do you need right now?" and mean it.</span></div>
        </div>

        <div class="fpAffectedBox" style="margin-top:10px;">
          <h4>If they've told you directly:</h4>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">🛑</span><span>Don't minimise ("I'm sure he didn't mean it"), investigate ("what were you wearing?"), or rush them ("you should report it").</span></div>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">✅</span><span>Do say: "I believe you. It's not your fault. I'm here."</span></div>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">🔄</span><span>Ask them what kind of support they want — practical help, someone to talk to, help finding resources, or just company. Let them lead.</span></div>
          <div class="fpAffectedRow"><span class="fpAffectedRowIcon">⚠️</span><span>Maintain their confidentiality unless there's a safety concern. Their story is theirs to tell — not yours to spread, even with good intentions.</span></div>
        </div>

        <div class="fpBoundaryBox" style="margin-top:10px;">
          <h4>About your own position in this:</h4>
          Being connected to both your friend and the person affected is genuinely hard. You may feel pulled in two directions. You don't have to choose between caring about both people — but you do have to be honest about what happened. Staying neutral doesn't protect anyone. Quiet support for both people is different from pretending nothing occurred.
        </div>

        <div class="grid" style="margin-top:16px;">
          <button class="btn btnPrimary" data-action="nextSteps">Go to resources & next steps</button>
          <button class="btn" data-action="fp_talk_to_friend">← Back to talking to your friend</button>
        </div>
      </div>
    `;
    actions.nextSteps = ()=>go("nextSteps");
    actions.fp_talk_to_friend = ()=>go("fp_talk_to_friend");
    return;
  }

  // ===== END FRIEND PATHWAY =====



  // ===== ACCUSED FLOW =====

  // CSS for accused flow - injected once via a style tag added dynamically
  // (styles are added in the initAccused function)

  if(id==="accused_landing"){
    screen.innerHTML = backBtn() + card(
      "That's a hard place to be.",
      [
        "Someone said something about you that you think isn't true — or isn't the whole story.",
        "This tool won't tell you whether you did something wrong. It won't judge you and it won't take sides.",
        "It will help you slow down and think it through clearly."
      ],
      null,
      `<div style="margin:14px 0 6px;">
        <div style="font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(209,254,255,.55);margin-bottom:10px;">When you heard about this accusation, what did you feel?<br><span style="font-weight:600;text-transform:none;letter-spacing:0;">Tap all that apply.</span></div>
        <div class="accFeelingGrid" id="accFeelings">
          <button class="accFeeling" data-f="shocked">😳 Shocked</button>
          <button class="accFeeling" data-f="angry">😠 Angry</button>
          <button class="accFeeling" data-f="scared">😰 Scared</button>
          <button class="accFeeling" data-f="confused">😕 Confused</button>
          <button class="accFeeling" data-f="guilty">😔 A little guilty</button>
          <button class="accFeeling" data-f="nowhere">🤯 Came out of nowhere</button>
          <button class="accFeeling" data-f="unfair">😤 This is unfair</button>
          <button class="accFeeling" data-f="numb">😶 Numb / nothing</button>
        </div>
        <div id="accFeelingNote" style="min-height:44px;margin:12px 0 6px;padding:10px 12px;border-radius:12px;border:1px solid rgba(209,254,255,.12);background:rgba(0,0,0,.16);font-size:13px;color:rgba(209,254,255,.75);line-height:1.45;transition:opacity .3s ease;opacity:0;"></div>
        <div style="margin-top:14px;">
          <button class="btn btnPrimary" id="accFeelingNext" style="opacity:.4;pointer-events:none;">Keep going →</button>
        </div>
      </div>`
    );
    setTimeout(()=>{
      const feelings = document.getElementById('accFeelings');
      const note = document.getElementById('accFeelingNote');
      const nextBtn = document.getElementById('accFeelingNext');
      const NOTES = {
        shocked: "Shock is a normal first response. It doesn't tell you whether something happened or not — it just means you weren't expecting this.",
        angry: "Anger makes sense. Being accused of something you didn't do — or didn't mean — feels deeply unfair. The question is what you do with that anger.",
        scared: "Fear usually means something is at stake. That's real. It also means this is worth thinking about carefully.",
        confused: "Confusion is actually useful information here. It often means something wasn't as clear as you thought it was.",
        guilty: "That feeling is worth paying attention to. Even small guilt signals are worth sitting with — not running from.",
        nowhere: "When something comes out of nowhere, it can feel unreal. But their experience was real to them, even if your intent was different.",
        unfair: "Feeling like it's unfair doesn't automatically mean nothing happened. Two things can be true at once.",
        numb: "Numbness is a shutdown response. It doesn't mean you don't care — it might mean this is too big to process all at once."
      };
      const selected = new Set();
      feelings.querySelectorAll('.accFeeling').forEach(btn=>{
        btn.addEventListener('click',()=>{
          btn.classList.toggle('on');
          const f = btn.dataset.f;
          if(btn.classList.contains('on')) selected.add(f); else selected.delete(f);
          if(selected.size > 0){
            const last = [...selected].pop();
            note.textContent = NOTES[last] || '';
            note.style.opacity = '1';
            nextBtn.style.opacity = '1';
            nextBtn.style.pointerEvents = 'auto';
          } else {
            note.style.opacity = '0';
            nextBtn.style.opacity = '.4';
            nextBtn.style.pointerEvents = 'none';
          }
        });
      });
      nextBtn.addEventListener('click',()=>{ state.accFeelings = [...selected]; go('accused_twosides'); });
    }, 0);
    return;
  }

  if(id==="accused_twosides"){
    screen.innerHTML = backBtn() + card(
      "Two people. One moment.",
      ["The same event can be experienced completely differently by two people — without either one lying."],
      null,
      `<div style="margin:14px 0;">
        <div style="font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(209,254,255,.55);margin-bottom:12px;">Tap each card to flip it.</div>
        <div class="accFlipRow">
          <div class="accFlipCard" id="flip1">
            <div class="accFlipInner">
              <div class="accFlipFront">
                <div class="accFlipLabel">Your side</div>
                <div class="accFlipQ">I thought it was fine.</div>
                <div class="accFlipHint">Tap to see why that can still be true — and incomplete.</div>
              </div>
              <div class="accFlipBack">
                <div class="accFlipBackText">Intent is real. But so is impact. You can mean well and still land hard on someone else. "I thought it was fine" and "they weren't okay" can both be true at once.</div>
              </div>
            </div>
          </div>
          <div class="accFlipCard" id="flip2">
            <div class="accFlipInner">
              <div class="accFlipFront">
                <div class="accFlipLabel">Their side</div>
                <div class="accFlipQ">They said something happened.</div>
                <div class="accFlipHint">Tap to see what that usually means.</div>
              </div>
              <div class="accFlipBack">
                <div class="accFlipBackText">Most people don't report or name things unless they felt real impact. They may have been scared, unsure, or processing for a while before saying anything. That doesn't make them right — but it does make them worth listening to.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="accFlipCard accFlipCardFull" id="flip3" style="margin-top:10px;">
          <div class="accFlipInner">
            <div class="accFlipFront">
              <div class="accFlipLabel">The gap</div>
              <div class="accFlipQ">Why does this happen?</div>
              <div class="accFlipHint">Tap to understand the space between two people's experiences.</div>
            </div>
            <div class="accFlipBack">
              <div class="accFlipBackText">Signals can be missed. Pressure can suppress "no." Fear, alcohol, and power dynamics can all change how an interaction feels from the inside versus the outside. Nobody has perfect perception — especially in charged moments.</div>
            </div>
          </div>
        </div>
        <div id="accFlipContinue" style="margin-top:16px;opacity:.4;pointer-events:none;transition:opacity .3s ease;">
          <button class="btn btnPrimary" data-action="accused_grayzone">Next →</button>
        </div>
      </div>`
    );
    setTimeout(()=>{
      const flipped = new Set();
      ['flip1','flip2','flip3'].forEach(id=>{
        const card = document.getElementById(id);
        if(!card) return;
        card.addEventListener('click',()=>{
          card.classList.toggle('flipped');
          flipped.add(id);
          if(flipped.size >= 2){
            const cont = document.getElementById('accFlipContinue');
            if(cont){ cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
          }
        });
      });
    },0);
    actions['accused_grayzone'] = ()=>go('accused_grayzone');
    return;
  }

  if(id==="accused_grayzone"){
    screen.innerHTML = backBtn() + card(
      "Myth or Reality?",
      ["Tap each one — these are beliefs that come up a lot. Some are myths. Some are more complicated."],
      null,
      `<div class="accMythStack" id="accMythStack"></div>
       <div id="accMythContinue" style="margin-top:14px;opacity:.4;pointer-events:none;transition:opacity .3s ease;">
         <button class="btn btnPrimary" data-action="accused_signals">Next →</button>
       </div>`
    );
    const MYTHS = [
      { statement: "\"If they didn't say no, it was okay.\"", verdict: "Incomplete", explain: "People don't always say no out loud — especially if they're scared, frozen, or unsure. Silence isn't the same as yes. A real yes sounds enthusiastic and clear." },
      { statement: "\"We were both into it at the time.\"", verdict: "Incomplete", explain: "What felt mutual to you may not have felt mutual to them. Pressure, power, alcohol, or social dynamics can all shape whether someone feels able to freely say no." },
      { statement: "\"They're just doing this to get me in trouble.\"", verdict: "Not Exactly", explain: "False accusations do happen, but they're uncommon. Most people who name something experienced real harm — even if the details look different from your side. Starting from that assumption leads to clearer thinking." },
      { statement: "\"If they seemed fine afterward, nothing bad happened.\"", verdict: "Not Exactly", explain: "People often take time to process. Many people seem okay in the moment — or act like it — because they're still figuring out how they feel, or because they don't feel safe reacting right away." },
      { statement: "\"Accountability means I have to admit I'm a rapist.\"", verdict: "Not Exactly", explain: "Accountability means looking honestly at what happened and what part you played — without needing a label. You can take responsibility for impact without collapsing your whole identity." },
    ];
    setTimeout(()=>{
      const stack = document.getElementById('accMythStack');
      let revealed = 0;
      stack.innerHTML = MYTHS.map((m,i)=>`
        <div class="accMyth" id="accMyth${i}" data-idx="${i}">
          <div class="accMythFront">
            <div class="accMythStatement">${m.statement}</div>
            <div class="accMythTap">Tap to reveal</div>
          </div>
          <div class="accMythBack">
            <div class="accMythVerdict ${m.verdict.toLowerCase().replace(/ /g,'-')}">${m.verdict}</div>
            <div class="accMythExplain">${m.explain}</div>
          </div>
        </div>
      `).join('');
      stack.querySelectorAll('.accMyth').forEach(el=>{
        el.addEventListener('click',()=>{
          if(el.classList.contains('open')) return;
          el.classList.add('open');
          revealed++;
          if(revealed >= 3){
            const cont = document.getElementById('accMythContinue');
            if(cont){ cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
          }
        });
      });
    },0);
    actions['accused_signals'] = ()=>go('accused_signals');
    return;
  }

  if(id==="accused_signals"){
    screen.innerHTML = backBtn() + card(
      "Look at the moment honestly.",
      ["This isn't about assigning blame. It's about seeing clearly."],
      null,
      `<div style="margin:10px 0;">
        <div style="font-size:13px;color:rgba(209,254,255,.75);line-height:1.5;margin-bottom:14px;">During the moment in question, did any of these things happen? Tap all that were true.</div>
        <div class="accSignalList" id="accSignals">
          <button class="accSignal" data-s="alcohol">🍺 Alcohol or substances were involved</button>
          <button class="accSignal" data-s="quiet">😶 They went quiet or stopped responding</button>
          <button class="accSignal" data-s="away">↩️ They pulled away or tensed up</button>
          <button class="accSignal" data-s="hesitate">⏸️ They hesitated before agreeing</button>
          <button class="accSignal" data-s="asked">🤔 I wasn't sure, but kept going</button>
          <button class="accSignal" data-s="pressure">😬 I pushed past a "maybe" or "I don't know"</button>
          <button class="accSignal" data-s="unclear">❓ I wasn't sure they were fully into it</button>
          <button class="accSignal" data-s="none">✅ None of these were true</button>
        </div>
        <div id="accSignalResult" style="margin:14px 0 4px;min-height:60px;padding:12px 14px;border-radius:14px;border:1px solid rgba(209,254,255,.12);background:rgba(0,0,0,.16);font-size:13px;color:rgba(209,254,255,.82);line-height:1.5;opacity:0;transition:opacity .3s ease;"></div>
        <div id="accSignalCont" style="margin-top:12px;opacity:.4;pointer-events:none;transition:opacity .3s ease;">
          <button class="btn btnPrimary" data-action="accused_fork">Continue →</button>
        </div>
      </div>`
    );
    setTimeout(()=>{
      const signals = document.getElementById('accSignals');
      const result = document.getElementById('accSignalResult');
      const cont = document.getElementById('accSignalCont');
      const selected = new Set();
      signals.querySelectorAll('.accSignal').forEach(btn=>{
        btn.addEventListener('click',()=>{
          if(btn.dataset.s === 'none'){
            signals.querySelectorAll('.accSignal').forEach(b=>{ if(b!==btn) b.classList.remove('on'); selected.clear(); });
          } else {
            signals.querySelector('[data-s="none"]')?.classList.remove('on');
            selected.delete('none');
          }
          btn.classList.toggle('on');
          if(btn.classList.contains('on')) selected.add(btn.dataset.s); else selected.delete(btn.dataset.s);
          state.accSignals = [...selected];
          const count = selected.has('none') ? 0 : selected.size;
          let msg = '';
          if(count === 0 && selected.has('none')){
            msg = "Okay. That matters. If none of those signals were present, and the experience was genuinely mutual, that's important context. What matters most now is how you're showing up in the aftermath.";
          } else if(count === 1){
            msg = "Even one of these is worth pausing on. Signals don't prove guilt — but they do mean something was less than fully clear. That gap is where harm lives, even when intent was good.";
          } else if(count >= 2 && count <= 3){
            msg = "A few of these together make a pattern. This doesn't make you a bad person — but it does mean something important was probably missed in that moment. That's worth sitting with.";
          } else if(count >= 4){
            msg = "Several of these together suggest the moment was significantly unclear or uncomfortable for them. That's hard to hear. The goal here isn't punishment — it's honesty, so you can do better.";
          }
          if(msg){ result.textContent = msg; result.style.opacity='1'; cont.style.opacity='1'; cont.style.pointerEvents='auto'; }
        });
      });
    },0);
    actions['accused_fork'] = ()=>go('accused_fork');
    return;
  }

  if(id==="accused_fork"){
    const signals = state.accSignals || [];
    const hasSignals = signals.length > 0 && !signals.includes('none');
    screen.innerHTML = backBtn() + card(
      "Where are you landing?",
      ["This is private. Just you and this screen."],
      null,
      `<div style="margin:14px 0;">
        <div style="font-size:13px;color:rgba(209,254,255,.75);margin-bottom:14px;line-height:1.5;">After going through this, which of these feels most true right now?</div>
        <div style="display:grid;gap:10px;">
          <button class="btn" data-action="accused_toaccountability" style="padding:16px 18px;border-radius:16px;text-align:left;border-color:rgba(21,255,200,.35);background:rgba(21,255,200,.07);">
            <div style="font-weight:900;font-size:15px;margin-bottom:4px;">💡 I think something may have gone wrong that I didn't fully realize</div>
            <div style="font-size:12px;color:rgba(209,254,255,.65);line-height:1.4;">I want to understand it better and figure out what accountability actually looks like for me.</div>
          </button>
          <button class="btn" data-action="accused_stilldenying" style="padding:16px 18px;border-radius:16px;text-align:left;border-color:rgba(255,180,60,.30);background:rgba(255,150,40,.06);">
            <div style="font-weight:900;font-size:15px;margin-bottom:4px;">⚡ I still believe this isn't what they're saying it is</div>
            <div style="font-size:12px;color:rgba(209,254,255,.65);line-height:1.4;">I want to understand my options and how to handle this situation.</div>
          </button>
          <button class="btn" data-action="accused_unsure" style="padding:16px 18px;border-radius:16px;text-align:left;">
            <div style="font-weight:900;font-size:15px;margin-bottom:4px;">🌫️ I genuinely don't know what to think</div>
            <div style="font-size:12px;color:rgba(209,254,255,.65);line-height:1.4;">It's complicated and I'm still processing.</div>
          </button>
        </div>
      </div>`
    );
    actions['accused_toaccountability'] = ()=>go('accused_accountability');
    actions['accused_stilldenying'] = ()=>go('accused_stilldenying');
    actions['accused_unsure'] = ()=>go('accused_unsure');
    return;
  }

  if(id==="accused_accountability"){
    screen.innerHTML = backBtn() + card(
      "Accountability isn't a label.",
      [],
      null,
      `<div style="margin:6px 0 14px;">
        <div class="accAccSteps" id="accAccSteps">
          <div class="accAccStep" data-step="0">
            <div class="accAccDot"></div>
            <div class="accAccBody">
              <div class="accAccTitle">Tap to start</div>
              <div class="accAccText">Accountability is not about whether you're a good or bad person. It's about one question: what part did I play?</div>
            </div>
          </div>
          <div class="accAccStep" data-step="1">
            <div class="accAccDot"></div>
            <div class="accAccBody">
              <div class="accAccTitle">Separate intent from impact</div>
              <div class="accAccText">You can mean well and still cause harm. Accountability means acknowledging the impact — even when your intent was different.</div>
            </div>
          </div>
          <div class="accAccStep" data-step="2">
            <div class="accAccDot"></div>
            <div class="accAccBody">
              <div class="accAccTitle">Don't make it about you</div>
              <div class="accAccText">When someone tells you they were hurt, the instinct to defend yourself is natural — but it can make things worse. Listening doesn't mean agreeing. It means trying to understand their experience.</div>
            </div>
          </div>
          <div class="accAccStep" data-step="3">
            <div class="accAccDot"></div>
            <div class="accAccBody">
              <div class="accAccTitle">Change is the point</div>
              <div class="accAccText">Real accountability leads somewhere. It asks: what do I do differently? What skills or habits do I need to build? It's not self-punishment — it's growth.</div>
            </div>
          </div>
          <div class="accAccStep" data-step="4">
            <div class="accAccDot"></div>
            <div class="accAccBody">
              <div class="accAccTitle">You can do this</div>
              <div class="accAccText">Coming here and going through this — even when it was uncomfortable — is a sign you're capable of taking this seriously. That matters.</div>
            </div>
          </div>
        </div>
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn btnPrimary" data-action="nextSteps" style="flex:1;">Continue to next steps →</button>
          <button class="btn" data-action="accused_resources" style="flex:1;">I also need practical help</button>
        </div>
      </div>`
    );
    setTimeout(()=>{
      const steps = document.querySelectorAll('.accAccStep');
      steps.forEach((step, i)=>{
        if(i===0){ step.classList.add('active'); }
        step.addEventListener('click',()=>{
          step.classList.add('done');
          if(steps[i+1]) steps[i+1].classList.add('active');
        });
      });
    },0);
    actions.nextSteps=()=>go('nextSteps');
    actions['accused_resources']=()=>go('accused_resources');
    return;
  }

  if(id==="accused_unsure"){
    screen.innerHTML = backBtn() + card(
      "Not knowing is okay — for now.",
      [
        "You don't have to have a clear answer today.",
        "But uncertainty isn't the same as nothing happened. It might mean something was less clear than you thought — even if your intent was good.",
      ],
      null,
      `<div style="margin:14px 0;">
        <div class="note" style="margin-bottom:14px;">The most honest thing you can do with uncertainty is sit with it — not rush to either conclusion. That takes real maturity.</div>
        <div style="display:grid;gap:10px;">
          <button class="btn btnPrimary" data-action="nextSteps">Go to next steps</button>
          <button class="btn" data-action="accused_resources">I also want practical support info</button>
          <button class="btn" data-action="accused_landing">Start this section over</button>
        </div>
      </div>`
    );
    actions.nextSteps=()=>go('nextSteps');
    actions['accused_resources']=()=>go('accused_resources');
    actions['accused_landing']=()=>go('accused_landing');
    return;
  }

  if(id==="accused_stilldenying"){
    screen.innerHTML = backBtn() + card(
      "That's a valid place to be.",
      [],
      null,
      `<div style="margin:6px 0 14px;">
        <div class="p" style="color:var(--muted);line-height:1.5;margin-bottom:10px;">
          Believing something didn't happen the way it's being described isn't the same as not caring. You're still here — still trying to understand it — and that matters.
        </div>
        <div class="note" style="margin-bottom:14px;">
          <b>One thing worth sitting with:</b><br>
          Two people can experience the exact same moment very differently — and both experiences can be real at the same time. That doesn't make you guilty. It does mean the other person's discomfort was genuine to them, even if your intent was different.
        </div>
        <div style="font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:12px;">What feels most true for you right now?</div>
        <div style="display:grid;gap:10px;">
          <button class="btn" data-action="sd_wantinfo" style="padding:14px 16px;border-radius:14px;text-align:left;">
            <div style="font-weight:900;margin-bottom:3px;">📋 I want to know what my practical options are</div>
            <div style="font-size:12px;color:rgba(209,254,255,.6);line-height:1.4;">What to do, what not to do, who to talk to</div>
          </button>
          <button class="btn" data-action="sd_stillopen" style="padding:14px 16px;border-radius:14px;text-align:left;">
            <div style="font-weight:900;margin-bottom:3px;">🌫️ Part of me wonders if I'm missing something</div>
            <div style="font-size:12px;color:rgba(209,254,255,.6);line-height:1.4;">I'm open to looking at this more carefully</div>
          </button>
        </div>
      </div>`
    );
    actions['sd_wantinfo'] = ()=>go('accused_resources');
    actions['sd_stillopen'] = ()=>go('accused_accountability');
    return;
  }

  if(id==="accused_resources"){
    screen.innerHTML = backBtn() + card(
      "Practical support.",
      ["Whether you're navigating an accusation, trying to understand your rights, or just need to talk to someone — here's where to start."],
      null,
      `<div style="margin:12px 0;">
        <div class="accResourceList">
          <div class="accResource">
            <div class="accResourceHead">🧑‍💼 Talk to a trusted adult first</div>
            <div class="accResourceBody">Before doing anything else — reaching out to the other person, posting about it, or venting to mutual friends — find a trusted adult like a parent, counselor, or coach who can help you think through next steps with a clear head. You don't have to navigate this alone.</div>
          </div>
          <div class="accResource">
            <div class="accResourceHead">🤐 Give them space</div>
            <div class="accResourceBody">Don't reach out to the other person right now — not to explain, apologize, or defend yourself. They need space to process, and so do you. Reaching out too soon, even with good intentions, can make things harder for both of you.</div>
          </div>
          <div class="accResource">
            <div class="accResourceHead">📋 Write down what you remember</div>
            <div class="accResourceBody">For your own clarity, write down what happened from your perspective — dates, context, how you were feeling. This isn't about building a case. It's about helping you understand the situation clearly so you can have honest conversations with a trusted adult.</div>
          </div>
          <div class="accResource">
            <div class="accResourceHead">💬 Talk to someone</div>
            <div class="accResourceBody">Carrying this alone makes it heavier and harder to think clearly. A school counselor, therapist, or trusted adult can help you process what happened and what you're feeling — without judgment. You deserve support through this.</div>
          </div>
          <div class="accResource">
            <div class="accResourceHead">🔄 Use this as a moment to grow</div>
            <div class="accResourceBody">Whatever happened, this situation is a chance to reflect on how you show up — your communication, your awareness of signals, your understanding of what consent actually looks like in real moments. That reflection is never wasted.</div>
          </div>
        </div>
        <div style="margin-top:14px;display:grid;gap:10px;">
          <button class="btn btnPrimary" data-action="accused_commitment">One last thing before next steps →</button>
        </div>
      </div>`
    );
    actions.nextSteps=()=>go('nextSteps');
    actions['accused_commitment']=()=>go('accused_commitment');
    return;
  }

  if(id==="accused_commitment"){
    screen.innerHTML = backBtn() + card(
      "One thing you can control.",
      ["Whatever happens next — there's one question worth sitting with."],
      null,
      `<div style="margin:14px 0;">
        <div class="note" style="margin-bottom:16px; font-size:14px; line-height:1.6;">
          <b>Regardless of what happened or how this resolves —</b><br>
          Is there anything about how I communicate, read signals, or show up in relationships that I want to be more aware of going forward?
        </div>
        <div style="font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:10px;">You don't have to write anything. But if something comes to mind:</div>
        <textarea id="accCommitInput" style="width:100%;background:rgba(0,0,0,.2);border:1px solid rgba(209,254,255,.18);border-radius:12px;padding:12px;color:var(--text);font-size:14px;font-family:inherit;resize:none;min-height:80px;line-height:1.5;" maxlength="200" placeholder="One thing I want to be more aware of…"></textarea>
        <div style="margin-top:12px;display:grid;gap:10px;">
          <button class="btn btnPrimary" data-action="nextSteps" id="accCommitBtn">Go to next steps →</button>
        </div>
      </div>`
    );
    actions.nextSteps=()=>go('nextSteps');
    return;
  }

  // ===== END ACCUSED FLOW =====

  if(id==="entryDeescalate"){
    screen.innerHTML = backBtn() + card(
      "Let’s slow this down.",
      [
        "It sounds like you’re carrying something heavy.",
        "This space isn’t here to judge or label you. It’s here to help you understand what happened and what you can do next.",
        "We’ll focus on behaviors, impact, and safer next steps."
      ],
      null,
      grid(
        btn("Continue","continue","btn btnPrimary") +
        btn("Go back","back")
      )
    );
    actions.continue=()=>go("topScenario");
    actions.back=()=>go("bringsYouHere");
    return;
  }

  if(id==="topScenario"){
    screen.innerHTML = backBtn() + card(
      "Which feels closest to what happened?",
      ["Pick the one that fits best. You don\'t need to explain."],
      null,
      `<div style="display:flex; flex-direction:column; gap:6px; margin-top:14px;">
        <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.6px; color:rgba(209,254,255,.42); margin:4px 0 2px; padding-left:4px;">Reading the moment</div>
        <button class="btn" data-action="s1" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">They froze or got quiet</button>
        <button class="btn" data-action="s2" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">They pulled away</button>
        <button class="btn" data-action="s12" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">They were asleep or half-asleep</button>
        <button class="btn" data-action="s5" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">They seemed upset or distant afterward</button>
        <button class="btn" data-action="s4" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">I\'m not sure they really wanted it</button>
        <div style="height:1px; background:rgba(209,254,255,.10); margin:4px 0;"></div>
        <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.6px; color:rgba(209,254,255,.42); margin:2px 0; padding-left:4px;">Pressure or circumstances</div>
        <button class="btn" data-action="s3" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">We were drinking or using substances</button>
        <button class="btn" data-action="s7" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">I kept persuading or pressuring them</button>
        <button class="btn" data-action="s8" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">There was an age or power difference</button>
        <button class="btn" data-action="s11" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">We were in a relationship and I assumed consent</button>
        <div style="height:1px; background:rgba(209,254,255,.10); margin:4px 0;"></div>
        <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.6px; color:rgba(209,254,255,.42); margin:2px 0; padding-left:4px;">Other</div>
        <button class="btn" data-action="s10" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">I ignored a clear \'no\'</button>
        <button class="btn" data-action="s9" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px;">Something happened digitally (photos/messages)</button>
        <button class="btn" data-action="s6" style="text-align:left; padding:13px 15px; font-size:14px; font-weight:800; border-radius:12px; opacity:.80;">I\'m still not sure what happened</button>
      </div>`
    );
    actions.s1=()=>routeScenario("freeze");
    actions.s2=()=>routeScenario("pulled_away");
    actions.s3=()=>routeScenario("drinking");
    actions.s4=()=>routeScenario("not_sure_wanted");
    actions.s5=()=>routeScenario("upset_after");
    actions.s6=()=>routeScenario("not_sure_what");
    actions.s7=()=>routeScenario("pressure");
    actions.s8=()=>routeScenario("age_power");
    actions.s9=()=>routeScenario("digital");
    actions.s10=()=>routeScenario("coercion");
    actions.s11=()=>routeScenario("relationship");
    actions.s12=()=>routeScenario("asleep");
    return;
  }

  // ===== Path A (Freeze) — Expanded Module =====

  // Step progress helper for the freeze module
  var freezeDots = function(step) {
    var steps = ['what-it-means','most-common','impact'];
    return '<div class="alcProgress" style="margin:10px 0 14px;">' +
      steps.map(function(_,i){
        return '<div class="alcDot ' + (i < step ? 'done' : '') + ' ' + (i === step ? 'active' : '') + '"></div>';
      }).join('') +
    '</div>';
  };

  if(id==="A_freeze_whatItMeans"){
    screen.innerHTML = backBtn() + `
      <div class="dsHeader">
        <div class="dsEyebrow">BAE Check &mdash; Understanding Freeze</div>
        <div class="h1">&#x1F9CA; When Someone Freezes</div>
        <div class="p" style="margin:0;">Understanding why this happens &mdash; and what it means.</div>
      </div>
      ${freezeDots(0)}
      <div class="dsPanel">
        <div class="p" style="margin-top:4px;">
          Sometimes people go quiet, stiff, or unresponsive when they feel overwhelmed or unsafe. This is called a <b>freeze response</b> &mdash; and it&rsquo;s one of the most common reactions to threat or danger.
        </div>
        <div class="p">
          It looks like: going very still, not speaking, feeling &ldquo;stuck,&rdquo; or being unable to push someone away even when you want to. <b>This is not a choice &mdash; it&rsquo;s the nervous system taking over.</b>
        </div>

        <div style="display:flex; flex-direction:column; gap:10px; margin:12px 0;">
          <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.06); border-radius:14px; padding:14px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:6px;">&#x1F534; Amygdala &mdash; Threat Response Centre</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.5;">When danger is sensed, the amygdala triggers red-alert and releases adrenalin and cortisol. It acts in milliseconds &mdash; far faster than conscious thought. <b>It doesn&rsquo;t ask permission.</b></div>
          </div>
          <div style="border:1px solid rgba(209,254,255,.18); background:rgba(0,0,0,.18); border-radius:14px; padding:14px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.60); margin-bottom:6px;">&#x1F535; Pre-Frontal Cortex (PFC) &mdash; Thinking Brain</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.5;">Responsible for rational decisions, planning, and language. <b>It goes offline during a threat response</b> &mdash; because careful thinking is too slow when survival is at stake. This is why someone who froze couldn&rsquo;t just say no or push away.</div>
          </div>
        </div>

        <div class="note" style="border-color:rgba(209,254,255,.30);">
          <b>Think of it like this:</b> Have you ever swerved a car before you consciously decided to? That&rsquo;s the same system &mdash; the threat response acted before the thinking brain could. In a frightening situation, the body does the same thing.
        </div>

        <div style="border:1px solid rgba(21,255,200,.22); background:rgba(21,255,200,.06); border-radius:14px; padding:14px 16px; margin:12px 0 0;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(21,255,200,.8); margin-bottom:8px;">The core truth</div>
          <div style="font-size:15px; font-weight:900; color:var(--sb-light); line-height:1.4;">Freezing does <em>not</em> mean yes.</div>
          <div style="font-size:13px; color:var(--muted); margin-top:8px; line-height:1.55;">If you noticed freezing, the right move is always: <b>pause, name what you noticed, and check in.</b> Silence is not consent.</div>
        </div>

        <div class="dsNavRow" style="margin-top:14px;">
          <button class="btn btnPrimary" data-action="A_freeze_mostCommon">Why freezing is so common &rarr;</button>
        </div>
      </div>
    `;
    actions.A_freeze_mostCommon = () => go("A_freeze_mostCommon");
    return;
  }

  if(id==="A_freeze_mostCommon"){
    screen.innerHTML = backBtn() + `
      <div class="dsHeader">
        <div class="dsEyebrow">BAE Check &mdash; Understanding Freeze</div>
        <div class="h1">Why Freezing Is So Common</div>
      </div>
      ${freezeDots(1)}
      <div class="dsPanel">
        <div class="p">Most people expect themselves (or others) to react to an assault by fighting back or running away. But research consistently shows the opposite: <b>freeze, appease, and flop are the most common responses to sexual assault</b>.</div>

        <div style="border:1px solid rgba(21,255,200,.22); background:rgba(21,255,200,.06); border-radius:14px; padding:14px 16px; margin:12px 0;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(21,255,200,.8); margin-bottom:8px;">What the research says</div>
          <div style="font-size:13px; color:var(--muted); line-height:1.6; display:flex; flex-direction:column; gap:8px;">
            <div style="padding:8px 10px; border-radius:8px; background:rgba(0,0,0,.18); border-left:3px solid rgba(21,255,200,.40);">People who <b>fight or flee</b> during a sexual assault are statistically <b>more likely to sustain physical injuries</b>.</div>
            <div style="padding:8px 10px; border-radius:8px; background:rgba(0,0,0,.18); border-left:3px solid rgba(21,255,200,.40);">Freezing can cause the assault to end sooner in some cases &mdash; which is why the nervous system may choose it.</div>
            <div style="padding:8px 10px; border-radius:8px; background:rgba(0,0,0,.18); border-left:3px solid rgba(21,255,200,.40);">Tonic immobility &mdash; a state of complete physical paralysis &mdash; affects a significant number of survivors and is entirely involuntary.</div>
          </div>
        </div>

        <div style="border:1px solid rgba(255,100,100,.25); background:rgba(255,80,80,.06); border-radius:14px; padding:14px 16px; margin:12px 0;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,160,140,.85); margin-bottom:8px;">The self-blame trap</div>
          <div style="font-size:13px; color:var(--muted); line-height:1.55;">After the threat passes, the thinking brain comes back online &mdash; and it often starts judging the choices made during the survival response. This is where thoughts like <em>&ldquo;why didn&rsquo;t I just say no?&rdquo;</em> or <em>&ldquo;why didn&rsquo;t I push them away?&rdquo;</em> come from. These questions are unfair. The thinking brain was not in charge. The nervous system was doing its best to keep you safe.</div>
        </div>

        <div class="note" style="font-size:13px; border-color:rgba(209,254,255,.30);">
          Victim-blaming exists partly because many people don&rsquo;t understand that fight and flight are not the default responses. Expecting someone to have &ldquo;just said no&rdquo; ignores how human survival actually works.
        </div>

        <div class="dsNavRow" style="margin-top:14px;">
          <button class="btn btnPrimary" data-action="A_freeze_impact">What this means for you &rarr;</button>
        </div>
      </div>
    `;
    actions.A_freeze_impact = () => go("A_freeze_impact");
    return;
  }

  if(id==="A_freeze_impact"){
    screen.innerHTML = backBtn() + `
      <div class="dsHeader">
        <div class="dsEyebrow">BAE Check &mdash; Understanding Freeze</div>
        <div class="h1">Impact Matters &mdash; Even Without Intent</div>
      </div>
      ${freezeDots(2)}
      <div class="dsPanel">
        <div class="p">Now that you understand why freezing happens, here&rsquo;s what it means for the situation you&rsquo;re reflecting on.</div>

        <div style="display:flex; flex-direction:column; gap:10px; margin:12px 0 16px;">
          <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.06); border-radius:14px; padding:14px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:6px;">Freeze &ne; Yes</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.55;">A person who froze could not freely choose to engage. Their nervous system had taken over. A frozen person cannot give meaningful consent &mdash; full stop.</div>
          </div>
          <div style="border:1px solid rgba(209,254,255,.18); background:rgba(0,0,0,.18); border-radius:14px; padding:14px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.60); margin-bottom:6px;">If things continued after you noticed it</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.55;">Even if you didn&rsquo;t intend harm, continuing when someone freezes can leave them feeling violated, overwhelmed, or unsafe. Their experience of what happened is valid regardless of your intent.</div>
          </div>
          <div style="border:1px solid rgba(21,255,200,.22); background:rgba(21,255,200,.06); border-radius:14px; padding:14px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(21,255,200,.8); margin-bottom:6px;">What the signal should have been</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.55;">Going still, going quiet, becoming unresponsive &mdash; these are signals to <b>stop and check in</b>. Saying something like &ldquo;Are you okay? Do you want to keep going?&rdquo; gives the person a chance to re-engage if they want to, or to feel safe enough to say no.</div>
          </div>
        </div>

        <div class="note" style="font-size:13px; font-weight:800; border-color:rgba(21,255,200,.50);">
          What matters now is what you do next: slow down, take responsibility for the impact, and build habits that prevent harm going forward.
        </div>

        <div class="dsNavRow" style="margin-top:14px;">
          <button class="btn btnPrimary" data-action="toEmotion">Continue &rarr;</button>
        </div>
      </div>
    `;
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== ALCOHOL / SUBSTANCE DEEP DIVE (Path B) =====

if(id==="B_drinking_basics"){
  var adots=function(s){var a=['basics','scenario','deep','signals','myths','plan'];return '<div class="alcProgress">'+a.map(function(_,i){return '<div class="alcDot '+(i<s?'done':'')+' '+(i===s?'active':'')+'"></div>';}).join('')+'</div>';};
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">BAE Check &mdash; Alcohol &amp; Substances</div><div class="h1">\uD83C\uDF7A Alcohol Changes Consent</div></div>' + adots(0) + '<div style="display:flex;flex-direction:column;gap:12px;"><div style="border:1px solid rgba(255,160,80,.30);background:rgba(255,120,40,.06);border-radius:16px;padding:16px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.85);margin-bottom:10px;">The core principle</div><div style="font-size:15px;font-weight:900;color:var(--sb-light);line-height:1.4;margin-bottom:10px;">Consent requires the capacity to give it. Alcohol and drugs reduce that capacity &mdash; sometimes to zero.</div><div style="font-size:13px;color:var(--muted);line-height:1.55;">This isn&rsquo;t about counting drinks or drawing an exact line. It&rsquo;s about understanding that <b>impairment changes the equation</b> &mdash; and the more impaired someone is, the less able they are to freely agree to anything.</div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:16px;padding:16px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:10px;">What the law generally says</div><div style="font-size:13px;color:var(--muted);line-height:1.55;">In most jurisdictions, a person who is <b>incapacitated</b> &mdash; unable to understand, communicate, or make decisions due to alcohol or drugs &mdash; <b>cannot legally consent</b> to sexual activity. This applies regardless of what happened before they became incapacitated, regardless of relationship status, and regardless of whether the other person was also drinking.</div><div style="margin-top:10px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,100,60,.25);background:rgba(255,80,40,.06);font-size:12px;color:rgba(255,180,140,.90);line-height:1.45;"><b>Key:</b> &ldquo;Incapacitated&rdquo; and &ldquo;had a few drinks&rdquo; are not the same thing. But the gray zone between them is where most harm happens &mdash; and that gray zone is yours to navigate responsibly.</div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:16px;padding:16px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:10px;">Why alcohol is different from other situations</div><div style="font-size:13px;color:var(--muted);line-height:1.55;">Alcohol doesn&rsquo;t just lower inhibitions &mdash; it <b>impairs judgment, distorts perception, slows processing, and reduces the ability to read social cues</b>. Both people may misread signals. But the person initiating sexual activity carries a higher responsibility to ensure clarity &mdash; not less.<br><br>Alcohol is the <b>most common substance involved in sexual assault</b>. Not because alcohol causes assault &mdash; but because it creates conditions where consent is murky, signals are missed, and people act on assumptions instead of clarity.</div></div></div><div class="grid" style="margin-top:16px;"><button class="btn btnPrimary" data-action="B_scenario">What was the situation? &rarr;</button></div>';
  actions.B_scenario = function(){go("B_drinking_scenario");};
  return;
}

if(id==="B_drinking_scenario"){
  var adots=function(s){var a=['basics','scenario','deep','signals','myths','plan'];return '<div class="alcProgress">'+a.map(function(_,i){return '<div class="alcDot '+(i<s?'done':'')+' '+(i===s?'active':'')+'"></div>';}).join('')+'</div>';};
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">BAE Check &mdash; Alcohol &amp; Substances</div><div class="h1">What was the situation?</div><div class="p" style="margin-bottom:0;">Pick the one that fits closest. Each leads somewhere different.</div></div>' + adots(1) + '<div class="alcScenarioGrid"><button class="alcScenarioBtn" data-action="B_both_drunk"><span class="alcScenarioIcon">\uD83C\uDF7B</span><span class="alcScenarioText"><span class="alcScenarioLabel">We were both drinking</span><span class="alcScenarioSub">&ldquo;We were both drunk &mdash; doesn&rsquo;t that cancel out?&rdquo;</span></span></button><button class="alcScenarioBtn" data-action="B_they_drunk"><span class="alcScenarioIcon">\uD83E\uDD74</span><span class="alcScenarioText"><span class="alcScenarioLabel">They were more intoxicated than me</span><span class="alcScenarioSub">I was sober or less drunk &mdash; they were visibly impaired</span></span></button><button class="alcScenarioBtn" data-action="B_i_drunk"><span class="alcScenarioIcon">\uD83E\uDEE0</span><span class="alcScenarioText"><span class="alcScenarioLabel">I was very drunk</span><span class="alcScenarioSub">&ldquo;I don&rsquo;t fully remember&rdquo; or &ldquo;I was out of it too&rdquo;</span></span></button><button class="alcScenarioBtn" data-action="B_drugs"><span class="alcScenarioIcon">\uD83D\uDC8A</span><span class="alcScenarioText"><span class="alcScenarioLabel">Drugs were involved (not just alcohol)</span><span class="alcScenarioSub">Weed, pills, molly, or other substances</span></span></button><button class="alcScenarioBtn" data-action="B_spiked"><span class="alcScenarioIcon">\u26A0\uFE0F</span><span class="alcScenarioText"><span class="alcScenarioLabel">I think they were drugged / drink was spiked</span><span class="alcScenarioSub">Their reaction didn&rsquo;t match how much they drank</span></span></button></div>';
  actions.B_both_drunk = function(){go("B_both_drunk");};
  actions.B_they_drunk = function(){go("B_they_drunk");};
  actions.B_i_drunk = function(){go("B_i_drunk");};
  actions.B_drugs = function(){go("B_drugs");};
  actions.B_spiked = function(){go("B_spiked");};
  return;
}

// ===== "We were both drinking" =====
if(id==="B_both_drunk"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div><div class="h1">&ldquo;We were both drunk&rdquo;</div><div class="p" style="margin-bottom:0;">This is the single most common thing people say in this situation. Let&rsquo;s unpack it honestly.</div></div><div class="alcReframeCard"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.85);margin-bottom:10px;">The thought</div><div style="font-size:16px;font-weight:900;color:var(--sb-light);line-height:1.35;">&ldquo;If we were both drunk, it&rsquo;s nobody&rsquo;s fault &mdash; right?&rdquo;</div><div class="alcReframeSide myth" style="margin-top:14px;"><div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,140,80,.80);margin-bottom:6px;">Why people think this</div>It feels like equal impairment creates equal responsibility. If both people made a bad decision, neither one is more accountable. This logic is intuitive &mdash; but it misses something critical.</div><div class="alcReframeSide truth"><div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:var(--sb-mint);margin-bottom:6px;">What&rsquo;s actually true</div>Mutual intoxication doesn&rsquo;t erase the concept of consent. Here&rsquo;s what to consider:<div style="margin-top:10px;display:flex;flex-direction:column;gap:8px;"><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(21,255,200,.40);font-size:12.5px;line-height:1.5;"><b>Who initiated?</b> The person who escalated the sexual activity carries more responsibility for confirming consent &mdash; regardless of their own intoxication.</div><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(21,255,200,.40);font-size:12.5px;line-height:1.5;"><b>Was there a difference in impairment?</b> &ldquo;Both drinking&rdquo; doesn&rsquo;t mean equally drunk. One person may have been far more impaired than the other.</div><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(21,255,200,.40);font-size:12.5px;line-height:1.5;"><b>Your intoxication doesn&rsquo;t excuse your actions.</b> Being drunk may explain why you missed cues or made poor choices &mdash; but it doesn&rsquo;t remove responsibility for those choices. Drunk driving is still your fault.</div><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(21,255,200,.40);font-size:12.5px;line-height:1.5;"><b>Their intoxication matters differently.</b> If they were too impaired to consent, the fact that you were also impaired doesn&rsquo;t create consent where none existed.</div></div></div></div><div class="note" style="border-color:rgba(255,160,80,.50);background:rgba(255,120,40,.08);"><b>The uncomfortable truth:</b> &ldquo;We were both drunk&rdquo; is sometimes a genuine description of a confusing situation &mdash; and sometimes it&rsquo;s a rationalization that protects you from examining what actually happened. Only honest reflection can tell you which one it is.</div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="B_signal_check">Check the signals &rarr;</button><button class="btn" data-action="B_bac">Understand impairment levels</button></div>';
  actions.B_signal_check = function(){go("B_signal_check");};
  actions.B_bac = function(){go("B_bac_awareness");};
  return;
}

// ===== "They were more intoxicated" =====
if(id==="B_they_drunk"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div><div class="h1">They were more impaired than you.</div></div><div style="display:flex;flex-direction:column;gap:12px;"><div style="border:1px solid rgba(255,100,60,.30);background:rgba(255,80,40,.06);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,140,80,.85);margin-bottom:8px;">This matters</div><div style="font-size:13.5px;color:var(--sb-light);line-height:1.55;">When there&rsquo;s an <b>impairment gap</b> &mdash; when one person is significantly more intoxicated than the other &mdash; the less impaired person has greater responsibility for ensuring consent is present.<br><br>If you were sober or mostly sober and they were visibly drunk, you were in a better position to judge the situation clearly. That means the accountability falls more heavily on you.</div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:8px;">Signs they may have been too impaired to consent</div><div style="font-size:13px;color:var(--muted);line-height:1.55;display:flex;flex-direction:column;gap:6px;"><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Slurred speech or difficulty forming sentences</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Stumbling, unable to walk steadily, needing physical support</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Confusion about where they were or who you were</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Vomiting or nausea</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Passed out, in and out of consciousness, or falling asleep</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Unable to make decisions (couldn&rsquo;t find phone, keys, or get themselves home)</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,160,80,.50);">Saying things that didn&rsquo;t make sense or changing their mind repeatedly</div></div></div><div class="note" style="border-color:rgba(255,100,60,.45);background:rgba(255,80,40,.06);"><b>If any of these applied:</b> they likely couldn&rsquo;t consent &mdash; and proceeding in that state is something you need to take seriously, regardless of what they said or seemed to agree to in the moment.</div></div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="B_signal_check">Check more signals &rarr;</button><button class="btn" data-action="B_bac">Understand impairment levels</button></div>';
  actions.B_signal_check = function(){go("B_signal_check");};
  actions.B_bac = function(){go("B_bac_awareness");};
  return;
}

// ===== "I was very drunk" =====
if(id==="B_i_drunk"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div><div class="h1">You were very drunk too.</div></div><div style="display:flex;flex-direction:column;gap:12px;"><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:14px;padding:14px;"><div style="font-size:13.5px;color:var(--muted);line-height:1.55;">This is genuinely confusing &mdash; and it&rsquo;s worth sitting with honestly. If you were very drunk, you may not fully remember what happened, what you did, or how the other person responded.<br><br>That <b>doesn&rsquo;t mean nothing happened</b>. Memory gaps don&rsquo;t erase impact.</div></div><div style="border:1px solid rgba(255,160,80,.30);background:rgba(255,120,40,.06);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.85);margin-bottom:8px;">Two things can be true at once</div><div style="font-size:13.5px;color:var(--sb-light);line-height:1.55;"><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(255,160,80,.40);margin-bottom:8px;"><b>You were impaired</b> &mdash; your judgment was affected, you may have acted in ways you wouldn&rsquo;t sober, and the experience may feel foggy or disjointed.</div><div style="padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.18);border-left:3px solid rgba(21,255,200,.40);"><b>You may still have caused harm</b> &mdash; even if unintentionally. Your impairment explains your choices but doesn&rsquo;t remove the impact on the other person.</div></div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:8px;">If you don&rsquo;t remember clearly</div><div style="font-size:13px;color:var(--muted);line-height:1.55;">Don&rsquo;t fill in the blanks with the version that makes you feel best. If there are gaps, those gaps mean uncertainty &mdash; and uncertainty should make you more accountable, not less.<br><br>Ask yourself: <em>Given what I do remember, is there any chance they weren&rsquo;t okay with what happened?</em> If the answer is &ldquo;maybe&rdquo; &mdash; that &ldquo;maybe&rdquo; deserves your full attention.</div></div><div class="note" style="border-color:rgba(21,255,200,.40);background:rgba(21,255,200,.06);"><b>Going forward:</b> If you regularly drink to the point where you can&rsquo;t remember your actions or read consent signals, that&rsquo;s a pattern worth examining &mdash; not just for others&rsquo; safety, but for your own.</div></div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="B_signal_check">Check the signals &rarr;</button><button class="btn" data-action="B_bac">Understand impairment levels</button></div>';
  actions.B_signal_check = function(){go("B_signal_check");};
  actions.B_bac = function(){go("B_bac_awareness");};
  return;
}

// ===== Drugs involved =====
if(id==="B_drugs"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Substances</div><div class="h1">Other substances were involved.</div></div><div style="display:flex;flex-direction:column;gap:12px;"><div style="border:1px solid rgba(255,160,80,.30);background:rgba(255,120,40,.06);border-radius:14px;padding:14px;"><div style="font-size:13.5px;color:var(--sb-light);line-height:1.55;">Everything that applies to alcohol applies to other substances &mdash; often <b>more intensely</b>. Many drugs impair consent capacity in ways that are harder to detect from the outside.</div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:10px;">How different substances affect consent</div><div style="font-size:13px;color:var(--muted);line-height:1.55;display:flex;flex-direction:column;gap:8px;"><div style="padding:10px 12px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(209,254,255,.10);"><b style="color:var(--sb-light);">Weed/Cannabis:</b> Can cause passivity, dissociation, or a sense of detachment. Someone may &ldquo;go along&rdquo; with things without actively choosing them. High doses can impair judgment similarly to alcohol.</div><div style="padding:10px 12px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(209,254,255,.10);"><b style="color:var(--sb-light);">MDMA/Molly:</b> Creates intense feelings of connection and lowered boundaries. Decisions made on MDMA may not reflect sober preferences. The euphoria can mask discomfort and override normal caution.</div><div style="padding:10px 12px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(209,254,255,.10);"><b style="color:var(--sb-light);">Benzodiazepines/Xanax:</b> Dramatically impair memory formation and decision-making. Someone on benzos may appear more functional than they are. Memory blackouts are common even at moderate doses.</div><div style="padding:10px 12px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(209,254,255,.10);"><b style="color:var(--sb-light);">Alcohol + anything:</b> Combining substances multiplies impairment unpredictably. Two drinks plus a Xanax can create incapacitation. Don&rsquo;t assume you can gauge impairment based on the amount of one substance alone.</div></div></div><div class="note" style="border-color:rgba(255,100,60,.45);background:rgba(255,80,40,.06);"><b>The standard is the same:</b> If someone&rsquo;s capacity to understand, communicate, or choose freely was diminished by any substance, consent may not have been present &mdash; regardless of what they said or did while under the influence.</div></div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="B_signal_check">Check the signals &rarr;</button><button class="btn" data-action="B_myths">Common myths about substances &amp; consent</button></div>';
  actions.B_signal_check = function(){go("B_signal_check");};
  actions.B_myths = function(){go("B_myths");};
  return;
}

// ===== Spiked / drugged =====
if(id==="B_spiked"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,100,60,.85);">Alcohol &amp; Substances</div><div class="h1">&#9888;&#65039; Possible drink spiking.</div></div><div style="display:flex;flex-direction:column;gap:12px;"><div style="border:1px solid rgba(255,80,60,.40);background:rgba(255,60,40,.08);border-radius:14px;padding:14px;"><div style="font-size:13.5px;color:var(--sb-light);line-height:1.55;">If you suspect the other person was drugged &mdash; whether by you, by someone else, or unknowingly &mdash; this is an <b>extremely serious situation</b>.</div></div><div style="border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.16);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.55);margin-bottom:8px;">Signs of drink spiking</div><div style="font-size:13px;color:var(--muted);line-height:1.55;display:flex;flex-direction:column;gap:6px;"><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,80,60,.50);">Sudden, extreme intoxication that doesn&rsquo;t match how much they drank</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,80,60,.50);">Loss of coordination or consciousness after just one or two drinks</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,80,60,.50);">Confusion, disorientation, or memory loss disproportionate to consumption</div><div style="padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);border-left:3px solid rgba(255,80,60,.50);">Nausea or vomiting that doesn&rsquo;t match the amount consumed</div></div></div><div style="border:1px solid rgba(21,255,200,.30);background:rgba(21,255,200,.06);border-radius:14px;padding:14px;"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:var(--sb-mint);margin-bottom:8px;">If you witnessed this and didn&rsquo;t intervene</div><div style="font-size:13px;color:var(--sb-light);line-height:1.55;">If you noticed these signs and sexual activity happened anyway &mdash; whether you were involved or someone else was &mdash; that&rsquo;s a situation that required intervention. Going forward, bystander action is critical: get them to safety, don&rsquo;t leave them alone, and call for help.<br><br>If <b>you</b> drugged someone&rsquo;s drink, that is a criminal act. This tool is not a substitute for legal accountability in that situation.</div></div></div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="toEmotion">Continue to reflection &rarr;</button></div>';
  actions.toEmotion = function(){go("emotion");};
  return;
}

// ===== BAC Awareness interactive gauge =====
if(id==="B_bac_awareness"){
  screen.innerHTML = backBtn() + '<div class="dsHeader"><div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div><div class="h1">Understanding Impairment</div><div class="p" style="margin-bottom:0;">This isn&rsquo;t about exact BAC numbers &mdash; it&rsquo;s about recognizing how impairment affects a person&rsquo;s ability to consent.</div></div><div class="bacGauge"><div style="display:flex;align-items:center;justify-content:space-between;gap:10px;"><div style="font-weight:900;font-size:13px;letter-spacing:.2px;">Impairment Level</div><div id="bacLevelLabel" style="font-weight:900;font-size:12px;color:var(--sb-light);padding:5px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.18);">Slide to explore</div></div><div class="bacBar"><div class="bacFill" id="bacFill" style="width:10%;background:rgba(21,255,200,.70);"></div></div><input class="bacSlider" id="bacSlider" type="range" min="0" max="4" step="1" value="0" aria-label="Set impairment level" /><div class="bacLabels"><span>Sober</span><span>Buzzed</span><span>Tipsy</span><span>Drunk</span><span>Incapacitated</span></div><div class="bacZone" id="bacZone" style="border:1px solid rgba(21,255,200,.30);background:rgba(21,255,200,.06);"><div class="bacConsentTag" id="bacConsentTag" style="background:rgba(21,255,200,.15);border:1px solid rgba(21,255,200,.40);color:var(--sb-mint);">Consent possible</div><div id="bacDesc" style="font-size:13px;color:var(--sb-light);line-height:1.5;"><b>Sober:</b> Clear judgment, full awareness of surroundings and partner. This is where consent is most reliable.</div></div></div><div class="note" style="border-color:rgba(255,160,80,.45);background:rgba(255,120,40,.06);"><b>The key insight:</b> There&rsquo;s no exact drink count that flips a switch. But the further right that slider goes, the less reliable consent becomes &mdash; and the more responsibility falls on the more sober person to <em>stop</em>.</div><div class="grid" style="margin-top:14px;"><button class="btn btnPrimary" data-action="B_signal_check">Check the signals &rarr;</button><button class="btn" data-action="goBack">&larr; Back</button></div>';

  (function(){
    var slider=document.getElementById("bacSlider"),fill=document.getElementById("bacFill"),zone=document.getElementById("bacZone"),tag=document.getElementById("bacConsentTag"),desc=document.getElementById("bacDesc"),label=document.getElementById("bacLevelLabel");
    if(!slider) return;
    var L=[
      {p:"10%",f:"rgba(21,255,200,.70)",b:"rgba(21,255,200,.30)",bg:"rgba(21,255,200,.06)",tb:"rgba(21,255,200,.15)",tbd:"rgba(21,255,200,.40)",tc:"var(--sb-mint)",tt:"Consent possible",l:"Sober",d:"<b>Sober:</b> Clear judgment, full awareness of surroundings and partner. This is where consent is most reliable. All signals can be read and given clearly."},
      {p:"30%",f:"rgba(180,220,80,.70)",b:"rgba(180,220,80,.30)",bg:"rgba(180,220,80,.06)",tb:"rgba(180,220,80,.15)",tbd:"rgba(180,220,80,.40)",tc:"rgba(200,240,100,.95)",tt:"Consent possible \u2014 with care",l:"Buzzed",d:"<b>Buzzed:</b> Slightly lowered inhibitions, relaxed. Judgment mostly intact but subtle cues harder to read. Consent is still possible, but check-ins matter more."},
      {p:"55%",f:"rgba(255,200,60,.75)",b:"rgba(255,200,60,.30)",bg:"rgba(255,200,60,.06)",tb:"rgba(255,200,60,.15)",tbd:"rgba(255,200,60,.40)",tc:"rgba(255,220,100,.95)",tt:"Gray zone \u2014 real caution needed",l:"Tipsy",d:"<b>Tipsy:</b> Judgment noticeably impaired. More impulsive, louder, less coordinated. Decisions made here may not reflect sober preferences. <b>This is where things start getting risky.</b> Slow down. Ask clearly. Watch for hesitation."},
      {p:"78%",f:"rgba(255,120,60,.80)",b:"rgba(255,100,60,.35)",bg:"rgba(255,100,60,.06)",tb:"rgba(255,100,60,.15)",tbd:"rgba(255,100,60,.40)",tc:"rgba(255,160,120,.95)",tt:"Consent cannot be trusted",l:"Drunk",d:"<b>Drunk:</b> Slurred speech, stumbling, difficulty with basic tasks. Emotional volatility, severely impaired judgment. A &ldquo;yes&rdquo; at this level is not meaningful &mdash; they do not have the clarity to understand what they&rsquo;re agreeing to. Do not proceed."},
      {p:"100%",f:"rgba(200,50,30,.80)",b:"rgba(200,50,30,.40)",bg:"rgba(200,50,30,.06)",tb:"rgba(200,50,30,.20)",tbd:"rgba(200,50,30,.50)",tc:"rgba(255,140,120,.95)",tt:"Consent is not possible",l:"Incapacitated",d:"<b>Incapacitated:</b> Passed out, in and out of consciousness, unable to walk or speak coherently, vomiting. <b>A person in this state cannot consent &mdash; period.</b> Any sexual activity with an incapacitated person is assault."}
    ];
    slider.addEventListener("input",function(){var v=parseInt(slider.value),o=L[v];fill.style.width=o.p;fill.style.background=o.f;zone.style.borderColor=o.b;zone.style.background=o.bg;tag.style.background=o.tb;tag.style.borderColor=o.tbd;tag.style.color=o.tc;tag.textContent=o.tt;desc.innerHTML=o.d;label.textContent=o.l;});
  })();
  actions.B_signal_check = function(){go("B_signal_check");};
  return;
}

// ===== Signal Check =====
if(id==="B_signal_check"){
  var alcSteps = ['basics','scenario','deep','signals','myths','plan'];
  var alcStep = 3;
  var alcDots = alcSteps.map(function(_,i){return '<div class="alcDot '+(i<alcStep?'done':'')+' '+(i===alcStep?'active':'')+'"></div>';}).join('');

  var SIGNALS = [
    { id:"slur", text:"They were slurring their words or having trouble speaking" },
    { id:"walk", text:"They were stumbling or couldn\u2019t walk steadily" },
    { id:"eyes", text:"Their eyes were glazed, unfocused, or they were drifting in and out" },
    { id:"know", text:"They seemed confused about where they were or what was happening" },
    { id:"pass", text:"They passed out, fell asleep, or were in and out of consciousness" },
    { id:"vomit", text:"They were vomiting or nauseous" },
    { id:"mood", text:"Their mood was swinging dramatically (crying, then laughing, then confused)" },
    { id:"init", text:"I was the one who initiated or escalated things" },
    { id:"ask", text:"I didn\u2019t ask clearly \u2014 I assumed or read signals" },
    { id:"cont", text:"I noticed hesitation or uncertainty and continued anyway" }
  ];

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div>
      <div class="h1">Honest Signal Check</div>
      <div class="p" style="margin-bottom:0;">Tap each one that was true. This is for you \u2014 nobody else sees it.</div>
    </div>
    <div class="alcProgress">${alcDots}</div>

    <div class="alcSignalGrid" id="alcSignalGrid">
      ${SIGNALS.map(function(s){ return '<button class="alcSignal" data-sig="'+s.id+'"><span class="alcSignalCheck"></span><span>'+s.text+'</span></button>'; }).join('')}
    </div>

    <div class="alcResultBox" id="alcResult"></div>

    <div class="grid" style="margin-top:14px;">
      <button class="btn btnPrimary" data-action="B_myths">Myths about alcohol &amp; consent \u2192</button>
      <button class="btn" data-action="B_safety_plan">Skip to safety plan</button>
    </div>
  `;

  (function(){
    var grid = document.getElementById("alcSignalGrid");
    var result = document.getElementById("alcResult");
    if(!grid) return;
    var checked = {};

    grid.addEventListener("click", function(e){
      var btn = e.target.closest(".alcSignal");
      if(!btn) return;
      var sig = btn.dataset.sig;
      if(checked[sig]){ delete checked[sig]; btn.classList.remove("checked"); btn.querySelector(".alcSignalCheck").innerHTML=""; }
      else { checked[sig]=true; btn.classList.add("checked"); btn.querySelector(".alcSignalCheck").innerHTML="\u2713"; }

      var keys = Object.keys(checked);
      var n = keys.length;
      var hasPhysical = ["slur","walk","eyes","know","pass","vomit","mood"].some(function(s){return checked[s];});
      var hasBehavior = ["init","ask","cont"].some(function(s){return checked[s];});

      if(n === 0){ result.classList.remove("show"); return; }

      result.classList.add("show");

      if(n >= 5 || checked["pass"]){
        result.style.borderColor = "rgba(200,50,30,.45)";
        result.style.background = "rgba(200,50,30,.08)";
        result.innerHTML = "<div style='font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,140,100,.85);margin-bottom:8px;'>Multiple signals present</div><div style='color:var(--sb-light);line-height:1.55;'>With this many indicators, there\u2019s a strong possibility consent wasn\u2019t present. This is something to take seriously \u2014 not to explain away. The next step is accountability, not rationalization.</div>";
      } else if(n >= 3 || (hasPhysical && hasBehavior)){
        result.style.borderColor = "rgba(255,160,80,.40)";
        result.style.background = "rgba(255,140,60,.07)";
        result.innerHTML = "<div style='font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.85);margin-bottom:8px;'>Significant concern</div><div style='color:var(--sb-light);line-height:1.55;'>Several signals suggest the situation wasn\u2019t as clear as it may have seemed in the moment. When impairment signs overlap with you initiating or not checking in clearly, the responsibility to have paused was on you.</div>";
      } else if(hasBehavior){
        result.style.borderColor = "rgba(255,200,80,.35)";
        result.style.background = "rgba(255,200,80,.06)";
        result.innerHTML = "<div style='font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,220,120,.85);margin-bottom:8px;'>Behavioral signals</div><div style='color:var(--sb-light);line-height:1.55;'>Even without obvious physical impairment signs, initiating without clear consent or continuing past hesitation means the interaction may not have been consensual. These behavioral patterns are the ones you have the most control over changing.</div>";
      } else {
        result.style.borderColor = "rgba(255,180,100,.30)";
        result.style.background = "rgba(255,160,80,.05)";
        result.innerHTML = "<div style='font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.75);margin-bottom:8px;'>Some indicators present</div><div style='color:var(--sb-light);line-height:1.55;'>Some physical impairment was present. Even one or two of these signs should have been a reason to slow down and check in clearly \u2014 or to stop entirely. Consider what you noticed at the time vs. what you chose to do.</div>";
      }
    });
  })();

  actions.B_myths = ()=>go("B_myths");
  actions.B_safety_plan = ()=>go("B_safety_plan");
  return;
}

// ===== Myths about alcohol and consent =====
if(id==="B_myths"){
  var alcSteps2 = ['basics','scenario','deep','signals','myths','plan'];
  var alcStep2 = 4;
  var alcDots2 = alcSteps2.map(function(_,i){return '<div class="alcDot '+(i<alcStep2?'done':'')+' '+(i===alcStep2?'active':'')+'"></div>';}).join('');

  var MYTHS = [
    { statement:"\u201CIf they chose to drink, they accepted the risk.\u201D", verdict:"false", verdictLabel:"False", explain:"Choosing to drink is not choosing to be assaulted. People consent to consuming alcohol \u2014 not to sexual activity they can\u2019t meaningfully agree to while impaired. Blaming someone for being assaulted because they were drinking is the same logic as blaming someone for being robbed because they had money." },
    { statement:"\u201CDrunk sex is always assault.\u201D", verdict:"partial", verdictLabel:"Not quite", explain:"Two people who\u2019ve had a couple drinks and enthusiastically choose to be together isn\u2019t automatically assault. The issue is when one person\u2019s impairment means they can\u2019t genuinely consent \u2014 or when one person is significantly more impaired than the other. Context, capacity, and who initiated all matter." },
    { statement:"\u201CIf they didn\u2019t say no, they consented.\u201D", verdict:"false", verdictLabel:"False", explain:"Alcohol can make it harder or impossible to say no \u2014 or to say anything at all. Silence, going limp, freezing, or not resisting are not consent. Consent is the presence of a clear yes \u2014 not the absence of a no." },
    { statement:"\u201CIf I was drunk too, I can\u2019t be held responsible.\u201D", verdict:"false", verdictLabel:"False", explain:"Your intoxication explains your impaired judgment but doesn\u2019t remove your responsibility. We don\u2019t accept \u201CI was drunk\u201D as a defense for drunk driving \u2014 and the same principle applies here. The person who initiates or escalates carries greater accountability for ensuring consent exists." },
    { statement:"\u201CThey were flirting / came back to my room \u2014 that\u2019s consent.\u201D", verdict:"false", verdictLabel:"False", explain:"Flirting, dancing, kissing, or going somewhere private are not consent to sex. Each escalation requires its own agreement. Being somewhere alone with someone, regardless of what came before, is never blanket consent for anything beyond what\u2019s been clearly agreed to." },
    { statement:"\u201CIf they don\u2019t remember, it doesn\u2019t matter.\u201D", verdict:"false", verdictLabel:"False", explain:"Memory loss from intoxication doesn\u2019t erase what happened \u2014 it actually makes it worse. If someone was too intoxicated to form memories, they were almost certainly too intoxicated to consent. The fact that they can\u2019t recall the experience doesn\u2019t diminish the harm." },
  ];

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div>
      <div class="h1">Myths vs. Reality</div>
      <div class="p" style="margin-bottom:0;">Tap each to see the truth. These are the rationalizations that let harm continue.</div>
    </div>
    <div class="alcProgress">${alcDots2}</div>

    <div class="alcMythStack" id="alcMythStack">
      ${MYTHS.map(function(m,i){ return '<div class="alcMyth" data-mi="'+i+'"><div class="alcMythFront"><div class="alcMythStatement">'+m.statement+'</div><div class="alcMythTap">Tap to reveal \u2192</div></div><div class="alcMythBack"><div class="alcMythVerdict '+m.verdict+'">'+m.verdictLabel+'</div><div class="alcMythExplain">'+m.explain+'</div></div></div>'; }).join('')}
    </div>

    <div class="grid" style="margin-top:14px;">
      <button class="btn btnPrimary" data-action="B_safety_plan">Build a safety plan \u2192</button>
    </div>
  `;

  setTimeout(function(){
    document.querySelectorAll('#alcMythStack .alcMyth').forEach(function(el){
      el.addEventListener('click', function(){ el.classList.add('open'); });
    });
  }, 0);

  actions.B_safety_plan = ()=>go("B_safety_plan");
  return;
}

// ===== Safety Plan =====
if(id==="B_safety_plan"){
  var alcSteps3 = ['basics','scenario','deep','signals','myths','plan'];
  var alcStep3 = 5;
  var alcDots3 = alcSteps3.map(function(_,i){return '<div class="alcDot '+(i<alcStep3?'done':'')+' '+(i===alcStep3?'active':'')+'"></div>';}).join('');

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow" style="color:rgba(255,180,100,.85);">Alcohol &amp; Consent</div>
      <div class="h1">Your Safety Plan</div>
      <div class="p" style="margin-bottom:0;">Concrete commitments \u2014 not abstract rules. Pick the ones you\u2019ll actually do.</div>
    </div>
    <div class="alcProgress">${alcDots3}</div>

    <div style="display:flex;flex-direction:column;gap:10px;">

      <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.70);margin-bottom:2px;">Before drinking</div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);">
        <span style="font-size:20px;flex-shrink:0;">\uD83E\uDDE0</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">Set a personal line</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">Decide before the night: \u201CI won\u2019t initiate anything sexual if either of us has been drinking heavily.\u201D Make this decision sober \u2014 it\u2019s almost impossible to make it well once you\u2019re impaired.</div>
        </div>
      </div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);">
        <span style="font-size:20px;flex-shrink:0;">\uD83D\uDC65</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">Tell a friend your plan</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">Ask a friend to check you. \u201CIf I\u2019m trying to go home with someone and we\u2019re both wasted, pull me aside.\u201D Accountability buddies work \u2014 use them.</div>
        </div>
      </div>

      <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.70);margin-top:8px;margin-bottom:2px;">During the night</div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);">
        <span style="font-size:20px;flex-shrink:0;">\u23F8\uFE0F</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">The pause test</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">Before escalating anything physical, stop and ask yourself: \u201CWould I be comfortable with this exact situation being reviewed tomorrow by someone I respect?\u201D If not \u2014 stop.</div>
        </div>
      </div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);">
        <span style="font-size:20px;flex-shrink:0;">\uD83D\uDD0D</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">Read the room \u2014 not the words</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">A drunk \u201Csure\u201D is not the same as a sober, enthusiastic yes. Watch for what their body and energy are doing, not just what they\u2019re saying. If there\u2019s a mismatch \u2014 trust the body language.</div>
        </div>
      </div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(255,180,100,.22);background:rgba(255,140,60,.05);">
        <span style="font-size:20px;flex-shrink:0;">\u270B</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">Uncertainty = stop</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">If you find yourself asking \u201Care they too drunk?\u201D \u2014 that question <em>is</em> the answer. The safest move is always to stop, make sure they\u2019re safe, and revisit when everyone is sober.</div>
        </div>
      </div>

      <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,180,100,.70);margin-top:8px;margin-bottom:2px;">The longer game</div>

      <div style="display:flex;align-items:flex-start;gap:12px;padding:14px;border-radius:14px;border:1px solid rgba(21,255,200,.22);background:rgba(21,255,200,.05);">
        <span style="font-size:20px;flex-shrink:0;">\uD83D\uDD04</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:var(--sb-light);margin-bottom:4px;">Examine your own pattern</div>
          <div style="font-size:12.5px;color:var(--muted);line-height:1.5;">If your sexual encounters frequently involve heavy drinking, ask yourself why. Is alcohol a social lubricant \u2014 or is it what makes escalation possible? If you can only initiate when drunk, that\u2019s worth exploring honestly.</div>
        </div>
      </div>
    </div>

    <div id="drThought" style="text-align:center;padding:22px 18px 18px;border-radius:18px;border:1px solid rgba(209,254,255,.14);background:rgba(0,0,0,.18);margin-top:16px;cursor:pointer;transition:border-color .2s ease,background .2s ease,opacity .4s ease;user-select:none;-webkit-tap-highlight-color:transparent;">
      <div style="font-size:11px;font-weight:900;letter-spacing:.5px;text-transform:uppercase;color:rgba(209,254,255,.38);margin-bottom:12px;">The thought in your head</div>
      <div style="font-size:20px;font-weight:900;line-height:1.4;color:rgba(209,254,255,.90);">&ldquo;Were they too drunk?&rdquo;</div>
      <div id="drCta" style="margin-top:14px;font-size:12px;color:rgba(255,180,100,.70);font-weight:800;letter-spacing:.2px;">Tap to see what this question means &#8594;</div>
    </div>

    <div id="drStopWrap" style="display:none;text-align:center;margin-top:14px;">
      <div id="drStop" style="display:inline-block;transform:scale(0) rotate(-15deg);transition:transform .55s cubic-bezier(.22,1.3,.36,1);filter:drop-shadow(0 0 18px rgba(200,50,30,.40)) drop-shadow(0 8px 24px rgba(0,0,0,.50));">
        <svg width="140" height="140" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
          <polygon points="47,4 113,4 156,47 156,113 113,156 47,156 4,113 4,47" fill="url(#stopGrad2)" />
          <polygon points="47,4 113,4 156,47 156,113 113,156 47,156 4,113 4,47" fill="none" stroke="white" stroke-width="5.5" transform="scale(0.865) translate(12,12)" />
          <text x="80" y="88" text-anchor="middle" dominant-baseline="middle" font-family="ui-sans-serif,system-ui,-apple-system,Arial,sans-serif" font-weight="900" font-size="36" letter-spacing="3" fill="white">STOP</text>
          <defs><linearGradient id="stopGrad2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#C0392B"/><stop offset="100%" stop-color="#922B21"/></linearGradient></defs>
        </svg>
      </div>
      <div id="drStopLabel" style="margin-top:12px;font-size:13px;font-weight:800;color:rgba(255,160,120,.85);opacity:0;transition:opacity .4s ease .3s;line-height:1.5;">
        That question <em>is</em> the answer.<br>
        <span style="font-weight:600;color:rgba(209,254,255,.60);">Uncertainty = stop.</span>
      </div>
    </div>

    <div class="grid" style="margin-top:16px;">
      <button class="btn btnPrimary" data-action="toEmotion">Continue to reflection \u2192</button>
    </div>
  `;

  (function(){
    var thought=document.getElementById("drThought");
    var stopWrap=document.getElementById("drStopWrap");
    var stopEl=document.getElementById("drStop");
    var stopLabel=document.getElementById("drStopLabel");
    var cta=document.getElementById("drCta");
    var tapped=false;
    if(!thought) return;
    thought.addEventListener("click",function(){
      if(tapped)return; tapped=true;
      thought.style.opacity=".38"; thought.style.cursor="default"; if(cta) cta.style.display="none";
      stopWrap.style.display="block";
      requestAnimationFrame(function(){requestAnimationFrame(function(){
        stopEl.style.transform="scale(1) rotate(0deg)";
      });});
      setTimeout(function(){stopLabel.style.opacity="1";},420);
    });
  })();

  actions.toEmotion = ()=>go("emotion");
  return;
}

// Keep old B_drinking_rule as redirect
if(id==="B_drinking_rule"){
  go("B_safety_plan");
  return;
}
  // ===== Path C (Pulled away) — Expanded =====
  if(id==="C_pulledAway_signal"){
    screen.innerHTML = backBtn() + `
      <div class="dsHeader">
        <div class="dsEyebrow">BAE Check &mdash; Reading the Moment</div>
        <div class="h1">&#x21A9;&#xFE0F; Pulling away is information.</div>
        <div class="p" style="margin:0;">Nonverbal signals count. Here&rsquo;s why &mdash; and what they mean.</div>
      </div>
      <div class="dsPanel">
        <div class="p" style="margin-top:4px;">
          Not everyone says &ldquo;no&rdquo; out loud. Some people pull away, go still, or disengage because they feel unsure, uncomfortable, or unsafe &mdash; and their body communicates what their words don&rsquo;t.
          <b>This is not ambiguous. It is a signal.</b>
        </div>

        <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.6px; color:rgba(209,254,255,.45); margin:14px 0 8px;">What &ldquo;pulling away&rdquo; can look like</div>
        <div style="display:flex; flex-direction:column; gap:7px; margin-bottom:14px;">
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.03); line-height:1.5;"><span style="flex-shrink:0;">&#x21A9;&#xFE0F;</span><span><b>Turning or shifting their body away</b> &mdash; Physically orienting away from you, even slightly, is the body saying <em>I want distance.</em></span></div>
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.03); line-height:1.5;"><span style="flex-shrink:0;">&#x1F91A;</span><span><b>Removing or redirecting your hands</b> &mdash; Lifting your hand off them, pushing it aside, or moving it somewhere neutral. This is a no in action.</span></div>
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.03); line-height:1.5;"><span style="flex-shrink:0;">&#x1F636;</span><span><b>Going very quiet or still</b> &mdash; If they were engaged and suddenly go silent, flat, or expressionless, something changed. That change matters.</span></div>
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.03); line-height:1.5;"><span style="flex-shrink:0;">&#x1FAE5;</span><span><b>Checking out mentally</b> &mdash; Eyes distant, responses short, body present but person absent. Dissociation is a protective response, not enthusiasm.</span></div>
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.03); line-height:1.5;"><span style="flex-shrink:0;">&#x1F4AA;</span><span><b>Tensing up</b> &mdash; A body that stiffens when touched is not a body welcoming touch. Tension is the nervous system saying <em>this doesn&rsquo;t feel safe.</em></span></div>
        </div>

        <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.06); border-radius:14px; padding:14px; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:8px;">The rationalization that lets people keep going</div>
          <div style="font-size:13px; color:var(--muted); line-height:1.55;">
            <em>&ldquo;They could&rsquo;ve just been shifting position.&rdquo; &ldquo;They didn&rsquo;t say stop.&rdquo; &ldquo;Maybe they were just nervous.&rdquo;</em>
            <br><br>
            These thoughts feel reasonable in the moment &mdash; but they&rsquo;re all reasons to <b>check in</b>, not to keep going. If you noticed something and kept going anyway, that&rsquo;s the part worth sitting with.
          </div>
        </div>

        <div style="border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.06); border-radius:14px; padding:14px; margin-bottom:4px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--sb-mint); margin-bottom:8px;">Why they didn&rsquo;t just say &ldquo;no&rdquo;</div>
          <div style="font-size:13px; color:var(--sb-light); line-height:1.55;">
            Fear of your reaction. Not wanting to ruin the moment. Feeling frozen. Not having the words. Hoping it would stop on its own.
            <br><br>
            Verbal no is not the only valid no. A body that is pulling away, tensing, or going absent is communicating &mdash; and continuing when those signals are present is a consent violation, even if no word was ever spoken.
          </div>
        </div>

        <div style="margin-top:14px;">
          <button class="btn btnPrimary" style="width:100%;" data-action="C1">What to do &rarr;</button>
        </div>
      </div>
    `;
    actions.C1=()=>go("C_pulledAway_script");
    return;
  }

  if(id==="C_pulledAway_script"){
    screen.innerHTML = backBtn() + `
      <div class="dsHeader">
        <div class="dsEyebrow">BAE Check &mdash; Reading the Moment</div>
        <div class="h1">&#x1F6D1; What to do when you notice it</div>
        <div class="p" style="margin:0;">In the moment, and going forward.</div>
      </div>
      <div class="dsPanel">

        <div style="border:1px solid rgba(209,254,255,.18); background:rgba(0,0,0,.20); border-radius:14px; padding:14px; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:10px;">In the moment &mdash; the three-step pause</div>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:flex-start; gap:12px; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(209,254,255,.10);"><span style="flex-shrink:0; width:22px; height:22px; border-radius:50%; background:rgba(21,255,200,.70); color:#041114; font-weight:900; font-size:12px; display:flex; align-items:center; justify-content:center;">1</span><span style="font-size:13px; color:var(--muted); line-height:1.5;"><b>Stop and take your hands/body back.</b> Don&rsquo;t wait to finish. Don&rsquo;t keep going while you think about it. Stop first.</span></div>
            <div style="display:flex; align-items:flex-start; gap:12px; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(209,254,255,.10);"><span style="flex-shrink:0; width:22px; height:22px; border-radius:50%; background:rgba(21,255,200,.70); color:#041114; font-weight:900; font-size:12px; display:flex; align-items:center; justify-content:center;">2</span><span style="font-size:13px; color:var(--muted); line-height:1.5;"><b>Ask a clear, low-pressure check-in.</b> Not &ldquo;are you sure?&rdquo; (which pushes for yes). Just: <em>&ldquo;Hey &mdash; you okay? We can stop.&rdquo;</em></span></div>
            <div style="display:flex; align-items:flex-start; gap:12px; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(209,254,255,.10);"><span style="flex-shrink:0; width:22px; height:22px; border-radius:50%; background:rgba(21,255,200,.70); color:#041114; font-weight:900; font-size:12px; display:flex; align-items:center; justify-content:center;">3</span><span style="font-size:13px; color:var(--muted); line-height:1.5;"><b>Wait. Really wait.</b> Give them silence to respond into. If they hesitate, go quiet, or pull away again &mdash; that&rsquo;s your answer. <b>Stop.</b></span></div>
          </div>
        </div>

        <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.6px; color:rgba(209,254,255,.45); margin:12px 0 8px;">Scripts that actually work</div>
        <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:14px;">
          <div style="padding:10px 12px; border-radius:10px; border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.08); font-size:13px; color:var(--muted); line-height:1.45;"><span style="font-weight:900; font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:var(--sb-mint); display:block; margin-bottom:4px;">&#x2705; Use this</span>&ldquo;Hey &mdash; are you okay? We can totally stop.&rdquo;</div>
          <div style="padding:10px 12px; border-radius:10px; border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.08); font-size:13px; color:var(--muted); line-height:1.45;"><span style="font-weight:900; font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:var(--sb-mint); display:block; margin-bottom:4px;">&#x2705; Use this</span>&ldquo;I want to make sure you&rsquo;re into this. Are you good?&rdquo;</div>
          <div style="padding:10px 12px; border-radius:10px; border:1px solid rgba(255,100,80,.30); background:rgba(255,80,60,.06); font-size:13px; color:var(--muted); line-height:1.45;"><span style="font-weight:900; font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:rgba(255,160,110,.85); display:block; margin-bottom:4px;">&#x274C; Avoid this</span>&ldquo;Are you sure? You seemed into it before.&rdquo; &mdash; This is pressure, not a check-in.</div>
          <div style="padding:10px 12px; border-radius:10px; border:1px solid rgba(255,100,80,.30); background:rgba(255,80,60,.06); font-size:13px; color:var(--muted); line-height:1.45;"><span style="font-weight:900; font-size:11px; text-transform:uppercase; letter-spacing:.4px; color:rgba(255,160,110,.85); display:block; margin-bottom:4px;">&#x274C; Avoid this</span>&ldquo;Why did you pull away? Did I do something wrong?&rdquo; &mdash; Centers your feelings, not theirs.</div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.18); border-radius:14px; padding:14px; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">If this already happened and you kept going</div>
          <div style="font-size:13px; color:var(--muted); line-height:1.55;">
            Noticing it now still matters. The next step isn&rsquo;t to explain or justify it to yourself &mdash; it&rsquo;s to sit with what the other person&rsquo;s experience was.
            They may have felt unheard, unsafe, or like their signals didn&rsquo;t matter. <b>That&rsquo;s the impact, regardless of your intent.</b>
            <br><br>
            Accountability isn&rsquo;t about punishing yourself. It&rsquo;s about understanding what happened clearly enough that it doesn&rsquo;t happen again.
          </div>
        </div>

        <div class="note" style="border-color:rgba(21,255,200,.45); background:rgba(21,255,200,.06); font-size:13px; line-height:1.5;">
          <b>The rule going forward:</b> Consent isn&rsquo;t the absence of a &ldquo;no.&rdquo; It&rsquo;s the presence of an enthusiastic, ongoing yes &mdash; expressed in words <em>and</em> in how someone&rsquo;s body is showing up.
        </div>

        <div style="margin-top:14px;">
          <button class="btn btnPrimary" style="width:100%;" data-action="toEmotion">Continue to reflection &rarr;</button>
        </div>
      </div>
    `;
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch D =====
  if(id==="D_pressure"){
    screen.innerHTML = backBtn() + card(
      "Pressure and persuasion",
      [
        "Repeatedly asking, convincing, bargaining, or emotionally pressuring someone can undermine consent.",
        "If someone agreed only after being worn down — or to avoid conflict — they may not have felt free to choose.",
        "A good rule: if you have to persuade, it’s not a yes. The safest move is to stop and give space."
      ],
      `<details style="margin-top:4px;">
        <summary style="cursor:pointer; font-weight:900; color: var(--sb-light);">Learn More About Why This Happens</summary>
        <div style="margin-top:8px; color: var(--muted); line-height:1.45;">
          Consent depends on freedom to choose. Pressure changes the situation by making “yes” feel like the easiest way to end discomfort, avoid anger, or keep the relationship stable.
          <br><br>
          Even when someone says yes, if it came after repeated persuasion, guilt-tripping, or bargaining, they may have felt they couldn’t say no safely. That’s why “one ask” and accepting no immediately is a safer norm.
        </div>
      </details>`,
      grid(btn("I asked more than once before they agreed","D_attrition","btn btnPrimary") + btn("Continue","toEmotion"))
    );
    actions.D_attrition=()=>go("D_pressure_attrition");
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== Branch D — Wearing down / attrition =====
  if(id==="D_pressure_attrition"){
    screen.innerHTML = backBtn() + card(
      "When “fine” isn’t a yes",
      ["There’s a pattern that’s easy to miss because no single moment feels like pressure — but the pattern as a whole is."],
      null,
      `<div style="display:flex; flex-direction:column; gap:10px; margin:4px 0 14px;">

        <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.07); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:8px;">What this looks like</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            You ask. They hesitate, or say not right now, or change the subject.<br>
            You ask again — maybe a little later, maybe framed differently.<br>
            Eventually they say <em>“fine”</em> or <em>“okay”</em> or just stop resisting.<br><br>
            That’s not a yes. That’s someone giving up on saying no.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">Why it doesn’t feel like pressure</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            Each ask can seem harmless on its own — you weren’t aggressive, you waited, you asked nicely. But the <em>pattern</em> of asking again after a hesitation or soft no changes the dynamic. It teaches the other person: resistance doesn’t end things, it just delays them.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">What “fine” often sounds like</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55; display:flex; flex-direction:column; gap:6px;">
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,160,80,.50);">“Fine, if it means that much to you.”</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,160,80,.50);">“Okay, okay — just stop asking.”</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,160,80,.50);">“I guess.”</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,160,80,.50);">[Stops resisting without ever saying yes]</div>
          </div>
        </div>

        <div style="border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.06); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--sb-mint); margin-bottom:8px;">The rule going forward</div>
          <div style="font-size:13.5px; color:var(--sb-light); line-height:1.55;">
            One ask. If the answer is anything other than a clear, enthusiastic yes — stop. Don’t rephrase it. Don’t wait and try again. A real yes doesn’t need to be extracted.
          </div>
        </div>
      </div>
      ${grid(btn("Continue to reflection","toEmotion","btn btnPrimary"))}`
    );
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch E =====
  if(id==="E_age_power"){
    screen.innerHTML = backBtn() + `
      <div class="h1">⚖️ Power Dynamics & Consent</div>
      <div class="pdIntro">
        Power imbalances don't have to involve physical force or a huge age gap to affect consent.
        When one person has more power — social, emotional, financial, or physical — the other person
        may feel pressure to go along even without being asked directly.<br><br>
        <b>Your first job here:</b> identify the type of power that was in play. That's the only
        way to understand whether the situation was truly voluntary for the other person.
      </div>

      <div style="font-size:11px;font-weight:900;letter-spacing:.7px;text-transform:uppercase;color:rgba(209,254,255,.55);margin-bottom:10px;">Which type of power was at play? Tap to explore.</div>

      <div class="pdTypeGrid" id="pdTypeGrid">
        <button class="pdTypeBtn" data-pd="popularity">
          <span class="pdTypeIcon">🏆</span>
          <span class="pdTypeLabel">Social / Popularity</span>
          <span class="pdTypeSub">Cool, well-known, high status at school or online</span>
        </button>
        <button class="pdTypeBtn" data-pd="athletic">
          <span class="pdTypeIcon">💪</span>
          <span class="pdTypeLabel">Athletic / Physical</span>
          <span class="pdTypeSub">Team captain, respected athlete, physical size</span>
        </button>
        <button class="pdTypeBtn" data-pd="emotional">
          <span class="pdTypeIcon">💔</span>
          <span class="pdTypeLabel">Emotional Dependency</span>
          <span class="pdTypeSub">They needed you, feared losing you, were in crisis</span>
        </button>
        <button class="pdTypeBtn" data-pd="financial">
          <span class="pdTypeIcon">💵</span>
          <span class="pdTypeLabel">Financial / Material</span>
          <span class="pdTypeSub">You paid for things, provided something they needed</span>
        </button>
        <button class="pdTypeBtn" data-pd="age">
          <span class="pdTypeIcon">📅</span>
          <span class="pdTypeLabel">Age / Experience</span>
          <span class="pdTypeSub">Significant age gap, more experience, seemed mature</span>
        </button>
        <button class="pdTypeBtn" data-pd="housing">
          <span class="pdTypeIcon">🏠</span>
          <span class="pdTypeLabel">Housing / Family</span>
          <span class="pdTypeSub">They stayed with you, depended on your family</span>
        </button>
      </div>

      <div id="pdDetailWrap"></div>

      <div id="pdContinueWrap" class="pdContinueWrap">
        <div id="pdWarnBoxInner" class="pdWarnBox" style="display:none;">
          <b>The core principle:</b> When you hold more power, the other person's "yes" carries more weight to verify. The higher the power gap, the more actively you need to check that their consent is real — not just compliance.
        </div>
        <div class="grid" style="margin-top:12px;">
          <button class="btn btnPrimary" data-action="toEmotion">Continue →</button>
        </div>
      </div>
    `;

    const PD_DATA = {
      popularity: {
        icon: "🏆",
        title: "Social status & popularity",
        sub: "When you're well-known, liked, or high-status, others may say yes to avoid being rejected by you or losing access to your social circle.",
        scenarios: [
          { text: "They seemed nervous around you and laughed a lot — even when things got uncomfortable.", reframe: "Nervous laughter and over-agreeableness is a sign of power anxiety, not enthusiasm. Real consent is relaxed and clear." },
          { text: "Mutual friends would know. They may have worried about their reputation if they said no.", reframe: "Social consequences for saying no remove voluntariness from consent. If they couldn't say no without social cost, it wasn't a free yes." },
          { text: "They seemed honoured to get your attention — and went along even though you sensed hesitation.", reframe: "Feeling special isn't the same as wanting the sexual interaction. The honour of being chosen doesn't override the need for genuine consent." }
        ]
      },
      athletic: {
        icon: "💪",
        title: "Athletic status & physical presence",
        sub: "Team status, reputation, and physical size can all create a felt sense of pressure — even when no threat is made.",
        scenarios: [
          { text: "You're significantly bigger or stronger. Even without threatening anyone, physical size changes how safe someone feels saying no.", reframe: "You don't have to threaten someone for physical difference to create pressure. When someone feels physically unsafe to resist, that's coercion by environment." },
          { text: "You're on a team they want to be connected to — or your teammates would know what happened.", reframe: "Reputation pressure is still social coercion. Consent isn't free when saying no risks being labelled or excluded." },
          { text: "They seemed intimidated, quiet, or compliant in a way that felt different from genuine interest.", reframe: "Intimidation-compliance looks like consent but isn't. The question is whether they felt free to say no — not just whether they said it." }
        ]
      },
      emotional: {
        icon: "💔",
        title: "Emotional dependency",
        sub: "When someone is attached to you, in crisis, or afraid of losing you, their 'yes' may be driven by fear of loss rather than genuine desire.",
        scenarios: [
          { text: "They were going through something hard and reached out to you for support. The emotional vulnerability created a dependency.", reframe: "Using someone's vulnerability to advance sexual contact is a serious consent issue. Care and sexual interest are not the same ask." },
          { text: "You had told them — directly or implicitly — that the relationship depended on sex.", reframe: "'If you loved me' or 'if this matters to you' isn't seduction — it's conditional coercion. Consent under threat of abandonment is not free consent." },
          { text: "They were in crisis and you were one of the only people they felt safe with.", reframe: "Crisis dependency removes the neutrality needed for consent. A person who needs you can't easily say no without risking their safety net." }
        ]
      },
      financial: {
        icon: "💵",
        title: "Financial & material power",
        sub: "Paying for things, providing gifts, or covering someone's needs creates obligation dynamics that can undermine freely given consent.",
        scenarios: [
          { text: "You paid for a night out, a trip, or consistent gifts — and both of you knew there was an expectation attached.", reframe: "Financial investment doesn't entitle you to sexual access. If someone felt they 'owed' you, that's transactional pressure, not consent." },
          { text: "They were going through financial difficulty and you provided support — money, transport, housing.", reframe: "When someone is materially dependent on you, saying no risks losing real, practical support. That dependency removes voluntariness." },
          { text: "They seemed to feel obligated rather than willing — like they were repaying a debt.", reframe: "Obligation-compliance isn't desire. Consent has to come from wanting — not from feeling like you've been bought." }
        ]
      },
      age: {
        icon: "📅",
        title: "Age gap & experience",
        sub: "An older, more experienced person shapes the interaction — whether intentionally or not. Age gaps affect both legal and ethical consent.",
        scenarios: [
          { text: "You're significantly older, have more experience, and they likely deferred to your lead throughout.", reframe: "Deference to experience isn't consent — it's a power gradient in action. The person with more experience bears more responsibility for ensuring real mutuality." },
          { text: "They may not have fully understood what they were agreeing to, or what was considered normal.", reframe: "Informed consent requires enough understanding to know what you're consenting to. Experience differences create an information gap — and that's your responsibility to address." },
          { text: "Depending on the ages involved, legal consent thresholds may also apply — regardless of what felt mutual.", reframe: "Check your jurisdiction's age of consent laws. They exist specifically because experience and power differences affect genuine voluntariness — even when both people 'wanted it.'." }
        ]
      },
      housing: {
        icon: "🏠",
        title: "Housing & family dependency",
        sub: "When someone is staying in your space or has nowhere else to go, saying no carries real practical risk for them.",
        scenarios: [
          { text: "They were staying at your place — temporarily, indefinitely, or because things at home were unsafe.", reframe: "When someone depends on your roof, saying no risks losing their housing. That's not a free choice. Power over their basic safety is a massive pressure on consent." },
          { text: "They were connected to your family in a way that made refusal socially complex or risky for them.", reframe: "Family network dependency creates social coercion. Saying no risks relationship disruption, loss of connection, or family conflict — all real stakes." },
          { text: "They were in a vulnerable situation (fleeing abuse, between homes, new in the area) and you provided stability.", reframe: "Providing safety doesn't create entitlement. When someone is in a survival situation, 'no' may simply not feel available to them." }
        ]
      }
    };

    (function initPD(){
      const pgrid = document.getElementById('pdTypeGrid');
      const dWrap = document.getElementById('pdDetailWrap');
      const cWrap = document.getElementById('pdContinueWrap');
      if(!pgrid) return;
      let openType = null;
      pgrid.querySelectorAll('.pdTypeBtn').forEach(function(tbtn){
        tbtn.addEventListener('click', function(){
          const type = tbtn.dataset.pd;
          pgrid.querySelectorAll('.pdTypeBtn').forEach(function(b){ b.classList.remove('selected'); });
          if(openType === type){ openType = null; dWrap.innerHTML = ''; return; }
          openType = type;
          tbtn.classList.add('selected');
          const d = PD_DATA[type];
          dWrap.innerHTML = '<div class="pdDetail"><div class="pdDetailHead"><div class="pdDetailTitle">' + d.icon + ' ' + d.title + '</div><div class="pdDetailSub">' + d.sub + '</div></div><div class="pdScenarioList"><div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(209,254,255,.45);margin-bottom:6px;">Tap each to reveal the reframe</div>' + d.scenarios.map(function(sc,i){ return '<div class="pdScenario" data-i="' + i + '"><div class="pdScText">' + sc.text + '</div><div class="pdScenarioReframe">→ ' + sc.reframe + '</div></div>'; }).join('') + '</div></div>';
          let revealed = 0;
          dWrap.querySelectorAll('.pdScenario').forEach(function(sc){
            sc.addEventListener('click', function(){
              if(!sc.classList.contains('revealed')){
                sc.classList.add('revealed');
                revealed++;
                if(revealed >= 1){
                  const wb = document.getElementById('pdWarnBoxInner');
                  if(wb) wb.style.display='block';
                }
              }
            });
          });
          setTimeout(function(){ dWrap.scrollIntoView({behavior:'smooth',block:'nearest'}); }, 100);
        });
      });
    })();
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch F (Digital) — Entry =====
  if(id==="F_digital"){
    screen.innerHTML = backBtn() + `
      <div class="h1">📱 Something happened digitally</div>
      <div class="p" style="margin-bottom:4px;">Digital consent is real consent. What specifically happened?</div>
      <div class="note" style="margin-bottom:16px; font-size:13px;">
        Choose the option that most closely fits. You can come back and explore others.
      </div>
      <div class="grid">
        <button class="btn" data-action="F_shared" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">📤 I shared or forwarded something</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">Sent, forwarded, or posted photos, videos, or messages without the person's permission</div>
        </button>
        <button class="btn" data-action="F_saved" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">💾 I saved or screenshotted something</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">Saved intimate images or private messages that were shared with me in confidence</div>
        </button>
        <button class="btn" data-action="F_pressured" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">💬 I pressured someone to send images</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">Asked repeatedly, guilted, threatened, or coerced someone into sending sexual content</div>
        </button>
        <button class="btn" data-action="F_posted" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">🌐 I posted about someone's sexual behavior</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">Shared details about someone's sexual activity or body publicly — with or without images</div>
        </button>
        <button class="btn" data-action="F_blackmail" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">⚠️ I used images or info as leverage</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">Threatened to share, or actually shared, intimate content to get something or hurt someone</div>
        </button>
      </div>
      <div style="margin-top:14px; font-size:12px; color:var(--muted); text-align:center; line-height:1.5;">
        Not sure which fits? <button class="btn btnSmall" data-action="F_digital_overview" style="display:inline; width:auto; padding:4px 10px; font-size:12px; margin-left:4px;">Read an overview first</button>
      </div>
    `;
    actions.F_shared   = () => go("F_shared");
    actions.F_saved    = () => go("F_saved");
    actions.F_pressured = () => go("F_pressured");
    actions.F_posted   = () => go("F_posted");
    actions.F_blackmail = () => go("F_blackmail");
    actions.F_digital_overview = () => go("F_digital_overview");
    return;
  }

  // ===== F_digital_overview =====
  if(id==="F_digital_overview"){
    screen.innerHTML = backBtn() + card(
      "Digital consent matters too",
      [
        "Just because something happened on a screen doesn't mean it's less serious. Digital harm is real harm — and in many cases, it's <em>permanent</em>.",
        "Once an image or message is out of your hands, you've lost all control over it. It can be screenshot, forwarded, posted publicly, or used against someone indefinitely. The harm compounds every time it's viewed or shared.",
        "Consent applies to digital content the same way it applies to physical contact. If someone shared something with you privately, that was an act of trust — not an invitation to pass it on.",
      ],
      `<div style="margin:10px 0 14px; background:rgba(21,255,200,.07); border:1px solid rgba(21,255,200,.22); border-radius:12px; padding:12px 14px; font-size:12.5px; color:var(--muted); line-height:1.5;">
        <b style="color:var(--sb-light);">⚖️ A note on the law:</b><br>
        Sharing intimate images without consent is illegal in most U.S. states and many countries — and when minors are involved, it can also be treated as distribution of child sexual abuse material (CSAM), regardless of intent. This isn't meant to scare you — it's information you need to make good decisions about what to do next.
      </div>`,
      grid(btn("← Back to choose what happened","F_digital") + btn("Continue to resources","toEmotion","btn btnPrimary"))
    );
    actions.toEmotion = () => go("emotion");
    actions.F_digital = () => go("F_digital");
    return;
  }

  // ===== F_shared — Sharing or forwarding =====
  if(id==="F_shared"){
    screen.innerHTML = backBtn() + `
      <div class="h1">📤 Sharing without permission</div>
      <div class="p">Forwarding, posting, or sending someone's intimate images or private messages — even once, even to one person — is a serious violation of their privacy and trust.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:8px;">Why this is so harmful</div>
        <div style="font-size:13px; color:var(--muted); line-height:1.5; display:flex; flex-direction:column; gap:6px;">
          <div>🔁 <b style="color:var(--sb-light);">It can never be fully undone.</b> Once shared, you can't control who sees it, saves it, or shares it further. The person loses control permanently.</div>
          <div>😔 <b style="color:var(--sb-light);">The harm compounds.</b> Every new person who sees it is another violation — and the affected person often has no way of knowing how far it spread.</div>
          <div>🏫 <b style="color:var(--sb-light);">It follows people.</b> Images or messages shared among peers can cause lasting damage to someone's reputation, relationships, mental health, and sense of safety.</div>
          <div>⚖️ <b style="color:var(--sb-light);">It may be illegal.</b> Non-consensual intimate image sharing (sometimes called "revenge porn") is illegal in most U.S. states. When minors are involved, it can constitute a federal crime.</div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>Accountability looks like:</b><br>
        Deleting the content from your own device. Reaching out to anyone you sent it to and asking them to delete it immediately (without explaining or involving the affected person further). Not seeking out the content again. If the affected person is someone you know — depending on your relationship — considering whether a sincere, pressure-free apology is appropriate. Not expecting forgiveness.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "But I didn't think it was a big deal at the time..."</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.5;">
          A lot of people share content without thinking it through — especially in group chats where it can feel casual or normalized. The intent doesn't change the impact. What matters now is what you do with this understanding going forward.
          <br><br>
          If you shared something in a moment of anger (like after a breakup), that's sometimes called "revenge porn" — and the motivation matters for understanding why you did it, even though the harm to the other person is the same regardless.
        </div>
      </details>

      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== F_saved — Saving or screenshotting =====
  if(id==="F_saved"){
    screen.innerHTML = backBtn() + `
      <div class="h1">💾 Saving without permission</div>
      <div class="p">If someone sent you intimate images or private messages — and you saved or screenshotted them without their knowledge or consent — that's a violation of the trust they placed in you, even if you haven't shared them with anyone.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:8px;">What makes saving harmful</div>
        <div style="font-size:13px; color:var(--muted); line-height:1.5; display:flex; flex-direction:column; gap:6px;">
          <div>🔒 <b style="color:var(--sb-light);">It removes their control.</b> When someone sends you something in a moment of intimacy or trust, they're not handing you permanent ownership of it. Saving it without asking crosses that boundary.</div>
          <div>⏳ <b style="color:var(--sb-light);">It creates future risk.</b> You now have something that could be shared, leaked, or discovered — even accidentally. Their safety is now at risk in a way they didn't agree to.</div>
          <div>📵 <b style="color:var(--sb-light);">Many platforms have explicit rules against this</b> — and in some places, even possessing intimate images of a minor is a crime, regardless of how they were received.</div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>Accountability looks like:</b><br>
        Deleting it now — not archiving it, not moving it somewhere else. If you're unsure whether what you have of a minor qualifies as something serious, you can contact the <a class="link" href="https://www.missingkids.org/gethelpnow/cybertipline" target="_blank" rel="noopener">NCMEC CyberTipline</a> anonymously. Going forward: if you want to save something someone sends you, ask first.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "They sent it to me — doesn't that mean it's mine?"</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.5;">
          Receiving something doesn't transfer ownership. Think of it like being told a secret — someone sharing it with you doesn't give you the right to tell everyone else, or to keep a recording of it. The same logic applies here.
        </div>
      </details>

      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== F_pressured — Pressuring someone to send images =====
  if(id==="F_pressured"){
    screen.innerHTML = backBtn() + `
      <div class="h1">💬 Pressuring someone to send images</div>
      <div class="p">Asking someone repeatedly, guilting them, threatening consequences, or making them feel like they "owe" you — these are all forms of coercion. An image sent under pressure is not consent.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:10px;">What pressure can look like — even when it doesn't feel like pressure to you</div>
        <div style="font-size:13px; color:var(--muted); line-height:1.5; display:flex; flex-direction:column; gap:8px;">
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);">
            <b style="color:var(--sb-light);">Persistence:</b> "Come on, just this once." "Why not?" "You always do this." Asking more than once after a no — or a hesitation — is pressure.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);">
            <b style="color:var(--sb-light);">Guilt:</b> "I thought you trusted me." "Other people do this." "Fine, I guess you don't care about us." Making someone feel bad for having a limit.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);">
            <b style="color:var(--sb-light);">Threats:</b> "I'll break up with you." "Everyone will think you're a prude." "Then I'll just find someone who will." Even subtle threats carry real weight.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);">
            <b style="color:var(--sb-light);">Conditional affection:</b> Withholding attention, affection, or the relationship itself as leverage.
          </div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>Accountability looks like:</b><br>
        Accepting that you used pressure — even if it didn't feel like it at the time. Not reaching out to ask again. Deleting any content you did receive under those circumstances, and not viewing or sharing it. Reflecting seriously on whether this pattern shows up in other areas of how you treat people.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "I didn't think of it as pressure — I was just being persistent..."</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.5;">
          Persistence that continues after someone declines — or hesitates — is pressure, regardless of the intent. The other person's experience of being asked repeatedly is what matters here, not your read of the tone.
          <br><br>
          Many people were taught that pursuing someone who says no is romantic or shows how much you care. That framing is harmful. Real desire is freely given — not extracted through repeated asking.
        </div>
      </details>

      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== F_posted — Posting about someone's sexual behavior =====
  if(id==="F_posted"){
    screen.innerHTML = backBtn() + `
      <div class="h1">🌐 Posting about someone's sexual behavior</div>
      <div class="p">Sharing details about someone's sexual activity, body, or intimate behavior publicly — even without images — is a form of sexual harm. It can be just as devastating as sharing photos.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:8px;">Why words can be just as harmful as images</div>
        <div style="font-size:13px; color:var(--muted); line-height:1.5; display:flex; flex-direction:column; gap:6px;">
          <div>🗣️ <b style="color:var(--sb-light);">Sexual reputation harm is real.</b> Publicly labeling someone based on their sexual behavior — or sharing what happened between you — can affect how an entire peer group treats them. This kind of social harm can be severe and long-lasting.</div>
          <div>🔍 <b style="color:var(--sb-light);">The internet is permanent.</b> Posts, comments, and even DMs can be screenshotted and spread far beyond the original audience.</div>
          <div>😞 <b style="color:var(--sb-light);">It removes their agency.</b> The person you shared about never agreed to have their private life made public. That decision was taken from them.</div>
          <div>⚖️ <b style="color:var(--sb-light);">In some cases, this can constitute defamation or harassment</b> depending on what was said and how it was shared.</div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>Accountability looks like:</b><br>
        Deleting the post, comment, or message if it's still accessible. Not re-sharing or talking about it further. Resisting the urge to explain yourself publicly (this often makes things worse). Reflecting on what motivated you — anger, entertainment, wanting social status — and whether that motivation is something you want to act on again.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "It was just a comment / it was true / everyone knew anyway..."</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.5;">
          Whether it was true, whether others already knew, whether it was "just" a comment — none of that changes that you chose to amplify it publicly without their consent. The question is: did they choose to make this information public? If not, that choice belonged to them, not you.
        </div>
      </details>

      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== F_blackmail — Using images as leverage =====
  if(id==="F_blackmail"){
    screen.innerHTML = backBtn() + `
      <div class="h1">⚠️ Using images or info as leverage</div>
      <div class="note" style="background:rgba(255,80,80,.08); border-color:rgba(255,80,80,.35); margin-bottom:14px; font-size:13px;">
        This is called <b>sextortion</b> — and it is a serious crime in most places, including under federal law in the United States. If this applies to you, it's important to understand the full weight of what happened.
      </div>
      <div class="p">Threatening to share — or actually sharing — intimate images or private information to get something, cause harm, or control someone's behavior is one of the most severe forms of digital abuse.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:8px;">What makes this different from other digital harm</div>
        <div style="font-size:13px; color:var(--muted); line-height:1.5; display:flex; flex-direction:column; gap:6px;">
          <div>🔒 <b style="color:var(--sb-light);">It's coercive by design.</b> The goal is to make someone comply through fear. That's not just a consent violation — it's a form of abuse and a criminal act.</div>
          <div>💔 <b style="color:var(--sb-light);">The psychological harm is severe.</b> Victims of sextortion report extreme anxiety, depression, social withdrawal, and in some cases, suicidal crisis. This is a life-altering harm.</div>
          <div>⚖️ <b style="color:var(--sb-light);">This is criminal.</b> Extortion, blackmail, and non-consensual intimate image sharing are illegal. Federal law in the U.S. specifically criminalizes sextortion when minors are involved.</div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>Accountability looks like:</b><br>
        Stopping immediately. Deleting the content. Not contacting the person further. Understanding that the harm you've caused is serious and that genuine accountability may require difficult steps — including, depending on the situation, coming forward to an appropriate adult, counselor, or legal resource. <b>This isn't something you should try to navigate alone.</b>
      </div>

      <div style="background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.2); border-radius:12px; padding:12px 14px; margin-bottom:14px; font-size:13px; color:var(--muted); line-height:1.5;">
        <b style="color:var(--sb-light);">If the person affected is in crisis:</b><br>
        The <a class="link" href="https://www.thorn.org" target="_blank" rel="noopener">Thorn</a> helpline and the <a class="link" href="https://cyberbullying.org" target="_blank" rel="noopener">Cyberbullying Research Center</a> both support survivors of sextortion and image-based abuse. The <a class="link" href="https://www.stopncii.org" target="_blank" rel="noopener">StopNCII</a> platform can help prevent further spread of intimate images without the images needing to be viewed by anyone.
      </div>

      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== Branch G (Coercion) — Entry =====
  if(id==="G_coercion"){
    screen.innerHTML = backBtn() + `
      <div class="h1">🛑 Ignoring a clear 'no'</div>
      <div class="p">A no — spoken clearly — ends the moment. That's not a rule that bends for context, mood, or history. What matters now is understanding exactly what happened, so you can be honest with yourself about it.</div>
      <div class="note" style="margin-bottom:16px; font-size:13px;">
        Before you continue: notice if part of you is already looking for a reason this doesn't fully apply to your situation. That pull toward minimizing is worth paying attention to.
      </div>
      <div style="font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--muted); margin-bottom:10px;">What happened more specifically?</div>
      <div class="grid">
        <button class="btn" data-action="G_verbal_no" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">🗣️ They said no — and I kept going</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">I heard a verbal no and continued anyway, even briefly</div>
        </button>
        <button class="btn" data-action="G_stopped_restarted" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">🔄 I stopped — but then started again</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">I paused when they said no, but re-initiated shortly after without a new yes</div>
        </button>
        <button class="btn" data-action="G_persuaded" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">💬 I kept pushing until they gave in</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">They said no, I negotiated or pressured, and they eventually stopped resisting</div>
        </button>
        <button class="btn" data-action="G_nonverbal" style="text-align:left; padding:14px 16px; border-radius:14px;">
          <div style="font-weight:900; margin-bottom:2px;">😶 Their body was saying no — I ignored it</div>
          <div style="font-size:12px; color:var(--muted); font-weight:500;">No verbal no, but they were tense, silent, pulling away, or clearly not present</div>
        </button>
      </div>
      <div style="margin-top:14px; padding-top:14px; border-top:1px solid rgba(209,254,255,.10);">
        <button class="btn" data-action="G_skip_to_emotion" style="width:100%; text-align:center; color:var(--muted); font-size:13px; font-weight:700; padding:12px;">
          I’m not sure — continue →
        </button>
      </div>
    `;
    actions.G_verbal_no         = () => go("G_verbal_no");
    actions.G_stopped_restarted = () => go("G_stopped_restarted");
    actions.G_persuaded         = () => go("G_persuaded");
    actions.G_nonverbal         = () => go("G_nonverbal");
    actions.G_skip_to_emotion   = () => go("emotion");
    return;
  }

  // ===== G_verbal_no — Heard a verbal no and continued =====
  if(id==="G_verbal_no"){
    screen.innerHTML = backBtn() + `
      <div class="h1">🗣️ Continuing after a verbal no</div>
      <div class="p">Hearing someone say no — and continuing — is sexual assault. That framing may feel harsh, but it's the accurate one. This screen isn't here to make you spiral; it's here to make sure you understand the full weight of what you're sitting with.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:10px;">What you probably told yourself in the moment</div>
        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px; color:var(--muted); line-height:1.5;">
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">"They didn't really mean it."</b> — This is one of the most common rationalizations. But a no doesn't require a second explanation to be real.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">"They were into it before."</b> — Prior consent doesn't carry forward. Consent is given moment to moment and can be withdrawn at any point.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">"I was too caught up to stop."</b> — Being aroused doesn't override someone else's right to stop. The ability to stop is a skill — and it can be built.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">"It was only for a second."</b> — Duration doesn't determine whether a line was crossed. It was crossed the moment you continued after the no.
          </div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>What accountability looks like here:</b><br>
        Owning what happened without qualifying it. Not reaching out to the person to explain or seek reassurance — that centers your needs, not theirs. Telling a trusted adult, counselor, or therapist what happened; this isn't something to process alone. Building the actual skill of stopping — which is covered in the next steps.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">⚖️ On the legal dimension</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.55;">
          Continuing sexual activity after a no is legally defined as sexual assault in most U.S. states and many countries. This doesn't mean you'll be prosecuted — most cases aren't — but it's important that you understand what this is, not a softer version of it. That understanding is part of taking it seriously.
        </div>
      </details>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🧠 Why stopping in the moment is hard — and how to get better at it</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.55;">
          Arousal narrows focus and can make it genuinely harder to register and respond to signals. That's real. But "harder" is not the same as "impossible" — and it's not an excuse, it's a starting point for skill-building.<br><br>
          The skill is practicing pause: building the mental habit of checking in <em>before</em> you're deep in a moment, so the check-in is automatic rather than effortful. It also means accepting that stopping — even when it's frustrating — is non-negotiable, and rehearsing that value when the stakes are low so it's available when they're high.
        </div>
      </details>

      <div class="grid" style="margin-top:4px;"><button class="btn btnPrimary" data-action="toEmotion">Continue →</button></div>
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== G_stopped_restarted — Stopped then re-initiated =====
  if(id==="G_stopped_restarted"){
    screen.innerHTML = backBtn() + `
      <div class="h1">🔄 Stopping — then starting again</div>
      <div class="p">Stopping when someone says no and then re-initiating without a new, clear yes is still a consent violation. The pause doesn't reset things. Their no was still in effect.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:10px;">Why this pattern is particularly important to understand</div>
        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px; color:var(--muted); line-height:1.5;">
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Stopping briefly can feel like compliance</b> — to you. But from the other person's perspective, the no is still there. If they didn't say "actually, yes" — silence or passivity after a pause is not a new yes.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Re-initiating is a test.</b> Whether or not you framed it that way, re-starting after a no communicates: "I'm going to try again and see if the no still holds." That puts pressure on the other person to re-assert a boundary they already set — which is a burden they shouldn't have to carry.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">This pattern can become a habit.</b> If re-initiating has "worked" before — if the person eventually went along with it — that creates a learned behavior that erodes someone's ability to feel like their no is real and permanent.
          </div>
        </div>
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>What accountability looks like here:</b><br>
        Understanding that stopping is only half of it — the other half is not re-initiating until you have an enthusiastic, unambiguous yes. In practice: when someone says no, the answer is to fully disengage and give them space. Not to wait a few minutes and try again. The next move is theirs, not yours.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "But they eventually said yes..."</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.55;">
          A yes that comes after repeated no's — after you re-initiated and the person felt pressure to comply — is not freely given consent. It's capitulation. Someone saying "fine" or going along because they felt they had no other option is not the same as someone genuinely wanting to continue.<br><br>
          This is one of the hardest things to sit with, because from the outside it looked like a yes. But intent and experience are two different things, and the other person's experience is what matters here.
        </div>
      </details>

      <div class="grid" style="margin-top:4px;"><button class="btn btnPrimary" data-action="toEmotion">Continue →</button></div>
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== G_persuaded — Negotiated until they gave in =====
  if(id==="G_persuaded"){
    screen.innerHTML = backBtn() + `
      <div class="h1">💬 Pushing until they gave in</div>
      <div class="p">When someone says no and you argue, negotiate, guilt, or wear them down until they stop resisting — that's coercion. What you received at the end was not consent; it was exhaustion or fear.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:10px;">What persuasion can look like — even when it doesn't feel like coercion</div>
        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px; color:var(--muted); line-height:1.5;">
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Asking "why not?"</b> — Treating their no as the beginning of a negotiation they need to justify. They don't owe you a reason.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Making them feel guilty</b> — "I thought you trusted me." "After everything." "I've been so patient." Framing their boundary as a betrayal.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Wearing them down</b> — Asking the same question multiple times, in different ways, until they run out of energy to keep saying no.
          </div>
          <div style="padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.2);">
            <b style="color:var(--sb-light);">Minimizing</b> — "It's not a big deal." "It'll only take a second." "You're overthinking it." Treating their hesitation as irrational rather than valid.
          </div>
        </div>
      </div>

      <div style="background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.2); border-radius:12px; padding:12px 14px; margin-bottom:14px; font-size:13px; color:var(--muted); line-height:1.5;">
        <b style="color:var(--sb-light);">Why this matters beyond this one moment:</b><br>
        Coercive patterns don't usually stay isolated. If negotiating past a no has "worked" — if the person eventually gave in — it reinforces a behavior that you're likely to repeat. That pattern can define how you relate to people in intimate situations for years if it goes unexamined.
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>What accountability looks like here:</b><br>
        Recognizing that persuasion after a no is not a gray area — it's coercion. Stopping the pattern entirely: when someone says no, that closes the conversation. Not arguing, not guilt-tripping, not re-framing the question. If this has been a consistent pattern, speaking to a counselor or therapist about it — seriously, not as a platitude — is the right next step.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "I genuinely thought they wanted to — they just needed convincing..."</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.55;">
          This belief — that someone's no is actually a hesitant yes waiting to be unlocked — is one of the most harmful myths about sex and consent. It comes from movies, music, and peer culture that romanticize persistence. But in reality, someone who wants to say yes doesn't need to be convinced. The need to convince someone is a signal that the answer is no — not that you need better arguments.
        </div>
      </details>

      <div class="grid" style="margin-top:4px;"><button class="btn btnPrimary" data-action="toEmotion">Continue →</button></div>
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

  // ===== G_nonverbal — Body language said no =====
  if(id==="G_nonverbal"){
    screen.innerHTML = backBtn() + `
      <div class="h1">😶 When the no wasn't said out loud</div>
      <div class="p">Consent isn't only communicated through words. A person who is tense, silent, pulling away, going still, or clearly not present is communicating something — and continuing when those signals are present is a consent violation, even if no verbal no was ever spoken.</div>

      <div style="background:rgba(0,0,0,.2); border:1px solid rgba(209,254,255,.12); border-radius:14px; padding:14px 16px; margin:12px 0;">
        <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:10px;">Non-verbal signals that mean stop</div>
        <div style="display:flex; flex-direction:column; gap:7px; font-size:13px; color:var(--muted); line-height:1.5;">
          <div style="display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04);">
            <span style="flex-shrink:0;">🧊</span>
            <span><b style="color:var(--sb-light);">Going still or tense</b> — A body that stiffens or freezes is not a body that's participating. This is a fear response, not enthusiasm.</span>
          </div>
          <div style="display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04);">
            <span style="flex-shrink:0;">👐</span>
            <span><b style="color:var(--sb-light);">Pulling away or pushing hands off</b> — Physical distancing or redirecting touch is a no in action.</span>
          </div>
          <div style="display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04);">
            <span style="flex-shrink:0;">😶</span>
            <span><b style="color:var(--sb-light);">Going quiet or dissociating</b> — Someone who was engaged and suddenly goes silent, looks away, or seems "elsewhere" is signaling discomfort.</span>
          </div>
          <div style="display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04);">
            <span style="flex-shrink:0;">😬</span>
            <span><b style="color:var(--sb-light);">"Going along" without engagement</b> — Passive compliance — just lying there, not reciprocating, letting it happen — is not the same as wanting it.</span>
          </div>
        </div>
      </div>

      <div style="background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.2); border-radius:12px; padding:12px 14px; margin-bottom:14px; font-size:13px; color:var(--muted); line-height:1.5;">
        <b style="color:var(--sb-light);">Why people don't always say no out loud:</b><br>
        Saying no in the moment is genuinely hard — especially with someone you know, someone you're afraid of upsetting, or when you feel frozen by anxiety or shock. Many people go silent or go still because they don't feel safe enough to speak, or because their body's threat response has taken over. The absence of a verbal no is <em>not</em> a yes.
      </div>

      <div class="note" style="margin-bottom:14px;">
        <b>What accountability looks like here:</b><br>
        Accepting that you were reading for a green light rather than watching for amber or red. Building the habit of treating uncertainty as a stop — not a continue. The rule going forward: if you're not seeing active, enthusiastic participation, pause and check in. Actively. Out loud. "Is this okay?" costs nothing. Continuing without it can cost everything.
      </div>

      <details style="margin-bottom:14px;">
        <summary style="cursor:pointer; font-weight:900; color:var(--sb-light); font-size:13px;">🤔 "How was I supposed to know if they didn't say anything?"</summary>
        <div style="margin-top:8px; color:var(--muted); font-size:13px; line-height:1.55;">
          This is a real question, and it deserves a real answer: you ask. You check in. You slow down when something feels off instead of hoping it isn't.<br><br>
          "I can't read minds" is sometimes true — but it's often used to avoid noticing signals that were there. The signals listed above are not subtle. A body going rigid or still, someone pulling away, someone going silent when they were engaged moments ago — these are noticeable if you're paying attention.<br><br>
          The standard isn't perfection. It's genuine attention and a willingness to stop when you're uncertain.
        </div>
      </details>

      <div class="grid" style="margin-top:4px;"><button class="btn btnPrimary" data-action="toEmotion">Continue →</button></div>
    `;
    actions.toEmotion = () => go("emotion");
    return;
  }

    // ===== New Branch H =====
  if(id==="H_relationship" || id==="H_relationship_ongoing"){
    screen.innerHTML = backBtn() + `
      <div class="h1">Assuming consent in a relationship</div>
      <div class="p">Being in a relationship does not automatically mean consent. Consent is required every time — and it can change moment to moment.</div>
      <div class="note" style="margin-bottom:14px;">If you assumed yes without checking in, the prevention move is to build a new habit: ask clearly, slow down, and respect boundaries right away.</div>
      ${ongoingConsentMarkup()}
      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `;

    // Panel toggle
    (function(){
      const panel  = document.getElementById("ocPanel");
      const header = document.getElementById("ocPanelHeader");
      if(!panel||!header) return;
      function toggle(){
        const open = panel.classList.contains("open");
        panel.classList.toggle("open", !open);
        header.setAttribute("aria-expanded", String(!open));
        if(!open) setTimeout(initOngoingConsentRoad, 50);
      }
      function onKey(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); } }
      header.addEventListener("click", toggle);
      header.addEventListener("keydown", onKey);
      var _prevCleanup = ongoingConsentCleanup;
      ongoingConsentCleanup = function(){
        header.removeEventListener("click", toggle);
        header.removeEventListener("keydown", onKey);
        if(_prevCleanup) _prevCleanup();
        ongoingConsentCleanup = null;
      };
    })();

    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch I =====
  if(id==="I_not_sure_wanted"){
    screen.innerHTML = backBtn() + card(
      "Not sure they wanted it",
      ["That uncertainty is information. The fact that you’re questioning it means something felt off — and that matters."],
      null,
      `<div style="display:flex; flex-direction:column; gap:10px; margin:4px 0 16px;">

        <div style="font-size:13px; color:var(--muted); line-height:1.55; padding: 2px 0 6px;">
          Uncertainty about someone’s desire isn’t a gray area to push through — it’s a signal to stop. Below are three common ways this plays out. See if any feel familiar.
        </div>

        <details style="border:1px solid rgba(209,254,255,.15); border-radius:14px; overflow:hidden; background:rgba(0,0,0,.18);">
          <summary style="cursor:pointer; padding:14px 16px; font-size:13.5px; font-weight:900; color:var(--sb-light); list-style:none; display:flex; justify-content:space-between; align-items:center; gap:8px; user-select:none;">
            <span>They went along but didn’t really engage</span>
            <span style="font-size:18px; color:var(--sb-mint); flex-shrink:0;">﹢</span>
          </summary>
          <div style="padding:0 16px 16px; border-top:1px solid rgba(209,254,255,.09);">
            <div style="margin-top:12px; font-size:13px; color:var(--muted); line-height:1.6;">
              Passive compliance — going still, being quiet, doing the minimum to get through it — is not a yes. People go along for a lot of reasons that have nothing to do with wanting something:
            </div>
            <div style="margin-top:10px; display:flex; flex-direction:column; gap:6px;">
              <div style="padding:7px 11px; border-radius:9px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.22); font-size:12.5px; color:var(--muted); line-height:1.45;">To avoid an argument or an awkward moment</div>
              <div style="padding:7px 11px; border-radius:9px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.22); font-size:12.5px; color:var(--muted); line-height:1.45;">Because they felt frozen and didn’t know how to stop it</div>
              <div style="padding:7px 11px; border-radius:9px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.22); font-size:12.5px; color:var(--muted); line-height:1.45;">Because they were afraid of how you’d react</div>
              <div style="padding:7px 11px; border-radius:9px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.22); font-size:12.5px; color:var(--muted); line-height:1.45;">Because they didn’t feel like they had a real choice</div>
            </div>
            <div style="margin-top:12px; font-size:13px; color:var(--sb-light); line-height:1.55; padding:10px 12px; border-radius:10px; background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.18);">
              <b>Participation is not the same as consent.</b> A body that’s present but disengaged is telling you something — if you were paying attention to them and not just the moment.
            </div>
          </div>
        </details>

        <details style="border:1px solid rgba(209,254,255,.15); border-radius:14px; overflow:hidden; background:rgba(0,0,0,.18);">
          <summary style="cursor:pointer; padding:14px 16px; font-size:13.5px; font-weight:900; color:var(--sb-light); list-style:none; display:flex; justify-content:space-between; align-items:center; gap:8px; user-select:none;">
            <span>I didn’t stop to ask — I assumed</span>
            <span style="font-size:18px; color:var(--sb-mint); flex-shrink:0;">﹢</span>
          </summary>
          <div style="padding:0 16px 16px; border-top:1px solid rgba(209,254,255,.09);">
            <div style="margin-top:12px; font-size:13px; color:var(--muted); line-height:1.6;">
              Assumptions feel like reading the room. They’re not. Assuming someone is okay with something because of how they were dressed, what happened before, how things started, or what’s happened in the past — none of that is consent to <em>this</em> moment.
            </div>
            <div style="margin-top:10px; display:flex; flex-direction:column; gap:7px;">
              <div style="padding:8px 12px; border-radius:10px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,160,80,.35);">
                <div style="font-size:11px; font-weight:700; color:rgba(255,180,100,.75); text-transform:uppercase; letter-spacing:.4px; margin-bottom:3px;">Assumption sounds like</div>
                <div style="font-style:italic; font-size:12.5px; color:var(--muted);">“They didn’t stop me, so I figured it was fine.”</div>
                <div style="font-style:italic; font-size:12.5px; color:var(--muted); margin-top:3px;">“We’d done it before, so I thought they were into it.”</div>
                <div style="font-style:italic; font-size:12.5px; color:var(--muted); margin-top:3px;">“Things were already going that direction.”</div>
              </div>
            </div>
            <div style="margin-top:12px; font-size:13px; color:var(--sb-light); line-height:1.55; padding:10px 12px; border-radius:10px; background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.18);">
              Consent requires a check-in, not just a lack of objection. The absence of “no” is not the presence of “yes.” Asking takes two seconds. Assuming can cause real harm.
            </div>
          </div>
        </details>

        <details style="border:1px solid rgba(209,254,255,.15); border-radius:14px; overflow:hidden; background:rgba(0,0,0,.18);">
          <summary style="cursor:pointer; padding:14px 16px; font-size:13.5px; font-weight:900; color:var(--sb-light); list-style:none; display:flex; justify-content:space-between; align-items:center; gap:8px; user-select:none;">
            <span>I noticed something was off but kept going</span>
            <span style="font-size:18px; color:var(--sb-mint); flex-shrink:0;">﹢</span>
          </summary>
          <div style="padding:0 16px 16px; border-top:1px solid rgba(209,254,255,.09);">
            <div style="margin-top:12px; font-size:13px; color:var(--muted); line-height:1.6;">
              This is the hardest one to sit with — because you already knew. Something shifted. You noticed. And then you kept going anyway.
            </div>
            <div style="margin-top:10px; font-size:13px; color:var(--muted); line-height:1.55; padding:10px 12px; border-radius:10px; background:rgba(255,80,80,.06); border:1px solid rgba(255,100,100,.20);">
              That moment of noticing and continuing is where harm most often happens — not always because of bad intent, but because momentum, desire, and discomfort with stopping all felt easier than pausing.
            </div>
            <div style="margin-top:10px; font-size:13px; color:var(--sb-light); line-height:1.55; padding:10px 12px; border-radius:10px; background:rgba(21,255,200,.06); border:1px solid rgba(21,255,200,.18);">
              The fact that you noticed means your instincts were working. Using this moment to understand that — and committing to stopping when you notice next time — is what real accountability looks like.
            </div>
          </div>
        </details>

        <div style="margin-top:6px; border-radius:16px; overflow:hidden; border:1.5px solid rgba(21,255,200,.45); background: linear-gradient(160deg, rgba(21,255,200,.10), rgba(19,132,143,.08));">
          <div style="padding:14px 16px 12px; border-bottom:1px solid rgba(21,255,200,.18);">
            <div style="font-size:10px; font-weight:900; text-transform:uppercase; letter-spacing:1px; color:var(--sb-mint); margin-bottom:6px;">The Standard</div>
            <div style="font-size:18px; font-weight:900; color:var(--sb-light); line-height:1.2;">Consent should be <em>unmistakable.</em></div>
            <div style="font-size:13px; color:var(--muted); line-height:1.5; margin-top:6px;">Enthusiastic consent isn’t a technicality or a checklist — it’s a <b>feeling in the room.</b> When someone genuinely wants something, you know. They’re present, engaged, and an active participant — not just someone who didn’t say stop.</div>
          </div>
          <div style="padding:14px 16px; display:flex; flex-direction:column; gap:7px;">
            <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.50); margin-bottom:2px;">What it actually looks like</div>
            <div style="padding:8px 12px; border-radius:9px; background:rgba(21,255,200,.07); border-left:3px solid rgba(21,255,200,.50); font-size:13px; color:var(--sb-light); line-height:1.45;">They initiate, reciprocate, and stay engaged — not just tolerate</div>
            <div style="padding:8px 12px; border-radius:9px; background:rgba(21,255,200,.07); border-left:3px solid rgba(21,255,200,.50); font-size:13px; color:var(--sb-light); line-height:1.45;">Their body language and words match — there’s no disconnect to explain away</div>
            <div style="padding:8px 12px; border-radius:9px; background:rgba(21,255,200,.07); border-left:3px solid rgba(21,255,200,.50); font-size:13px; color:var(--sb-light); line-height:1.45;">If you paused and asked, they’d say yes clearly — not out of obligation</div>
            <div style="padding:8px 12px; border-radius:9px; background:rgba(21,255,200,.07); border-left:3px solid rgba(21,255,200,.50); font-size:13px; color:var(--sb-light); line-height:1.45;">You don’t have to wonder. You’re not rationalizing. You just <em>know.</em></div>
            <div style="font-size:14px; color:var(--sb-light); font-weight:900; line-height:1.55; padding:13px 16px; border-radius:12px; background:rgba(21,255,200,.14); border:1px solid rgba(21,255,200,.40); text-align:center; margin-top:6px;">
              If you’re asking yourself <em>“did they really want it?”</em><br>— that question <b>is</b> the answer.
            </div>
          </div>
        </div>

      </div>
      ${grid(btn("Continue","toEmotion","btn btnPrimary"))}
    `
    );
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch J =====
  if(id==="J_upset_after"){
    screen.innerHTML = backBtn() + card(
      "They seemed upset afterward",
      [
        "If someone became distant, upset, or quiet afterward, that can be a sign they didn’t feel okay about what happened.",
        "You don’t need them to ‘prove’ anything for their feelings to matter.",
        "Accountability here can look like listening, apologizing without pressure, and respecting whatever boundaries they set."
      ],
      `<details style="margin-top:4px;">
        <summary style="cursor:pointer; font-weight:900; color: var(--sb-light);">Learn More About Why This Happens</summary>
        <div style="margin-top:8px; color: var(--muted); line-height:1.45;">
          Emotional withdrawal after a sexual encounter can be a sign that someone felt unsafe, pressured, or violated — even if they didn’t say so in the moment. People often need time and distance before they can process what happened.
          <br><br>
          Silence afterward isn’t the same as being okay. If someone is distant, quiet, or avoidant, that response deserves to be taken seriously — not explained away or minimized. The most accountable response is to create space, listen without defensiveness, and let them lead.
        </div>
      </details>`,
      grid(btn("They told me directly they were upset","J_told_directly","btn btnPrimary") + btn("They said it was fine, but something still feels off","J_said_fine"))
    );
    actions.toEmotion=()=>go("emotion");
    actions.J_told_directly=()=>go("J_told_directly");
    actions.J_said_fine=()=>go("J_upset_said_fine");
    return;
  }

  // ===== Branch J1 — "They told me directly" =====
  if(id==="J_told_directly"){
    screen.innerHTML = backBtn() + card(
      "They told you. That matters.",
      ["When someone says directly that they were hurt or uncomfortable, they're doing something hard. That deserves a direct response."],
      null,
      `<div style="display:flex; flex-direction:column; gap:10px; margin:4px 0 14px;">

        <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.07); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:8px;">What you've been given</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            A lot of people in this situation never get told directly — they find out through silence, distance, or a third party. You were told. That's information you can actually work with.<br><br>
            The instinct is sometimes to explain, justify, or defend. That's understandable. But the most important thing to do with a direct statement of harm is to <em>receive it</em> before anything else.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">Receiving vs. deflecting</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55; display:flex; flex-direction:column; gap:8px;">
            <div>
              <div style="font-size:11px; font-weight:700; color:rgba(255,100,80,.80); text-transform:uppercase; letter-spacing:.4px; margin-bottom:4px;">Deflecting sounds like</div>
              <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,100,80,.40); font-style:italic;">"But I didn't mean it that way."</div>
              <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,100,80,.40); font-style:italic; margin-top:4px;">"You seemed okay at the time."</div>
              <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(255,100,80,.40); font-style:italic; margin-top:4px;">"Why are you bringing this up now?"</div>
            </div>
            <div>
              <div style="font-size:11px; font-weight:700; color:rgba(21,255,200,.70); text-transform:uppercase; letter-spacing:.4px; margin-bottom:4px;">Receiving sounds like</div>
              <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(21,255,200,.40); font-style:italic;">"Thank you for telling me. I'm sorry you experienced that."</div>
              <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(21,255,200,.40); font-style:italic; margin-top:4px;">"I hear you. I want to understand."</div>
            </div>
          </div>
        </div>

        <div style="border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.06); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--sb-mint); margin-bottom:8px;">What comes next</div>
          <div style="font-size:13.5px; color:var(--sb-light); line-height:1.55;">
            Accountability doesn't require you to accept a version of events you genuinely disagree with. But it does require you to take their experience seriously first — before any explaining, context, or defense.<br><br>
            Your intent matters to you. Their experience is what happened to them. Both can be real at once.
          </div>
        </div>
      </div>
      ${grid(btn("Continue to reflection","toEmotion","btn btnPrimary"))}`
    );
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== Branch J2 — "They said fine but I still feel off" =====
  if(id==="J_upset_said_fine"){
    screen.innerHTML = backBtn() + card(
      "Trust that feeling.",
      ["You're here because something in you noticed a gap between what they said and what you sensed. That's worth taking seriously."],
      null,
      `<div style="display:flex; flex-direction:column; gap:10px; margin:4px 0 14px;">

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">Why "fine" doesn't always mean fine</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            People say "I'm fine" for a lot of reasons — to avoid conflict, to end an uncomfortable conversation, because they're still processing, or because they don't yet have words for what they're feeling.<br><br>
            A verbal "fine" and an emotional resolution are different things. One can exist without the other.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">Signals that something might still be unresolved</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55; display:flex; flex-direction:column; gap:6px;">
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.25);">They said fine quickly, without really engaging</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.25);">Things felt subtly different between you afterward</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.25);">You keep replaying it — your gut is flagging something</div>
            <div style="padding:6px 10px; border-radius:8px; background:rgba(255,255,255,.04); border-left:3px solid rgba(209,254,255,.25);">They changed the subject and you never really talked it through</div>
          </div>
        </div>

        <div style="border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.06); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--sb-mint); margin-bottom:8px;">What to do with this</div>
          <div style="font-size:13.5px; color:var(--sb-light); line-height:1.55;">
            The fact that you're asking the question is already accountability in action. If something feels unresolved, it's okay to gently open the door again.<br><br>
            A low-pressure check-in can sound like: <em>"Hey, I've been thinking about the other night. I want to make sure you're actually okay — not just 'fine.'"</em><br><br>
            Then listen. Don't fill the silence. Let them lead.
          </div>
        </div>
      </div>
      ${grid(btn("Continue to reflection","toEmotion","btn btnPrimary"))}`
    );
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== New Branch K =====
  if(id==="K_not_sure_what"){
    screen.innerHTML = backBtn() + card(
      "Still not sure what happened",
      [
        "Confusion is common — especially when emotions, alcohol, or pressure were involved.",
        "A helpful question: did you check in clearly and get an enthusiastic yes? If not, the safest assumption is that you need stronger consent practices.",
        "You can’t redo the past, but you can choose accountability now: learn, change habits, and avoid repeating harm."
      ],
      `<details style="margin-top:4px;">
        <summary style="cursor:pointer; font-weight:900; color: var(--sb-light);">Learn More About Why This Happens</summary>
        <div style="margin-top:8px; color: var(--muted); line-height:1.45;">
          Confusion after a sexual encounter is common — especially when alcohol, strong emotions, or social pressure were involved. Our brains can struggle to process events clearly in the moment, and certainty often only comes later.
          <br><br>
          If you’re unsure whether something was okay, that uncertainty itself is meaningful. A clear yes — enthusiastic, verbal, and freely given — is something you tend to remember. If you can’t recall that, the accountable move is to take the uncertainty seriously, reflect honestly, and build stronger habits going forward.
        </div>
      </details>`,
      grid(btn("Continue","toEmotion","btn btnPrimary"))
    );
    actions.toEmotion=()=>go("signalBoard");
    return;
  }





  // ===== New Branch L (Asleep) =====
  if(id==="L_asleep"){
    screen.innerHTML = backBtn() + card(
      "When someone is asleep or half-asleep",
      [
        "An asleep person can't consent. A half-asleep person can't consent clearly.",
        "This is true even in an established relationship — ongoing intimacy doesn't create blanket permission."
      ],
      null,
      `<div style="display:flex; flex-direction:column; gap:10px; margin:4px 0 14px;">

        <div style="border:1px solid rgba(255,160,80,.30); background:rgba(255,120,40,.07); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(255,180,100,.85); margin-bottom:8px;">The "we always do this" trap</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            In relationships, it's common to assume that past yeses carry forward — especially for things that have happened many times without objection. But consent needs to be present each time, not borrowed from history.<br><br>
            Even if a partner never explicitly said no to being woken this way, that's not the same as freely agreeing to it. They may have gone along, felt they couldn't object, or not known how to bring it up.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">Why "they didn't stop me" isn't a yes</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            Someone waking up to unwanted touch may freeze, go along to avoid conflict, or feel disoriented and unable to respond clearly. Not stopping you isn't the same as wanting it — it may just be the path of least resistance from a vulnerable state.
          </div>
        </div>

        <div style="border:1px solid rgba(209,254,255,.14); background:rgba(0,0,0,.16); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:rgba(209,254,255,.55); margin-bottom:8px;">If this has happened more than once</div>
          <div style="font-size:13.5px; color:var(--muted); line-height:1.55;">
            If this is a pattern in a relationship, the accountable move is to have an explicit conversation about it — not while it's happening, but at a calm, neutral moment. Ask directly whether your partner is okay with this, and make it safe for them to say no.
          </div>
        </div>

        <div style="border:1px solid rgba(21,255,200,.25); background:rgba(21,255,200,.06); border-radius:14px; padding:14px;">
          <div style="font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; color:var(--sb-mint); margin-bottom:8px;">The standard going forward</div>
          <div style="font-size:13.5px; color:var(--sb-light); line-height:1.55;">
            If you want intimacy to be something that can happen while a partner is waking up, that agreement needs to be made explicitly — when you're both fully awake, clear, and able to say no freely. Without that conversation, the default is: wait until they're awake.
          </div>
        </div>
      </div>
      ${grid(btn("Continue to reflection","toEmotion","btn btnPrimary"))}`
    );
    actions.toEmotion=()=>go("emotion");
    return;
  }

  // ===== Shared emotion + next steps =====
  // ===== Signal Board =====
  if(id==="signalBoard"){
    screen.innerHTML = backBtn() + card(
      "What signals were present?",
      [],
      null,
      `<div class="sbScreen">
        <p class="sbIntro">Before you describe how you feel, take a moment with this.<br>
        <b>Toggle every signal that was present</b> — even if you're not sure it meant anything.</p>

        <div class="sbGrid" id="sbGrid">
          <div class="sbSignal" data-sig="0" data-weight="3">
            <span class="sbSignalEmoji">😶</span>
            <span class="sbSignalLabel">Went quiet or still</span>
            <span class="sbSignalSub">Stopped responding, froze, or became silent</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="1" data-weight="3">
            <span class="sbSignalEmoji">↩️</span>
            <span class="sbSignalLabel">Pulled away physically</span>
            <span class="sbSignalSub">Moved back, turned away, created distance</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="2" data-weight="2">
            <span class="sbSignalEmoji">😐</span>
            <span class="sbSignalLabel">Didn't participate</span>
            <span class="sbSignalSub">Passive, not actively engaged or reciprocating</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="3" data-weight="2">
            <span class="sbSignalEmoji">😬</span>
            <span class="sbSignalLabel">Looked uncomfortable</span>
            <span class="sbSignalSub">Tense body language, avoiding eye contact</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="4" data-weight="2">
            <span class="sbSignalEmoji">🗣️</span>
            <span class="sbSignalLabel">Said "wait" or "stop"</span>
            <span class="sbSignalSub">Any verbal hesitation, even softly or once</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="5" data-weight="3">
            <span class="sbSignalEmoji">😔</span>
            <span class="sbSignalLabel">Seemed upset after</span>
            <span class="sbSignalSub">Quiet, withdrawn, or tearful afterward</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="6" data-weight="1">
            <span class="sbSignalEmoji">🍺</span>
            <span class="sbSignalLabel">Had been drinking</span>
            <span class="sbSignalSub">Either of you had consumed alcohol</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
          <div class="sbSignal" data-sig="7" data-weight="2">
            <span class="sbSignalEmoji">🤐</span>
            <span class="sbSignalLabel">Never gave a clear yes</span>
            <span class="sbSignalSub">No explicit agreement — went along without saying yes</span>
            <span class="sbSignalCheck"><svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 5l2.5 2.5L8 3" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
          </div>
        </div>

        <div class="sbMeterWrap">
          <div class="sbMeterLabel">
            <span class="sbMeterTitle">Signal clarity</span>
            <span class="sbMeterPhrase" id="sbPhrase" style="color:rgba(209,254,255,.40)">No signals selected</span>
          </div>
          <div class="sbMeterTrack">
            <div class="sbMeterFill" id="sbFill"></div>
          </div>
        </div>

        <div class="sbReframe" id="sbReframe">
          <div class="sbReframeTag" id="sbReframeTag">What this means</div>
          <div class="sbReframeInner" id="sbReframeInner">
            Select the signals that were present. Even one changes the picture.
          </div>
        </div>

        <div class="sbCountRow">
          <div class="sbCountPill" id="sbPillCount">0 signals selected</div>
          <div class="sbCountPill" id="sbPillLevel">—</div>
        </div>

        <button class="btn btnPrimary" data-action="toEmotion" style="margin-top:4px; width:100%; padding:13px;">
          Continue to reflection →
        </button>
      </div>`
    );

    // Signal Board logic
    (function initSignalBoard(){
      const LEVELS = [
        { min:0,  max:0,  color:'rgba(209,254,255,.40)', phrase:'No signals selected',
          tag:'', text:'Select the signals that were present. Even one changes the picture.' },
        { min:1,  max:3,  color:'rgba(255,220,100,.80)', phrase:'Some signals present',
          tag:'Worth pausing on',
          text:'<b>At least one signal was there.</b> Even subtle signals — silence, stillness, not participating — are communication. If you noticed them, they mattered.' },
        { min:4,  max:7,  color:'rgba(255,150,60,.90)', phrase:'Multiple clear signals',
          tag:'This needed a check-in',
          text:'<b>Several signals were present at once.</b> When more than one thing feels off, the pattern gets harder to miss. A pause and a direct question — "Are you okay with this?" — was available and needed.' },
        { min:8,  max:11, color:'rgba(255,80,40,.95)', phrase:'Strong cluster of signals',
          tag:'These were not subtle',
          text:'<b>This was a significant cluster of signals.</b> Taken together, these strongly indicate the other person was not freely okay with what was happening. The clearest sign isn\'t always a "no" — sometimes it\'s everything else.' },
        { min:12, max:99, color:'rgba(220,40,40,1.0)', phrase:'Overwhelming signal weight',
          tag:'Unmistakable',
          text:'<b>These signals, together, were unmistakable.</b> Consent wasn\'t present here. Recognizing that — even now — is the first step toward real accountability.' }
      ];

      const signals = document.querySelectorAll('.sbSignal');
      const fill    = document.getElementById('sbFill');
      const phrase  = document.getElementById('sbPhrase');
      const reframe = document.getElementById('sbReframe');
      const rtag    = document.getElementById('sbReframeTag');
      const rtext   = document.getElementById('sbReframeInner');
      const pillCount = document.getElementById('sbPillCount');
      const pillLevel = document.getElementById('sbPillLevel');

      const MAX_WEIGHT = 18; // sum of all weights

      function update(){
        let weight = 0, count = 0;
        signals.forEach(s => {
          if(s.classList.contains('active')){
            weight += parseInt(s.dataset.weight, 10);
            count++;
          }
        });

        const pct = Math.min(100, Math.round((weight / MAX_WEIGHT) * 100));
        fill.style.width = pct + '%';

        // Color gradient: mint → amber → orange → red
        const r = Math.min(255, Math.round(pct * 2.55));
        const g = Math.max(40,  Math.round(255 - pct * 2.0));
        const b = Math.max(30,  Math.round(200 - pct * 2.0));
        fill.style.background = `rgba(${r},${g},${b},.85)`;

        // Pick level
        const level = LEVELS.find(l => weight >= l.min && weight <= l.max) || LEVELS[0];
        phrase.textContent = level.phrase;
        phrase.style.color = level.color;

        if(weight > 0){
          reframe.classList.add('warm');
          rtag.textContent  = level.tag;
          rtext.innerHTML   = level.text;
        } else {
          reframe.classList.remove('warm');
          rtag.textContent  = '';
          rtext.innerHTML   = level.text;
        }

        pillCount.textContent = count === 0 ? '0 signals selected' : count + ' signal' + (count===1?'':'s') + ' selected';
        pillCount.classList.toggle('lit', count > 0);
        pillLevel.textContent = weight === 0 ? '—' : 'Weight: ' + weight + ' / ' + MAX_WEIGHT;
        pillLevel.classList.toggle('lit', weight > 0);
      }

      signals.forEach(sig => {
        sig.addEventListener('click', () => {
          sig.classList.toggle('active');
          update();
        });
      });

      update();
    })();

    actions.toEmotion = () => go('emotion');
    return;
  }

  if(id==="emotion"){
    screen.innerHTML = backBtn() + card(
      "What are you feeling right now?",
      ["Pick the closest one. There's no wrong answer."],
      null,
      `<div class="emotionGrid">
        <button class="emotionCard" data-action="guilt">
          <span class="emotionEmoji">😔</span>
          <span class="emotionLabel">Guilt</span>
        </button>
        <button class="emotionCard" data-action="defensive">
          <span class="emotionEmoji">😤</span>
          <span class="emotionLabel">Defensive</span>
        </button>
        <button class="emotionCard" data-action="confused">
          <span class="emotionEmoji">😕</span>
          <span class="emotionLabel">Confused / Unsure</span>
        </button>
        <button class="emotionCard" data-action="ashamed">
          <span class="emotionEmoji">😳</span>
          <span class="emotionLabel">Ashamed</span>
        </button>
        <button class="emotionCard" data-action="anxious">
          <span class="emotionEmoji">😰</span>
          <span class="emotionLabel">Anxious / Panicking</span>
        </button>
        <button class="emotionCard" data-action="angry">
          <span class="emotionEmoji">😠</span>
          <span class="emotionLabel">Angry</span>
        </button>
        <button class="emotionCard" data-action="numb">
          <span class="emotionEmoji">😶</span>
          <span class="emotionLabel">Numb / Shut Down</span>
        </button>
        <button class="emotionCard" data-action="sad">
          <span class="emotionEmoji">😢</span>
          <span class="emotionLabel">Sad</span>
        </button>
        <button class="emotionCard" data-action="embarrassed">
          <span class="emotionEmoji">😬</span>
          <span class="emotionLabel">Embarrassed</span>
        </button>
        <button class="emotionCard" data-action="okay">
          <span class="emotionEmoji">😌</span>
          <span class="emotionLabel">Okay / Alright</span>
        </button>
      </div>`
    );
    actions.guilt=()=>{state.emotion="guilt"; go("emotionMessage");};
    actions.defensive=()=>{state.emotion="defensive"; go("emotionMessage");};
    actions.confused=()=>{state.emotion="confused"; go("emotionMessage");};
    actions.ashamed=()=>{state.emotion="ashamed"; go("emotionMessage");};
    actions.anxious=()=>{state.emotion="anxious"; go("emotionMessage");};
    actions.angry=()=>{state.emotion="angry"; go("emotionMessage");};
    actions.numb=()=>{state.emotion="numb"; go("emotionMessage");};
    actions.sad=()=>{state.emotion="sad"; go("emotionMessage");};
    actions.embarrassed=()=>{state.emotion="embarrassed"; go("emotionMessage");};
    actions.okay=()=>{state.emotion="okay"; go("emotionMessage");};
    return;
  }

  if(id==="emotionMessage"){

    if(state.emotion==="confused"){
      screen.innerHTML = backBtn() + fogFeature();
      setTimeout(startFog, 0);
      actions.replayFog = ()=>startFog();
      actions.nextSteps = ()=>go("nextSteps");
      return;
    }

    const msg = state.emotion==="guilt"
      ? `You’re feeling guilty.

That feeling usually shows up when you care about impact. It means something in you recognizes that what happened may not have felt okay to the other person.

Guilt doesn’t mean you’re permanently a bad person. It means you’re noticing something that needs attention.

Instead of spiraling, slow down and get specific. Ask yourself: what exactly would I do differently next time?

Guilt becomes useful when it turns into a concrete behavior change. That’s accountability.`
      : (state.emotion==="defensive"
        ? `You’re feeling defensive.

That’s common when something threatens how you see yourself. It’s uncomfortable to even consider that you may have caused harm.

Defensiveness often sounds like: “I didn’t mean to,” “That’s not who I am,” or “It wasn’t that bad.”

You can care about your identity and still examine your behavior honestly.

Try this: if you set aside your intention for a moment, what might their experience have been?`
        : (state.emotion==="confused"
          ? `You’re feeling confused.

Confusion often happens when signals were subtle, mixed, or never clearly spoken — especially if emotions, pressure, or alcohol were involved.

Instead of asking “Was that technically okay?” try asking: was there clear, enthusiastic agreement?

Uncertainty usually means clarity was missing.

Going forward: if you don’t have a clear yes, slow down. Ask directly. Be prepared to stop without arguing.`
          : (state.emotion==="ashamed"
            ? `You’re feeling shame.

Shame can feel heavy. It can make you want to disappear, deny, or punish yourself.

But shame tends to focus on identity — “I am bad” — instead of behavior — “I made a harmful choice.” Those are not the same.

You don’t have to destroy yourself to take responsibility. What matters is whether you’re willing to look honestly at what happened and change your behavior going forward.

Stay with the discomfort without collapsing into self-hatred. Growth requires staying present.`
            : (state.emotion==="anxious"
              ? `You’re feeling anxious or panicked.

When consequences feel possible, your body reacts. That’s a nervous system response.

Panic can push you toward worst-case thinking. Pause and slow your body first.

You don’t have to solve everything immediately. Focus on one question: what is the most responsible next step I can take?

Calm first. Act second.`
              : (state.emotion==="angry"
                ? `You’re feeling angry.

Anger often shows up when something feels unfair, exaggerated, or threatening.

But anger can protect your ego in ways that block reflection.

Instead of asking “Is this fair to me?” try asking: what might have felt uncomfortable or unsafe for them?

Don’t text. Don’t argue. Let the intensity drop before making decisions. Reflection requires steadiness.`
                : (state.emotion==="numb"
                  ? `You’re feeling numb.

Sometimes when something feels overwhelming, your brain shuts things down. Numbness can be a protective response.

Not feeling much doesn’t mean nothing happened. And it doesn’t remove responsibility.

If emotions aren’t accessible right now, focus on behavior: did I check in clearly? Did I continue after hesitation? Was there pressure involved?

You can change future actions even before your feelings fully catch up.`
                  : (state.emotion==="sad"
                    ? `You’re feeling sad.

That’s not the wrong response here. Sadness usually means your attention has shifted toward the other person — what they felt, what they might have lost, what you wish had gone differently.

That matters. Most people in this situation are thinking about themselves — their reputation, their consequences. Feeling sad about impact puts you ahead of that.

Sadness is not the same as guilt, and it’s not the same as accountability. But it can be the door to both. The question is what you do with it.

Sit with it for a moment before you move on. Then take one concrete step — not to feel better, but to do better.`
                    : (state.emotion==="embarrassed"
                      ? `You’re feeling embarrassed.

Embarrassment lives in other people’s eyes. It’s the feeling of being seen doing something you wish you hadn’t — of imagining everyone forming an opinion about you right now.

That feeling is real. But it’s not the most useful place to focus.

Here’s the shift: embarrassment asks “what do they think of me?” Accountability asks “what did my actions do to someone else?” Those are completely different questions — and only one of them leads somewhere.

The noise outside your head doesn’t change what happened. And it can’t drive the response that actually matters. Your next move is yours — not theirs.`
                      : `You’re feeling okay.

That’s worth checking. Okay can mean you’re genuinely settled — that you’ve processed what happened and you’re in a clear, grounded place. That’s legitimate.

But it can also mean things haven’t fully landed yet. Sometimes the weight of something arrives later, once the adrenaline drops.

Either way, okay is a fine place to be right now. Just make sure it’s the kind of okay that stays honest. If something surfaces later — a feeling, a realization, a conversation that’s still needed — don’t let “I was fine” be the reason you don’t act on it.

Use this moment to choose one thing you’ll carry forward. Not a rule to memorize — a habit to actually build.`))))))));

    const parts = msg.split("\n\n").filter(Boolean);

    let extra = "";

if(state.emotion==="guilt"){
  extra = nextRightMoveMarkup();
}

if(state.emotion==="anxious"){
  extra = breatheWidget() + `<div class="mutedBox"><b>Try this:</b> breathe in as it grows… breathe out as it shrinks. Two cycles is enough to get a little steadier.</div>`;
}

if(state.emotion==="numb"){
  extra = catRunnerMarkup();
}

if(state.emotion==="ashamed"){
  extra = spiralInterruptMarkup();
}

if(state.emotion==="defensive"){
  extra = brickWallMarkup();
}

if(state.emotion==="angry"){
  extra = angerPressureMarkup() + `<div class="mutedBox"><b>Goal:</b> get your heat low enough to choose your next step — not to pretend you aren't angry.</div>`;
}

if(state.emotion==="sad"){
  extra = rainWindowMarkup();
}

if(state.emotion==="embarrassed"){
  extra = eyeGridMarkup();
}

if(state.emotion==="okay"){
  extra = vibeJukeboxMarkup();
}

    const hideDefaultContinue = (state.emotion==="sad" || state.emotion==="embarrassed");
    screen.innerHTML = backBtn() + card(
      "Okay.",
      parts,
      null,
      extra + (hideDefaultContinue ? `` : grid(btn("Continue","nextSteps","btn btnPrimary")))
    );
if(state.emotion==="numb"){
  // wait a tick so the canvas exists in the DOM
  setTimeout(initCatRunner, 0);
} else {
  // if we leave the numb screen, stop the game loop / listeners
  if (catRunnerCleanup) catRunnerCleanup();
}

if(state.emotion==="guilt"){
  setTimeout(initNextRightMove, 0);
} else {
  if(nextRightMoveCleanup) nextRightMoveCleanup();
}

if(state.emotion==="ashamed"){
  // mount spiral interrupt after DOM paint
  setTimeout(initSpiralInterrupt, 0);
} else {
  if (spiralCleanup) spiralCleanup();
}

if(state.emotion==="defensive"){
  setTimeout(initBrickWall, 0);
} else {
  if (brickWallCleanup) brickWallCleanup();
}

if(state.emotion==="angry"){
  setTimeout(initAngerPressure, 0);
} else {
  if(angerPressureCleanup) angerPressureCleanup();
}

if(state.emotion==="sad"){
  setTimeout(initRainWindow, 0);
} else {
  if(rainWindowCleanup) rainWindowCleanup();
}

if(state.emotion==="embarrassed"){
  setTimeout(initEyeGrid, 0);
} else {
  if(eyeGridCleanup) eyeGridCleanup();
}

if(state.emotion==="okay"){
  setTimeout(initVibeJukebox, 0);
} else {
  if(vibeJukeboxCleanup) vibeJukeboxCleanup();
}

    actions.nextSteps=()=>go("nextSteps");
    return;
  }


  if(id==="grounding"){
    screen.innerHTML = backBtn() + groundingMarkup();
    setTimeout(initGrounding, 0);
    actions.nextSteps = ()=>go("nextSteps");
    return;
  }


  if(id==="nextSteps"){
    screen.innerHTML = backBtn() + card(
      "What do you want to do next?",
      ["Choose one to start. You can come back and try others."],
      null,
      `<div class="nextGrid">
        <button class="nextBtn" data-action="learn">
          <span class="nextBtnIcon">📚</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Learn</span>
            <span class="nextBtnSub">Quick basics on consent, relationships & digital safety</span>
          </span>
        </button>

        <button class="nextBtn" data-action="prevent">
          <span class="nextBtnIcon">🛡️</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Prevent it from happening again</span>
            <span class="nextBtnSub">Practical skills and tools to build safer habits</span>
          </span>
        </button>

        <button class="nextBtn" data-action="repair">
          <span class="nextBtnIcon">🤝</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Repair</span>
            <span class="nextBtnSub">If appropriate — draft an accountable apology</span>
          </span>
        </button>

        <button class="nextBtn" data-action="beliefShift">
          <span class="nextBtnIcon">🧠</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Belief Shift</span>
            <span class="nextBtnSub">Reframe reactive thoughts toward accountability</span>
          </span>
        </button>

        <button class="nextBtn" data-action="grounding">
          <span class="nextBtnIcon">🫧</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Ground / reset</span>
            <span class="nextBtnSub">5-4-3-2-1 and body-based calming</span>
          </span>
        </button>

        <button class="nextBtn" data-action="support">
          <span class="nextBtnIcon">💬</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Talk to someone / Get support</span>
            <span class="nextBtnSub">Resources for accountability learning and crisis support</span>
          </span>
        </button>

        <button class="nextBtn" data-action="rejection">
          <span class="nextBtnIcon">💔</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Understanding Rejection</span>
            <span class="nextBtnSub">Process a breakup or rejection — interactive guided tool</span>
          </span>
        </button>

        <button class="nextBtn" data-action="closing" style="border-color:rgba(21,255,200,.30); background:rgba(21,255,200,.07);">
          <span class="nextBtnIcon">✅</span>
          <span class="nextBtnText">
            <span class="nextBtnLabel">Finish for now</span>
            <span class="nextBtnSub">You can return anytime</span>
          </span>
        </button>
      </div>
      <div class="mutedBox" style="margin-top:12px;"><b>Note:</b> This is not legal advice. It doesn't determine guilt or assign labels.</div>`
    );
    actions.learn=()=>go("learn");
    actions.prevent=()=>go("prevent");
    actions.repair=()=>go("repair");
    actions.beliefShift=()=>go("beliefShift");
    actions.grounding=()=>go("grounding");
    actions.support=()=>go("support");
    actions.closing=()=>go("closing");
    actions.rejection=()=>go("rejection");
    actions.digitalSafety=()=>go("digitalSafety");
    actions.maleYouth=()=>{ myState={step:0,openCard:-1,quizIdx:0,quizAnswers:{},tsSelected:[],ttOpenIdx:null}; go("maleYouth"); };
    actions.healthyRelationships=()=>{ hrState={step:0,openAbuseTab:'physical',cycleOpen:null,sortState:{placed:{}},quizIdx:0,quizAnswers:{}}; go("healthyRelationships"); };
    actions.rapeCulture=()=>{ rcState={step:0,mythOpen:null,elementOpen:null,quizIdx:0,quizAnswers:{}}; go("rapeCulture"); };
    actions.consentModule=()=>{ conState={step:0,pillarOpen:null,quizIdx:0,quizAnswers:{}}; go("consentModule"); };
    actions.sardModule=()=>{ sardState={step:0,quizIdx:0,quizAnswers:{}}; go("sardModule"); };
    return;
  }

  // ============================================================
  // THE STANDARD
  // ============================================================
  if(id==="theStandard"){
    screen.innerHTML = backBtn() + `
      <div class="h1">&#9876;&#65039; The Standard</div>
      <div class="p" style="color:var(--muted);">Most guys operate by what they can get away with. That's a low bar. This is about what you actually hold yourself to.</div>

      <div class="tsIntro">
        High performers in any field — sport, business, combat — have a code they operate by. Not because someone made them. Because a man with no standard is just reacting. You decide the bar.
      </div>

      <div class="tsTraits" id="tsTraits"></div>

      <div class="tsCommit" id="tsCommit" style="display:none;">
        <div class="tsCommitLabel">YOUR CODE</div>
        <div class="tsCommitText" id="tsCommitText"></div>
        <div class="tsCommitSub">That's the standard. It doesn't change based on who's watching.</div>
      </div>

      <div class="grid" style="margin-top:16px;">
        ${btn("Back","nextSteps")}
        ${btn("Finish","closing","btn btnPrimary")}
      </div>
    `;

    const TS_TRAITS = [
      {
        id:"clarity",
        icon:"&#127919;",
        label:"Clarity over assumption",
        desc:"When something's unclear, I pause and check. Assuming is lazy. Asking is confident.",
        alt:"I'll figure it out from context",
        altReframe:"Figuring it out from context means guessing at someone else's comfort. That's not skill — it's avoidance."
      },
      {
        id:"awareness",
        icon:"&#128065;&#65039;",
        label:"I read the room — all of it",
        desc:"Engagement is active. A real read means noticing when someone's gone quiet, slowed down, or stopped matching your energy.",
        alt:"If they didn't say anything, we're good",
        altReframe:"People don't always say something. That's the whole issue. Waiting for words when body language is off isn't attentiveness — it's wilful blindness."
      },
      {
        id:"control",
        icon:"&#129504;",
        label:"I stay in control of myself",
        desc:"Drunk, charged, in the moment — I still make decisions I can stand behind the next morning. That's discipline. That's strength.",
        alt:"It's hard to think straight when things are intense",
        altReframe:"Hard is different from impossible. The guys who can regulate under pressure are the ones who don't have to apologize or explain themselves after."
      },
      {
        id:"ownership",
        icon:"&#129710;",
        label:"I own my outcomes",
        desc:"If something went wrong, I don't build a case for why it wasn't my fault. I look at what I did or didn't do — and I fix it.",
        alt:"There were factors outside my control",
        altReframe:"Maybe. And your actions are still yours. Ownership isn't about blame — it's about not outsourcing your behaviour to circumstances."
      },
      {
        id:"respect",
        icon:"&#9889;",
        label:"I don't need to push",
        desc:"If I have to push — pressure, persistence, convincing — that's a signal, not a strategy. Men who are genuinely confident don't need to override someone else's hesitation.",
        alt:"Sometimes you have to show you're serious",
        altReframe:"There's a difference between showing commitment and overriding someone's discomfort. One is attractive. The other is coercive."
      }
    ];

    let tsSelected = new Set();

    function tsRender(){
      const container = document.getElementById('tsTraits');
      if(!container) return;
      container.innerHTML = '';
      TS_TRAITS.forEach(function(t){
        const isOn = tsSelected.has(t.id);
        const card = document.createElement('div');
        card.className = 'tsCard' + (isOn ? ' tsOn' : '');
        card.innerHTML =
          '<div class="tsCardTop">' +
            '<span class="tsIcon">' + t.icon + '</span>' +
            '<span class="tsCardLabel">' + t.label + '</span>' +
            '<span class="tsToggle">' + (isOn ? '&#10003; IN' : 'ADD') + '</span>' +
          '</div>' +
          '<div class="tsCardDesc">' + t.desc + '</div>' +
          (isOn ? '' :
            '<div class="tsAlt"><span class="tsAltLabel">Common shortcut:</span> <em>&ldquo;' + t.alt + '&rdquo;</em></div>' +
            '<div class="tsAltReframe">' + t.altReframe + '</div>'
          );
        card.addEventListener('click', function(){
          if(tsSelected.has(t.id)) tsSelected.delete(t.id);
          else tsSelected.add(t.id);
          tsRender();
          tsUpdateCommit();
        });
        container.appendChild(card);
      });
    }

    function tsUpdateCommit(){
      const box = document.getElementById('tsCommit');
      const txt = document.getElementById('tsCommitText');
      if(!box || !txt) return;
      if(tsSelected.size === 0){ box.style.display='none'; return; }
      const lines = TS_TRAITS.filter(function(t){ return tsSelected.has(t.id); }).map(function(t){ return t.icon + ' ' + t.label; });
      txt.innerHTML = lines.map(function(l){ return '<div class="tsCommitLine">' + l + '</div>'; }).join('');
      box.style.display='block';
    }

    tsRender();
    actions.nextSteps=()=>go("nextSteps");
    actions.closing=()=>go("closing");
    return;
  }

  // ============================================================
  // THE REAL TALK TEST
  // ============================================================
  if(id==="tateTest"){
    screen.innerHTML = backBtn() + `
      <div class="h1">&#128269; The Real Talk Test</div>
      <div class="p" style="color:var(--muted);">Some things sound sharp when you first hear them. Run them through what actually happens in practice — and see where the logic holds up.</div>

      <div class="ttIntro">
        This isn't about politics. It's not about who's right. It's about whether the thinking actually works when it hits a real situation — or whether it leaves you exposed.
      </div>

      <div class="ttCards" id="ttCards"></div>

      <div class="grid" style="margin-top:16px;">
        ${btn("Back","nextSteps")}
        ${btn("Finish","closing","btn btnPrimary")}
      </div>
    `;

    const TT_ITEMS = [
      {
        claim: '"If she didn\'t say no, that\'s a yes."',
        soundsRight: "Clean logic. No guessing. No mind-reading. Binary.",
        reality: "In practice, most people who aren't comfortable don't say no out loud. They go quiet. They go along. They freeze. The absence of no is not the presence of yes — it's often just the presence of fear. If you're operating on this logic, you're not reading the situation. You're ignoring it.",
        theGap: "Strong move: make yes obvious, not just assumed."
      },
      {
        claim: '"We were both drinking, so it\'s equal."',
        soundsRight: "Seems fair. Both made the same choice to drink. Nobody forced either of you.",
        reality: "Being drunk doesn't mean both people had the same experience. One person can be significantly more impaired than the other. One person can be less able to communicate or set limits. 'We were both drinking' doesn't neutralise a situation where one person wasn't in a state to clearly say yes. It's often used after the fact to spread responsibility — not to think clearly before.",
        theGap: "If you wouldn't drive drunk, don't assume being drunk makes complex decisions cleaner."
      },
      {
        claim: '"She was into it at the time."',
        soundsRight: "You were there. You read the room. She seemed fine.",
        reality: "Being into something in the moment and feeling okay about it afterward aren't the same. People can go along, be in shock, or suppress discomfort in the moment — and process what happened later. This isn't about changing a story. It's about the gap between what you saw and what they were experiencing. If you were genuinely paying attention, you'd have checked in rather than assumed.",
        theGap: "Reading the room isn't a one-time assessment. It's continuous."
      },
      {
        claim: '"I didn\'t mean for it to go that way."',
        soundsRight: "Intent matters. You're not a bad person. You weren't trying to hurt anyone.",
        reality: "Intent and impact aren't the same thing. You can have good intentions and still cause harm — by moving too fast, by not paying attention, by assuming. 'I didn't mean to' is true and also beside the point. The question isn't whether you meant it. The question is what you actually did, and what the person on the other end of that experience needs from you now.",
        theGap: "Owning impact doesn't mean you're a bad person. It means you're accountable."
      }
    ];

    let ttOpenIdx = null;

    function ttRender(){
      const container = document.getElementById('ttCards');
      if(!container) return;
      container.innerHTML = '';
      TT_ITEMS.forEach(function(item, i){
        const isOpen = ttOpenIdx === i;
        const card = document.createElement('div');
        card.className = 'ttCard' + (isOpen ? ' ttOpen' : '');
        const bodyId = 'ttBody' + i;
        card.innerHTML =
          '<div class="ttCardHeader" tabindex="0" role="button" aria-expanded="' + (isOpen ? 'true' : 'false') + '" aria-controls="' + bodyId + '">' +
            '<div class="ttClaimWrap">' +
              '<span class="ttClaimTag">THE LOGIC</span>' +
              '<span class="ttClaim">' + item.claim + '</span>' +
            '</div>' +
            '<div class="ttChev" aria-hidden="true">' +
              '<svg width="14" height="14" viewBox="0 0 14 14" fill="none">' +
                '<path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>' +
              '</svg>' +
            '</div>' +
          '</div>' +
          '<div class="ttBody" id="' + bodyId + '" ' + (isOpen ? '' : 'style="display:none"') + '>' +
            '<div class="ttSection">' +
              '<div class="ttSectionLabel ttLabelSounds">Sounds right because</div>' +
              '<div class="ttSectionText">' + item.soundsRight + '</div>' +
            '</div>' +
            '<div class="ttSection">' +
              '<div class="ttSectionLabel ttLabelReality">What actually happens</div>' +
              '<div class="ttSectionText">' + item.reality + '</div>' +
            '</div>' +
            '<div class="ttGap">' +
              '<span class="ttGapIcon">&rarr;</span> ' + item.theGap +
            '</div>' +
          '</div>';

        const hdr = card.querySelector('.ttCardHeader');
        function onToggle(){ ttOpenIdx = isOpen ? null : i; ttRender(); }
        hdr.addEventListener('click', onToggle);
        hdr.addEventListener('keydown', function(e){ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onToggle(); }});
        container.appendChild(card);
      });
    }

    ttRender();
    actions.nextSteps=()=>go("nextSteps");
    actions.closing=()=>go("closing");
    return;
  }

  if(id==="beliefShift"){
    screen.innerHTML = backBtn() + card(
      "🧠 Belief Shift",
      [
        "Drag each slider from a reactive thought to an accountability thought.",
        "No debate, no shame — just a steadier frame you can act from."
      ],
      null,
      `
        <div class="bsColLabels">
          <div class="bsColLabel bsColLabel-reactive">
            <span class="bsColDot"></span>Reactive Thought
          </div>
          <div class="bsColLabel bsColLabel-account">
            Accountability Thought<span class="bsColDot"></span>
          </div>
        </div>

        <div class="bsStack" id="bsStack"></div>

        <div class="mutedBox" style="margin-bottom:12px;">
          <b>Micro-rule:</b> If you feel resistance, you don’t have to fully agree.
          Try moving one notch toward <i>“I can take this seriously.”</i>
        </div>

        <div class="bsHint">Drag handle or use ← → keys</div>

        ${grid(
          btn("Back","nextSteps") +
          btn("Finish","closing","btn btnPrimary")
        )}
      `
    );

    setTimeout(initBeliefShift, 0);
    actions.nextSteps=()=>go("nextSteps");
    actions.closing=()=>go("closing");
    return;
  }

  if(id==="learn"){
  screen.innerHTML = backBtn() + `
    <div class="p">Choose a topic to explore. Each one is an interactive guided module you can work through at your own pace.</div>

    <div class="nextGrid" style="margin:14px 0 18px; grid-template-columns: 1fr 1fr;">
      <button class="nextBtn" data-action="sardModule">
        <span class="nextBtnIcon">📖</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">The Spectrum of Harm</span>
          <span class="nextBtnSub">Definitions, the continuum of sexual violence, and how to prevent it</span>
        </span>
      </button>
      <button class="nextBtn" data-action="consentModule">
        <span class="nextBtnIcon">🤝</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">Consent</span>
          <span class="nextBtnSub">What it means, the 6 pillars, how to practice it, and when it's not possible</span>
        </span>
      </button>
      <button class="nextBtn" data-action="rapeCulture">
        <span class="nextBtnIcon">🌍</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">Rape Culture</span>
          <span class="nextBtnSub">What it is, how it's learned, and how to shift toward a culture of respect</span>
        </span>
      </button>
      <button class="nextBtn" data-action="healthyRelationships">
        <span class="nextBtnIcon">💚</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">Healthy Relationships</span>
          <span class="nextBtnSub">Green flags, red flags, boundaries, and recognizing abuse</span>
        </span>
      </button>
      <button class="nextBtn" data-action="maleYouth">
        <span class="nextBtnIcon">👊</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">Men, Masculinity & Sexual Violence</span>
          <span class="nextBtnSub">Masculinity, bro-code, rejection, and how to be part of the change</span>
        </span>
      </button>
      <button class="nextBtn" data-action="digitalSafety">
        <span class="nextBtnIcon">📱</span>
        <span class="nextBtnText">
          <span class="nextBtnLabel">Digital Safety & Image Consent</span>
          <span class="nextBtnSub">Consent online, sexting, and what to do if images are shared</span>
        </span>
      </button>
    </div>

    <div class="grid" style="margin-top:4px;">
      ${btn("Back","nextSteps")}
      ${btn("Finish","closing","btn btnPrimary")}
    </div>
  `;

  actions.sardModule = ()=>go("sardModule");
  actions.consentModule = ()=>go("consentModule");
  actions.rapeCulture = ()=>go("rapeCulture");
  actions.healthyRelationships = ()=>go("healthyRelationships");
  actions.maleYouth = ()=>go("maleYouth");
  actions.digitalSafety = ()=>go("digitalSafety");
  actions.rejection = ()=>go("rejection");

  actions.nextSteps = ()=>go("nextSteps");
  actions.closing = ()=>go("closing");
  return;
}

  if(id==="prevent"){
    screen.innerHTML = backBtn() + `
      <div class="h1">Prevent it from happening again</div>
      <div class="p">These tools can help you build real prevention skills \u2014 not just rules to memorize.</div>

      <div class="pvGrid">
        <button class="pvBtn" data-action="openConsentRoadModal">
          <span class="pvIcon">🛣️</span>
          <span class="pvLabel">Ongoing Consent Road</span>
          <span class="pvSub">Practice check-ins in real time</span>
        </button>
        <button class="pvBtn" data-action="openSurvivorModal">
          <span class="pvIcon">&#128172;</span>
          <span class="pvLabel">Supporting a Survivor</span>
          <span class="pvSub">What to say \u2014 and what not to say</span>
        </button>
        <button class="pvBtn" data-action="openCultureModal">
          <span class="pvIcon">&#127757;</span>
          <span class="pvLabel">Shift the Culture</span>
          <span class="pvSub">Ways to build consent culture around you</span>
        </button>
        <button class="pvBtn" data-action="openBystanderModal">
          <span class="pvIcon">✋🛡️</span>
          <span class="pvLabel">Bystander Intervention</span>
          <span class="pvSub">How to step in safely</span>
        </button>
      </div>

      ${grid(btn("Back","nextSteps") + btn("Finish","closing","btn btnPrimary"))}
    `;

    // ── Consent Road modal ──
    actions.openConsentRoadModal = ()=>{
      openModal("🛣️ Ongoing Consent Road", `
        <div class="p" style="color:var(--muted);margin:0 0 10px;">Consent is a <em>repeated practice</em>, not a one-time question. Each tap adds a real check-in phrase to the road.</div>
        <div class="ocTopCopy" style="margin-bottom:10px; border-color:rgba(21,255,200,.16); background:rgba(13,40,50,.60);">
          <p><b>Consent doesn\u2019t carry over.</b> It has to be present throughout an interaction \u2014 and revisited over time.</p>
          <p>The prevention habit: <b>ask clearly</b>, listen carefully, and stop the moment anything feels uncertain.</p>
        </div>
        <div class="ocRoadContainer">
          <div class="ocRoadTitle" style="font-size:9px; padding:6px 14px 4px;">🛣️ &nbsp;Tap "Add check-in" to build your road</div>
          <div class="ocRoadWrap" id="ocRoadWrap" aria-label="Ongoing consent roadmap" style="height:320px !important;">
          <div class="ocRoadInner" id="ocRoadInner" style="height:320px !important; min-height:320px !important;">
            <div class="ocRoad" aria-hidden="true"></div>
            <div id="ocProgressLine"></div>
            <div id="ocMileLayer"></div>
          </div>
        </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap;">
          <button id="ocAddBtn" class="ocBtn" type="button">&#10133; Add check-in</button>
          <button id="ocResetBtn" class="ocBtn ocBtnGhost" type="button">&#8635; Reset</button>
          <span id="ocCount" style="font-size:12px;color:rgba(21,255,200,.80);font-weight:800;padding:3px 8px;border-radius:999px;border:1px solid rgba(21,255,200,.25);background:rgba(21,255,200,.08);">0 / 11</span>
        </div>
        <div class="ocProgressTrack" style="margin-top:10px;"><div class="ocProgressFill" id="ocProgressFill"></div></div>
        <div id="ocEndNote" class="ocEndNote" style="margin-top:10px; border-color:rgba(21,255,200,.45); background:rgba(21,255,200,.08);">
          \u2705 <b>Road complete.</b> Ongoing consent is a <em>pattern</em>, not a moment.
        </div>
        <div style="margin-top:8px;"><span id="ocTip" style="font-size:12px;color:rgba(209,254,255,.65);font-style:italic;">Tip: check in when things change.</span></div>
      `);
      setTimeout(initOngoingConsentRoad, 0);
    };

    // ── Supporting a Survivor modal ──
    actions.openSurvivorModal = ()=>{
      openModal("&#128172; Supporting a Survivor", `
        <div class="p" style="color:var(--muted);margin:0 0 14px;">If someone discloses to you, how you respond matters. Here’s what helps — and what causes harm.</div>
        <div class="ssGrid">
          <div class="ssCol ssColDo">
            <div class="ssColHead">&#10003;&nbsp; Try saying</div>
            <div class="ssItem">“I’m so sorry this happened to you.”</div>
            <div class="ssItem">“You are not alone. I know there are people that can help.”</div>
            <div class="ssItem">“How can I support you?”</div>
            <div class="ssItem">“It’s not your fault.”</div>
            <div class="ssItem">“I’m glad you felt safe to tell me so I can be here for you.”</div>
            <div class="ssItem">“You didn’t deserve that to happen to you.”</div>
          </div>
          <div class="ssCol ssColDont">
            <div class="ssColHead">&#10007;&nbsp; Don’t say</div>
            <div class="ssItem">“Why didn’t you just leave?”</div>
            <div class="ssItem">“Why were you there?”</div>
            <div class="ssItem">“If you kissed, you should have known something was going to happen.”</div>
            <div class="ssItem">“Were you drinking?”</div>
            <div class="ssItem">“What were you wearing?”</div>
            <div class="ssItem">“It’s going to be fine; just move on.”</div>
            <div class="ssItem">“If it was really a big deal, why didn’t you tell me sooner?”</div>
          </div>
        </div>
        <div class="mutedBox" style="margin-top:14px;">Your job is to listen and support — not to investigate, fix, or decide what they should do.</div>
      `);
    };

    // ── Shift the Culture modal ──
    actions.openCultureModal = ()=>{
      const items = [
        { emoji:"&#128588;", title:"Create a culture of enthusiastic consent", body:"Only engage in sex-positive activity when there is ENTHUSIASTIC verbal consent. When you model this, others around you learn to as well." },
        { emoji:"&#128683;", title:"Don\u2019t laugh at rape jokes or \u2018locker room talk\u2019", body:"Speak up when you see people using sexually degrading terms or behavior. Let people know it\u2019s not okay with you \u2014 even a quiet \u201cthat\u2019s not funny\u201d shifts the room." },
        { emoji:"&#9876;&#65039;", title:"Speak out against the root causes", body:"Don\u2019t buy into ideas which view masculinity as violent and dominant, or femininity as passive, weak, or less valued. Redefine masculinity and challenge gender stereotypes when you encounter them." },
        { emoji:"&#128064;", title:"Draw a clear line", body:"Do not share intimate images of anyone without their permission, and let your friends know you aren\u2019t okay with them doing it either." },
        { emoji:"&#127757;", title:"Take an intersectional approach", body:"Rape culture affects us all regardless of gender identity, sexuality, race, religion, or ability. Transgender youth, Indigenous, Brown and Black girls, and people with disabilities are most at-risk and deserve centered support." },
        { emoji:"&#128101;", title:"Be an active bystander", body:"Not just among your friends, but with ANYONE. Safely intervening signals to the perpetrator that their behavior is unacceptable and may help someone stay safe." },
        { emoji:"&#9878;&#65039;", title:"Stop victim blaming", body:"Perpetrators are responsible for assault \u2014 NEVER the survivor. A survivor\u2019s sobriety, clothing, and sexual history are not relevant. Ask instead why the perpetrator felt entitled." },
        { emoji:"&#128483;&#65039;", title:"Educate your peers and start the conversation", body:"Talk to your family and friends about how you can work together to end rape culture and support survivors. Awareness + Action = Culture Change." },
      ];
      openModal("&#127757; Shift the Culture", `
        <div class="p" style="color:var(--muted);margin:0 0 14px;">Culture changes through consistent, small actions. Here are ways you can contribute starting today.</div>
        <div class="scAccordion">
          ${items.map((it,i)=>`
            <div class="scItem" id="scItem${i}">
              <button class="scHeader" type="button" data-sc="${i}" aria-expanded="false">
                <span class="scEmoji">${it.emoji}</span>
                <span class="scTitle">${it.title}</span>
                <span class="scChev" aria-hidden="true">
                  <svg width="12" height="12" viewBox="0 0 14 14" fill="none"><path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </span>
              </button>
              <div class="scBody" id="scBody${i}">${it.body}</div>
            </div>
          `).join('')}
        </div>
      `);
      // accordion logic
      document.querySelectorAll('.scHeader').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const idx = btn.getAttribute('data-sc');
          const body = document.getElementById('scBody'+idx);
          const open = body.classList.contains('scOpen');
          // close all
          document.querySelectorAll('.scBody').forEach(b=>b.classList.remove('scOpen'));
          document.querySelectorAll('.scHeader').forEach(b=>{ b.classList.remove('scOpen'); b.setAttribute('aria-expanded','false'); });
          if(!open){
            body.classList.add('scOpen');
            btn.classList.add('scOpen');
            btn.setAttribute('aria-expanded','true');
          }
        });
      });
    };

    // ── Bystander Intervention modal ──
    actions.openBystanderModal = ()=>{
      openModal("✋🛡️ Bystander Intervention", `
        <div class="p" style="color:var(--muted);margin:0 0 6px;">Bystander intervention is the idea that we can all step in to help prevent violence, harassment, or abuse \u2014 and it doesn\u2019t have to be aggressive or confrontational.</div>

        <div class="mutedBox" style="margin-bottom:14px;">A bystander is present in about <b>30% of cases</b> of rape, threat of rape, or unwanted sexual contact. It\u2019s natural to not know what to do \u2014 but if one person gets involved, others are likely to follow.</div>

        <div class="biSectionHead">The 4 D\u2019s of Intervention</div>
        <div class="p" style="color:var(--muted);font-size:12px;margin:-8px 0 10px;">Use whichever fits the moment and your safety level.</div>
        <div class="biCards">
          <div class="biCard">
            <div class="biNum">Distract</div>
            <div class="biBody">Interrupt without confrontation \u2014 ask for directions, pretend your wallet is missing, suggest going somewhere else. Great when you\u2019re unsure what\u2019s happening or don\u2019t know the people involved. Can be safer than direct intervention if the situation might escalate.</div>
          </div>
          <div class="biCard">
            <div class="biNum">Delegate</div>
            <div class="biBody">Seek help from a third party \u2014 get a trusted friend, tell a trusted adult, enlist a party host to remove a problematic person. Use this when you don\u2019t feel equipped to handle it alone or when things become more dangerous. Respect the survivor\u2019s privacy.</div>
          </div>
          <div class="biCard">
            <div class="biNum">Direct</div>
            <div class="biBody">Directly intervene \u2014 tell someone to stop a behavior, separate people, or express disapproval while it\u2019s happening. Consider everyone\u2019s safety level, including yours. Most useful when you know the people involved and feel comfortable stepping in.</div>
          </div>
          <div class="biCard">
            <div class="biNum">Delay</div>
            <div class="biBody">Check in with someone afterwards \u2014 see how the survivor is doing, or confront the perpetrator separately. Sometimes situations happen in seconds and you can\u2019t act in the moment. If that happens, you are <em>never</em> at fault for the perpetrator\u2019s actions. Following up still matters.</div>
          </div>
        </div>

        <div class="biSectionHead" style="margin-top:16px;">Common barriers \u2014 and why to push past them</div>
        <div class="biBarriers">
          <div class="biBarrier">\u201cIt\u2019s none of my business.\u201d</div>
          <div class="biBarrier">\u201cSomeone else will step in.\u201d</div>
          <div class="biBarrier">\u201cI don\u2019t know what to say.\u201d</div>
          <div class="biBarrier">\u201cI don\u2019t want to cause a scene.\u201d</div>
          <div class="biBarrier">\u201cIf I say something, it might start a fight.\u201d</div>
          <div class="biBarrier">\u201cI\u2019m not sure if this is really crossing the line.\u201d</div>
        </div>
        <div class="p" style="color:var(--muted);font-size:12px;margin:8px 0 14px;">It\u2019s better to risk being wrong about a situation than to passively witness harassment. It\u2019s not about being a hero \u2014 it\u2019s about preventing harm.</div>

        <div class="biSectionHead">The BAE Code</div>
        <div class="p" style="color:var(--muted);font-size:12px;margin:-6px 0 10px;">BAE-code means committing to keep an eye out for <em>anyone</em> who might need help \u2014 even if they aren\u2019t your friend.</div>
        <div class="biBaeCode">
          <div class="biBaeItem">Watch out for the safety of everyone, not just your friends</div>
          <div class="biBaeItem">Always intervene if you see something sketchy</div>
          <div class="biBaeItem">Don\u2019t send unrequested nude photos</div>
          <div class="biBaeItem">Don\u2019t pressure someone to send nudes or share them without consent</div>
          <div class="biBaeItem">Never pressure someone to do something sexually</div>
          <div class="biBaeItem">Always get enthusiastic consent</div>
          <div class="biBaeItem">Look out for people who have been drinking and help get them home safely</div>
          <div class="biBaeItem">Change the conversation away from sexist or negative talk about people</div>
        </div>
      `);
    };

    actions.nextSteps=()=>go("nextSteps");
    actions.closing=()=>go("closing");
    return;
  }

  if(id==="repair"){
  screen.innerHTML = backBtn() + `
    <div class="h1">Repair (if appropriate)</div>
    <div class="p">Accountability means taking responsibility and respecting boundaries — not earning forgiveness. If you reach out, keep it short, don’t ask for comfort, and allow space.</div>

    <div class="note" style="margin-bottom:14px;">
      <b>Possible script:</b> “I’ve been thinking about what happened. I’m sorry I didn’t pause and check in. You didn’t deserve that. I’ll respect whatever space you want.”
    </div>

    <div class="repairWrap">

      <div class="repairPanel" id="rbPanel">
        <div class="panelHeader" id="rbHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="rbBody">
          <div class="titleBlock">
            <div class="panelTitle">&#9999;&#65039; Repair Builder</div>
            <div class="panelSub">Draft an accountable apology step by step</div>
          </div>
          <div class="chev" aria-hidden="true">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <div class="panelBody" id="rbBody">
          <div class="inner">
            <div class="rbWarning">
              <b>Before sending:</b> Do not use this to pressure someone. If they asked for no contact, respect that. An apology does not require forgiveness.
            </div>
            <div class="rbSection">
              <div class="rbLabel">1. What are you apologizing for?</div>
              <textarea class="rbTextarea" id="rbPart1" placeholder="I…"></textarea>
              <div id="rbFlag1" class="rbFlag">&#9888; Avoid “if,” “but,” or minimizing language — they shift blame.</div>
            </div>
            <div class="rbSection">
              <div class="rbLabel">2. Acknowledge the impact</div>
              <textarea class="rbTextarea" id="rbPart2" placeholder="I understand that…"></textarea>
            </div>
            <div class="rbSection">
              <div class="rbLabel">3. Respect their space</div>
              <textarea class="rbTextarea" id="rbPart3" placeholder="I’ll respect whatever space you want."></textarea>
            </div>
            <div class="rbSection" style="margin-bottom:0;">
              <div class="rbLabel">4. Name the behavior change</div>
              <textarea class="rbTextarea" id="rbPart4" placeholder="Next time, I will…"></textarea>
            </div>
            <div class="rbBtnRow">
              <button class="rbBtn rbBtnGhost" id="rbBuildBtn" type="button">Build Message</button>
              <button class="rbBtn" id="rbCopyBtn" type="button">Copy</button>
              <button class="rbBtn rbBtnGhost" id="rbClearBtn" type="button">Clear</button>
            </div>
            <div class="rbCopyConfirm" id="rbCopyConfirm">&#10003; Copied to clipboard</div>
            <div class="rbOutput" id="rbOutput"></div>
            <div style="font-size:11px;color:var(--muted);margin-top:10px;opacity:.7;">Accountability means clarity, not self-destruction.</div>
          </div>
        </div>
      </div>

      <div class="repairPanel" id="forgivePanel">
        <div class="panelHeader" id="forgiveHeader" tabindex="0" role="button" aria-expanded="false" aria-controls="forgiveBody">
          <div class="titleBlock">
            <div class="panelTitle">&#128172; What If They Don’t Forgive Me?</div>
            <div class="panelSub">Understanding accountability without closure</div>
          </div>
          <div class="chev" aria-hidden="true">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <div class="panelBody" id="forgiveBody">
          <div class="inner">
            <div class="p" style="margin:0 0 10px;color:var(--muted);">
              They might not — and that can hurt. But forgiveness isn’t something you’re owed, and it isn’t proof that you “did accountability right.”
            </div>
            <div class="p" style="margin:0 0 10px;color:var(--muted);">
              A solid repair attempt is about <b>responsibility</b> and <b>respecting boundaries</b>, not getting emotional relief.
            </div>
            <div class="note" style="margin:0 0 10px;">
              <b>What accountability looks like either way:</b><br>
              &bull; Accept their response &mdash; including no response.<br>
              &bull; Don’t argue, minimize, or ask them to reassure you.<br>
              &bull; Change your behavior even if you never get closure.<br>
              &bull; Give space, and don’t keep “checking in” to see if they’re over it.
            </div>
            <div class="mutedBox">
              <b>Reality check:</b> You can’t control whether someone forgives you. You <i>can</i> control whether you repeat harm.
            </div>
          </div>
        </div>
      </div>

    </div>

    ${grid(btn("Back","nextSteps") + btn("Finish","closing","btn btnPrimary"))}
  `;

  function makeRepairToggle(panelId, headerId){
    const panel  = document.getElementById(panelId);
    const header = document.getElementById(headerId);
    if(!panel||!header) return ()=>{};
    function toggle(){
      const open = panel.classList.contains('open');
      panel.classList.toggle('open', !open);
      header.setAttribute('aria-expanded', String(!open));
    }
    function onKey(e){ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggle(); } }
    header.addEventListener('click', toggle);
    header.addEventListener('keydown', onKey);
    return ()=>{ header.removeEventListener('click', toggle); header.removeEventListener('keydown', onKey); };
  }

  const cleanRb      = makeRepairToggle('rbPanel','rbHeader');
  const cleanForgive = makeRepairToggle('forgivePanel','forgiveHeader');

  function rbContainsMinimizing(t){ return ["if "," but ","misunderstand","didn't mean"].some(p=>t.toLowerCase().includes(p)); }

  document.getElementById('rbBuildBtn').addEventListener('click', ()=>{
    const p1 = document.getElementById('rbPart1').value.trim();
    const p2 = document.getElementById('rbPart2').value.trim();
    const p3 = document.getElementById('rbPart3').value.trim();
    const p4 = document.getElementById('rbPart4').value.trim();
    document.getElementById('rbFlag1').style.display = rbContainsMinimizing(p1) ? 'block' : 'none';
    const msg = [p1,p2,p3,p4].filter(Boolean).join('\n\n');
    const output = document.getElementById('rbOutput');
    output.textContent = msg || '(Fill in at least one field above.)';
    output.style.display = 'block';
  });

  document.getElementById('rbCopyBtn').addEventListener('click', ()=>{
    const output = document.getElementById('rbOutput');
    if(!output.textContent || output.style.display==='none') return;
    const confirm = document.getElementById('rbCopyConfirm');
    navigator.clipboard.writeText(output.textContent).then(()=>{
      confirm.classList.add('show');
      setTimeout(()=>confirm.classList.remove('show'), 2000);
    }).catch(()=>{});
  });

  document.getElementById('rbClearBtn').addEventListener('click', ()=>{
    ['rbPart1','rbPart2','rbPart3','rbPart4'].forEach(id=>{ document.getElementById(id).value=''; });
    const output = document.getElementById('rbOutput');
    output.style.display='none'; output.textContent='';
    document.getElementById('rbFlag1').style.display='none';
    document.getElementById('rbCopyConfirm').classList.remove('show');
  });

  actions.nextSteps = () => { cleanRb(); cleanForgive(); go("nextSteps"); };
  actions.closing   = () => { cleanRb(); cleanForgive(); go("closing"); };
  return;
}

    if(id==="support"){
    screen.innerHTML = backBtn() + card(
      "Support options",
      [
        "If you want structured accountability learning, consider SafeBAE's training.",
        "If you're overwhelmed or unsafe, reaching out for support can help."
      ],
      null,
      `<div style="display:flex; flex-direction:column; gap:8px; margin-top:14px;">
        <a class="supportLink" href="https://safebae.org/360-schools/accountability-training/" target="_blank" rel="noopener noreferrer">
          <span class="supportLinkIcon">🏫</span>
          <span class="supportLinkText">
            <span class="supportLinkLabel">SafeBAE Accountability Training</span>
            <span class="supportLinkSub">Structured program for behavior change</span>
          </span>
          <span class="supportLinkArrow">↗</span>
        </a>
        <a class="supportLink" href="https://rainn.org/" target="_blank" rel="noopener noreferrer">
          <span class="supportLinkIcon">🫂</span>
          <span class="supportLinkText">
            <span class="supportLinkLabel">RAINN</span>
            <span class="supportLinkSub">National sexual assault hotline &amp; resources</span>
          </span>
          <span class="supportLinkArrow">↗</span>
        </a>
        <a class="supportLink" href="https://988lifeline.org/" target="_blank" rel="noopener noreferrer">
          <span class="supportLinkIcon">📞</span>
          <span class="supportLinkText">
            <span class="supportLinkLabel">988 Lifeline</span>
            <span class="supportLinkSub">Call or text 988 for mental health crisis support</span>
          </span>
          <span class="supportLinkArrow">↗</span>
        </a>
        <a class="supportLink" href="https://www.crisistextline.org/" target="_blank" rel="noopener noreferrer">
          <span class="supportLinkIcon">💬</span>
          <span class="supportLinkText">
            <span class="supportLinkLabel">Crisis Text Line</span>
            <span class="supportLinkSub">Text HOME to 741741 for free crisis counseling</span>
          </span>
          <span class="supportLinkArrow">↗</span>
        </a>
      </div>
      <div style="margin-top:14px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        ${btn("Back","nextSteps")}
        ${btn("Finish","closing","btn btnPrimary")}
      </div>`
    );
    actions.nextSteps=()=>go("nextSteps");
    actions.closing=()=>go("closing");
    return;
  }

  if(id==="digitalSafety"){ dsRender(); return; }
  if(id==="maleYouth"){ myRender(); return; }
  if(id==="healthyRelationships"){ hrRender(); return; }
  if(id==="rapeCulture"){ rcRender(); return; }
  if(id==="consentModule"){ consentRender(); return; }
  if(id==="sardModule"){ sardRender(); return; }
  if(id==="rejection"){ rejectionScreen(); return; }

  if(id==="closing"){
    screen.innerHTML = card(
      "✅ You paused. That matters.",
      [
        "Taking a moment to reflect — even when it's uncomfortable — reduces the chance of harm happening again.",
        "Accountability isn't a single moment. It's a pattern of honest reflection, behavior change, and choosing safer next steps."
      ],
      null,
      `<div id="forgeSection">
        <div class="forgeWrap">
          <div class="forgeLabel">🔨 Forge your commitment</div>
          <textarea id="forgeInput" class="forgeTextarea" maxlength="200" placeholder="Write one concrete thing you'll do differently next time…"></textarea>
          <button id="forgeSubmitBtn" class="forgeBtn" disabled>Forge It →</button>
        </div>

        <div id="forgedCardWrap" class="forgedCardWrap">
          <div class="forgedCard" id="forgedCard">
            <div class="forgedCardMeta">
              <span class="forgedCardBadge">⚡ Commitment Forged</span>
              
            </div>
            <div class="forgedCardText" id="forgedCardText"></div>
            <div class="forgedCardGlow"></div>
          </div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:16px;">
          ${btn("Start over","restart","btn btnPrimary")}
          ${btn("Explore pathways","pathMenu")}
        </div>
      </div>`
    );

    // --- Forge logic ---
    const forgeInput = document.getElementById('forgeInput');
    const forgeBtn   = document.getElementById('forgeSubmitBtn');
    const cardWrap   = document.getElementById('forgedCardWrap');
    const cardText   = document.getElementById('forgedCardText');
    
    // Enable/disable forge button
    forgeInput.addEventListener('input', ()=>{
      forgeBtn.disabled = forgeInput.value.trim().length < 5;
    });

    forgeBtn.addEventListener('click', ()=>{
      const text = forgeInput.value.trim();
      if(text.length < 5) return;

      
      // Show forged card
      cardText.textContent = '\u201C' + text + '\u201D';
            cardWrap.classList.add('show');

      // Re-trigger animation
      const fc = document.getElementById('forgedCard');
      fc.style.animation = 'none';
      fc.offsetHeight; // reflow
      fc.style.animation = '';
      fc.classList.add('forgePulse');
      setTimeout(()=> fc.classList.remove('forgePulse'), 700);

      // Swap button
      forgeBtn.textContent = '\u2713 Commitment forged';
      forgeBtn.disabled = true;
      forgeInput.disabled = true;
      forgeInput.style.opacity = '.55';
    });

    actions.restart=()=>reset();
    actions.pathMenu=()=>go("pathMenu");
    return;
  }


  if(id==="pathMenu"){
    screen.innerHTML = backBtn() + card(
      "Prototype pathways menu",
      ["Jump directly into a pathway (for demo)."],
      null,
      grid(
        btn("Freeze","jumpFreeze") +
        btn("Pulled away","jumpPull") +
        btn("Drinking","jumpDrink") +
        btn("Pressure","jumpPressure") +
        btn("Age/power","jumpAgePower") +
        btn("Digital","jumpDigital") +
        btn("Ignored no","jumpCoercion") +
        btn("Relationship assumed consent","jumpRelationship") +
        btn("Not sure they wanted it","jumpWanted") +
        btn("Upset afterward","jumpUpset") +
        btn("Still not sure","jumpNotSure") +
        btn("My friend did something","jumpFriend") +
        btn("Back to start","landing")
      )
    );
    actions.jumpFreeze=()=>{go("A_freeze_whatItMeans");};
    actions.jumpPull=()=>{go("C_pulledAway_signal");};
    actions.jumpDrink=()=>{go("B_drinking_basics");};
    actions.jumpPressure=()=>{go("D_pressure");};
    actions.jumpAgePower=()=>{go("E_age_power");};
    actions.jumpDigital=()=>{go("F_digital");};
    actions.jumpCoercion=()=>{go("G_coercion");};
    actions.jumpRelationship=()=>{go("H_relationship");};
    actions.jumpWanted=()=>{go("I_not_sure_wanted");};
    actions.jumpUpset=()=>{go("J_upset_after");};
    actions.jumpNotSure=()=>{go("K_not_sure_what");};
    actions.jumpFriend=()=>{state.entry="friend_pathway"; go("friend_landing");};
    actions.landing=()=>go("landing");
    return;
  }
  if(id==="consentEdu"){
    screen.innerHTML = backBtn() + card(
      "Understanding Consent",
      [
        "<b>Consent is ongoing.</b> It must be clear, voluntary, and can change at any time.",
        "<b>Silence isn’t consent.</b> If someone freezes, goes quiet, or pulls away — pause and check in.",
        "<b>Consent requires capacity.</b> Someone who is significantly impaired by alcohol or pressure may not be able to freely agree.",
        "<b>Relationships don’t equal consent.</b> Consent is required every time."
      ],
      `<div class="note">
        Healthy consent includes active participation, mutual enthusiasm, and the ability to say no without pressure.
      </div>`,
      grid(
        btn("Continue","emotion","btn btnPrimary") +
        btn("Return to start","landing")
      )
    );

    actions.emotion = ()=>go("emotion");
    actions.landing = ()=>go("landing");
    return;
  }

  if(id==="about"){
    screen.innerHTML = backBtn() + card(
      "About this prototype",
      [
        "This is a prototype of a private accountability and reflection tool. It is designed for moments of uncertainty — when someone is questioning whether they crossed a boundary or harmed someone.",
        "Rather than labeling or judging, the tool guides users through structured reflection on the situation and their emotional responses. It helps people pause, examine specific behaviors, and understand how factors such as consent, pressure, alcohol, and power dynamics can shape impact.",
        "The tool is non-punitive and educational. It does not collect personal information, assign labels, or make legal determinations. Its purpose is to reduce harm by increasing awareness, strengthening accountability, and building practical prevention skills that support lasting behavior change.",
        "This version demonstrates how scenario-based pathways and emotional check-ins work together to guide safer choices moving forward."

      ],
      null,
      grid(btn("Back","landing","btn btnPrimary"))
    );
    actions.landing=()=>go("landing");
    return;
  }

  if(id==="decoy"){
    screen.innerHTML = backBtn() + card(
      "Weekly Study Planner",
      [
        "Mon: Math • Tue: English • Wed: Science • Thu: History • Fri: Catch-up",
        "Tip: Break big tasks into 15-minute blocks."
      ],
      null,
      grid(btn("Return to prototype","landing","btn btnPrimary"))
    );
    actions.landing=()=>go("landing");
    return;
  }
}

render();


// ===== Belief Shift =====
function initBeliefShift(){
  var BS_PAIRS = [
    { left: "They're lying.",                         right: "Even if details differ, something didn't feel okay for them." },
    { left: "It wasn't that bad.",                    right: "It might not have felt that bad to me — but it might have to them." },
    { left: "They didn't say no.",                    right: "No isn't the only signal. If it wasn't a clear yes, I should've paused." },
    { left: "I didn't mean to.",                      right: "I can mean well and still mess up." },
    { left: "This is unfair to me.",                  right: "It can feel unfair and still be something I need to own." },
    { left: "If I admit anything, I'm a bad person.", right: "Owning a mistake isn't the same as being evil." },
    { left: "They're trying to ruin my life.",        right: "This might be about them feeling unsafe — not revenge." },
    { left: "They should've just told me.",           right: "Not everyone can speak up in the moment — that's why I need to check in." },
    { left: "Everyone does this.",                    right: "I don't want my standard to be what everyone else does. I want it to be safe." },
    { left: "I was drunk too.",                       right: "If alcohol made it unclear, that's my cue to stop." },
    { left: "I need them to say it's okay.",          right: "It's not their job to fix my guilt." },
    { left: "I'm being attacked.",                    right: "I feel attacked — and I can still listen." },
    { left: "I can't handle this.",                   right: "I don't have to handle all of it, just one step at a time." }
  ];
  var stack = document.getElementById('bsStack');
  if(!stack) return;
  stack.innerHTML = '';
  function bsClamp(n,lo,hi){ return Math.max(lo,Math.min(hi,n)); }
  function bsEsc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function bsApply(card, pos, i){
    pos = bsClamp(pos,0,100); card.dataset.pos = String(pos);
    var mask=card.querySelector('.bs-mask-'+i), inner=card.querySelector('.bs-inner-'+i),
        track=card.querySelector('.bs-track-'+i), knob=card.querySelector('.bs-knob-'+i);
    if(mask)  mask.style.width  = pos+'%';
    if(inner) inner.style.width = card.offsetWidth+'px';
    if(track) track.style.left  = pos+'%';
    if(knob)  knob.setAttribute('aria-valuenow', String(Math.round(pos)));
  }
  BS_PAIRS.forEach(function(pair,i){
    var card = document.createElement('div');
    card.className='bsCard'; card.dataset.pos='0';
    card.innerHTML=
      '<span class="bsCardNum">'+String(i+1).padStart(2,'0')+'</span>'+
      '<div class="bsSide bsSideLeft"><div class="bsSideText">'+bsEsc(pair.left)+'</div></div>'+
      '<div class="bsRevealMask bs-mask-'+i+'">'+
        '<div class="bsRevealInner bsSide bsSideRight bs-inner-'+i+'">'+
          '<div class="bsReframeText">'+bsEsc(pair.right)+'</div>'+
        '</div>'+
      '</div>'+
      '<div class="bsHandleTrack bs-track-'+i+'">'+
        '<div class="bsDividerLine"></div>'+
        '<div class="bsKnob bs-knob-'+i+'" tabindex="0" role="slider" aria-label="Belief shift" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">'+
          '<svg width="16" height="16" viewBox="0 0 24 24" fill="none">'+
            '<path d="M9 18l-6-6 6-6" stroke="rgba(255,160,160,.85)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>'+
            '<path d="M15 6l6 6-6 6" stroke="rgba(21,255,200,.95)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>'+
          '</svg>'+
        '</div>'+
      '</div>';
    stack.appendChild(card);
    bsApply(card,0,i);
    new ResizeObserver(function(){ bsApply(card,Number(card.dataset.pos),i); }).observe(card);
    var dragging=false, knob=card.querySelector('.bs-knob-'+i);
    function posFromEvt(e){
      var rect=card.getBoundingClientRect(), cx=(e.touches&&e.touches[0])?e.touches[0].clientX:e.clientX;
      return bsClamp(((cx-rect.left)/rect.width)*100,0,100);
    }
    knob.addEventListener('pointerdown',function(e){ dragging=true; knob.classList.add('bsDragging'); knob.setPointerCapture(e.pointerId); e.stopPropagation(); });
    knob.addEventListener('pointermove',function(e){ if(!dragging)return; bsApply(card,posFromEvt(e),i); });
    knob.addEventListener('pointerup',function(){ dragging=false; knob.classList.remove('bsDragging'); });
    knob.addEventListener('pointercancel',function(){ dragging=false; knob.classList.remove('bsDragging'); });
    card.addEventListener('pointerdown',function(e){ if(e.target.closest('.bs-knob-'+i))return; bsApply(card,posFromEvt(e),i); });
    knob.addEventListener('keydown',function(e){
      var step=e.shiftKey?12:5, cur=Number(card.dataset.pos);
      if(e.key==='ArrowRight'){e.preventDefault();bsApply(card,cur+step,i);}
      if(e.key==='ArrowLeft'){e.preventDefault();bsApply(card,cur-step,i);}
      if(e.key==='Home'){e.preventDefault();bsApply(card,0,i);}
      if(e.key==='End'){e.preventDefault();bsApply(card,100,i);}
    });
  });
}

// =============================================
//  REJECTION MODULE
// =============================================

const FEELINGS = {
  hurt:    {emoji:'💔', label:'Hurt',        title:'Hurt is honest.',         text:'What you\'re feeling makes complete sense. Hurt means you opened up and cared — and that\'s not a weakness. Give yourself space to feel this without rushing past it.'},
  angry:   {emoji:'🔥', label:'Angry',       title:'Anger is energy.',        text:'It\'s okay to feel angry. But anger that turns inward or outward in harmful ways won\'t help you heal. Working through what\'s underneath the anger is where things start to shift.'},
  confused:{emoji:'🌀', label:'Confused',    title:'Confusion is understandable.', text:'When we don\'t understand why something happened, our mind fills in the gaps — usually with the worst answers. The truth is usually far less about you than you think.'},
  sad:     {emoji:'🌧️', label:'Sad',         title:'Sadness means you cared.', text:'The ache you\'re feeling is real. Sadness after rejection is healthy — it\'s your heart acknowledging that something mattered to you. That\'s depth, not weakness.'},
  okay:    {emoji:'🌤️', label:'Actually Okay', title:'Being okay is okay too.',  text:'Not every rejection hits the same way. If you\'re processing from a place of calm, that\'s great. You can still learn something useful here about yourself and how connection works.'},
  numb:    {emoji:'😶‍🌫️', label:'Not Sure',  title:'Numb is still something.', text:'Sometimes the feelings haven\'t fully arrived yet. That\'s a valid place to be. Go at your own pace — there\'s no rush.'},
};
const REJ_MYTHS = [
  {icon:'🪞', myth:'"It means I\'m not good enough."', title:'It\'s about fit, not worth.',  body:'Rejection almost never reflects your value as a person. Someone not wanting a relationship with you is about compatibility, timing, and their own life — not a verdict on you.'},
  {icon:'🗣️', myth:'"Their \'no\' means something deeper."', title:'"No" usually just means "no."', body:'A "no" is a complete sentence. It\'s not a coded message, a challenge, or an invitation to try harder. It means exactly what it says — and it deserves to be respected as-is.'},
  {icon:'⚖️', myth:'"Being rejected is unfair."', title:'It\'s the same right you have.',    body:'You\'d never want someone to stay in a relationship out of obligation. They\'re exercising the exact same right you\'d want for yourself — the right to choose.'},
  {icon:'🚪', myth:'"This closes a door forever."', title:'There are always more possibilities.', body:'One rejection is not the end of connection in your life. There will be more people, more moments, more chances. This is not the whole story.'},
];
const NO_MEANINGS = [
  {text:'A decision, not a verdict on your worth.', fact:true},
  {text:'"I\'m not ready for this right now."', fact:true},
  {text:'"You\'re not lovable."', fact:false},
  {text:'Someone exercising their right to choose.', fact:true},
  {text:'"Try harder — I\'m testing you."', fact:false},
  {text:'A boundary worth respecting.', fact:true},
  {text:'"Something is wrong with you."', fact:false},
  {text:'An opening to redirect your energy.', fact:true},
];
const REJ_REASONS = [
  {num:'01', tag:'Timing',        title:"They're not in the right place right now.",    body:"Relationships require emotional availability. Someone might like you and still not be ready — because of their own healing, stress, or life changes. That\'s about them, not you."},
  {num:'02', tag:'Compatibility', title:"Different goals, paths, or desires.",           body:"Two people can both be good people and still not be right for each other. Values, communication styles, future plans — compatibility is complex. No one failed."},
  {num:'03', tag:'Pressure',      title:"Family, religion, or cultural expectations.",  body:"Many people navigate real external pressure about who they can be with. A 'no' that comes from here isn\'t a reflection of your desirability."},
  {num:'04', tag:'Their Struggles', title:"Anxiety, grief, or emotional overload.",    body:"Some people genuinely can\'t be present in a relationship because of what they\'re carrying. It\'s not your job to fix it, and it\'s not your fault."},
  {num:'05', tag:'Simple Truth',  title:"They just don't feel the same way.",           body:"Attraction and connection can\'t be forced. Feelings aren\'t wrong or unfair. Not feeling the same way back isn\'t cruelty — it\'s just honesty."},
];
const REJ_SCENARIOS = [
  {
    text:"You told someone you liked them and they said they weren't interested. Later that day you see them laughing with friends.",
    opts:[
      {e:'💛', t:'Feel hurt for a bit, then give them space and move on.', good:true},
      {e:'📱', t:'Send them a long message asking why and what\'s wrong with you.', good:false},
      {e:'😤', t:'Tell your friends something embarrassing about them.', good:false},
      {e:'🧘', t:'Remind yourself their choice is valid, even if it hurts.', good:true},
    ],
    good:{h:'That\'s a healthy response.',t:'Taking space and respecting their decision — even when it hurts — is exactly what healthy processing looks like. Your feelings are valid. Their choice is also valid.'},
    bad: {h:'Let\'s think about this differently.',t:'When we react from pain, we sometimes do things that don\'t reflect who we are. Pressuring someone to explain, or retaliating, doesn\'t change their answer — it just adds harm.'},
  },
  {
    text:"You've been seeing someone for a few weeks and they text you saying they don't want to continue.",
    opts:[
      {e:'🚗', t:'Show up to talk them out of it in person.', good:false},
      {e:'🫂', t:'Feel sad, talk to a friend, give yourself time.', good:true},
      {e:'🔍', t:'Try to find out if they\'re seeing someone else.', good:false},
      {e:'💙', t:'Respect their decision, even though it hurts.', good:true},
    ],
    good:{h:'Grief is part of this.',t:'It\'s okay to feel real pain after rejection. Processing that with someone you trust — instead of pushing to change their mind — is healthy and shows emotional maturity.'},
    bad: {h:'Their decision is final.',t:'When someone says no, showing up to change their mind or investigating their life isn\'t love — it\'s pressure. Their "no" deserves the same respect you\'d want for yours.'},
  },
  {
    text:"Someone you've liked for a long time is now dating someone else after turning you down last year.",
    opts:[
      {e:'🌱', t:'Feel a sting, then remind yourself their choice was valid.', good:true},
      {e:'⏳', t:'Tell yourself they made a mistake and wait for them to realize it.', good:false},
      {e:'📸', t:'Post constantly to make them jealous.', good:false},
      {e:'✨', t:'Acknowledge the feeling and focus back on your own life.', good:true},
    ],
    good:{h:'That kind of self-awareness takes real strength.',t:'Sitting with a difficult feeling and redirecting — instead of spiraling — is one of the most powerful things you can do.'},
    bad: {h:'Waiting or performing won\'t change the outcome.',t:'Holding out hope or trying to make someone jealous keeps you stuck. Their choices are theirs to make. Your energy is better spent on you.'},
  },
];
const REJ_JOURNAL = [
  {tab:'Feeling',     prompt:'"What am I actually feeling right now?"',                              hint:'You don\'t have to explain or justify it. Just describe what\'s here.',                            affirm:'Naming your feelings is the first step to processing them. What you\'re feeling is real.'},
  {tab:'Their Side',  prompt:'"What might have been going on for them that had nothing to do with me?"', hint:'Imagine their world — pressures, fears, where they\'re at. Not to excuse anything, just to understand.', affirm:'Seeing another person\'s full humanity — even when you\'re hurt — is emotional maturity.'},
  {tab:'Your Worth',  prompt:'"What would I say to a close friend going through exactly this?"',      hint:'Write the words you\'d actually give them. Then read them back to yourself.',                     affirm:'You deserve the same compassion you give to others. Always.'},
  {tab:'Forward',     prompt:'"What does this tell me about what I actually want?"',                  hint:'Sometimes rejection clarifies things. What feels clearer now about yourself or what you\'re looking for?', affirm:'Clarity about who you are is worth whatever pain brought you here.'},
];
const REJ_AFFIRMS = [
  {e:'🌿', t:'"Being rejected doesn\'t make you less worthy of love. It means this specific moment, with this specific person, wasn\'t the right fit."'},
  {e:'🌊', t:'"There are always more opportunities to meet new people and build new connections."'},
  {e:'💛', t:'"Your value as a person does not change based on who does or doesn\'t choose you."'},
  {e:'🔮', t:'"Their \'no\' protects your time and energy for someone who is genuinely a yes."'},
  {e:'🫂', t:'"Feeling this deeply just means you showed up with your whole heart. That takes courage."'},
  {e:'✨', t:'"Respecting someone\'s decision — even when it hurts you — is one of the most powerful things you can do."'},
  {e:'🌱', t:'"Every experience, even painful ones, helps you understand who you are and what you\'re really looking for."'},
];
const REJ_STEPS = ['Check-In','Myth vs Truth','What "No" Means','Why It Happens','The Reality','Real Situations','Journal','Affirmations','Wrap Up'];

let rState = null;
function getRState(){
  if(!rState) rState = {step:0,feeling:null,noRevealed:false,scenarioIdx:0,scenarioAnswered:false,scenarioChosen:-1,scenarioAnswers:{},journalTab:0,affirmIdx:0,savedAffirms:[]};
  return rState;
}
function resetRState(){ rState = {step:0,feeling:null,noRevealed:false,scenarioIdx:0,scenarioAnswered:false,scenarioChosen:-1,scenarioAnswers:{},journalTab:0,affirmIdx:0,savedAffirms:[]}; }

function rejWC(s){ return s&&s.trim() ? s.trim().split(/\s+/).length : 0; }

function rejectionScreen(){
  const rs = getRState();
  const stepsHTML = REJ_STEPS.map((_,i)=>
    `<div class="rejStep ${i<rs.step?'done':i===rs.step?'active':''}"></div>`).join('');
  let inner = '';
  const s = rs.step;
  if(s===0){
    const feelBtns = Object.entries(FEELINGS).map(([k,f])=>
      `<button class="rejFeelingBtn${rs.feeling===k?' sel':''}" data-rejfeeling="${k}">
         <span class="rfe">${f.emoji}</span><span class="rfl">${f.label}</span>
       </button>`).join('');
    const resp = rs.feeling ? `<div class="rejFeelingResponse show"><strong>${FEELINGS[rs.feeling].title}</strong>${FEELINGS[rs.feeling].text}</div>` : '';
    inner = `<div class="p">How are you feeling right now? No judgment — pick what feels closest.</div>
      <div class="rejFeelingGrid">${feelBtns}</div>${resp}
      <div class="rejNavRow">${rs.feeling?`<button class="btn btnPrimary" data-rejnext>Next →</button>`:`<button class="btn" disabled style="opacity:.35;cursor:default">Choose a feeling to continue</button>`}</div>`;
  } else if(s===1){
    inner = `<div class="p">Tap each card to reveal the truth behind what we tell ourselves about rejection.</div>
      <div class="rejMythGrid">${REJ_MYTHS.map((m,i)=>`
        <div class="rejMythCard" data-mythtoggle="${i}">
          <div class="rejMythHead">
            <span class="rejMythIcon">${m.icon}</span>
            <div class="rejMythTexts"><div class="rejMythMuted">${m.myth}</div><div class="rejMythTitle">${m.title}</div></div>
            <div class="rejMythChev">+</div>
          </div>
          <div class="rejMythBody">${m.body}</div>
        </div>`).join('')}</div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else if(s===2){
    const pillsHTML = rs.noRevealed ? NO_MEANINGS.map((m,i)=>
      `<div class="rejMeaningPill ${m.fact?'fact':'myth'} show" style="transition-delay:${i*80}ms">
         <span class="rejMeaningTag">${m.fact?'✓ Means':'✗ Does NOT mean'}</span>${m.text}
       </div>`).join('') : '';
    inner = `<div class="p">We often read way too much into a single word.</div>
      <div class="rejNoStage">
        <span class="rejNoBig${rs.noRevealed?' tapped':''}" ${rs.noRevealed?'':'id="rejNoBig"'}>NO</span>
        <div class="rejNoHint">${rs.noRevealed?'What "no" IS — and what it is NOT':'Tap the word to find out what it really means'}</div>
      </div>
      <div class="rejMeaningGrid">${pillsHTML}</div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else if(s===3){
    inner = `<div class="p">Tap each one to understand what might really be going on for the other person.</div>
      <div class="rejReasonList">${REJ_REASONS.map((r,i)=>`
        <div class="rejReasonRow" data-reasontoggle="${i}">
          <div class="rejReasonHead">
            <span class="rejReasonNum">${r.num}</span>
            <div class="rejReasonLabel"><span class="rejReasonTag">${r.tag}</span><span class="rejReasonTitle">${r.title}</span></div>
            <div class="rejReasonChev">▾</div>
          </div>
          <div class="rejReasonBody">${r.body}</div>
        </div>`).join('')}</div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else if(s===4){
    inner = `<div class="p">This is why how we respond to rejection isn't just personal — it's a matter of safety.</div>
      <div class="rejStatBlock">
        <div class="rejStatNum" id="rejStatNum">0%</div>
        <div class="rejStatBody">of teen victims of intimate-partner homicides were girls killed by a partner who was jealous or angry about a breakup or unrequited affection.</div>
        <div class="rejStatNote">When rejection isn't treated as neutral — when it's taken as a personal attack or a challenge to someone's identity — the consequences can be devastating. Respecting "no" literally saves lives.</div>
      </div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else if(s===5){
    const sc = REJ_SCENARIOS[rs.scenarioIdx];
    const chosen = rs.scenarioAnswered ? rs.scenarioChosen : -1;
    const chosenGood = chosen >= 0 ? sc.opts[chosen].good : false;
    const optButtons = sc.opts.map((o,i)=>{
      let cls = 'rejOpt';
      if(chosen >= 0){
        if(i===chosen) cls += chosenGood ? ' good-chosen' : ' bad-chosen';
        else cls += sc.opts[i].good ? ' fade-good' : ' fade-bad';
      }
      return `<button class="${cls}" data-rejopt="${i}"><span class="rejOptEmoji">${o.e}</span>${o.t}</button>`;
    }).join('');
    const feedbackData = chosen >= 0 ? (chosenGood ? sc.good : sc.bad) : null;
    const feedbackHTML = feedbackData
      ? `<div class="rejFeedback show${chosenGood?'':' bad'}"><strong>${feedbackData.h}</strong>${feedbackData.t}</div>`
      : `<div class="rejFeedback"></div>`;
    inner = `<div class="p">Real situations. Choose how you'd respond — there's something to learn in each one.</div>
      <div class="rejScenarioCard">
        <div class="rejScenarioText">${sc.text}</div>
        <div class="rejScenarioQ">How do you respond?</div>
        <div class="rejOptList">${optButtons}</div>
        ${feedbackHTML}
      </div>
      <div class="rejScenarioNav">
        <span style="font-size:12px;color:var(--muted)">Situation ${rs.scenarioIdx+1} of ${REJ_SCENARIOS.length}</span>
        ${rs.scenarioAnswered&&rs.scenarioIdx<REJ_SCENARIOS.length-1?`<button class="btn btnSmall" data-rejnextscenario style="width:auto">Next →</button>`:rs.scenarioAnswered?`<button class="btn btnSmall btnPrimary" data-rejnext style="width:auto">Continue →</button>`:''}
      </div>
      <div class="rejNavRow" style="margin-top:8px">${rs.scenarioIdx > 0 ? `<button class="btn" data-rejprevscenario>← Previous Question</button>` : `<button class="btn" data-rejback>← Back</button>`}</div>`;
  } else if(s===6){
    const tabs = REJ_JOURNAL.map((p,i)=>`<button class="rejJTab${i===rs.journalTab?' on':''}" data-rejjtab="${i}">${p.tab}</button>`).join('');
    const panels = REJ_JOURNAL.map((p,i)=>{
      const val = rs['j'+i]||'';
      return `<div class="rejJPanel${i===rs.journalTab?' on':''}">
        <div class="rejJPrompt">${p.prompt}</div>
        <div class="rejJHint">${p.hint}</div>
        <textarea class="rejJTa" data-rejjtextarea="${i}" placeholder="Write here... (this is just for you)">${val}</textarea>
        <div class="rejWC" id="rejWC${i}">${rejWC(val)} words</div>
        <div class="rejJAffirm${rejWC(val)>=10?' show':''}" id="rejJA${i}"><b>💫</b> ${p.affirm}</div>
      </div>`;}).join('');
    inner = `<div class="p">These prompts are private — just for you. Write as much or as little as you want.</div>
      <div class="rejJournalTabs">${tabs}</div><div>${panels}</div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else if(s===7){
    const a = REJ_AFFIRMS[rs.affirmIdx];
    const dots = REJ_AFFIRMS.map((_,i)=>`<span class="rejADot${i===rs.affirmIdx?' on':''}" data-rejadot="${i}"></span>`).join('');
    inner = `<div class="p">Swipe through these — take a breath and let the ones that land, land.</div>
      <div class="rejAffirmCard">
        <span class="rejAffirmEmoji">${a.e}</span>
        <div class="rejAffirmText show">${a.t}</div>
      </div>
      <div class="rejAffirmControls">
        <button class="rejAffirmArrow" data-rejarrprev>←</button>
        <div class="rejADots">${dots}</div>
        <button class="rejAffirmArrow" data-rejarrnext>→</button>
      </div>
      <div class="rejNavRow"><button class="btn" data-rejback>← Back</button><button class="btn btnPrimary" data-rejnext>Next →</button></div>`;
  } else {
    inner = `<div style="text-align:center;padding:14px 0 20px">
        <div style="font-size:2.5rem;margin-bottom:10px">🌱</div>
        <div class="h1">You're going to be okay.</div>
        <div class="p">Rejection is part of the journey, not the destination. Every experience shapes who you are and helps you understand what you're really looking for.</div>
      </div>
      <div class="rejWrapPills">${['Your worth doesn\'t change with a "no"','Respecting others\' choices matters','"No" is a complete sentence','There are always more opportunities','Feelings are valid — behaviors have consequences','You deserve someone who is a genuine yes','This is not the whole story of your life'].map(p=>`<span class="rejWrapPill">${p}</span>`).join('')}</div>
      <div class="rejNavRow" style="flex-direction:column;gap:8px">
        <button class="btn btnPrimary" data-rejrestart>Start this tool over ↺</button>
        <button class="btn" data-action="nextSteps">Back to Next Steps</button>
      </div>`;
  }

  screen.innerHTML = backBtn() + `
    <div class="rejHeader">
      <div class="rejEyebrow">BAE Check — Guided Tool</div>
      <div class="h1">💔 When Someone Says No</div>
      <div class="p" style="margin:0">A tool to help you process rejection and understand your worth.</div>
    </div>
    <div class="rejProgress">${stepsHTML}</div>
    <div class="rejPanel active">${inner}</div>`;

  // Attach all event handlers
  const el = screen;

  el.querySelectorAll('[data-rejfeeling]').forEach(btn=>{
    btn.onclick=()=>{ rState.feeling=btn.dataset.rejfeeling; rejectionScreen(); };
  });
  el.querySelectorAll('[data-rejnext]').forEach(b=>{
    b.onclick=()=>{ rState.step=Math.min(REJ_STEPS.length-1,rState.step+1); rState.scenarioAnswered=false; rState.scenarioChosen=-1; rejectionScreen(); };
  });
  el.querySelectorAll('[data-rejback]').forEach(b=>{
    b.onclick=()=>{ if(rState.step>0){rState.step--;rejectionScreen();}else{go('nextSteps');} };
  });
  el.querySelectorAll('[data-rejrestart]').forEach(b=>{
    b.onclick=()=>{ resetRState(); rejectionScreen(); };
  });
  el.querySelectorAll('[data-mythtoggle]').forEach(card=>{
    card.onclick=()=>{
      const open=card.classList.contains('open');
      el.querySelectorAll('.rejMythCard').forEach(c=>c.classList.remove('open'));
      if(!open) card.classList.add('open');
    };
  });
  const noBig=el.querySelector('#rejNoBig');
  if(noBig) noBig.onclick=()=>{ rState.noRevealed=true; rejectionScreen(); };
  el.querySelectorAll('[data-reasontoggle]').forEach(row=>{
    row.onclick=()=>{
      const open=row.classList.contains('open');
      el.querySelectorAll('.rejReasonRow').forEach(r=>r.classList.remove('open'));
      if(!open) row.classList.add('open');
    };
  });
  const statEl=el.querySelector('#rejStatNum');
  if(statEl){ let n=0; const t=setInterval(()=>{n+=2;if(n>=90){n=90;clearInterval(t);}statEl.textContent=n+'%';},25); }
  el.querySelectorAll('[data-rejopt]').forEach(btn=>{
    btn.onclick=()=>{
      if(rState.scenarioAnswered) return;
      rState.scenarioAnswered=true;
      rState.scenarioChosen=parseInt(btn.dataset.rejopt);
      rState.scenarioAnswers[rState.scenarioIdx]=rState.scenarioChosen;
      rejectionScreen();
    };
  });
  el.querySelectorAll('[data-rejnextscenario]').forEach(b=>{
    b.onclick=()=>{
      rState.scenarioIdx++;
      if(rState.scenarioAnswers[rState.scenarioIdx] !== undefined){
        rState.scenarioAnswered=true;
        rState.scenarioChosen=rState.scenarioAnswers[rState.scenarioIdx];
      } else {
        rState.scenarioAnswered=false;
        rState.scenarioChosen=-1;
      }
      rejectionScreen();
    };
  });
  el.querySelectorAll('[data-rejprevscenario]').forEach(b=>{
    b.onclick=()=>{
      rState.scenarioIdx=Math.max(0, rState.scenarioIdx-1);
      if(rState.scenarioAnswers[rState.scenarioIdx] !== undefined){
        rState.scenarioAnswered=true;
        rState.scenarioChosen=rState.scenarioAnswers[rState.scenarioIdx];
      } else {
        rState.scenarioAnswered=false;
        rState.scenarioChosen=-1;
      }
      rejectionScreen();
    };
  });
  el.querySelectorAll('[data-rejjtab]').forEach(t=>{
    t.onclick=()=>{ rState.journalTab=parseInt(t.dataset.rejjtab); rejectionScreen(); };
  });
  el.querySelectorAll('[data-rejjtextarea]').forEach(ta=>{
    ta.oninput=()=>{
      const i=parseInt(ta.dataset.rejjtextarea);
      rState['j'+i]=ta.value;
      const wc=el.querySelector('#rejWC'+i); if(wc) wc.textContent=rejWC(ta.value)+' words';
      const ja=el.querySelector('#rejJA'+i); if(ja&&rejWC(ta.value)>=10) ja.classList.add('show');
    };
  });
  el.querySelectorAll('[data-rejarrprev]').forEach(b=>{ b.onclick=()=>{ rState.affirmIdx=(rState.affirmIdx-1+REJ_AFFIRMS.length)%REJ_AFFIRMS.length; rejectionScreen(); }; });
  el.querySelectorAll('[data-rejarrnext]').forEach(b=>{ b.onclick=()=>{ rState.affirmIdx=(rState.affirmIdx+1)%REJ_AFFIRMS.length; rejectionScreen(); }; });
  el.querySelectorAll('[data-rejadot]').forEach(d=>{ d.onclick=()=>{ rState.affirmIdx=parseInt(d.dataset.rejadot); rejectionScreen(); }; });
}

actions.rejection = ()=>go('rejection');

// ============================================================
// DIGITAL SAFETY & IMAGE CONSENT TOOL
// ============================================================

const DS_STEPS = ['Intro', 'Online dangers', 'Sending nudes', 'If it happens to you', 'Bystander support', 'Resources'];

// Step 1: Online Dangers — expandable cards
const DS_DANGER_CARDS = [
  {
    emoji: '📡',
    head: 'Always connected',
    tag: 'risk',
    tagLabel: 'Heads up',
    body: 'Think about how many devices you carry — phone, laptop, smartwatch. Constant notifications and "FOMO" can fuel anxiety and make it hard to step back from situations that don\'t feel right.'
  },
  {
    emoji: '🚪',
    head: 'No "safe" zone',
    tag: 'risk',
    tagLabel: 'Heads up',
    body: 'Most people carry their phones everywhere. Anyone can reach you via DMs at any time. If someone starts harassing or bullying you online, it can feel impossible to find an escape.'
  },
  {
    emoji: '❓',
    head: 'Anyone can be anonymous',
    tag: 'risk',
    tagLabel: 'Heads up',
    body: 'The internet lets anyone stay unknown or pretend to be someone else. You don\'t always know who you\'re really talking to — which makes it easier for people to harass survivors from the shadows.'
  },
  {
    emoji: '🎭',
    head: 'Online predators & sextortion',
    tag: 'no',
    tagLabel: 'Serious risk',
    body: 'Some adults pose as young people on apps, social media, and gaming communities to pressure teens for intimate images — then blackmail them. This is called <b>sextortion</b>. Block any contact that escalates inappropriately and tell a trusted adult immediately.'
  }
];

// Step 2: Sending nudes — risk awareness cards
const DS_NUDE_CARDS = [
  {
    emoji: '🔁',
    head: 'Once sent, you lose control',
    tag: 'risk',
    tagLabel: 'Real risk',
    body: 'After you send an image, you can\'t control what happens to it. Screenshots, forwarding, and saving happen even when someone promises otherwise. Ask yourself: do you fully trust this person?'
  },
  {
    emoji: '🤐',
    head: 'Pressure is not consent',
    tag: 'no',
    tagLabel: 'Not okay',
    body: '"If you loved me you would," repeated asking after you\'ve said no, or threatening to end the relationship — none of this is real consent. <b>You don\'t owe anyone nudes.</b> Ever.'
  },
  {
    emoji: '⚖️',
    head: 'There are legal consequences',
    tag: 'risk',
    tagLabel: 'Know the law',
    body: 'Laws vary by state. Sharing intimate images of someone under 18 — even if they were sent willingly — can be a criminal offense. Reporting can be complicated for minors, so look up "intimate images laws" in your state and talk to a trusted adult.'
  },
  {
    emoji: '💔',
    head: 'If it\'s shared without consent',
    tag: 'no',
    tagLabel: 'Not your fault',
    body: 'If you\'re pressured into sending nudes, or they\'re shared without your permission, <b>it is not your fault.</b> This is a form of harassment. Nobody deserves to have their images used against them.'
  }
];

// Step 3: Action steps if images were shared
const DS_ACTION_STEPS = [
  {
    num: '1',
    title: 'It\'s not your fault',
    body: 'Being pressured or having images shared without your consent is harassment — full stop. What happened to you is wrong, and you deserve support.'
  },
  {
    num: '2',
    title: 'Document everything',
    body: 'Screenshot the posts/accounts (with timestamps), note usernames and URLs. This evidence matters if you decide to report later.'
  },
  {
    num: '3',
    title: 'Report & block on the platform',
    body: 'Report the posts/accounts to the social media platform to get them taken down. Block the person(s) and consider temporarily deactivating your account to protect your mental health — this is not letting them win.'
  },
  {
    num: '4',
    title: 'Use StopNCII.org',
    body: 'StopNCII creates a digital "hash" of your image so platforms can detect and auto-block it — without anyone seeing the photo. Free and confidential.'
  },
  {
    num: '5',
    title: 'Tell a trusted adult',
    body: 'Reach out to a school counselor, therapist, family member, or advocate. Note: school officials are often mandated reporters and may need to contact authorities depending on the situation.'
  },
  {
    num: '6',
    title: 'Know your legal options',
    body: 'In most U.S. states, sharing intimate images without consent is illegal. The Cyber Civil Rights Initiative offers free legal referrals. If you\'re under 18, NCMEC\'s CyberTipline is also an option.'
  }
];

// Step 4: Bystander support scripts
const DS_SCRIPTS = {
  'Supporting a survivor': {
    label: 'Supporting a survivor',
    lines: [
      'I believe you, and what\'s happening to you isn\'t okay.',
      'You don\'t deserve this — it\'s not your fault at all.',
      'I\'ve got your back. How can I best support you right now?'
    ]
  },
  'Setting a boundary': {
    label: 'Setting a boundary',
    lines: [
      'I\'m not comfortable sharing or receiving photos like that. I need you to respect that.',
      'Even if someone is pressuring you: "I\'ve already said no. That\'s not going to change."',
      'You never have to explain or soften a boundary — stating it clearly is enough.'
    ]
  },
  'Responding to gossip': {
    label: 'Shutting down gossip',
    lines: [
      'That\'s someone\'s private life — I\'m not going to engage with this.',
      'Sharing or liking this kind of stuff only makes it worse for them.',
      'If you actually care about what happened, focus on supporting them, not spreading it.'
    ]
  },
  'Asking before sending': {
    label: 'Asking before sending',
    lines: [
      'Hey — I\'d love to share something more intimate. Are you comfortable with that?',
      'If yes: "I want you to know I\'d never share it or keep it if you ever asked me to delete it."',
      'If no or unsure: "Totally okay, no pressure. I appreciate you being honest with me."'
    ]
  }
};

const DS_RESOURCES = [
  {
    icon: '🏫',
    name: 'SafeBAE',
    desc: 'Resources, support, and education for teen survivors',
    url: 'https://safebae.org'
  },
  {
    icon: '🛑',
    name: 'StopNCII.org',
    desc: 'Hash your image so platforms auto-block it — no one sees the photo',
    url: 'https://stopncii.org'
  },
  {
    icon: '⚖️',
    name: 'Cyber Civil Rights Initiative',
    desc: 'Free legal referrals and crisis support for image-based abuse',
    url: 'https://cybercivilrights.org'
  },
  {
    icon: '💬',
    name: 'Crisis Text Line',
    desc: 'Text HOME to 741741 — free, confidential support 24/7',
    url: 'https://crisistextline.org'
  },
  {
    icon: '📋',
    name: 'NCMEC CyberTipline (under 18)',
    desc: 'Report child sexual exploitation images at CyberTipline.org',
    url: 'https://www.missingkids.org/gethelpnow/cybertipline'
  }
];

let dsState = { step: 0, openCard: -1, nudeCard: -1, scriptKey: 'Supporting a survivor' };

function dsRender(){
  const id = 'digitalSafety';
  const s = dsState.step;
  const totalSteps = DS_STEPS.length;

  const progressDots = DS_STEPS.map((_,i) => {
    let cls = 'dsProgressDot';
    if(i < s) cls += ' done';
    else if(i === s) cls += ' active';
    return `<div class="${cls}"></div>`;
  }).join('');

  let innerHTML = '';

  if(s === 0){
    // Intro
    innerHTML = `
      <div class="p">Being online is part of everyday life — and so is navigating it safely. This tool covers the risks of sharing intimate images, what to do if something goes wrong, and how to support people around you.</div>
      <div class="note"><b>This tool covers:</b> Online dangers & predators · Sending nudes & knowing the risks · What to do if images are shared · How to support survivors</div>
      <div class="note" style="border-color:rgba(209,254,255,.4);background:rgba(209,254,255,.06);">🔒 <b>Private:</b> Nothing you do here is stored or shared. This is a judgment-free zone.</div>
      <div class="dsNavRow"><button class="btn btnPrimary" data-dsaction="next">Let's start →</button></div>
    `;
  } else if(s === 1){
    // Online dangers — expandable cards
    const cards = DS_DANGER_CARDS.map((c,i) => `
      <div class="dsConsentCard${dsState.openCard===i?' open':''}" data-dscard="${i}">
        <div class="dsConsentHead">
          <span class="dsConsentEmoji">${c.emoji}</span>
          ${c.head}
          <span class="dsConsentChev">▾</span>
        </div>
        <div class="dsConsentBody">
          <span class="dsConsentTag ${c.tag}">${c.tagLabel}</span><br>
          ${c.body}
        </div>
      </div>`).join('');
    innerHTML = `
      <div class="p">The internet makes connection easier — and danger harder to spot. Tap each card to learn what to watch for.</div>
      <div class="dsConsentGrid">${cards}</div>
      <div class="note" style="margin-top:4px;">🔑 <b>Stay safe:</b> Keep your profile private, avoid sharing your location in real time, and only communicate with people who respect your comfort level.</div>
      <div class="dsNavRow">
        <button class="btn" data-dsaction="back">← Back</button>
        <button class="btn btnPrimary" data-dsaction="next">Next →</button>
      </div>
    `;
  } else if(s === 2){
    // Sending nudes — risk cards
    const cards = DS_NUDE_CARDS.map((c,i) => `
      <div class="dsConsentCard${dsState.nudeCard===i?' open':''}" data-dsnudecard="${i}">
        <div class="dsConsentHead">
          <span class="dsConsentEmoji">${c.emoji}</span>
          ${c.head}
          <span class="dsConsentChev">▾</span>
        </div>
        <div class="dsConsentBody">
          <span class="dsConsentTag ${c.tag}">${c.tagLabel}</span><br>
          ${c.body}
        </div>
      </div>`).join('');
    innerHTML = `
      <div class="p">Sending intimate images has become normalized — but the risks are real. This isn't about judgment. It's about making informed choices. <b>#KnowB4UNude</b></div>
      <div class="dsConsentGrid">${cards}</div>
      <div class="dsNavRow">
        <button class="btn" data-dsaction="back">← Back</button>
        <button class="btn btnPrimary" data-dsaction="next">Next →</button>
      </div>
    `;
  } else if(s === 3){
    // If images were shared without consent
    const steps = DS_ACTION_STEPS.map(a => `
      <div class="dsStep">
        <div class="dsStepNum">${a.num}</div>
        <div class="dsStepText"><b>${a.title}</b><br>${a.body}</div>
      </div>`).join('');
    innerHTML = `
      <div class="p">If intimate images of you were shared without your consent — or you\'re being pressured or blackmailed — here are clear steps to take.</div>
      <div class="note" style="border-color:rgba(209,254,255,.4);background:rgba(0,0,0,.14);">Remember: what\'s being spread reflects on <em>them</em>, not you. You are not alone, and this is not the whole story of your life.</div>
      <div class="dsStepList">${steps}</div>
      <div class="dsNavRow">
        <button class="btn" data-dsaction="back">← Back</button>
        <button class="btn btnPrimary" data-dsaction="next">Next →</button>
      </div>
    `;
  } else if(s === 4){
    // Bystander support scripts
    const keys = Object.keys(DS_SCRIPTS);
    const chips = keys.map(k => `<button class="dsScriptChip${dsState.scriptKey===k?' on':''}" data-dschip="${k}">${DS_SCRIPTS[k].label}</button>`).join('');
    const sc = DS_SCRIPTS[dsState.scriptKey];
    const lines = sc.lines.map(l => `<div class="dsScriptText" style="margin-bottom:8px;">"${l}"</div>`).join('');
    innerHTML = `
      <div class="p">Ending online harassment is everyone\'s responsibility. Pick a situation below for real language you can use — no one can do everything, but everyone can do something.</div>
      <div class="dsScriptSwitcher">${chips}</div>
      <div class="dsScriptBlock">
        <div class="dsScriptLabel">${sc.label}</div>
        ${lines}
      </div>
      <div class="mutedBox">These are starting points — adjust the tone to fit your voice. The goal is showing up, not perfection.</div>
      <div class="dsNavRow">
        <button class="btn" data-dsaction="back">← Back</button>
        <button class="btn btnPrimary" data-dsaction="next">Next →</button>
      </div>
    `;
  } else {
    // Resources
    const resources = DS_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You don\'t have to navigate this alone. These resources are here specifically for teens dealing with digital safety and image-based abuse.</div>
      <div class="dsResourceList">${resources}</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-dsaction="restart" style="width:100%">Start this tool over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Tool</div>
      <div class="h1">📱 Digital Safety & Image Consent</div>
      <div class="p" style="margin:0">Consent online, what to do if images are shared, and real scripts.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Attach events
  screen.querySelectorAll('[data-dsaction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.dsaction;
      if(a === 'next'){ dsState.step = Math.min(DS_STEPS.length-1, dsState.step+1); dsRender(); }
      else if(a === 'back'){ dsState.step = Math.max(0, dsState.step-1); dsRender(); }
      else if(a === 'restart'){ dsState = { step:0, openCard:-1, nudeCard:-1, scriptKey:'Supporting a survivor' }; dsRender(); }
    };
  });
  screen.querySelectorAll('[data-dscard]').forEach(card => {
    card.onclick = () => {
      const i = parseInt(card.dataset.dscard);
      dsState.openCard = dsState.openCard === i ? -1 : i;
      dsRender();
    };
  });
  screen.querySelectorAll('[data-dsnudecard]').forEach(card => {
    card.onclick = () => {
      const i = parseInt(card.dataset.dsnudecard);
      dsState.nudeCard = dsState.nudeCard === i ? -1 : i;
      dsRender();
    };
  });
  screen.querySelectorAll('[data-dschip]').forEach(chip => {
    chip.onclick = () => { dsState.scriptKey = chip.dataset.dschip; dsRender(); };
  });
}

// Register the digitalSafety screen in render()
const _origRender = render;
// Patch: the digitalSafety screen is handled inside render() via the id check below
// We inject the digitalSafety case by appending to the render function logic
const _dsScreenPatch = true; // flag so we know to handle it

actions.digitalSafety = () => {
  dsState = { step: 0, openCard: -1, nudeCard: -1, scriptKey: 'Supporting a survivor' };
  go('digitalSafety');
};

// ============================================================
// MALE YOUTH & SEXUAL VIOLENCE MODULE
// ============================================================

const MY_STEPS = [
  'Intro',
  'Understanding Context',
  'Gender Rules & Toxic Masculinity',
  'Bro-Code',
  'Men as Survivors',
  'Rejection',
  'BAEcode: Being the Change',
  'The Standard',
  'The Real Talk Test',
  'Knowledge Check',
  'Resources'
];

const MY_INFO_CARDS = [
  {
    emoji: '⚠️',
    head: 'Sexual violence is LEARNED — not inevitable',
    tag: 'no',
    tagLabel: 'Myth',
    body: 'False messages from TV, music, social media, and peers pressure boys into harmful behaviors. Entitlement, aggression, and silence around vulnerability are taught — which means they can be unlearned.'
  },
  {
    emoji: '🪞',
    head: '"Boys will be boys" — what it actually means',
    tag: 'no',
    tagLabel: 'Harmful Idea',
    body: 'This phrase is used to excuse behavior by implying boys can\'t control themselves. Think about what that actually says: that you\'re not capable of empathy, self-regulation, or accountability. It\'s a low bar dressed up as an excuse — and it does real damage.'
  },
  {
    emoji: '🌐',
    head: 'The system doesn\'t just hurt women',
    tag: 'yes',
    tagLabel: 'Key Insight',
    body: 'The same rules that restrict women also restrict men — just differently. They give you a narrow, brittle version of manhood that cuts you off from real friendships, emotional depth, and the ability to ask for help. Vulnerability isn\'t weakness. It\'s what makes relationships actually work.'
  },
  {
    emoji: '🔁',
    head: 'Gender roles are a feedback loop',
    tag: 'no',
    tagLabel: 'System',
    body: 'From the toys you were given to the movies you watched, you were being taught what "masculine" looks like. Those messages shape what skills you develop and what you suppress — which then reinforces the same stereotypes for the next generation. You can\'t opt out of having been shaped by it. But you can decide what you do with it now.'
  }
];

const MY_BROCODE_ITEMS = [
  { label: 'Stay loyal to your friends no matter what — even when they\'re causing harm', harm: 'Loyalty becomes a shield for bad behavior. It protects the person doing damage, not the people being damaged.' },
  { label: 'Never show vulnerability or emotion — that\'s weakness', harm: 'Feelings that can\'t go anywhere don\'t disappear. They accumulate and come out as anger, aggression, or worse.' },
  { label: 'Treat anyone not a cis male as lesser — or as an object', harm: 'This is how entitlement forms. And entitlement is where most harm starts.' },
  { label: 'Dominate, collect "conquests," never let your guard down', harm: 'When sex becomes a score, consent stops being the point. That\'s a serious problem.' },
  { label: 'Never snitch — cover for your friends, always', harm: 'Silence after harm happens makes you part of what happened. That\'s not loyalty — that\'s complicity.' }
];

const MY_BAECODE_ITEMS = [
  'Watch out for everyone in the room — not just the people you came with',
  'Step in when something looks off. You don\'t need a perfect script — just don\'t walk past it',
  'Get a clear yes, not just an absence of no',
  'If someone\'s too drunk to drive, they\'re too drunk to consent. Help them get home',
  'Call out the joke. You don\'t have to lecture — just don\'t laugh',
  'When a friend tells you they were assaulted, believe them. That takes guts to say',
  'Holding your friends accountable is what loyalty actually looks like'
];

const MY_QUIZ = [
  {
    q: 'Harmful behaviors in men are mostly caused by:',
    options: ['Biology and hormones', 'Learned social messages and culture', 'Bad individual character', 'Random chance'],
    correct: 1,
    explain: 'This stuff is learned — through media, peer groups, what got rewarded and what got mocked. That means it can be unlearned. That\'s the whole point.'
  },
  {
    q: '"Boys will be boys" is harmful because it implies boys are NOT:',
    options: ['Athletic and competitive', 'Capable of self-control and caring for others', 'Interested in relationships', 'Interested in school'],
    correct: 1,
    explain: 'The phrase says boys can\'t regulate themselves or be accountable. That\'s a low bar — and most guys are capable of a lot more than it gives them credit for.'
  },
  {
    q: 'Bro-code becomes a problem when it means:',
    options: ['Supporting your friends emotionally', 'Covering for friends who cause harm to avoid being an outcast', 'Spending time with male friends', 'Being loyal in general'],
    correct: 1,
    explain: 'Covering for someone who caused harm doesn\'t make you loyal — it makes you part of what happened. Real loyalty means being honest, not being a shield.'
  },
  {
    q: 'Men can be survivors of sexual violence. Which statement is true?',
    options: [
      'Men who are assaulted must not have wanted to stop it',
      'Only gay men are assaulted by other men',
      'Most male perpetrators of sexual violence identify as heterosexual',
      'An erection always means consent'
    ],
    correct: 2,
    explain: 'Most male perpetrators identify as heterosexual. A physical response is biology — it\'s not agreement. Sexual violence affects every gender, and assumptions about who can be a victim stop a lot of men from ever speaking up.'
  },
  {
    q: 'When someone says "no" to a date or hookup, the right response is:',
    options: [
      'Try harder — persistence shows you\'re serious',
      'Get angry — rejection is disrespectful',
      'Accept it. Rejection is a neutral event, not an attack on your worth',
      'Cut them off completely'
    ],
    correct: 2,
    explain: 'Rejection is someone making a choice — the same kind you\'re allowed to make. It\'s not about you. When men treat rejection as a personal attack, the consequences can be serious.'
  }
];

const MY_RESOURCES = [
  { icon: '🏫', name: 'SafeBAE', desc: 'Student-led resources, education, and support for teen survivors', url: 'https://safebae.org' },
  { icon: '📞', name: 'RAINN Hotline', desc: '1-800-656-HOPE — National Sexual Assault Hotline, 24/7 confidential', url: 'https://rainn.org' },
  { icon: '💬', name: 'Crisis Text Line', desc: 'Text HOME to 741741 — free, confidential support 24/7', url: 'https://crisistextline.org' },
  { icon: '🧠', name: 'A Call To Men', desc: 'Healthy manhood education and bystander tools for men and boys', url: 'https://acalltomen.org' },
  { icon: '🤝', name: '1in6.org', desc: 'Support and resources specifically for male survivors of sexual abuse', url: 'https://1in6.org' }
];

let myState = { step: 0, openCard: -1, quizIdx: 0, quizAnswers: {}, tsSelected: [], ttOpenIdx: null };

function myRender() {
  const s = myState.step;
  const totalSteps = MY_STEPS.length;

  const progressDots = MY_STEPS.map((_,i) => {
    let cls = 'dsProgressDot';
    if(i < s) cls += ' done';
    else if(i === s) cls += ' active';
    return `<div class="${cls}"></div>`;
  }).join('');

  let innerHTML = '';

  if(s === 0) {
    innerHTML = `
      <div class="p">Most conversations about sexual violence aren't aimed at you. They talk about the problem without talking to the people who are most positioned to change it.</div>
      <div class="p" style="color:var(--muted);">This module is different. It's about what you've been taught, what actually plays out in practice, and what it looks like to hold yourself to a higher bar.</div>
      <div class="note"><b>What's ahead:</b> Where the rules come from · Bro-code and what it actually costs · Men as survivors · Rejection · The Standard · The Real Talk Test · Knowledge check</div>
      <div class="note" style="border-color:rgba(209,254,255,.4);background:rgba(209,254,255,.06);">🔒 Nothing you do here is stored or shared.</div>
      <div class="note" style="border-color:rgba(255,200,100,.3); background:rgba(255,200,100,.06); color:var(--sb-light);">This module covers sexual assault and violence. Take a break at any point — it'll be here when you come back.</div>
      <div class="dsNavRow"><button class="btn btnPrimary" data-myaction="next">Let's go →</button></div>
    `;
  } else if(s === 1) {
    innerHTML = `
      <div class="p" style="font-weight:800; font-size:15px; color:var(--sb-light);">A few things to be straight about before we start.</div>
      <div class="p">Sexual violence affects every gender. Every gender is capable of causing harm. The majority of men don't assault anyone.</div>
      <div class="note" style="border-color:rgba(255,80,80,.4); background:rgba(255,80,80,.07);">And yet — men make up the highest percentage of perpetrators across every form of sexual harm. That's not an accusation. It's the reason this conversation matters and why you're the right person to have it.</div>
      <div class="p" style="margin-top:10px;">This isn't a women's issue that men should care about as allies. It's a human issue — and the people with the most power to shift the culture are the ones inside it.</div>
      <div class="mutedBox">That's you. Not because you've done something wrong. Because you're in a position to do something right.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next →</button>
      </div>
    `;
  } else if(s === 2) {
    const cards = MY_INFO_CARDS.map((c,i) => `
      <div class="dsConsentCard${myState.openCard===i?' open':''}" data-mycard="${i}">
        <div class="dsConsentHead">
          <span class="dsConsentEmoji">${c.emoji}</span>
          ${c.head}
          <span class="dsConsentChev">▾</span>
        </div>
        <div class="dsConsentBody">
          <span class="dsConsentTag ${c.tag}">${c.tagLabel}</span><br>
          ${c.body}
        </div>
      </div>`).join('');
    innerHTML = `
      <div class="p">You didn't invent the rules. You inherited them — from media, from older guys, from what got rewarded and what got mocked. Most men have never examined where any of it came from.</div>
      <div class="p" style="color:var(--muted);">Tap each card to look at what's actually being taught.</div>
      <div class="dsConsentGrid">${cards}</div>
      <div class="mutedBox" style="margin-top:4px;">Behavior that's learned can be unlearned. That's not a therapy statement — it's just how it works.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next →</button>
      </div>
    `;
  } else if(s === 3) {
    const broItems = MY_BROCODE_ITEMS.map(item => `
      <div class="dsStep" style="flex-direction:column; gap:6px;">
        <div style="display:flex; align-items:flex-start; gap:10px;">
          <div class="dsStepNum" style="background:rgba(255,80,80,.15); border-color:rgba(255,80,80,.4); color:#ff6060;">✗</div>
          <div class="dsStepText"><b>${item.label}</b></div>
        </div>
        <div style="margin-left:38px; font-size:12px; color:rgba(255,160,160,.8); line-height:1.35;">↳ ${item.harm}</div>
      </div>`).join('');
    innerHTML = `
      <div class="p">Bro-code isn't just locker room talk. It's a set of unspoken rules that shape what men do, what they stay silent about, and what they cover for.</div>
      <div class="dsStepList">${broItems}</div>
      <div class="mutedBox" style="margin-top:10px;">When you can't be vulnerable with other men, feelings don't disappear — they build up and come out as something else. The cycle looks like this: suppress it → low self-worth → stuck → trauma → consequences → back to suppressing it.</div>
      <div class="note" style="border-color:rgba(21,255,200,.4);">Real loyalty isn't protecting someone from consequences. It's caring enough to tell them the truth. Those aren't the same thing.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next →</button>
      </div>
    `;
  } else if(s === 4) {
    innerHTML = `
      <div class="p" style="font-weight:800; font-size:15px; color:var(--sb-light);">Men get assaulted too. And it's handled badly.</div>
      <div class="p">The idea that men can't be victims — or that they secretly wanted it — isn't just wrong. It's the reason most male survivors never say anything.</div>
      <div class="dsStepList">
        <div class="dsStep">
          <div class="dsStepNum">1</div>
          <div class="dsStepText"><b>The dismissal is immediate</b><br>Tell your friends you were assaulted and you're likely to hear "you must have wanted it" or silence. That response does real damage.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">2</div>
          <div class="dsStepText"><b>Women can and do commit sexual violence against men</b><br>The cultural assumption that a guy who didn't want sex must be gay stops a lot of men from naming what happened to them.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">3</div>
          <div class="dsStepText"><b>A physical response is not consent</b><br>An erection is a biological reaction. It says nothing about what someone wanted or agreed to.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">4</div>
          <div class="dsStepText"><b>Some men carry more risk</b><br>Black, transgender, and LGBTQ+ men face significantly higher rates of sexual violence. 1 in 6 Black boys will experience sexual abuse before age 18. This isn't talked about enough.</div>
        </div>
      </div>
      <div class="note" style="border-color:rgba(21,255,200,.4);">If a friend tells you they were assaulted — believe them. Listen without pressing for details. Don't make it about their gender. Don't push them to report. Your job in that moment is to be someone they can trust.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next →</button>
      </div>
    `;
  } else if(s === 5) {
    innerHTML = `
      <div class="p" style="font-weight:800; font-size:15px; color:var(--sb-light);">Rejection is a neutral event.</div>
      <div class="p">Not a verdict on who you are. Not disrespect. Not something to recover from or retaliate against. Someone made a choice — the same kind of choice you're allowed to make.</div>
      <div class="note" style="border-color:rgba(255,80,80,.4); background:rgba(255,80,80,.07);">📊 90% of teen intimate-partner homicide victims are girls — killed by a partner who was angry or jealous about a breakup or rejection. — <em>JAMA Pediatrics</em></div>
      <div class="dsStepList">
        <div class="dsStep">
          <div class="dsStepNum">1</div>
          <div class="dsStepText"><b>"No" is not an insult</b><br>It's a decision. It tells you nothing about your value — only about what that person wants right now.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">2</div>
          <div class="dsStepText"><b>Pressure is not persuasion</b><br>If someone gives in because they felt they had no other option, that's not a win. That's a problem — and it's on you to recognize the difference.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">3</div>
          <div class="dsStepText"><b>Going along isn't the same as saying yes</b><br>Compliance under pressure isn't consent. The absence of resistance isn't enthusiasm. If you're not sure, you're not done checking.</div>
        </div>
      </div>
      <div class="mutedBox">Someone not being ready doesn't say anything about you. There are timing factors, personal history, pressures you can't see. Accept it, move on, and stay the kind of person you'd want to be known as.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next →</button>
      </div>
    `;
  } else if(s === 6) {
    const baeItems = MY_BAECODE_ITEMS.map(item => `
      <div class="dsStep">
        <div class="dsStepNum" style="background:rgba(21,255,200,.15); border-color:rgba(21,255,200,.4); color:var(--sb-mint);">✓</div>
        <div class="dsStepText">${item}</div>
      </div>`).join('');
    const chips = [
      '"Did you really just say that?"',
      '"That\'s not cool."',
      '"Do you kiss your mom with that mouth?"',
      '"I can\'t be the only one who doesn\'t find this funny."',
      '"I\'m not going to hang around with people who say stuff like that."'
    ].map(p => `<div class="myPhrase">${p}</div>`).join('');
    innerHTML = `
      <div class="p">BAEcode is the counter-move to bro-code. It's what it looks like to hold yourself — and the people around you — to an actual standard.</div>
      <div class="dsStepList">${baeItems}</div>
      <div class="p" style="margin-top:12px; font-weight:800; color:var(--sb-light);">When you hear a rape joke or something that doesn't sit right:</div>
      <div class="myPhraseGrid">${chips}</div>
      <div class="mutedBox" style="margin-top:12px;">You don't have to give a speech. You just have to not go along with it. That's enough to shift what people think is acceptable in a room.</div>
      <div class="dsNavRow">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next: The Standard →</button>
      </div>
    `;
  } else if(s === 7) {
    // THE STANDARD — embedded
    const MY_TS_TRAITS = [
      { id:'clarity', icon:'🎯', label:'Clarity over assumption', desc:'When something\'s unclear, I pause and check. Assuming is lazy. Asking is confident.', alt:'I\'ll figure it out from context', altReframe:'Figuring it out from context means guessing at someone else\'s comfort. That\'s not skill — it\'s avoidance.' },
      { id:'awareness', icon:'👁️', label:'I read the room — all of it', desc:'Engagement is active. A real read means noticing when someone\'s gone quiet, slowed down, or stopped matching your energy.', alt:'If they didn\'t say anything, we\'re good', altReframe:'People don\'t always say something. That\'s the whole issue. Waiting for words when body language is off isn\'t attentiveness — it\'s wilful blindness.' },
      { id:'control', icon:'🧠', label:'I stay in control of myself', desc:'Drunk, charged, in the moment — I still make decisions I can stand behind the next morning. That\'s discipline. That\'s strength.', alt:'It\'s hard to think straight when things are intense', altReframe:'Hard is different from impossible. The guys who can regulate under pressure are the ones who don\'t have to apologize or explain themselves after.' },
      { id:'ownership', icon:'🪖', label:'I own my outcomes', desc:'If something went wrong, I don\'t build a case for why it wasn\'t my fault. I look at what I did or didn\'t do — and I fix it.', alt:'There were factors outside my control', altReframe:'Maybe. And your actions are still yours. Ownership isn\'t about blame — it\'s about not outsourcing your behaviour to circumstances.' },
      { id:'respect', icon:'⚡', label:'I don\'t need to push', desc:'If I have to push — pressure, persistence, convincing — that\'s a signal, not a strategy. Men who are genuinely confident don\'t need to override someone else\'s hesitation.', alt:'Sometimes you have to show you\'re serious', altReframe:'There\'s a difference between showing commitment and overriding someone\'s discomfort. One is attractive. The other is coercive.' }
    ];

    const traitCards = MY_TS_TRAITS.map(t => {
      const isOn = myState.tsSelected.includes(t.id);
      return `
        <div class="tsCard${isOn ? ' tsOn' : ''}" data-mytrait="${t.id}">
          <div class="tsCardTop">
            <span class="tsIcon">${t.icon}</span>
            <span class="tsCardLabel">${t.label}</span>
            <span class="tsToggle">${isOn ? '✓ IN' : 'ADD'}</span>
          </div>
          <div class="tsCardDesc">${t.desc}</div>
          ${isOn ? '' : `<div class="tsAlt"><span class="tsAltLabel">Common shortcut:</span> <em>"${t.alt}"</em></div><div class="tsAltReframe">${t.altReframe}</div>`}
        </div>`;
    }).join('');

    const commitLines = MY_TS_TRAITS.filter(t => myState.tsSelected.includes(t.id)).map(t => `<div class="tsCommitLine">${t.icon} ${t.label}</div>`).join('');
    const commitBox = myState.tsSelected.length > 0 ? `
      <div class="tsCommit" style="margin-top:12px;">
        <div class="tsCommitLabel">YOUR CODE</div>
        <div class="tsCommitText">${commitLines}</div>
        <div class="tsCommitSub">That's the standard. It doesn't change based on who's watching.</div>
      </div>` : '';

    innerHTML = `
      <div class="p" style="color:var(--muted);">Most guys operate by what they can get away with. That's a low bar. This is about what you actually hold yourself to.</div>
      <div class="tsIntro">High performers in any field — sport, business, combat — have a code they operate by. Not because someone made them. Because a man with no standard is just reacting. You decide the bar.</div>
      <div class="tsTraits" id="myTsTraits">${traitCards}</div>
      ${commitBox}
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Next: Real Talk Test →</button>
      </div>
    `;
  } else if(s === 8) {
    // THE REAL TALK TEST — embedded
    const MY_TT_ITEMS = [
      { claim: '"If she didn\'t say no, that\'s a yes."', soundsRight: 'Clean logic. No guessing. No mind-reading. Binary.', reality: 'In practice, most people who aren\'t comfortable don\'t say no out loud. They go quiet. They go along. They freeze. The absence of no is not the presence of yes — it\'s often just the presence of fear. If you\'re operating on this logic, you\'re not reading the situation. You\'re ignoring it.', theGap: 'Strong move: make yes obvious, not just assumed.' },
      { claim: '"We were both drinking, so it\'s equal."', soundsRight: 'Seems fair. Both made the same choice to drink. Nobody forced either of you.', reality: 'Being drunk doesn\'t mean both people had the same experience. One person can be significantly more impaired. "We were both drinking" doesn\'t neutralise a situation where one person wasn\'t in a state to clearly say yes. It\'s often used after the fact to spread responsibility — not to think clearly before.', theGap: 'If you wouldn\'t drive drunk, don\'t assume being drunk makes complex decisions cleaner.' },
      { claim: '"She was into it at the time."', soundsRight: 'You were there. You read the room. She seemed fine.', reality: 'Being into something in the moment and feeling okay about it afterward aren\'t the same. People can go along, be in shock, or suppress discomfort in the moment — and process what happened later. If you were genuinely paying attention, you\'d have checked in rather than assumed.', theGap: 'Reading the room isn\'t a one-time assessment. It\'s continuous.' },
      { claim: '"I didn\'t mean for it to go that way."', soundsRight: 'Intent matters. You\'re not a bad person. You weren\'t trying to hurt anyone.', reality: 'Intent and impact aren\'t the same thing. You can have good intentions and still cause harm — by moving too fast, by not paying attention, by assuming. The question isn\'t whether you meant it. The question is what you actually did, and what the person on the other end needs from you now.', theGap: 'Owning impact doesn\'t mean you\'re a bad person. It means you\'re accountable.' }
    ];

    const ttCards = MY_TT_ITEMS.map((item, i) => {
      const isOpen = myState.ttOpenIdx === i;
      return `
        <div class="ttCard${isOpen ? ' ttOpen' : ''}" data-myttcard="${i}">
          <div class="ttCardHeader">
            <div class="ttClaimWrap">
              <span class="ttClaimTag">THE LOGIC</span>
              <span class="ttClaim">${item.claim}</span>
            </div>
            <div class="ttChev"><svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          </div>
          ${isOpen ? `
          <div class="ttBody">
            <div class="ttSection"><div class="ttSectionLabel ttLabelSounds">Sounds right because</div><div class="ttSectionText">${item.soundsRight}</div></div>
            <div class="ttSection"><div class="ttSectionLabel ttLabelReality">What actually happens</div><div class="ttSectionText">${item.reality}</div></div>
            <div class="ttGap"><span class="ttGapIcon">→</span> ${item.theGap}</div>
          </div>` : ''}
        </div>`;
    }).join('');

    innerHTML = `
      <div class="p" style="color:var(--muted);">Some things sound sharp when you first hear them. Run them through what actually happens in practice — and see where the logic holds up.</div>
      <div class="ttIntro">This isn't about politics. It's not about who's right. It's about whether the thinking actually works when it hits a real situation — or whether it leaves you exposed.</div>
      <div class="ttCards">${ttCards}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-myaction="back">← Back</button>
        <button class="btn btnPrimary" data-myaction="next">Knowledge Check →</button>
      </div>
    `;
  } else if(s === 9) {
    // Knowledge Check Quiz
    const qi = myState.quizIdx;
    const q = MY_QUIZ[qi];
    const answered = myState.quizAnswers[qi] !== undefined;
    const chosen = myState.quizAnswers[qi];
    const isCorrect = chosen === q.correct;
    const isLast = qi === MY_QUIZ.length - 1;

    const opts = q.options.map((opt, oi) => {
      let cls = 'myQuizOpt';
      if(answered) {
        if(oi === q.correct) cls += ' myQuizCorrect';
        else if(oi === chosen && !isCorrect) cls += ' myQuizWrong';
      }
      return `<button class="btn ${cls}" data-myquiz="${oi}" ${answered?'disabled':''}>${opt}</button>`;
    }).join('');

    const feedback = answered ? `
      <div class="note" style="border-color:${isCorrect?'rgba(21,255,200,.5)':'rgba(255,80,80,.5)'}; background:${isCorrect?'rgba(21,255,200,.08)':'rgba(255,80,80,.08)'}; margin-top:8px;">
        ${isCorrect ? '✅ Correct!' : '❌ Not quite.'} ${q.explain}
      </div>` : '';

    const nextBtn = answered
      ? (isLast
        ? `<button class="btn btnPrimary" data-myaction="next" style="margin-top:10px;">See Resources →</button>`
        : `<button class="btn btnPrimary" data-myquiznext="1" style="margin-top:10px;">Next Question →</button>`)
      : '';

    const prevBtn = qi > 0
      ? `<button class="btn" data-myquizprev="1">← Previous Question</button>`
      : `<button class="btn" data-myaction="back">← Back</button>`;

    innerHTML = `
      <div class="p"><b>Question ${qi+1} of ${MY_QUIZ.length}</b></div>
      <div class="note" style="background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.25); font-size:15px; font-weight:800; color:var(--sb-light); margin-bottom:12px;">${q.q}</div>
      <div class="dsConsentGrid" style="gap:8px;">${opts}</div>
      ${feedback}
      ${nextBtn}
      <div class="dsNavRow" style="margin-top:12px;">
        ${prevBtn}
      </div>
    `;
  } else {
    // Resources (step 10)
    const resources = MY_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You don't have to figure this out alone. These are real resources — for survivors, for people who want to be better, and for anyone who needs to talk.</div>
      <div class="dsResourceList">${resources}</div>
      <div class="mutedBox" style="margin-top:12px;">Asking for help isn't soft. Holding yourself to a standard when no one's watching — that's what this was about.</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-myaction="restart" style="width:100%">Start this module over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Module</div>
      <div class="h1">👊 Men, Masculinity & Sexual Violence</div>
      <div class="p" style="margin:0">Masculinity, bro-code, rejection, and how to be part of the change.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Attach events
  screen.querySelectorAll('[data-myaction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.myaction;
      if(a === 'next'){ myState.step = Math.min(MY_STEPS.length-1, myState.step+1); myState.openCard=-1; myRender(); }
      else if(a === 'back'){ myState.step = Math.max(0, myState.step-1); myState.openCard=-1; myRender(); }
      else if(a === 'restart'){ myState={step:0,openCard:-1,quizIdx:0,quizAnswers:{},tsSelected:[],ttOpenIdx:null}; myRender(); }
    };
  });
  screen.querySelectorAll('[data-mycard]').forEach(card => {
    card.onclick = () => {
      const i = parseInt(card.dataset.mycard);
      myState.openCard = myState.openCard === i ? -1 : i;
      myRender();
    };
  });
  screen.querySelectorAll('[data-mytrait]').forEach(el => {
    el.onclick = () => {
      const id = el.dataset.mytrait;
      const idx = myState.tsSelected.indexOf(id);
      if(idx >= 0) myState.tsSelected.splice(idx, 1);
      else myState.tsSelected.push(id);
      myRender();
    };
  });
  screen.querySelectorAll('[data-myttcard]').forEach(el => {
    el.onclick = () => {
      const i = parseInt(el.dataset.myttcard);
      myState.ttOpenIdx = myState.ttOpenIdx === i ? null : i;
      myRender();
    };
  });
  screen.querySelectorAll('[data-myquiz]').forEach(btn => {
    btn.onclick = () => {
      const oi = parseInt(btn.dataset.myquiz);
      myState.quizAnswers[myState.quizIdx] = oi;
      myRender();
    };
  });
  screen.querySelectorAll('[data-myquiznext]').forEach(btn => {
    btn.onclick = () => {
      myState.quizIdx = Math.min(MY_QUIZ.length - 1, myState.quizIdx + 1);
      myRender();
    };
  });
  screen.querySelectorAll('[data-myquizprev]').forEach(btn => {
    btn.onclick = () => {
      myState.quizIdx = Math.max(0, myState.quizIdx - 1);
      myRender();
    };
  });
  screen.querySelectorAll('[data-action="nextSteps"]').forEach(el => {
    el.onclick = () => go('nextSteps');
  });
}

actions.maleYouth = () => {
  myState = { step: 0, openCard: -1, quizIdx: 0, quizAnswers: {} };
  go('maleYouth');
};

// ============================================================
// HEALTHY RELATIONSHIPS MODULE
// ============================================================
let hrState = { step: 0, openAbuseTab: 'physical', cycleOpen: null, sortState: { placed: {} }, quizIdx: 0, quizAnswers: {} };

const HR_STEPS = [
  'Intro',
  'Communication is Key',
  'Boundaries',
  'How People Define Dating',
  'Signs of a Healthy vs. Unhealthy Relationship',
  'The Cycle of Violence',
  'Types of Abuse',
  'Safely Leaving',
  'How to Help a Loved One',
  'Knowledge Check',
  'Resources'
];

const HR_QUIZ = [
  {
    q: 'Which of the following is an example of a healthy boundary?',
    options: [
      'Telling your partner they can\'t hang out with friends of any gender',
      'Deciding for yourself that you won\'t go home with someone on a first date',
      'Demanding your partner text you back within 10 minutes',
      'Checking your partner\'s phone without asking'
    ],
    correct: 1,
    explain: 'Boundaries are limits you set for yourself — not rules you impose on your partner. Deciding you won\'t go home with someone on a first date is a personal boundary. Controlling who your partner sees or demanding immediate responses are controlling behaviors, not boundaries.'
  },
  {
    q: 'What is "love-bombing"?',
    options: [
      'A healthy way to show affection after a conflict',
      'Over-the-top displays of attention and affection used to manipulate a partner',
      'Sending flowers as an apology',
      'Expressing love in public'
    ],
    correct: 1,
    explain: 'Love-bombing is a manipulation tactic — overwhelming someone with attention, gifts, and affection to gain influence over them. Signs include rushed intimacy, excessive compliments followed by put-downs, and gifts given as substitutes for changed behavior.'
  },
  {
    q: 'On average, how many times does someone attempt to leave before permanently leaving an abusive relationship?',
    options: ['1-2 times', '3-4 times', '6 times', '10+ times'],
    correct: 2,
    explain: 'It takes on average 6 attempts before someone permanently leaves an abusive relationship. Leaving is actually the most dangerous time — abusers often escalate. Fear of retaliation, financial dependence, and the cycle of apologies all make leaving very difficult.'
  },
  {
    q: 'Which of the following is NOT considered a form of abuse?',
    options: [
      'Controlling all the money in the relationship',
      'Spreading rumors about your partner',
      'Having a respectful disagreement about different values',
      'Removing a condom without a partner\'s knowledge'
    ],
    correct: 2,
    explain: 'Respectful disagreements are a normal, healthy part of any relationship. Financial control, spreading rumors (psychological abuse), and removing a condom without consent (sexual abuse) are all forms of abuse.'
  },
  {
    q: 'If a friend is in an abusive relationship, what should you do?',
    options: [
      'Confront their partner directly and post about it online',
      'Pressure them to leave immediately or stop talking to them',
      'Be supportive, listen without judgment, and connect them to resources',
      'Avoid bringing it up so you don\'t make things awkward'
    ],
    correct: 2,
    explain: 'Be supportive and patient — acknowledge their feelings and respect their decisions, even if they choose to stay. Avoid contacting the abuser or posting about it publicly. Connect them to resources like loveisrespect.org, and remember: just being there matters.'
  }
];

const HR_RESOURCES = [
  { icon: '🌐', name: 'SafeBAE', desc: 'Resources for students on healthy relationships and consent', url: 'https://www.safebae.org' },
  { icon: '💬', name: 'loveisrespect.org', desc: 'National teen dating abuse helpline — text LOVEIS to 22522 or call 1-866-331-9474', url: 'https://www.loveisrespect.org' },
  { icon: '🏠', name: 'National DV Hotline', desc: '1-800-799-7233 — 24/7 support for domestic violence survivors', url: 'https://www.thehotline.org' },
  { icon: '🏳️‍🌈', name: 'Trevor Lifeline', desc: 'For LGBTQ+ youth — 1-866-488-7386', url: 'https://www.thetrevorproject.org' },
  { icon: '📞', name: 'Crisis Text Line', desc: 'Text HOME to 741741 to reach a crisis counselor', url: 'https://www.crisistextline.org' },
];

function hrRender() {
  const screen = document.getElementById('screen');
  const s = hrState.step;

  const progressDots = HR_STEPS.map((_, i) =>
    `<div class="dsProgressDot${i < s ? ' done' : i === s ? ' active' : ''}"></div>`
  ).join('');

  function backBtn() {
    const action = s > 0 ? 'data-hraction="back"' : 'data-action="nextSteps"';
    return `<button class="btn" ${action} style="padding:9px 14px;border-radius:999px;font-size:13px;color:var(--muted);background:rgba(255,255,255,.04);border:1px solid var(--border);margin-bottom:10px;width:auto;">← Back</button>`;
  }

  let innerHTML = '';

  if (s === 0) {
    // Intro
    innerHTML = `
      <div class="p" style="color:var(--muted);">Understanding what makes a relationship healthy — and what doesn't — is one of the most important skills you can build.</div>
      <div class="note">This module covers communication, boundaries, green and red flags, the cycle of abuse, and how to safely exit or support someone in an unhealthy relationship.</div>
      <div class="hrFlagRow">
        <div class="hrFlagBtn green" style="cursor:default;">
          <span class="hrFlagIcon">🟢</span>
          <span class="hrFlagLabel">Green Flags</span>
        </div>
        <div class="hrFlagBtn red" style="cursor:default;">
          <span class="hrFlagIcon">🔴</span>
          <span class="hrFlagLabel">Red Flags</span>
        </div>
      </div>
      <div class="p" style="color:var(--muted);">Some signs can look different depending on the relationship. But some things are never okay — no matter what someone says.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn btnPrimary" data-hraction="next" style="width:100%;">Let's start →</button>
      </div>
    `;
  } else if (s === 1) {
    // Communication is KEY
    innerHTML = `
      <div class="p" style="color:var(--muted);">In a healthy relationship, all partners respect each other and remain independent — each person is a whole individual, not just half of a couple.</div>
      <div class="dsStepList">
        <div class="dsStep">
          <div class="dsStepNum">1</div>
          <div class="dsStepText"><b>Ask the important questions.</b> Before becoming intimate, make sure you're on the same page about what you both want.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">2</div>
          <div class="dsStepText"><b>Uncomfortable questions now</b> can save a lot of heartache later — especially if you haven't discussed being exclusive.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">3</div>
          <div class="dsStepText"><b>Everyone brings different experiences</b> to a relationship. When navigating intimacy, remember that your history shapes how you connect.</div>
        </div>
      </div>
      <div class="note" style="margin-top:12px;">💬 <b>Communication isn't just talking</b> — it's listening, checking in, and making sure your partner feels heard and safe to speak up.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 2) {
    // Boundaries
    innerHTML = `
      <div class="p" style="color:var(--muted);">Boundaries are limits you set <em>for yourself</em> — not rules you impose on your partner.</div>
      <div class="dsConsentGrid">
        <div class="dsConsentCard" id="hrB1" data-hrtoggle="hrB1">
          <div class="dsConsentHead"><span class="dsConsentEmoji">✅</span> Good boundary example <span class="dsConsentChev">▾</span></div>
          <div class="dsConsentBody"><div class="dsConsentTag yes">Example</div>"I'm not going to go home with someone on a first date." — This is a limit you set for your own comfort and safety.</div>
        </div>
        <div class="dsConsentCard" id="hrB2" data-hrtoggle="hrB2">
          <div class="dsConsentHead"><span class="dsConsentEmoji">🚫</span> NOT a boundary <span class="dsConsentChev">▾</span></div>
          <div class="dsConsentBody"><div class="dsConsentTag no">Controlling</div>"You can't have friends of the opposite gender." — This is dictating your partner's behavior, not setting a personal limit.</div>
        </div>
      </div>
      <div class="note" style="margin-top:8px;"><b>Feeling jealous or insecure?</b> That's normal — those feelings are okay to have. But how you act on them matters. Feelings don't give you the right to control your partner. Practice open communication instead.</div>
      <div class="p" style="color:var(--muted);margin-top:8px;">Try to distinguish between feelings that come from the vulnerability of being close to someone — vs. feelings that come from your partner actively causing harm.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 3) {
    // How people define dating
    const types = [
      { label: 'A Hookup', desc: 'A one-time or limited sexual or intimate act.', icon: '⚡' },
      { label: 'Friends with Benefits', desc: 'Sexual acts between people without any commitment.', icon: '🤝' },
      { label: 'Situationship', desc: 'More than friends, but less committed than long-term partners. Undefined.', icon: '🌫️' },
      { label: 'Intimacy → Relationship', desc: 'Starts with a physical act that grows into a committed relationship over time.', icon: '🌱' },
      { label: 'Open Relationship', desc: 'Partners are intimate with each other but are mutually comfortable with outside intimacy.', icon: '🔓' },
      { label: 'Exclusive Relationship', desc: 'Committed to only one partner. Can be between two people (monogamous) or more (polyamorous).', icon: '💍' },
    ];
    const cards = types.map(t => `
      <div class="dsConsentCard" style="cursor:default;">
        <div class="dsConsentHead"><span class="dsConsentEmoji">${t.icon}</span> ${t.label}</div>
        <div class="dsConsentBody" style="max-height:none;padding:0 14px 12px;">${t.desc}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p" style="color:var(--muted);">There are many ways people connect. None are "wrong" — as long as all people involved practice open, honest communication.</div>
      <div class="dsConsentGrid">${cards}</div>
      <div class="note" style="margin-top:8px;">📣 <b>The most important thing</b> is that everyone involved agrees on what kind of relationship it is — and that this is communicated clearly.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 4) {
    // Signs: Healthy vs Unhealthy — interactive sort game
    const healthySigns = [
      'Open communication', 'Strong trust', 'Mutual respect', 'Healthy boundaries',
      'Feeling safe', 'Shared decisions', 'Having fun together', 'Inspiring each other'
    ];
    const unhealthySigns = [
      'Guilt trips', 'Withholding affection', 'Unreasonable jealousy', 'Constant put-downs',
      'Isolating from friends', 'Threats & intimidation', 'Lying and cheating', 'Using money to control'
    ];
    // Mix them up
    const allSigns = [
      { text: 'Open communication', type: 'healthy' },
      { text: 'Guilt trips', type: 'unhealthy' },
      { text: 'Strong trust', type: 'healthy' },
      { text: 'Withholding affection', type: 'unhealthy' },
      { text: 'Mutual respect', type: 'healthy' },
      { text: 'Threats & intimidation', type: 'unhealthy' },
      { text: 'Feeling safe', type: 'healthy' },
      { text: 'Constant put-downs', type: 'unhealthy' },
      { text: 'Healthy boundaries', type: 'healthy' },
      { text: 'Isolating from friends', type: 'unhealthy' },
    ];

    const placed = hrState.sortState.placed || {};
    const unplaced = allSigns.filter(s => !placed[s.text]);
    const healthyPlaced = allSigns.filter(s => placed[s.text] === 'healthy');
    const unhealthyPlaced = allSigns.filter(s => placed[s.text] === 'unhealthy');

    const unplacedCards = unplaced.map(s =>
      `<button class="hrSortCard" data-hrsort="${s.text}" data-hrtype="${s.type}">${s.text}</button>`
    ).join('');

    const hPlaced = healthyPlaced.map(s => `<span class="hrPlacedTag healthy">✅ ${s.text}</span>`).join('');
    const uPlaced = unhealthyPlaced.map(s => `<span class="hrPlacedTag unhealthy">⚠️ ${s.text}</span>`).join('');

    const allDone = Object.keys(placed).length === allSigns.length;
    const correct = allSigns.filter(s => placed[s.text] === s.type).length;
    const scoreHtml = allDone ? `<div class="hrScoreBox show">You got <b>${correct} out of ${allSigns.length}</b> correct. ${correct === allSigns.length ? '🎉 Perfect! You know the signs.' : correct >= 7 ? '👍 Great work — you know most of the signs.' : 'Keep going — recognizing these patterns takes practice.'}</div>` : '';

    innerHTML = `
      <div class="p" style="color:var(--muted);">Tap a sign to select it, then tap the 🟢 Healthy or 🔴 Unhealthy column to place it. Some healthy relationships have "bad" moments — and unhealthy ones can have "good" moments too. Look at the overall pattern.</div>
      ${unplaced.length > 0 ? `<div class="hrSortGame"><div class="hrSortRow">${unplacedCards}</div></div>` : ''}
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;">
        <div>
          <div class="hrDropZoneLabel" style="color:rgba(21,255,100,.8);font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;">🟢 Healthy</div>
          <div class="hrDropZone green-zone" id="hrDropHealthy" data-hrdest="healthy">
            ${hPlaced || '<span style="opacity:.35;font-size:11px;font-weight:700;">Tap a sign, then tap here</span>'}
          </div>
        </div>
        <div>
          <div class="hrDropZoneLabel" style="color:rgba(255,80,80,.8);font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;">🔴 Unhealthy</div>
          <div class="hrDropZone red-zone" id="hrDropUnhealthy" data-hrdest="unhealthy">
            ${uPlaced || '<span style="opacity:.35;font-size:11px;font-weight:700;">Tap a sign, then tap here</span>'}
          </div>
        </div>
      </div>
      ${scoreHtml}
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        ${allDone ? `<button class="btn btnPrimary" data-hraction="next">Next →</button>` : `<button class="btn" data-hraction="resetsort">↺ Reset</button>`}
      </div>
    `;
  } else if (s === 5) {
    // Cycle of Violence
    const cyclePhases = [
      {
        id: 'escalating', title: 'Escalating', color: 'rgba(255,200,60,.80)',
        abuser: 'Moody → yelling → threatening → withdrawing affection → critical',
        victim: 'Nurturing → stays away from friends → agrees → tries to calm → tip-toes around'
      },
      {
        id: 'explosion', title: 'Explosion', color: 'rgba(255,80,80,.85)',
        abuser: 'Hitting → choking → humiliating → using weapons → verbal abuse → destroying property',
        victim: 'Calls for help → tries to reason with abuser → fights back → leaves'
      },
      {
        id: 'apologies', title: 'Apologies (Honeymoon)', color: 'rgba(21,255,200,.80)',
        abuser: 'Begs forgiveness → promises to never do it again → cries → promises love',
        victim: 'Agrees to stay → gets abuser help → covers up abuse → acts happy with abuser'
      },
    ];

    const phaseCards = cyclePhases.map(p => {
      const isOpen = hrState.cycleOpen === p.id;
      return `
        <div class="hrCycleCard${isOpen ? ' active' : ''}" data-hrcycle="${p.id}">
          <div class="hrCycleTitle" style="color:${p.color};">${p.title}</div>
          <div class="hrCycleBody">Tap to see what this phase looks like.</div>
          ${isOpen ? `
          <div class="hrCycleDetail show">
            <div style="margin-bottom:8px;"><b>The person causing harm:</b> ${p.abuser}</div>
            <div><b>The person being harmed:</b> ${p.victim}</div>
          </div>` : ''}
        </div>
      `;
    }).join('');

    innerHTML = `
      <div class="p" style="color:var(--muted);">Abuse often follows a pattern. Understanding the cycle helps explain why leaving is so hard — and why it takes on average <b>6 attempts</b> to permanently leave.</div>
      <div class="hrCycleGrid">${phaseCards}</div>
      <div class="note">⚠️ <b>Leaving is the most dangerous time</b> for a person in an abusive relationship. After the explosion, the cycle often resets to the "honeymoon" phase — where the abuser apologizes and promises change. This makes it very hard to leave.</div>
      <div class="p" style="color:var(--muted);margin-top:8px;">Fear of retaliation, financial dependency, and for LGBTQ+ people, fear of being outed — all make leaving harder, especially for marginalized communities.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 6) {
    // Types of Abuse
    const abuseTabs = [
      {
        id: 'physical', label: '🤜 Physical',
        items: ['Hitting', 'Kicking', 'Slapping', 'Punching', 'Hair pulling', 'Restraining', 'Biting', 'Choking']
      },
      {
        id: 'sexual', label: '🚫 Sexual',
        items: [
          'Rape',
          'Physically forcing sexual acts',
          'Coercing or pressuring sexual acts',
          'Forcing a partner to watch or reenact pornography',
          'Sharing nude photos without consent (illegal for minors)',
          'Removing a condom without consent (stealthing)',
          'Lying about birth control',
          'Recording sexual acts without knowledge'
        ]
      },
      {
        id: 'psychological', label: '🧠 Psychological',
        items: [
          'Threatening to hurt the other person or their loved ones',
          'Demanding rapid text responses',
          'Threatening self-harm to control a partner',
          'Spreading rumors',
          'Gaslighting — making someone doubt their own reality'
        ]
      },
      {
        id: 'emotional', label: '💔 Emotional',
        items: [
          'Criticizing appearance or intelligence',
          'Telling them no one else would want them',
          'Flirting with others in front of them',
          'Verbal abuse / name calling',
          'Humiliation and public shaming'
        ]
      },
      {
        id: 'financial', label: '💰 Financial',
        items: [
          'Controlling all money in the relationship',
          'Refusing access to bank accounts or cash',
          'Stealing from the other person',
          'Preventing them from working or finishing school'
        ]
      },
    ];

    const currentTab = abuseTabs.find(t => t.id === hrState.openAbuseTab) || abuseTabs[0];
    const tabs = abuseTabs.map(t =>
      `<button class="hrAbuseTab${t.id === hrState.openAbuseTab ? ' active' : ''}" data-hrabuse="${t.id}">${t.label}</button>`
    ).join('');
    const items = currentTab.items.map(item => `
      <div class="hrAbuseItem">
        <div class="hrAbuseChev">
          <svg width="8" height="8" viewBox="0 0 8 8" fill="none"><path d="M1.5 3L4 5.5L6.5 3" stroke="#ff8080" stroke-width="1.5" stroke-linecap="round"/></svg>
        </div>
        <span>${item}</span>
      </div>
    `).join('');

    innerHTML = `
      <div class="p" style="color:var(--muted);">Abuse takes many forms. Recognizing them is the first step to understanding what's happening.</div>
      <div class="note" style="background:rgba(255,80,80,.07);border-color:rgba(255,80,80,.30);">📊 1 out of 3 teens will be in an abusive relationship. <b>Intimate Partner Violence</b> = physical, sexual, or psychological harm by a current or former partner.</div>
      <div class="hrAbuseTabs">${tabs}</div>
      <div class="hrAbuseList">${items}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 7) {
    // Safely leaving
    innerHTML = `
      <div class="p" style="color:var(--muted);">If you're in an unhealthy relationship, figuring out how to leave can be hard. Your safety comes first.</div>
      <div class="note" style="background:rgba(21,255,200,.07);border-color:rgba(21,255,200,.30);font-size:14px;font-weight:800;">You do not owe your abuser your physical presence — in any way.</div>
      <div class="p" style="color:var(--muted);">If there has been past violence, if you don't feel safe, or if previous attempts to end the relationship were manipulated — it is completely okay to end things over a phone call or text.</div>
      <div class="dsStepList" style="margin-top:10px;">
        <div class="dsStep">
          <div class="dsStepNum">1</div>
          <div class="dsStepText"><b>Choose a safe setting.</b> If you decide to meet in person, pick a busy public place. Tell a trusted person where you're going.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">2</div>
          <div class="dsStepText"><b>Be honest and clear.</b> Don't play the blame game — state your intention. You don't need to justify yourself.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">3</div>
          <div class="dsStepText"><b>If they can't be respectful,</b> it's okay to end the conversation without further discussion. You don't owe anyone a debate about your own safety.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">4</div>
          <div class="dsStepText"><b>Keep it off social media.</b> Don't share screenshots, nudes, or post about the relationship publicly — it can complicate things and put you at risk.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">5</div>
          <div class="dsStepText"><b>Allow time to heal.</b> It's okay to feel sad or confused — you may still have feelings for them. Give yourself space and avoid making excuses to re-engage.</div>
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Next →</button>
      </div>
    `;
  } else if (s === 8) {
    // Help a loved one
    const tips = [
      { icon: '👂', title: 'Listen without judging', body: 'Be supportive and patient. Acknowledge their feelings and respect their decisions — even if they choose to stay.' },
      { icon: '📣', title: 'Reach out with care', body: 'Don\'t be afraid to tell them you\'re concerned. Say "I care about you and I\'m worried about your safety."' },
      { icon: '💡', title: 'Name what you\'re seeing', body: 'Help them recognize that the abuse is not "normal" and is not their fault. Everyone deserves a healthy, non-violent relationship.' },
      { icon: '🎯', title: 'Focus on them, not the abuser', body: 'Even if they stay with their partner, it\'s important they still feel comfortable talking to you.' },
      { icon: '🤝', title: 'Seek support together', body: 'You don\'t have to figure this out alone. Encourage them to reach out to resources like loveisrespect.org. Help them develop a safety plan.' },
      { icon: '⏳', title: 'Stay in it for the long haul', body: 'They may return to their abuser several times — on average, it takes 6 attempts before someone permanently leaves. Keep showing up.' },
    ];
    const tipCards = tips.map(t => `
      <div class="dsStep">
        <div class="dsStepNum">${t.icon}</div>
        <div class="dsStepText"><b>${t.title}</b><br>${t.body}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p" style="color:var(--muted);">If someone you care about is in an unhealthy or abusive relationship, here's how to help without making things worse.</div>
      <div class="dsStepList">${tipCards}</div>
      <div class="mutedBox" style="margin-top:10px;">Even when it feels like nothing is working — just being supportive and caring is already doing a lot. Don't give up on them.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-hraction="back">← Back</button>
        <button class="btn btnPrimary" data-hraction="next">Knowledge Check →</button>
      </div>
    `;
  } else if (s === 9) {
    // Quiz
    const qi = hrState.quizIdx;
    const q = HR_QUIZ[qi];
    const answered = hrState.quizAnswers[qi] !== undefined;
    const chosen = hrState.quizAnswers[qi];
    const isCorrect = chosen === q.correct;
    const isLast = qi === HR_QUIZ.length - 1;

    const opts = q.options.map((opt, oi) => {
      let cls = 'btn myQuizOpt';
      if (answered) {
        if (oi === q.correct) cls += ' myQuizCorrect';
        else if (oi === chosen && !isCorrect) cls += ' myQuizWrong';
      }
      return `<button class="${cls}" data-hrquiz="${oi}" ${answered ? 'disabled' : ''}>${opt}</button>`;
    }).join('');

    const feedback = answered ? `
      <div class="note" style="border-color:${isCorrect ? 'rgba(21,255,200,.5)' : 'rgba(255,80,80,.5)'}; background:${isCorrect ? 'rgba(21,255,200,.08)' : 'rgba(255,80,80,.08)'}; margin-top:8px;">
        ${isCorrect ? '✅ Correct!' : '❌ Not quite.'} ${q.explain}
      </div>` : '';

    const nextBtn = answered
      ? (isLast
        ? `<button class="btn btnPrimary" data-hraction="next" style="margin-top:10px;width:100%;">See Resources →</button>`
        : `<button class="btn btnPrimary" data-hrquiznext="1" style="margin-top:10px;width:100%;">Next Question →</button>`)
      : '';

    const prevBtn = qi > 0
      ? `<button class="btn" data-hrquizprev="1">← Previous Question</button>`
      : `<button class="btn" data-hraction="back">← Back</button>`;

    innerHTML = `
      <div class="p"><b>Question ${qi + 1} of ${HR_QUIZ.length}</b></div>
      <div class="note" style="background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.25); font-size:15px; font-weight:800; color:var(--sb-light); margin-bottom:12px;">${q.q}</div>
      <div class="dsConsentGrid" style="gap:8px;">${opts}</div>
      ${feedback}
      ${nextBtn}
      <div class="dsNavRow" style="margin-top:12px;">
        ${prevBtn}
      </div>
    `;
  } else {
    // Resources
    const resList = HR_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You've completed the Healthy Relationships module. Here are real resources if you or someone you know needs help.</div>
      <div class="dsResourceList">${resList}</div>
      <div class="mutedBox" style="margin-top:12px;">Remember: checking in with yourself about your relationship is a sign of strength, not weakness. You deserve to feel safe and respected.</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-hraction="restart" style="width:100%">Start this module over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Module</div>
      <div class="h1">💚 Healthy Relationships</div>
      <div class="p" style="margin:0">Green flags, red flags, boundaries, and recognizing abuse.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Events
  screen.querySelectorAll('[data-hraction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.hraction;
      if (a === 'next') { hrState.step = Math.min(HR_STEPS.length - 1, hrState.step + 1); hrRender(); }
      else if (a === 'back') { hrState.step = Math.max(0, hrState.step - 1); hrRender(); }
      else if (a === 'restart') { hrState = { step: 0, openAbuseTab: 'physical', cycleOpen: null, sortState: { placed: {} }, quizIdx: 0, quizAnswers: {} }; hrRender(); }
      else if (a === 'resetsort') { hrState.sortState = { placed: {} }; hrRender(); }
    };
  });

  // Boundary card toggles
  screen.querySelectorAll('[data-hrtoggle]').forEach(el => {
    el.onclick = () => {
      el.classList.toggle('open');
    };
  });

  // Sort game
  // Tap-to-select card, then tap zone to place
  let hrSelectedSign = null;

  function updateZoneHighlight() {
    const greenZone = screen.querySelector('#hrDropHealthy');
    const redZone = screen.querySelector('#hrDropUnhealthy');
    if (!greenZone || !redZone) return;
    if (hrSelectedSign) {
      greenZone.classList.add('zone-active');
      redZone.classList.add('zone-active');
      greenZone.style.cursor = 'pointer';
      redZone.style.cursor = 'pointer';
    } else {
      greenZone.classList.remove('zone-active');
      redZone.classList.remove('zone-active');
      greenZone.style.cursor = '';
      redZone.style.cursor = '';
    }
  }

  screen.querySelectorAll('[data-hrsort]').forEach(btn => {
    btn.onclick = () => {
      // Deselect if already selected
      if (hrSelectedSign === btn.dataset.hrsort) {
        hrSelectedSign = null;
        screen.querySelectorAll('[data-hrsort]').forEach(b => b.classList.remove('selected'));
      } else {
        hrSelectedSign = btn.dataset.hrsort;
        screen.querySelectorAll('[data-hrsort]').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
      }
      updateZoneHighlight();
    };
  });

  screen.querySelectorAll('[data-hrdest]').forEach(zone => {
    zone.onclick = () => {
      if (!hrSelectedSign) return;
      const dest = zone.dataset.hrdest;
      hrState.sortState.placed[hrSelectedSign] = dest;
      hrSelectedSign = null;
      hrRender();
    };
  });

  // Abuse tabs
  screen.querySelectorAll('[data-hrabuse]').forEach(el => {
    el.onclick = () => { hrState.openAbuseTab = el.dataset.hrabuse; hrRender(); };
  });

  // Cycle of violence cards
  screen.querySelectorAll('[data-hrcycle]').forEach(el => {
    el.onclick = () => {
      const id = el.dataset.hrcycle;
      hrState.cycleOpen = hrState.cycleOpen === id ? null : id;
      hrRender();
    };
  });

  // Quiz
  screen.querySelectorAll('[data-hrquiz]').forEach(btn => {
    btn.onclick = () => {
      const oi = parseInt(btn.dataset.hrquiz);
      hrState.quizAnswers[hrState.quizIdx] = oi;
      hrRender();
    };
  });
  screen.querySelectorAll('[data-hrquiznext]').forEach(btn => {
    btn.onclick = () => {
      hrState.quizIdx = Math.min(HR_QUIZ.length - 1, hrState.quizIdx + 1);
      hrRender();
    };
  });
  screen.querySelectorAll('[data-hrquizprev]').forEach(btn => {
    btn.onclick = () => {
      hrState.quizIdx = Math.max(0, hrState.quizIdx - 1);
      hrRender();
    };
  });

  // Back to next steps
  screen.querySelectorAll('[data-action="nextSteps"]').forEach(el => {
    el.onclick = () => go('nextSteps');
  });
}

actions.healthyRelationships = () => {
  hrState = { step: 0, openAbuseTab: 'physical', cycleOpen: null, sortState: { placed: {} }, quizIdx: 0, quizAnswers: {} };
  go('healthyRelationships');
};
// =============================================
//  RAPE CULTURE MODULE
// =============================================

const RC_STEPS = [
  'What Is Rape Culture',
  'Where It Starts',
  'Where It\'s Learned',
  'Elements',
  'Rape Myths',
  'Racial Stereotypes',
  'Peer Influence',
  'Gender Beliefs',
  'Recognize & Call Out',
  'Shift the Culture',
  'Knowledge Check',
  'Resources'
];

const RC_MYTHS = [
  {
    myth: '"Real rape" is committed by strangers.',
    fact: 'Anyone can be a perpetrator. 92% of female victims and 74% of male victims report perpetrators as acquaintances or intimate partners. Most rapes are committed by someone known to the victim.',
    icon: '🚨'
  },
  {
    myth: 'Only women can be raped.',
    fact: '1 out of 10 rape victims are male, and 1 in 2 transgender persons are sexually assaulted in their lifetime. Sexual assault is experienced by people of all genders.',
    icon: '♾️'
  },
  {
    myth: 'False rape claims are common — people "cry rape" for revenge or attention.',
    fact: 'False reporting for sexual assault is 2–10%, the same rate as other crimes. In fact, 23% of rapes go unreported to official authorities.',
    icon: '📊'
  },
  {
    myth: 'Clothing, location, and alcohol use can prevent rape.',
    fact: 'This places responsibility on survivors rather than perpetrators. Sexual assault is about power, not clothing. This narrative unfairly holds survivors responsible for their own assault instead of the rapist.',
    icon: '👗'
  },
];

const RC_ELEMENTS = [
  { icon: '🎯', title: 'Victim Blaming', body: 'Suggesting the survivor is responsible for the assault based on their behavior, clothing, or choices. This shifts accountability away from the perpetrator.' },
  { icon: '📖', title: 'Rape Myths', body: 'False beliefs about sexual violence that minimize or excuse harm — like "they asked for it" or "it wasn\'t really rape if they didn\'t fight back."' },
  { icon: '📱', title: 'Media & Algorithms', body: 'Films, music, ads, and social media that normalize objectification, harassment, and non-consensual behavior — shaping what we see as "normal."' },
  { icon: '👥', title: 'Peer Influence', body: 'Friends who support harassment, "locker room talk," and herd mentality all reinforce rape culture. The group shapes what feels acceptable.' },
  { icon: '⚧️', title: 'Gender & Sexuality Beliefs', body: 'Rigid beliefs about gender roles — men must be dominant, women must be passive — increase tolerance for sexual violence at both individual and community levels.' },
  { icon: '🏷️', title: 'Racial Stereotypes', body: 'Racist myths that hypersexualize Black and Brown people lead to higher rates of violence AND more extreme victim blaming, limiting access to justice and resources.' },
];

const RC_QUIZ = [
  {
    q: 'Rape culture refers to:',
    options: [
      'Only physical sexual violence',
      'Values, attitudes, and behaviors that normalize or trivialize sexual violence',
      'A type of media censorship',
      'Laws that are too lenient on sexual crimes'
    ],
    correct: 1,
    explain: 'Rape culture is a collection of values, attitudes, beliefs, and behaviors that trivialize or normalize sexual violence — including victim blaming, slut-shaming, and minimizing rape\'s impact.'
  },
  {
    q: 'What percentage of female rape victims report their perpetrator as an acquaintance or intimate partner?',
    options: ['25%', '50%', '92%', '100%'],
    correct: 2,
    explain: '92% of female victims and 74% of male victims report their perpetrators as acquaintances or intimate partners. Most rapes are NOT committed by strangers.'
  },
  {
    q: 'Which of these is an example of rape culture?',
    options: [
      'Teaching people to get enthusiastic consent',
      'Believing survivors and supporting them',
      '"Locker room talk" and rape jokes',
      'Challenging gender stereotypes'
    ],
    correct: 2,
    explain: '"Locker room talk," rape jokes, catcalling, and victim blaming are all examples of how rape culture starts. The others are examples of how we shift AWAY from rape culture.'
  },
  {
    q: 'False rape reports occur at what rate?',
    options: ['50% of all claims', '25–30%', '2–10%, same as other crimes', 'Over 60%'],
    correct: 2,
    explain: 'False reporting rates for sexual assault are 2–10%, the same as other crimes. Meanwhile, 23% of rapes go unreported. The myth of widespread false claims is itself an example of rape culture.'
  },
  {
    q: 'How can YOU help shift toward a culture of respect?',
    options: [
      'Laugh along with rape jokes so you don\'t seem uptight',
      'Avoid the topic entirely to not upset people',
      'Only speak up if you personally know the survivor',
      'Be an active bystander, challenge harmful norms, and believe survivors'
    ],
    correct: 3,
    explain: 'Being an active bystander, calling out harmful language, listening to survivors, and challenging gender stereotypes are all ways you can help create a culture of respect and consent.'
  },
];

const RC_RESOURCES = [
  { icon: '🌐', name: 'SafeBAE', desc: 'Student-led resources on sexual assault prevention & survivor support', url: 'https://safebae.org' },
  { icon: '📞', name: 'RAINN Hotline', desc: '1-800-656-HOPE — National Sexual Assault Hotline, free & confidential', url: 'https://rainn.org' },
  { icon: '💬', name: 'Crisis Text Line', desc: 'Text HOME to 741741 — free, 24/7 crisis counseling', url: 'https://www.crisistextline.org' },
  { icon: '🏥', name: 'Love Is Respect', desc: 'Resources on healthy relationships and relationship abuse', url: 'https://www.loveisrespect.org' },
];

let rcState = null;

function rcRender() {
  if (!rcState) rcState = { step: 0, mythOpen: null, elementOpen: null, quizIdx: 0, quizAnswers: {} };
  const s = rcState.step;
  const totalSteps = RC_STEPS.length;
  const progressDots = RC_STEPS.map((_, i) =>
    `<div class="dsProgressDot ${i < s ? 'done' : i === s ? 'active' : ''}"></div>`
  ).join('');

  let innerHTML = '';

  if (s === 0) {
    // What is Rape Culture
    innerHTML = `
      <div class="note" style="background:rgba(255,80,80,.08);border-color:rgba(255,100,100,.35);color:rgba(255,220,220,.95);margin-bottom:14px;">
        ⚠️ This module covers sexual violence and may be difficult. Take breaks whenever you need.
      </div>
      <div class="p"><b>Rape culture</b> is a collection of values, attitudes, beliefs, and behaviors that trivialize or normalize sexual violence.</div>
      <div class="p">Examples include victim blaming, slut-shaming, sexual objectification, minimizing the impact of rape, denial of widespread rape, and refusing to acknowledge the harm caused by sexual violence.</div>
      <div class="note">The term "rape culture" seems extreme to some people — but it is <b>real</b>, and a major factor in allowing harmful behavior to continue in our society.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn btnPrimary" data-rcaction="next" style="width:100%;">Next: Where It Starts →</button>
      </div>
    `;
  } else if (s === 1) {
    // Where rape culture starts
    const behaviors = [
      'Rape jokes', 'Victim blaming', 'Catcalling', '"Locker room talk"',
      'Not believing survivors', 'Believing rape can only happen to women',
      'Rating people\'s bodies', 'Stalking', 'Threatening or pressuring a partner',
      'Groping', 'Sending unsolicited nudes', 'Revenge porn',
      'Facilitation with drugs or alcohol', 'Teaching how not to get raped vs. how not to rape'
    ];
    const tags = behaviors.map(b =>
      `<span style="display:inline-block;padding:6px 12px;border-radius:999px;border:1px solid rgba(255,100,100,.35);background:rgba(255,80,80,.10);color:rgba(255,220,220,.92);font-size:13px;font-weight:700;margin:4px;">${b}</span>`
    ).join('');
    innerHTML = `
      <div class="p" style="font-weight:900;font-size:15px;color:rgba(209,254,255,.95);">This is where rape culture starts 👇</div>
      <div style="border:1px solid rgba(255,100,100,.25);border-radius:14px;background:rgba(255,80,80,.06);padding:14px;margin:10px 0;">
        <div style="display:flex;flex-wrap:wrap;gap:4px;">${tags}</div>
      </div>
      <div class="note" style="margin-top:12px;">These behaviors might seem minor on their own — but together they create an environment where more serious harm becomes normalized and excused.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 2) {
    // Rape Culture in the Media
    const mediaExamples = [
      { n: '1', text: 'TV programs with little or no representation of nonbinary or gender non-conforming people in healthy intimate relationships.' },
      { n: '2', text: 'Films showcasing catcalling & harassment as an acceptable or even flattering occurrence.' },
      { n: '3', text: 'Characters who ply someone with alcohol for the express purpose of getting them "drunk enough" to have sex.' },
      { n: '4', text: 'Song lyrics that shame, degrade, depict violence, or non-consensual sexual activities.' },
      { n: '5', text: 'Fashion advertisements depicting violent poses and objectification.' },
      { n: '6', text: 'Male characters portrayed as sexually aggressive and unable to take "no" for an answer — rarely modeled asking for consent.' },
    ];
    const exampleHtml = mediaExamples.map(e =>
      `<div class="dsStep"><div class="dsStepNum">${e.n}</div><div class="dsStepText">${e.text}</div></div>`
    ).join('');
    innerHTML = `
      <div class="p">We learn rape culture from films, books, music, video games, fashion, and pornography. Some examples:</div>
      <div class="dsStepList">${exampleHtml}</div>
      <div class="mutedBox" style="margin-top:10px;"><b>Think about it:</b> How do ads, films, or song lyrics you've seen recently shape perceptions and feed into rape culture?</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 3) {
    // Elements of Rape Culture
    const elems = RC_ELEMENTS.map((el, i) => {
      const isOpen = rcState.elementOpen === i;
      return `
        <div class="dsConsentCard ${isOpen ? 'open' : ''}" data-rcelement="${i}">
          <div class="dsConsentHead">
            <span class="dsConsentEmoji">${el.icon}</span>
            <span style="flex:1;">${el.title}</span>
            <span class="dsConsentChev">▾</span>
          </div>
          <div class="dsConsentBody">${el.body}</div>
        </div>
      `;
    }).join('');
    innerHTML = `
      <div class="p">Where is rape culture learned? Tap each element to learn more.</div>
      <div class="dsConsentGrid">${elems}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 4) {
    // Rape Myths
    const mythCards = RC_MYTHS.map((m, i) => {
      const isOpen = rcState.mythOpen === i;
      return `
        <div style="border:1px solid ${isOpen ? 'rgba(21,255,200,.45)' : 'rgba(209,254,255,.18)'};border-radius:14px;background:${isOpen ? 'rgba(21,255,200,.06)' : 'rgba(255,255,255,.04)'};overflow:hidden;cursor:pointer;transition:all .2s ease;" data-rcmyth="${i}">
          <div style="display:flex;align-items:center;gap:10px;padding:12px 14px;">
            <span style="font-size:18px;">${m.icon}</span>
            <div style="flex:1;">
              <div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,120,120,.85);margin-bottom:3px;">MYTH ✗</div>
              <div style="font-size:13px;font-weight:800;color:rgba(209,254,255,.95);line-height:1.3;">${m.myth}</div>
            </div>
            <span style="font-size:12px;color:var(--muted);transition:transform .2s;transform:rotate(${isOpen ? '180' : '0'}deg);">▾</span>
          </div>
          ${isOpen ? `
            <div style="padding:0 14px 14px 44px;border-top:1px solid rgba(21,255,200,.20);">
              <div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;color:rgba(21,255,200,.85);margin:10px 0 5px;">FACT ✓</div>
              <div style="font-size:13px;color:rgba(209,254,255,.88);line-height:1.5;">${m.fact}</div>
            </div>` : ''}
        </div>
      `;
    }).join('');
    innerHTML = `
      <div class="p">Rape myths and victim blaming fuel rape culture. Tap each myth to reveal the fact.</div>
      <div style="display:grid;gap:10px;margin:10px 0;">${mythCards}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 5) {
    // Racial Stereotypes
    innerHTML = `
      <div class="p"><b>Racial Myths & Stereotypes</b></div>
      <div class="p">Black and Brown people are often assumed to be hypersexual due to racist stereotypes. This leads to experiencing violence at higher rates AND more extreme victim blaming — limiting access to reporting and resources.</div>
      <div style="border:1px solid rgba(209,254,255,.18);border-radius:14px;background:rgba(0,0,0,.18);padding:14px;margin:10px 0;">
        <div style="font-weight:900;font-size:14px;margin-bottom:10px;color:rgba(209,254,255,.95);">Where stereotypes began</div>
        <div style="font-size:13px;color:rgba(209,254,255,.82);line-height:1.6;">
          To justify violence, white society created racist myths.<br><br>
          <b>For Black women:</b> They were labeled "Jezebels" — as if they always wanted sex. That made it easier to excuse rape.<br><br>
          <b>For Black men:</b> They were portrayed as dangerous and hypersexual — always predators. That made it easier to criminalize and kill them.<br><br>
          These stereotypes didn't disappear — they evolved. And they still hurt.
        </div>
      </div>
      <div class="note" style="background:rgba(255,200,80,.07);border-color:rgba(255,200,80,.35);">
        <b>🤔 Think about it:</b> Do you notice in your school or community that Black and Brown kids are more likely to be labeled a certain way? How might these stereotypes affect access to justice or the likelihood of survivors being believed?
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 6) {
    // Peer Influence
    const influences = [
      { color: 'rgba(255,80,80,.12)', borderColor: 'rgba(255,100,100,.30)', title: 'You are only as good as the company you keep', body: 'Having friends who support sexual harassment or violence is a big risk factor for committing sexual assault yourself. Our social circles shape what we consider acceptable.' },
      { color: 'rgba(21,200,150,.08)', borderColor: 'rgba(21,255,200,.25)', title: 'Male bonding', body: 'One of the things that matters most to boys and emerging adult men is the opinion of others their age. Dehumanizing victims can be seen as "proving manhood" in certain peer groups.' },
      { color: 'rgba(19,132,143,.15)', borderColor: 'rgba(19,132,143,.40)', title: 'Herd mentality', body: 'Teens who follow peers without thinking independently are more likely to engage in high-risk behaviors. In the absence of an ethical, compassionate leader or bystander, a culture of bullying and rape can grow.' },
    ];
    const influenceHtml = influences.map(item =>
      `<div style="border:1px solid ${item.borderColor};border-radius:14px;background:${item.color};padding:14px;">
        <div style="font-weight:900;font-size:14px;margin-bottom:7px;color:rgba(209,254,255,.95);">${item.title}</div>
        <div style="font-size:13px;color:rgba(209,254,255,.82);line-height:1.5;">${item.body}</div>
      </div>`
    ).join('');
    innerHTML = `
      <div class="p">Our friends and social environments shape what we see as normal. Here's how peer dynamics fuel rape culture:</div>
      <div style="display:grid;gap:10px;margin:10px 0;">${influenceHtml}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 7) {
    // Gender Norms & Sexuality Beliefs
    innerHTML = `
      <div class="p">Rigid beliefs about gender increase sexual violence at both individual and community levels.</div>
      <div style="display:grid;gap:10px;margin:10px 0;">
        <div style="border:1px solid rgba(21,255,200,.25);border-radius:14px;background:rgba(21,255,200,.06);padding:14px;">
          <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:var(--sb-mint);margin-bottom:6px;">INDIVIDUAL LEVEL</div>
          <div style="font-size:13px;color:rgba(209,254,255,.88);line-height:1.5;">Sexist beliefs + negative attitudes about sexual violence = <b>increased tolerance and perpetration of sexual violence.</b></div>
        </div>
        <div style="border:1px solid rgba(255,120,80,.30);border-radius:14px;background:rgba(255,80,80,.06);padding:14px;">
          <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(255,160,120,.85);margin-bottom:6px;">COMMUNITY LEVEL</div>
          <div style="font-size:13px;color:rgba(209,254,255,.88);line-height:1.5;">Higher levels of sexist beliefs + rigid gender roles = <b>increased rates of violence against women.</b></div>
        </div>
      </div>
      <div class="note" style="margin-top:10px;">Girls, especially Black and Brown girls, LGBTQ+ youth, and people with disabilities, are often portrayed as sexually available in media. The intersections of racism, sexism, and homophobia leave Indigenous and Black girls, and transgender youth, the most at-risk for sexual violence.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 8) {
    // Recognize & Call Out
    const dismissals = [
      '"Can\'t you take a joke?!"', '"Man up."',
      '"It\'s not my fault you\'re so sensitive."', '"No one else cares when I say things."',
      '"Snitches get stitches."', '"Don\'t be such a feminist."',
      '"It\'s really not a big deal — you know how boys are."', '"Don\'t be a drama queen."',
      '"You should take it as a compliment."', '"Don\'t take it so personally."'
    ];
    const dismissalTags = dismissals.map(d =>
      `<span style="display:inline-block;padding:6px 12px;border-radius:999px;border:1px solid rgba(255,150,80,.35);background:rgba(255,100,50,.10);color:rgba(255,210,180,.90);font-size:12px;font-weight:700;margin:4px;">${d}</span>`
    ).join('');
    innerHTML = `
      <div class="p">When someone speaks up about rape culture, they often face pushback. Recognizing these responses helps you stand firm.</div>
      <div style="border:1px solid rgba(255,150,80,.30);border-radius:14px;background:rgba(255,80,50,.06);padding:14px;margin:10px 0;">
        <div style="font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:.4px;color:rgba(255,160,100,.80);margin-bottom:10px;">DO THESE SOUND FAMILIAR? Recognize it — shut it down.</div>
        <div style="display:flex;flex-wrap:wrap;gap:4px;">${dismissalTags}</div>
      </div>
      <div class="note" style="margin-top:10px;">When someone says something consistent with rape culture and then shames you for calling it out — <b>you were not wrong for calling it out.</b> Don't be afraid to stand up when you know it's the right thing to do, whether the comments are directed at you, a friend, or an acquaintance.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Next →</button>
      </div>
    `;
  } else if (s === 9) {
    // How to Shift to a Culture of Respect
    const shifts = [
      { emoji: '📚', title: 'Broaden your understanding', body: 'Rape culture takes many forms beyond the narrow notion of a man assaulting a woman — including child marriage, rape as a tactic of war, and "corrective rape" against LGBTQ+ individuals.' },
      { emoji: '✅', title: 'Create a culture of enthusiastic consent', body: 'Only engage in sex-positive activity when there is ENTHUSIASTIC verbal consent. Model this and others around you learn it too.' },
      { emoji: '🗣️', title: 'Speak out against root causes', body: 'Don\'t buy into ideas that view masculinity as violent and dominant, or femininity as passive, weak, or less valued. Challenge these stereotypes when you encounter them.' },
      { emoji: '🚫', title: 'Have zero tolerance', body: 'Do not share intimate images of anyone without their permission, and let your friends know you aren\'t okay with them doing it either.' },
      { emoji: '🛑', title: 'Stop victim blaming', body: 'Perpetrators are always responsible for assault — NEVER the survivor. A survivor\'s sobriety, clothing, and sexual history are not relevant.' },
      { emoji: '🌍', title: 'Take an intersectional approach', body: 'Rape culture affects everyone regardless of gender, sexuality, race, religion, or ability. Transgender youth, Indigenous, Brown and Black girls, and people with disabilities are most at-risk.' },
      { emoji: '👂', title: 'Listen to survivors', body: 'Survivors are speaking up more than ever. Listen to their experiences, have compassion, and believe their truth.' },
      { emoji: '✋', title: 'Be an active bystander', body: 'Not just among your friends, but with ANYONE. Safely intervening signals that harmful behavior is unacceptable and may help someone stay safe.' },
      { emoji: '⚖️', title: 'Fight for justice', body: 'Justice looks different for every survivor. Support them in whatever they choose, and help hold perpetrators accountable.' },
      { emoji: '💬', title: 'Educate your peers', body: 'Talk to your family and friends about how to end rape culture and support survivors. Awareness + Action = Culture Change.' },
    ];
    const shiftHtml = shifts.map((item, i) => `
      <div class="scItem" id="rcShift${i}">
        <button class="scHeader" type="button" data-rcshift="${i}" aria-expanded="false">
          <span class="scEmoji">${item.emoji}</span>
          <span class="scTitle">${item.title}</span>
          <span class="scChev" aria-hidden="true">
            <svg width="12" height="12" viewBox="0 0 14 14" fill="none"><path d="M2.5 5L7 9.5L11.5 5" stroke="rgba(209,254,255,.78)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </span>
        </button>
        <div class="scBody" id="rcShiftBody${i}">${item.body}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p">YOU can change the culture of your school and community. When you do, people will see and join you.</div>
      <div class="mutedBox" style="margin-bottom:12px;"><b>Awareness + Action = Culture Change</b></div>
      <div class="scAccordion">${shiftHtml}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-rcaction="back">← Back</button>
        <button class="btn btnPrimary" data-rcaction="next">Knowledge Check →</button>
      </div>
    `;
  } else if (s === 10) {
    // Quiz
    const qi = rcState.quizIdx;
    const q = RC_QUIZ[qi];
    const answered = rcState.quizAnswers[qi] !== undefined;
    const chosen = rcState.quizAnswers[qi];
    const isCorrect = chosen === q.correct;
    const isLast = qi === RC_QUIZ.length - 1;

    const opts = q.options.map((opt, oi) => {
      let cls = 'btn myQuizOpt';
      if (answered) {
        if (oi === q.correct) cls += ' myQuizCorrect';
        else if (oi === chosen && !isCorrect) cls += ' myQuizWrong';
      }
      return `<button class="${cls}" data-rcquiz="${oi}" ${answered ? 'disabled' : ''}>${opt}</button>`;
    }).join('');

    const feedback = answered ? `
      <div class="note" style="border-color:${isCorrect ? 'rgba(21,255,200,.5)' : 'rgba(255,80,80,.5)'}; background:${isCorrect ? 'rgba(21,255,200,.08)' : 'rgba(255,80,80,.08)'}; margin-top:8px;">
        ${isCorrect ? '✅ Correct!' : '❌ Not quite.'} ${q.explain}
      </div>` : '';

    const nextBtn = answered
      ? (isLast
        ? `<button class="btn btnPrimary" data-rcaction="next" style="margin-top:10px;width:100%;">See Resources →</button>`
        : `<button class="btn btnPrimary" data-rcquiznext="1" style="margin-top:10px;width:100%;">Next Question →</button>`)
      : '';

    const prevBtn = qi > 0
      ? `<button class="btn" data-rcquizprev="1">← Previous Question</button>`
      : `<button class="btn" data-rcaction="back">← Back</button>`;

    innerHTML = `
      <div class="p"><b>Question ${qi + 1} of ${RC_QUIZ.length}</b></div>
      <div class="note" style="background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.25); font-size:15px; font-weight:800; color:var(--sb-light); margin-bottom:12px;">${q.q}</div>
      <div class="dsConsentGrid" style="gap:8px;">${opts}</div>
      ${feedback}
      ${nextBtn}
      <div class="dsNavRow" style="margin-top:12px;">
        ${prevBtn}
      </div>
    `;
  } else {
    // Resources
    const resList = RC_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You've completed the Rape Culture module. Here are real resources if you or someone you know needs support.</div>
      <div class="dsResourceList">${resList}</div>
      <div class="mutedBox" style="margin-top:12px;">Remember: rape culture is real, but so is your power to push back. Awareness + Action = Culture Change.</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-rcaction="restart" style="width:100%">Start this module over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Module</div>
      <div class="h1">🌍 Rape Culture</div>
      <div class="p" style="margin:0">What it is, how it's learned, and how to shift toward a culture of respect.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Nav events
  screen.querySelectorAll('[data-rcaction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.rcaction;
      if (a === 'next') {
        if (s === 10) {
          // from quiz, go to resources
          rcState.step = Math.min(RC_STEPS.length - 1, rcState.step + 1);
        } else {
          rcState.step = Math.min(RC_STEPS.length - 1, rcState.step + 1);
        }
        rcRender();
      } else if (a === 'back') {
        rcState.step = Math.max(0, rcState.step - 1);
        rcRender();
      } else if (a === 'restart') {
        rcState = { step: 0, mythOpen: null, elementOpen: null, quizIdx: 0, quizAnswers: {} };
        rcRender();
      }
    };
  });

  // Myth toggles
  screen.querySelectorAll('[data-rcmyth]').forEach(el => {
    el.onclick = () => {
      const idx = parseInt(el.dataset.rcmyth);
      rcState.mythOpen = rcState.mythOpen === idx ? null : idx;
      rcRender();
    };
  });

  // Element toggles
  screen.querySelectorAll('[data-rcelement]').forEach(el => {
    el.onclick = () => {
      const idx = parseInt(el.dataset.rcelement);
      rcState.elementOpen = rcState.elementOpen === idx ? null : idx;
      rcRender();
    };
  });

  // Shift culture accordion
  screen.querySelectorAll('[data-rcshift]').forEach(btn => {
    btn.onclick = () => {
      const idx = btn.getAttribute('data-rcshift');
      const body = document.getElementById('rcShiftBody' + idx);
      const open = body.classList.contains('scOpen');
      document.querySelectorAll('[id^="rcShiftBody"]').forEach(b => b.classList.remove('scOpen'));
      document.querySelectorAll('[data-rcshift]').forEach(b => { b.classList.remove('scOpen'); b.setAttribute('aria-expanded', 'false'); });
      if (!open) {
        body.classList.add('scOpen');
        btn.classList.add('scOpen');
        btn.setAttribute('aria-expanded', 'true');
      }
    };
  });

  // Quiz answers
  screen.querySelectorAll('[data-rcquiz]').forEach(btn => {
    btn.onclick = () => {
      const oi = parseInt(btn.dataset.rcquiz);
      rcState.quizAnswers[rcState.quizIdx] = oi;
      rcRender();
    };
  });
  screen.querySelectorAll('[data-rcquiznext]').forEach(btn => {
    btn.onclick = () => {
      rcState.quizIdx = Math.min(RC_QUIZ.length - 1, rcState.quizIdx + 1);
      rcRender();
    };
  });
  screen.querySelectorAll('[data-rcquizprev]').forEach(btn => {
    btn.onclick = () => {
      rcState.quizIdx = Math.max(0, rcState.quizIdx - 1);
      rcRender();
    };
  });

  // Back to next steps
  screen.querySelectorAll('[data-action="nextSteps"]').forEach(el => {
    el.onclick = () => go('nextSteps');
  });
}
// ================================================================
// CONSENT MODULE
// Based on SafeBAE Consent educational module © 2020 safebae.org
// ================================================================

let conState = { step: 0, pillarOpen: null, quizIdx: 0, quizAnswers: {} };

const CON_STEPS = [
  'Intro',
  'What Is Consent?',
  'When Do You Need It?',
  'The 6 Pillars',
  'Pillar: Mutual',
  'Pillar: Ongoing',
  'Pillar: Voluntary',
  'Pillar: Sober',
  'Pillar: Revocable',
  'Pillar: Enthusiastic',
  'Getting It Wrong',
  'When Is Consent Not Possible?',
  'Knowledge Check',
  'Resources'
];

const CON_PILLARS = [
  {
    id: 0,
    name: 'Mutual',
    emoji: '🤲',
    short: 'Everyone agrees — without pressure.',
    body: `Both parties agree to any and all intimacy without pressure. Consent is more about mutual experiences and collaboration, where all people involved get to voice their desires and boundaries and have them respected. It's about each person being able to communicate throughout an experience about what they like and don't like or want and don't want.`,
    tip: `Establish your own boundaries before you're in the situation. Talk them through with your partner — and learn theirs.`
  },
  {
    id: 1,
    name: 'Ongoing',
    emoji: '🔄',
    short: 'Consent must be present the whole time.',
    body: `Consent is not a one-time question at the beginning. It must be checked in on throughout. Establishing and communicating boundaries is a precursor to consent — talking through scenarios first, then putting them into practice together.`,
    tip: `Ask: "Are you okay?" "Does this feel good?" "Should we stop?" Keep checking in — things shift all the time.`
  },
  {
    id: 2,
    name: 'Voluntary',
    emoji: '🙌',
    short: 'No pressure, guilt, or coercion.',
    body: `Consent is voluntary when you genuinely want to participate — freely, clearly, and without pressure. You're saying yes because you're excited to, not because you feel pressured, worn down, or afraid to say no. "No doesn't mean convince me." Dating isn't a game, and consent isn't something to "win."`,
    tip: `You should never feel like you owe someone sex — not to make them like you, not because they did something nice, not because of "blue balls." Internalized pressure is as real as external pressure.`
  },
  {
    id: 3,
    name: 'Sober',
    emoji: '🧠',
    short: 'Everyone must be clear-headed.',
    body: `Everyone involved must have a clear mind and the ability to make thoughtful, informed choices. Alcohol or drugs blur judgment and make it harder to communicate boundaries. If someone is inebriated, they can't fully consent — and if you are, you can't fully read or respect someone else's boundaries either.`,
    tip: `If you wouldn't let a drunk friend drive, don't let them hook up either. If you see a friend trying to hook up with someone who's drunk, step in.`
  },
  {
    id: 4,
    name: 'Revocable',
    emoji: '↩️',
    short: 'Anyone can change their mind — anytime.',
    body: `Either party can change their mind at any time for any reason. No exceptions. No excuses. No pressure. This goes for hook-ups, long-term relationships, and everything in between — even if you've done something before. Consent given once is not consent for all time. Consent for one action is not consent for all actions.`,
    tip: `"Maybe" and "I guess so" aren't substitutes for "yes." Asking over and over until someone gives in is not consent. Offer an easy out: "You seem nervous — do you want to stop?"`
  },
  {
    id: 5,
    name: 'Enthusiastic',
    emoji: '✨',
    short: 'A hesitant yes is actually a no.',
    body: `The best kind of consent is when there is reciprocal pleasure. Don't just assume your partner is as into it as you are. If they seem hesitant or not as engaged, it's up to you to stop and check in. Communication is the foundation of good intimacy. By being open and honest about what you want, there's less room for confusion or risk of crossing someone's boundaries.`,
    tip: `"Do you think it would be fun if we ___?" "Do you like it when I ___?" Making sure your partner is enjoying it is the best part.`
  }
];

const CON_QUIZ = [
  {
    q: 'If someone says "I guess so" or "maybe," that counts as consent.',
    options: ['True — they didn\'t say no', 'False — a hesitant yes is actually a no', 'It depends on the situation'],
    correct: 1,
    explain: 'A hesitant yes is a definite no. Only enthusiastic, clear agreement counts. Keep checking in.'
  },
  {
    q: 'Once someone gives consent, it applies for the rest of the encounter.',
    options: ['True — they already said yes', 'False — consent can be revoked at any time', 'Only if it\'s a long-term relationship'],
    correct: 1,
    explain: 'Consent is revocable at any moment, for any reason. Anyone can stop and they shouldn\'t be made to feel bad about it.'
  },
  {
    q: 'Someone who is drunk can still give valid consent if they verbally say yes.',
    options: ['True — they spoke the words', 'False — you cannot get consent from someone under the influence', 'It depends how drunk they are'],
    correct: 1,
    explain: 'Consent is not possible from someone under the influence of any substance — even if they say yes. This is considered sexual assault.'
  },
  {
    q: 'Which of these best describes "mutual" consent?',
    options: [
      'One person asks, the other says yes',
      'Everyone involved voices their desires and boundaries and has them respected',
      'The person who initiates is responsible for consent'
    ],
    correct: 1,
    explain: 'Mutual consent is collaborative — not a one-way ask. All parties communicate what they want and don\'t want throughout.'
  },
  {
    q: 'You should only ask for consent once — at the very beginning — to avoid being awkward.',
    options: ['True — asking too much kills the mood', 'False — consent must be ongoing throughout', 'Only for new partners'],
    correct: 1,
    explain: 'Ongoing consent means checking in throughout. Asking questions doesn\'t have to be awkward — it makes the experience better for everyone.'
  }
];

const CON_RESOURCES = [
  { icon: '🌐', name: 'SafeBAE', desc: 'Student-led resources on consent, safety, and accountability', url: 'https://safebae.org' },
  { icon: '📞', name: 'RAINN Hotline', desc: '1-800-656-HOPE (4673) — 24/7 support for sexual violence', url: 'https://www.rainn.org/get-help' },
  { icon: '💬', name: 'Crisis Text Line', desc: 'Text HOME to 741741 for free, confidential support', url: 'https://www.crisistextline.org' },
  { icon: '🎥', name: 'Tea & Consent (video)', desc: 'A clear, simple explanation of consent using tea as a metaphor', url: 'https://www.youtube.com/watch?v=oQbei5JGiT8' },
  { icon: '📚', name: 'NSVRC', desc: 'National Sexual Violence Resource Center — education & research', url: 'https://www.nsvrc.org' }
];

function consentRender() {
  const screen = document.getElementById('screen');
  const s = conState.step;
  const total = CON_STEPS.length;

  const progressDots = CON_STEPS.map((_, i) => {
    let cls = 'dsProgressDot';
    if (i === s) cls += ' active';
    else if (i < s) cls += ' done';
    return `<div class="${cls}"></div>`;
  }).join('');

  let innerHTML = '';

  if (s === 0) {
    // Intro
    innerHTML = `
      <div class="note" style="font-size:15px; font-weight:900; color:var(--sb-light); border-color:rgba(21,255,200,.6); background:rgba(21,255,200,.10);">
        Consent = Asking Permission
      </div>
      <div class="p">Consent is usually discussed in the context of sexual activity — but it can really apply to any interaction of any kind. The definition is simple: <b>"permission for something to happen or agreement to do something."</b></div>
      <div class="p">That means people can be practicing consent long before it has anything to do with sex. You should ask consent to borrow your sister's sweater!</div>
      <div class="p" style="color:var(--sb-mint); font-weight:800;">Good consent is a practice — so keep at it. Be kind, respectful, and considerate to all your partners.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back to modules</button>
        <button class="btn btnPrimary" data-conaction="next">Start →</button>
      </div>
    `;
  } else if (s === 1) {
    // What is consent
    innerHTML = `
      <div class="p">Consent is more than a legal checkbox — it's a habit of paying attention. To your partner. To signals. To hesitation. To your own assumptions.</div>
      <div class="dsConsentGrid">
        <div class="dsStep">
          <div class="dsStepNum">📖</div>
          <div class="dsStepText"><b>The definition:</b> Permission for something to happen, or agreement to do something.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">👶</div>
          <div class="dsStepText"><b>It starts young:</b> When a caretaker teaches you to say "please" — that's the beginning of consent practice.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">🔁</div>
          <div class="dsStepText"><b>It's a skill:</b> Skills get better with practice. Consent isn't a rule you follow once — it's something you keep developing.</div>
        </div>
      </div>
      <div class="mutedBox">Consent applies to all interactions — borrowing someone's bike, giving a hug, tickling a friend, and yes, sexual activity too.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">Next →</button>
      </div>
    `;
  } else if (s === 2) {
    // When do you need it
    const examples = [
      { emoji: '🚲', label: 'Borrowing a bike', note: 'They may say yes on Tuesday but not Friday.' },
      { emoji: '🤗', label: 'Giving someone a hug', note: 'Not everyone wants a hug, even from friends.' },
      { emoji: '😄', label: 'Tickling someone', note: 'They may say yes at first, then want you to stop.' },
      { emoji: '📱', label: 'Using their phone or screen time', note: 'Checking in matters even for small things.' },
      { emoji: '👕', label: 'Borrowing clothes', note: 'Ask, don\'t assume — even from close family.' },
      { emoji: '💋', label: 'Kissing or physical affection', note: 'Physical contact always requires a yes.' },
    ];
    const cards = examples.map(e => `
      <div class="dsStep">
        <div class="dsStepNum">${e.emoji}</div>
        <div class="dsStepText"><b>${e.label}</b> — ${e.note}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p">Consent doesn't begin with sex. It starts the moment you interact with another person's body, belongings, or space.</div>
      <div class="note" style="font-weight:800; color:var(--sb-light); font-size:14px;">Consent starts when you are a little kid — way back when your caretaker taught you to say "please."</div>
      <div class="dsStepList">${cards}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">Next →</button>
      </div>
    `;
  } else if (s === 3) {
    // 6 Pillars overview
    const pillarsHtml = CON_PILLARS.map((p, i) => `
      <button class="btn" data-conpillar="${i}" style="display:flex;align-items:center;gap:12px;padding:12px 14px;">
        <span style="font-size:20px;">${p.emoji}</span>
        <span style="flex:1;text-align:left;">
          <span style="display:block;font-weight:900;font-size:14px;color:var(--sb-light);">${p.name}</span>
          <span style="display:block;font-size:12px;color:var(--muted);margin-top:2px;">${p.short}</span>
        </span>
        <span style="color:var(--muted);font-size:12px;">→</span>
      </button>
    `).join('');
    innerHTML = `
      <div class="p">SafeBAE's framework for consent has <b>6 pillars</b>. Each one is essential — they work together, not in isolation.</div>
      <div class="note" style="font-weight:900; font-size:14px; color:var(--sb-mint);">CONSENT IS BAE — Before. Anyone. Else.</div>
      <div class="dsConsentGrid" style="gap:8px;">${pillarsHtml}</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">Explore each pillar →</button>
      </div>
    `;
  } else if (s >= 4 && s <= 9) {
    // Individual pillars (steps 4–9 = pillars 0–5)
    const pIdx = s - 4;
    const p = CON_PILLARS[pIdx];
    const isLast = pIdx === 5;
    innerHTML = `
      <div class="note" style="background:rgba(21,255,200,.08); border-color:rgba(21,255,200,.4); font-size:22px; font-weight:900; color:var(--sb-light); padding:16px; text-align:center;">
        ${p.emoji} ${p.name}
      </div>
      <div class="p" style="margin-top:12px;">${p.body}</div>
      <div class="dsScriptBlock">
        <div class="dsScriptLabel">💡 How to apply this</div>
        <div class="dsScriptText">${p.tip}</div>
      </div>
      <div class="mutedBox" style="margin-top:10px;font-size:11px;">Pillar ${pIdx + 1} of 6</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">${isLast ? 'Getting It Wrong →' : 'Next Pillar →'}</button>
      </div>
    `;
  } else if (s === 10) {
    // Getting It Wrong / Intent vs Impact
    innerHTML = `
      <div class="note" style="font-weight:900; font-size:15px; color:var(--sb-light); border-color:rgba(21,255,200,.5);">
        INTENT vs. IMPACT
      </div>
      <div class="p">There are times when even well-meaning partners unintentionally cross boundaries. <b>If this ever happens, take responsibility.</b></div>
      <div class="dsStepList">
        <div class="dsStep">
          <div class="dsStepNum">1</div>
          <div class="dsStepText"><b>Don't be defensive.</b> You may not have meant to hurt them, but being defensive or refusing to believe it will only cause further harm.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">2</div>
          <div class="dsStepText"><b>Different recollections are common.</b> Two people in the same situation can have very different understandings of what happened — that's normal.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">3</div>
          <div class="dsStepText"><b>Take time to understand the harm.</b> If you try to understand how your behavior affected them, you help them heal — and help yourself not repeat it.</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum">4</div>
          <div class="dsStepText"><b>Communicate what you heard and how you'll do better.</b> Not just "I'm sorry" — but what you'll actually change going forward.</div>
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">When consent isn't possible →</button>
      </div>
    `;
  } else if (s === 11) {
    // When consent is not possible
    const notPossible = [
      { emoji: '😴', label: 'Unconscious or asleep', body: 'You cannot get consent from someone who is not awake or aware.' },
      { emoji: '🍺', label: 'Under the influence', body: 'Consent is NOT possible from anyone under the influence of any substance — even if they say yes. This is considered sexual assault.' },
      { emoji: '🧒', label: 'Under age', body: 'Minors cannot give consent to sexual activity with adults. Age of consent laws exist to protect young people from exploitation.' },
      { emoji: '👑', label: 'Power imbalance / coercion', body: 'When one person uses their power (age, status, authority, popularity) to pressure another, consent is not truly free. If someone feels they have to say yes, it\'s not consent.' },
      { emoji: '🗣️', label: 'Talked or manipulated into it', body: 'Pressuring, guilt-tripping, or wearing someone down until they give in is coercion — not consent.' },
    ];
    const cards = notPossible.map(n => `
      <div class="dsConsentCard" style="cursor:default;">
        <div class="dsConsentHead">
          <span class="dsConsentEmoji">${n.emoji}</span>
          <span>${n.label}</span>
        </div>
        <div style="font-size:13px;color:var(--muted);padding:0 14px 14px;line-height:1.4;">${n.body}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p">Consent requires everyone involved to be capable of freely and knowingly agreeing. Here are situations where consent is <b>not possible:</b></div>
      <div class="dsConsentGrid" style="gap:8px;">${cards}</div>
      <div class="note" style="font-weight:800; margin-top:10px;">Being sober means more fulfilling, safer interactions. The same logic that stops drunk driving applies here.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-conaction="back">← Back</button>
        <button class="btn btnPrimary" data-conaction="next">Knowledge Check →</button>
      </div>
    `;
  } else if (s === 12) {
    // Quiz
    const qi = conState.quizIdx;
    const q = CON_QUIZ[qi];
    const answered = conState.quizAnswers[qi] !== undefined;
    const chosen = conState.quizAnswers[qi];
    const isCorrect = chosen === q.correct;
    const isLast = qi === CON_QUIZ.length - 1;

    const opts = q.options.map((opt, oi) => {
      let cls = 'btn myQuizOpt';
      if (answered) {
        if (oi === q.correct) cls += ' myQuizCorrect';
        else if (oi === chosen && !isCorrect) cls += ' myQuizWrong';
      }
      return `<button class="${cls}" data-conquiz="${oi}" ${answered ? 'disabled' : ''}>${opt}</button>`;
    }).join('');

    const feedback = answered ? `
      <div class="note" style="border-color:${isCorrect ? 'rgba(21,255,200,.5)' : 'rgba(255,80,80,.5)'}; background:${isCorrect ? 'rgba(21,255,200,.08)' : 'rgba(255,80,80,.08)'}; margin-top:8px;">
        ${isCorrect ? '✅ Correct!' : '❌ Not quite.'} ${q.explain}
      </div>` : '';

    const nextBtn = answered
      ? (isLast
        ? `<button class="btn btnPrimary" data-conaction="next" style="margin-top:10px;width:100%;">See Resources →</button>`
        : `<button class="btn btnPrimary" data-conquiznext="1" style="margin-top:10px;width:100%;">Next Question →</button>`)
      : '';

    const prevBtn = qi > 0
      ? `<button class="btn" data-conquizprev="1">← Previous Question</button>`
      : `<button class="btn" data-conaction="back">← Back</button>`;

    innerHTML = `
      <div class="p"><b>Question ${qi + 1} of ${CON_QUIZ.length}</b></div>
      <div class="note" style="background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.25); font-size:15px; font-weight:800; color:var(--sb-light); margin-bottom:12px;">${q.q}</div>
      <div class="dsConsentGrid" style="gap:8px;">${opts}</div>
      ${feedback}
      ${nextBtn}
      <div class="dsNavRow" style="margin-top:12px;">
        ${prevBtn}
      </div>
    `;
  } else {
    // Resources
    const resList = CON_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You've completed the Consent module. Here are resources to learn more or get support.</div>
      <div class="dsResourceList">${resList}</div>
      <div class="mutedBox" style="margin-top:12px;"><b>Remember:</b> Good consent is a practice. Keep at it — and be kind, respectful, and considerate to all your partners.</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-conaction="restart" style="width:100%">Start this module over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Module</div>
      <div class="h1">🤝 Consent</div>
      <div class="p" style="margin:0">What it means, the 6 pillars, how to practice it, and when it's not possible.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Nav
  screen.querySelectorAll('[data-conaction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.conaction;
      if (a === 'next') {
        conState.step = Math.min(CON_STEPS.length - 1, conState.step + 1);
        consentRender();
      } else if (a === 'back') {
        if (conState.step === 0) {
          go('nextSteps');
        } else {
          conState.step = Math.max(0, conState.step - 1);
          consentRender();
        }
      } else if (a === 'restart') {
        conState = { step: 0, pillarOpen: null, quizIdx: 0, quizAnswers: {} };
        consentRender();
      }
    };
  });

  // Pillar shortcut from overview
  screen.querySelectorAll('[data-conpillar]').forEach(btn => {
    btn.onclick = () => {
      conState.step = 4 + parseInt(btn.dataset.conpillar);
      consentRender();
    };
  });

  // Quiz answers
  screen.querySelectorAll('[data-conquiz]').forEach(btn => {
    btn.onclick = () => {
      conState.quizAnswers[conState.quizIdx] = parseInt(btn.dataset.conquiz);
      consentRender();
    };
  });
  screen.querySelectorAll('[data-conquiznext]').forEach(btn => {
    btn.onclick = () => {
      conState.quizIdx = Math.min(CON_QUIZ.length - 1, conState.quizIdx + 1);
      consentRender();
    };
  });
  screen.querySelectorAll('[data-conquizprev]').forEach(btn => {
    btn.onclick = () => {
      conState.quizIdx = Math.max(0, conState.quizIdx - 1);
      consentRender();
    };
  });

  // Back to next steps from resources
  screen.querySelectorAll('[data-action="nextSteps"]').forEach(el => {
    el.onclick = () => go('nextSteps');
  });
}

// =====================================================
// SARD MODULE — Sexual Harassment, Assault & Rape Defined
// =====================================================
let sardState = { step: 0, quizIdx: 0, quizAnswers: {} };

const SARD_STEPS = [
  'warning', 'intro', 'svForms', 'svList',
  'harassment_what', 'harassment_def', 'harassment_facts', 'harassment_types',
  'assault_what', 'assault_def', 'assault_more',
  'rape_what', 'rape_def', 'rape_legal',
  'continuum', 'validity', 'prevention', 'quiz', 'resources'
];

const SARD_QUIZ = [
  {
    q: 'Sexual violence is primarily motivated by sexual desire.',
    options: ['True', 'False'],
    correct: 1,
    explain: 'Sexual violence is typically motivated by the desire to control, humiliate, and/or harm — not by sexual desire.'
  },
  {
    q: 'Which of the following is an example of CYBER harassment?',
    options: ['Catcalling someone on the street', 'Sharing someone\'s intimate photo without consent', 'Unwanted kissing', 'Obscene gestures'],
    correct: 1,
    explain: 'Sharing pictures without consent is cyber harassment. Catcalling is verbal, unwanted kissing is physical, and obscene gestures are nonverbal harassment.'
  },
  {
    q: 'Sexual harassment can only happen between strangers.',
    options: ['True', 'False — it can be someone you know or are close with'],
    correct: 1,
    explain: 'A harasser could be someone you know or are close with. Sexual harassment can occur online, at school, in the workplace, or anywhere.'
  },
  {
    q: 'Sexual assault requires penetration to qualify as assault.',
    options: ['True', 'False — it includes many forms of unwanted sexual contact'],
    correct: 1,
    explain: 'Sexual assault includes fondling, unwanted touching, forcing sexual acts, and more — not only penetration. It is an overall term for any kind of sexual violence.'
  },
  {
    q: 'If someone\'s assault wasn\'t as severe as someone else\'s, their experience is less valid.',
    options: ['True', 'False — every survivor\'s experience is valid'],
    correct: 1,
    explain: 'Every survivor\'s experience is valid and potentially traumatizing. Harm doesn\'t have to be visible for it to be real. Scars do not have to be on the outside.'
  },
  {
    q: 'Which is NOT a way to keep peers safe?',
    options: [
      'Intervening if you see someone pursuing a person who can\'t consent',
      'Judging others based on their sexual activity',
      'Supporting survivors when they disclose to you',
      'Standing up if you see negative comments online'
    ],
    correct: 1,
    explain: 'Judging others based on their sexual activity is harmful, not helpful. The other three are all positive bystander actions that keep peers safer.'
  }
];

const SARD_RESOURCES = [
  { icon: '🌐', name: 'SafeBAE', desc: 'Resources for student survivors', url: 'https://safebae.org/' },
  { icon: '🆘', name: 'RAINN', desc: 'National Sexual Assault Hotline: 1-800-656-4673', url: 'https://rainn.org/' },
  { icon: '💬', name: 'Crisis Text Line', desc: 'Text HOME to 741741', url: 'https://www.crisistextline.org/' },
  { icon: '📞', name: '988 Lifeline', desc: 'Call or text 988 for mental health support', url: 'https://988lifeline.org/' },
];

function sardRender() {
  const screen = document.getElementById('screen');
  const s = sardState.step;
  const total = SARD_STEPS.length;

  const progressDots = SARD_STEPS.map((_, i) => {
    let cls = 'dsProgressDot';
    if (i < s) cls += ' done';
    if (i === s) cls += ' active';
    return `<div class="${cls}"></div>`;
  }).join('');

  let innerHTML = '';

  if (s === 0) {
    // Content warning
    innerHTML = `
      <div style="text-align:center; padding:10px 0 18px;">
        <div style="font-size:2.8rem; margin-bottom:10px;">⚠️</div>
        <div class="note" style="font-size:15px; font-weight:900; border-color:rgba(255,160,80,.5); background:rgba(255,160,80,.08); color:var(--sb-light); text-align:center;">
          Content Warning
        </div>
        <div class="p" style="margin-top:14px; font-size:14px; line-height:1.65; text-align:center;">
          This module covers <b>sexual harassment, assault, and rape</b>. These are very sensitive topics.
          We encourage you to take your time and <b>pause whenever you need to</b>.
        </div>
        <div class="mutedBox" style="margin-top:10px; font-size:12px;">
          If you need support right now, call or text <b>RAINN at 1-800-656-4673</b> or text HOME to <b>741741</b>.
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:10px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">I'm ready →</button>
      </div>
    `;
  } else if (s === 1) {
    // Intro — what is sexual violence
    innerHTML = `
      <div class="note" style="font-weight:900; font-size:15px; color:var(--sb-light); border-color:rgba(21,255,200,.5);">
        📖 SEXUAL VIOLENCE
      </div>
      <div class="p" style="margin-top:12px;">
        Sexual harassment, assault and rape are all forms of <b>sexual and interpersonal violence</b>.
      </div>
      <div class="p">
        Sexual violence is a crime typically motivated by the desire to <b>control, humiliate, and/or harm</b> — not by sexual desire.
      </div>
      <div class="p">
        In this module you'll learn the definitions of each type of sexual violence, how they differ, and what you can do to prevent harm in your school and community.
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">What does it include? →</button>
      </div>
    `;
  } else if (s === 2) {
    // Forms of sexual violence — cards
    const forms = [
      { emoji: '👁️', label: 'Exposure', body: 'Gaining pleasure from exposing genitals and/or for the purpose of upsetting or harming another.' },
      { emoji: '🔭', label: 'Voyeurism', body: 'Gaining sexual pleasure from watching others when they are naked or engaged in sexual activity.' },
      { emoji: '🚫', label: 'Incest', body: 'The crime of having sexual intercourse with a parent, child, sibling, or grandchild.' },
    ];
    const cards = forms.map(f => `
      <div class="dsConsentCard" style="cursor:default;">
        <div class="dsConsentHead">
          <span class="dsConsentEmoji">${f.emoji}</span>
          <span>${f.label}</span>
        </div>
        <div style="font-size:13px;color:var(--muted);padding:0 14px 14px;line-height:1.45;">${f.body}</div>
      </div>
    `).join('');
    innerHTML = `
      <div class="p">Sexual violence includes acts such as:</div>
      <div class="dsConsentGrid" style="gap:8px;">${cards}</div>
      <div class="note" style="margin-top:10px;">These are just a few examples. Any act that violates another person's bodily autonomy without consent is a form of sexual violence.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Full list →</button>
      </div>
    `;
  } else if (s === 3) {
    // Full list — stop all forms
    const items = [
      'Rape by strangers or acquaintances',
      'Rape within marriage or dating relationships',
      'Unwanted sexual advances or sexual harassment (at school, work, etc.)',
      'Systematic rape, sexual slavery and other forms of violence common in armed conflicts',
      'Sexual abuse of mentally or physically disabled people',
      'Rape and sexual abuse of children',
      'Customary forms of sexual violence, such as forced marriage or cohabitation',
    ];
    innerHTML = `
      <div class="note" style="font-weight:900; font-size:14px; border-color:rgba(255,80,80,.4); background:rgba(255,80,80,.06); color:var(--sb-light);">
        🛑 Stop All Forms of Sexual Violence
      </div>
      <div class="dsStepList" style="margin-top:12px;">
        ${items.map(item => `
          <div class="dsStep">
            <div class="dsStepNum" style="background:rgba(255,80,80,.15); border-color:rgba(255,80,80,.3); color:rgba(255,160,160,.9);">✕</div>
            <div class="dsStepText">${item}</div>
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">What is Sexual Harassment? →</button>
      </div>
    `;
  } else if (s === 4) {
    // Section header: Sexual Harassment
    innerHTML = `
      <div style="text-align:center; padding:16px 0 24px;">
        <div style="font-size:2.2rem; margin-bottom:12px;">🗣️</div>
        <div style="font-weight:900; font-size:22px; line-height:1.25; color:var(--sb-light);">
          What EXACTLY is<br><span style="position:relative; display:inline-block;">Sexual <span style="color:var(--sb-mint);">Harassment</span>?<span style="position:absolute;left:0;bottom:-4px;width:100%;height:3px;background:var(--sb-mint);border-radius:2px;opacity:.6;"></span></span>
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">The Definition →</button>
      </div>
    `;
  } else if (s === 5) {
    // Sexual Harassment definition
    innerHTML = `
      <div class="dsEyebrow">SEXUAL HARASSMENT</div>
      <div class="h1" style="margin-bottom:16px;">The <span style="background:rgba(21,255,200,.25); border-radius:6px; padding:2px 6px;">Definition</span></div>
      <div class="p">
        Sexual harassment is <b>unwelcome sexual advances, requests for sexual favors</b> and other unwanted verbal or physical conduct of sexual nature.
      </div>
      <div class="note" style="margin-top:10px; font-weight:800;">
        Sexual harassment includes sexual assault.
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Key Facts →</button>
      </div>
    `;
  } else if (s === 6) {
    // Sexual Harassment facts
    const facts = [
      { n: '1', text: 'Sexual harassment can occur <b>anywhere</b>: online, in the street, at school, or in the workplace.' },
      { n: '2', text: 'People of <b>any age, gender, race, sexuality, ethnicity, or religion</b> may harass or be harassed.' },
      { n: '3', text: 'There are many different types, including <b>"Quid Pro Quo"</b> — a favor or advantage granted or expected in return for something.' },
      { n: '4', text: 'A harasser could be <b>someone you know or are close with</b>. They are not necessarily a random stranger.' },
    ];
    innerHTML = `
      <div class="dsEyebrow">SEXUAL HARASSMENT</div>
      <div class="h1" style="margin-bottom:14px;">Key Facts</div>
      <div class="dsStepList">
        ${facts.map(f => `
          <div class="dsStep">
            <div class="dsStepNum">${f.n}</div>
            <div class="dsStepText">${f.text}</div>
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Types of Harassment →</button>
      </div>
    `;
  } else if (s === 7) {
    // Types of sexual harassment — 4 categories
    const types = [
      {
        icon: '💬', color: 'rgba(21,255,200,.12)', borderColor: 'rgba(21,255,200,.3)',
        label: 'Verbal', items: ['Spreading rumors', 'Catcalls', 'Offensive jokes', 'Pressuring someone', 'Repeatedly asking someone on a date after they\'ve said no']
      },
      {
        icon: '📱', color: 'rgba(100,180,255,.10)', borderColor: 'rgba(100,180,255,.3)',
        label: 'Cyber', items: ['Posts on social media', 'Unwanted text messaging', 'Harassing emails', 'Sharing pictures without consent', 'Pressuring someone for nude photos']
      },
      {
        icon: '✋', color: 'rgba(255,160,100,.10)', borderColor: 'rgba(255,160,100,.3)',
        label: 'Physical', items: ['Unwanted touching or kissing', 'Following or stalking', 'Taking someone\'s picture without permission']
      },
      {
        icon: '🚫', color: 'rgba(200,80,255,.10)', borderColor: 'rgba(200,80,255,.3)',
        label: 'Nonverbal', items: ['Obscene gestures', 'Writing sexually explicit things about someone', 'Intimidating someone to not report']
      },
    ];
    innerHTML = `
      <div class="dsEyebrow">SEXUAL HARASSMENT</div>
      <div class="h1" style="margin-bottom:4px;">What does it look like?</div>
      <div class="p" style="font-size:13px;">Sexual harassment could be happening all around you. Do you know what it looks like?</div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px;">
        ${types.map(t => `
          <div style="border:1px solid ${t.borderColor}; background:${t.color}; border-radius:14px; padding:12px;">
            <div style="font-size:1.2rem; margin-bottom:4px;">${t.icon}</div>
            <div style="font-weight:900; font-size:13px; color:var(--sb-light); margin-bottom:6px;">${t.label}</div>
            <div style="font-size:11px; color:var(--muted); line-height:1.55;">
              ${t.items.map(i => `<div style="margin-bottom:2px;">• ${i}</div>`).join('')}
            </div>
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">What is Sexual Assault? →</button>
      </div>
    `;
  } else if (s === 8) {
    // Section header: Sexual Assault
    innerHTML = `
      <div style="text-align:center; padding:16px 0 24px;">
        <div style="font-size:2.2rem; margin-bottom:12px;">⚡</div>
        <div style="font-weight:900; font-size:22px; line-height:1.25; color:var(--sb-light);">
          What EXACTLY is<br><span style="position:relative; display:inline-block;">Sexual <span style="color:var(--sb-mint);">Assault</span>?<span style="position:absolute;left:0;bottom:-4px;width:100%;height:3px;background:var(--sb-mint);border-radius:2px;opacity:.6;"></span></span>
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">The Definition →</button>
      </div>
    `;
  } else if (s === 9) {
    // Sexual Assault definition
    innerHTML = `
      <div class="dsEyebrow">SEXUAL ASSAULT</div>
      <div class="h1" style="margin-bottom:16px;">The <span style="background:rgba(21,255,200,.25); border-radius:6px; padding:2px 6px;">Definition</span></div>
      <div class="p">
        Sexual assault refers to <b>sexual contact or behavior that occurs without explicit consent</b> of the person.
      </div>
      <div class="p">Some forms include:</div>
      <div style="display:flex; flex-direction:column; gap:6px; margin-top:4px;">
        ${['Attempted rape', 'Fondling or unwanted sexual touching', 'Forcing a victim to perform sexual acts such as oral sex', 'Penetrating a person\'s body without their explicit consent'].map(f => `
          <div style="display:flex; align-items:flex-start; gap:8px; font-size:13px; color:var(--muted); padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:rgba(255,255,255,.03);">
            <span style="color:var(--sb-mint); font-weight:900; flex-shrink:0;">→</span> ${f}
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Broader Scope →</button>
      </div>
    `;
  } else if (s === 10) {
    // Sexual Assault — broader term
    innerHTML = `
      <div class="dsEyebrow">SEXUAL ASSAULT</div>
      <div class="note" style="font-weight:900; font-size:15px; border-color:rgba(21,255,200,.5); color:var(--sb-light);">
        Sexual assault is used as an overall term for <em>any kind of sexual violence.</em>
      </div>
      <div class="p" style="margin-top:12px;">It can also include:</div>
      <div style="display:flex; flex-direction:column; gap:6px;">
        ${['Groping', 'Threats of sexual violence', 'Blackmail', 'Sexual bribes', 'Revenge porn', 'Coerced sex', 'Any sexual contact with someone incapable of consenting', 'Forced rape'].map(f => `
          <div style="display:flex; align-items:center; gap:8px; font-size:13px; color:var(--muted); padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:rgba(255,255,255,.03);">
            <span style="color:rgba(255,120,80,.85); font-weight:900; flex-shrink:0;">•</span> ${f}
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">What is Rape? →</button>
      </div>
    `;
  } else if (s === 11) {
    // Section header: Rape
    innerHTML = `
      <div style="text-align:center; padding:16px 0 24px;">
        <div style="font-size:2.2rem; margin-bottom:12px;">⚖️</div>
        <div style="font-weight:900; font-size:22px; line-height:1.25; color:var(--sb-light);">
          What EXACTLY is<br><span style="position:relative; display:inline-block;"><span style="color:var(--sb-mint);">Rape</span>?<span style="position:absolute;left:0;bottom:-4px;width:100%;height:3px;background:var(--sb-mint);border-radius:2px;opacity:.6;"></span></span>
        </div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">The Definition →</button>
      </div>
    `;
  } else if (s === 12) {
    // Rape definition
    innerHTML = `
      <div class="dsEyebrow">RAPE</div>
      <div class="h1" style="margin-bottom:16px;">The <span style="background:rgba(21,255,200,.25); border-radius:6px; padding:2px 6px;">Definition</span></div>
      <div class="p">
        Rape is a type of sexual violence involving <b>non-consensual penetration or touching</b>, no matter how slight, of the vagina or anus with <b>ANY body part OR object</b>, or oral penetration or touching of another person's genitalia, <b>without their consent</b>.
      </div>
      <div class="note" style="margin-top:10px; font-size:13px;">
        The law defines rape as sexual intercourse specifically. State laws differ about the specific details of what type of sex qualifies as rape vs. sexual assault.
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Legal History →</button>
      </div>
    `;
  } else if (s === 13) {
    // Rape — legal definitions & Celia's story
    innerHTML = `
      <div class="dsEyebrow">RAPE — LEGAL HISTORY</div>
      <div class="h1" style="margin-bottom:14px;">Legal Definitions of Rape</div>
      <div class="p" style="font-style:italic; font-size:13px; border-left:3px solid rgba(21,255,200,.5); padding-left:12px; color:var(--muted);">
        In 1855, a 19-year-old enslaved girl named Celia was raped repeatedly by her enslaver. One night, she fought back — and killed him.
      </div>
      <div class="p" style="margin-top:10px;">But instead of being protected, she was <b>sentenced to death</b>. Why? Because the court, in <em>Missouri v. Celia</em>, ruled that enslaved women didn't count as women under rape laws. They were considered property, not people.</div>
      <div class="dsStepList" style="margin-top:10px;">
        <div class="dsStep">
          <div class="dsStepNum" style="background:rgba(255,80,80,.15); border-color:rgba(255,80,80,.3); color:rgba(255,160,160,.9);">✕</div>
          <div class="dsStepText">Black women could be legally raped during slavery</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum" style="background:rgba(255,80,80,.15); border-color:rgba(255,80,80,.3); color:rgba(255,160,160,.9);">✕</div>
          <div class="dsStepText">Even self-defense didn't matter under these laws</div>
        </div>
        <div class="dsStep">
          <div class="dsStepNum" style="background:rgba(255,80,80,.15); border-color:rgba(255,80,80,.3); color:rgba(255,160,160,.9);">✕</div>
          <div class="dsStepText">The law protected white men — not Black girls like Celia</div>
        </div>
      </div>
      <div class="mutedBox" style="margin-top:10px;">Celia's story shows how the legal system was historically designed to allow violence against Black women. Recognizing this history is part of understanding sexual violence today.</div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">The Spectrum →</button>
      </div>
    `;
  } else if (s === 14) {
    // Continuum of sexual harm
    const cols = [
      {
        label: 'SEXUAL HARASSMENT', color: 'rgba(21,255,200,.12)', border: 'rgba(21,255,200,.35)',
        items: ['Offensive remarks about someone\'s sex', 'Sexual requests, pressure & threats of violence or intimate image sharing', 'Physical intimidation', 'Online harassment']
      },
      {
        label: 'SEXUAL ASSAULT', color: 'rgba(100,180,255,.10)', border: 'rgba(100,180,255,.35)',
        items: ['Unwanted sexual touching (kissing, fondling, groping)', 'Sexual blackmail', 'Bribed sexual actions', 'Sharing intimate images without consent', 'Forced sexual favors for job advancement']
      },
      {
        label: 'RAPE', color: 'rgba(255,100,100,.08)', border: 'rgba(255,100,100,.35)',
        items: ['Non-consensual penetration or touching of any kind', 'Oral touching of another person\'s sex organ', 'Sex with a person incapable of consent for any reason']
      },
    ];
    innerHTML = `
      <div class="dsEyebrow">CONTINUUM OF SEXUAL HARM</div>
      <div class="h1" style="margin-bottom:4px;">What's the Difference?</div>
      <div class="p" style="font-size:13px; margin-bottom:12px;">These three categories exist on a spectrum. All are serious. None are acceptable.</div>
      <div style="display:flex; flex-direction:column; gap:10px;">
        ${cols.map(c => `
          <div style="border:1px solid ${c.border}; background:${c.color}; border-radius:14px; padding:14px;">
            <div style="font-weight:900; font-size:12px; letter-spacing:.5px; text-transform:uppercase; color:var(--sb-light); margin-bottom:8px;">${c.label}</div>
            ${c.items.map(i => `
              <div style="font-size:12.5px; color:var(--muted); padding:4px 0; border-bottom:1px solid rgba(255,255,255,.05); line-height:1.4;">• ${i}</div>
            `).join('')}
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">All Experiences Are Valid →</button>
      </div>
    `;
  } else if (s === 15) {
    // Validity of all experiences
    innerHTML = `
      <div class="note" style="font-weight:900; font-size:16px; border-color:rgba(21,255,200,.6); color:var(--sb-light); text-align:center;">
        Any violation of another person's bodily autonomy is <em>unacceptable.</em>
      </div>
      <div class="p" style="margin-top:14px;">
        Survivors can often compare their experiences with others and <b>downplay what happened to them</b>. This is something we must work against.
      </div>
      <div class="p">
        <b>Each survivor's experience is valid and potentially traumatizing.</b> Just because other people have suffered in different ways does not diminish what happened to any survivor, nor does it excuse not holding perpetrators accountable because they could have done something "worse."
      </div>
      <div class="dsScriptBlock" style="margin-top:10px;">
        <div class="dsScriptLabel">💡 Remember</div>
        <div class="dsScriptText">You wouldn't be less sympathetic to someone who broke one leg just because they weren't in a full body cast. There doesn't have to be visible injuries for an assault or harassment to be extremely harmful. <b>Scars do not have to be on the outside.</b></div>
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Prevention →</button>
      </div>
    `;
  } else if (s === 16) {
    // Prevention actions
    const actions_list = [
      { icon: '🚫', text: "Don't pursue someone who isn't able to consent." },
      { icon: '👁️', text: "If you see someone pursuing a person who can't consent, intervene." },
      { icon: '🍺', text: "If you see someone under the influence, make sure they are safe." },
      { icon: '🆘', text: "If you see someone in an uncomfortable situation, distract the perpetrator or help them leave." },
      { icon: '📵', text: "Don't share intimate pictures without consent." },
      { icon: '💬', text: "Stand up if you see negative or harassing comments online." },
      { icon: '⚖️', text: "Don't judge others based on their sexual activity." },
      { icon: '💚', text: "Support survivors when they disclose to you." },
    ];
    innerHTML = `
      <div class="dsEyebrow">PREVENTION</div>
      <div class="h1" style="margin-bottom:8px;">Actions We Can Take</div>
      <div class="p" style="font-size:13px;">How can we prevent sexual harassment and assault at our schools and communities?</div>
      <div style="display:flex; flex-direction:column; gap:7px; margin-top:8px;">
        ${actions_list.map(a => `
          <div style="display:flex; align-items:flex-start; gap:10px; font-size:13px; color:var(--muted); padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(21,255,200,.04); line-height:1.45;">
            <span style="flex-shrink:0; font-size:1.1rem;">${a.icon}</span>
            <span>${a.text}</span>
          </div>
        `).join('')}
      </div>
      <div class="dsNavRow" style="margin-top:14px;">
        <button class="btn" data-sardaction="back">← Back</button>
        <button class="btn btnPrimary" data-sardaction="next">Knowledge Check →</button>
      </div>
    `;
  } else if (s === 17) {
    // Quiz
    const qi = sardState.quizIdx;
    const q = SARD_QUIZ[qi];
    const answered = sardState.quizAnswers[qi] !== undefined;
    const chosen = sardState.quizAnswers[qi];
    const isCorrect = chosen === q.correct;
    const isLast = qi === SARD_QUIZ.length - 1;

    const opts = q.options.map((opt, oi) => {
      let cls = 'btn myQuizOpt';
      if (answered) {
        if (oi === q.correct) cls += ' myQuizCorrect';
        else if (oi === chosen && !isCorrect) cls += ' myQuizWrong';
      }
      return `<button class="${cls}" data-sardquiz="${oi}" ${answered ? 'disabled' : ''}>${opt}</button>`;
    }).join('');

    const feedback = answered ? `
      <div class="note" style="border-color:${isCorrect ? 'rgba(21,255,200,.5)' : 'rgba(255,80,80,.5)'}; background:${isCorrect ? 'rgba(21,255,200,.08)' : 'rgba(255,80,80,.08)'}; margin-top:8px;">
        ${isCorrect ? '✅ Correct!' : '❌ Not quite.'} ${q.explain}
      </div>` : '';

    const nextBtn = answered
      ? (isLast
        ? `<button class="btn btnPrimary" data-sardaction="next" style="margin-top:10px;width:100%;">See Resources →</button>`
        : `<button class="btn btnPrimary" data-sardquiznext="1" style="margin-top:10px;width:100%;">Next Question →</button>`)
      : '';

    const prevBtn = qi > 0
      ? `<button class="btn" data-sardquizprev="1">← Previous Question</button>`
      : `<button class="btn" data-sardaction="back">← Back</button>`;

    innerHTML = `
      <div class="p"><b>Question ${qi + 1} of ${SARD_QUIZ.length}</b></div>
      <div class="note" style="background:rgba(255,255,255,.04); border-color:rgba(209,254,255,.25); font-size:15px; font-weight:800; color:var(--sb-light); margin-bottom:12px;">${q.q}</div>
      <div class="dsConsentGrid" style="gap:8px;">${opts}</div>
      ${feedback}
      ${nextBtn}
      <div class="dsNavRow" style="margin-top:12px;">
        ${prevBtn}
      </div>
    `;
  } else {
    // Resources
    const resList = SARD_RESOURCES.map(r => `
      <a class="dsResource" href="${r.url}" target="_blank" rel="noopener noreferrer">
        <span class="dsResourceIcon">${r.icon}</span>
        <span>
          <div class="dsResourceName">${r.name}</div>
          <div class="dsResourceDesc">${r.desc}</div>
        </span>
      </a>`).join('');
    innerHTML = `
      <div class="p">You've completed The Spectrum of Harm module.</div>
      <div class="mutedBox" style="margin-bottom:12px;">If you or someone you know has been affected by sexual violence, <b>you are not alone</b>. Reach out to one of these resources.</div>
      <div class="dsResourceList">${resList}</div>
      <div class="note" style="margin-top:12px; font-weight:800;">Remember: Any violation of another person's bodily autonomy is unacceptable — and every survivor's experience is valid.</div>
      <div class="dsNavRow" style="flex-direction:column;gap:8px;margin-top:14px;">
        <button class="btn btnPrimary" data-sardaction="restart" style="width:100%">Start this module over ↺</button>
        <button class="btn" data-action="nextSteps" style="width:100%">Back to Next Steps</button>
      </div>
    `;
  }

  screen.innerHTML = backBtn() + `
    <div class="dsHeader">
      <div class="dsEyebrow">BAE Check — Guided Module</div>
      <div class="h1">📖 The Spectrum of Harm</div>
      <div class="p" style="margin:0">Definitions, the continuum of sexual violence, and how to prevent it.</div>
    </div>
    <div class="dsProgress">${progressDots}</div>
    <div class="dsPanel">${innerHTML}</div>
  `;
  triggerTransition();

  // Nav
  screen.querySelectorAll('[data-sardaction]').forEach(el => {
    el.onclick = () => {
      const a = el.dataset.sardaction;
      if (a === 'next') {
        sardState.step = Math.min(SARD_STEPS.length - 1, sardState.step + 1);
        sardRender();
      } else if (a === 'back') {
        if (sardState.step === 0) {
          go('nextSteps');
        } else {
          sardState.step = Math.max(0, sardState.step - 1);
          sardRender();
        }
      } else if (a === 'restart') {
        sardState = { step: 0, quizIdx: 0, quizAnswers: {} };
        sardRender();
      }
    };
  });

  // Quiz answers
  screen.querySelectorAll('[data-sardquiz]').forEach(btn => {
    btn.onclick = () => {
      sardState.quizAnswers[sardState.quizIdx] = parseInt(btn.dataset.sardquiz);
      sardRender();
    };
  });
  screen.querySelectorAll('[data-sardquiznext]').forEach(btn => {
    btn.onclick = () => {
      sardState.quizIdx = Math.min(SARD_QUIZ.length - 1, sardState.quizIdx + 1);
      sardRender();
    };
  });
  screen.querySelectorAll('[data-sardquizprev]').forEach(btn => {
    btn.onclick = () => {
      sardState.quizIdx = Math.max(0, sardState.quizIdx - 1);
      sardRender();
    };
  });

  // Back to next steps from resources
  screen.querySelectorAll('[data-action="nextSteps"]').forEach(el => {
    el.onclick = () => go('nextSteps');
  });
}
</script>
</body>
</html>
